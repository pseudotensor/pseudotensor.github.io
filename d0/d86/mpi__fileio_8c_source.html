<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: mpi_fileio.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mpi_fileio.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d0/d86/mpi__fileio_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;decs.h&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keywordtype">void</span> mpiio_init(<span class="keywordtype">int</span> bintxt, <span class="keywordtype">int</span> sorted, FILE ** fpptr, <span class="keywordtype">long</span> headerbytesize, <span class="keywordtype">int</span> which, <span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> <a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>,</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                MPI_Datatype datatype, <span class="keywordtype">void</span> **jonioptr, <span class="keywordtype">void</span> **writebufptr)</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;{</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  logsfprintf(<span class="stringliteral">&quot;\nmpiio_init begin\n&quot;</span>);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="comment">// this check covers combine and seperate</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(!sorted){</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>){</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such thing as binary unsorted output\n&quot;</span>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      myexit(1);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// clean up prior call (internally handle mpicombinetype)</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"></span>  mpiio_final(bintxt, sorted, fpptr, headerbytesize, which, filename, numcolumns, datatype, jonioptr, writebufptr);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// Initialize new call</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a242111ff46bde86789e819eccbb97e69">mpicombinetype</a>==MPICOMBINEROMIO){</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    mpiioromio_init_combine(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a3a03c459718a3a0b20ff3872636b8617">INITROMIO</a>, which, headerbytesize, filename,numcolumns, datatype,writebufptr,(<span class="keywordtype">void</span>*)0x0);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    mpiios_init(bintxt, sorted, fpptr, which, headerbytesize, filename, numcolumns, datatype,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                jonioptr, writebufptr);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiio_init end\n&quot;</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keywordtype">void</span> mpiio_final(<span class="keywordtype">int</span> bintxt, <span class="keywordtype">int</span> sorted, FILE ** fpptr, <span class="keywordtype">long</span> headerbytesize, <span class="keywordtype">int</span> which, <span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> numcolumns,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                 MPI_Datatype datatype, <span class="keywordtype">void</span> **jonioptr, <span class="keywordtype">void</span> **writebufptr)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> priorinit=0;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">if</span>(priorinit){</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    logsfprintf(<span class="stringliteral">&quot;\nmpiio_final begin\n&quot;</span>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// &quot;true&quot; value same</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// doesn&#39;t use jonioptr or bintxt or sorted or fpptr</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// writebuf not set yet for combine or seperate, have to allocate at address writebufptr first.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// then assume previously wrote file that now needs to be fully ended before one can write another</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    mpiioromio_init_combine(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#adab978aded115a7ce2168927e056ff2f">WRITEENDROMIO</a>, which, headerbytesize, filename,numcolumns, datatype,writebufptr,*writebufptr);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiio_final end\n&quot;</span>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// priorinit indicates to *next call* of this function that mpiio_final(priorinit) should end/close/cleanup previously written file if was using ROMIO and writing in this call</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// otherwise assume file writing call was fully completed already before</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// below assumes mpicombinetype==truempicombinetype when doing ROMIO</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a242111ff46bde86789e819eccbb97e69">mpicombinetype</a>==MPICOMBINEROMIO &amp;&amp; which==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    priorinit=1;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">else</span> priorinit=0;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">// if numcolumns==-1, then separate finish of ROMIO call</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span>(numcolumns==-1) priorinit=0;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keywordtype">void</span> mpiio_combine(<span class="keywordtype">int</span> bintxt, <span class="keywordtype">int</span> sorted,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                   <span class="keywordtype">int</span> numcolumns, MPI_Datatype datatype,</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                   FILE ** fpptr, <span class="keywordtype">void</span> *jonio, <span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiio start combine\n&quot;</span>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a125da10d4f20cf53facb2a408fdc3f52">USEROMIO</a>){</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// doesn&#39;t use jonioptr or bintxt or sorted or fpptr</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// address not used, just value of writebuf</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// headerbytesize no longer needed</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    mpiioromio_init_combine(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ad18275c18442d214c5d593c553c08bd0">WRITECLOSEROMIO</a>, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>,  0, <span class="stringliteral">&quot;&quot;</span>, numcolumns, datatype,&amp;writebuf,writebuf);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINESIMPLE){</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">if</span> (sorted) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a83e18b4873b8b6552a9d0a2c900419c4">mpiios_combine</a>(bintxt, datatype, numcolumns,fpptr, jonio, writebuf);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a47aed413ab62346af7d9b11e25fdc9ca">mpiiotu_combine</a>(datatype, numcolumns, fpptr, writebuf);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINEMINMEM){</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      mpiiomin_final(numcolumns,fpptr, jonio, writebuf);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor"></span>  logsfprintf(<span class="stringliteral">&quot;mpiio end combine\n&quot;</span>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="code" href="../../d0/d86/mpi__fileio_8c.html#a0914c2c0a476f8416ab1c4c79fd528da">  146</a></span>&#160;<span class="preprocessor">#define DEBUGMINMEM 0</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keywordtype">void</span> mpiio_minmem(<span class="keywordtype">int</span> readwrite, <span class="keywordtype">int</span> whichdump, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> bintxt, <span class="keywordtype">int</span> sorted,</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                  <span class="keywordtype">int</span> numcolumns, MPI_Datatype datatype,</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                  FILE ** fp, <span class="keywordtype">void</span> *jonio, <span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * blinkptr;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * cpulinkptr;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> datasofar0,datasofarc0;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> done0=0;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> datagot;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> bfi;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sii,uii;<span class="comment">// sorted and unsorted index sometimes</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor"></span>  MPI_Request request;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  MPI_Request request0;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> joniooffset;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">void</span> *joniosubmit;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *jonio1;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">float</span> *jonio4;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">double</span> *jonio8;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *jonio16;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">int</span> *jonio4i;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *jonio8i;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> mapjoniosorted,mapjoniounsorted;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> datatoget0,datatogetc0,datasent0;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">int</span> doset;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">int</span> dofull;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">int</span> dolocal;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordtype">int</span> doing0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> gi,gj,gk;<span class="comment">//global i,j,k starting from first cpu reference and adding the sorted index</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> lastnum;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> masterdone;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> thisslavedone;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> mypos;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> short4char;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor"></span>  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0: i=%d j=%d k=%d\n&quot;</span>,i,j,k); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">if</span>(sorted==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a96d713e213dcfe22f6f8c69c46a4495e">UNSORTED</a>){</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Not setup to do unsorted with this method\n&quot;</span>);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    myexit(10001);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="comment">// very quickly determine whether at required point to begin read or write of data, or still busy with buffer.</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>((i==0)&amp;&amp;(j==0)&amp;&amp;(k==0)){</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// then first time here for this cpu for this dump</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    blinkptr=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20cfabf76fa7dff1137eeaf6508d6db3">blinkptr0</a>[whichdump];</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    datagot=0;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">if</span>(myid==0) masterdone=0;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    thisslavedone=0;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">if</span>(masterdone&amp;&amp;(myid==0)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span>(thisslavedone&amp;&amp;(myid!=0)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// i+1 since called inside loop before i++, but really has done i++ things</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    bfi=((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)k*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)j*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)(i+1))*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns; <span class="comment">// recall that we are always at col=0 since we always complete a column</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    bfi=((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)k*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)j*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>)*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span>(blinkptr==NULL) dolocal=0; <span class="comment">// end of local list</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// see if completed a single node in the list yet</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordflow">if</span>(bfi==((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)datagot+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>)) dolocal=1; <span class="comment">// at a completion point, need to send to cpu=0</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordflow">else</span>   dolocal=0; <span class="comment">// not yet completed</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="keywordflow">if</span>(bfi==(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)datagot) dolocal=1; <span class="comment">// at a completion point, need to recv from cpu=0</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">else</span>   dolocal=0; <span class="comment">// not yet completed</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="comment">// ANY CPU Send/Recv a buffer to cpu=0</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span>(dolocal){</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.5: %lld %lld %lld %d\n&quot;</span>,bfi,datagot+blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,dolocal); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor"></span>    <span class="comment">// We are ready to read or write from/to cpu=0</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.6\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// WRITEFILE, so other CPU sends to cpu=0</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"></span>    </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="comment">// means we have put what we want into writebuf, now send to cpu=0</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="preprocessor"></span>      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.65 : %lld %lld %d %d\n&quot;</span>,writebuf,blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,MPIid[0],myid); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor"></span>      <span class="comment">// must keep myid&gt;0 cpus stalled until cpu=0 needs their data</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="comment">// that is, Wait below continues if data copied out of buffer, but we want pseudo-blocking call here</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">if</span>(myid&gt;0) MPI_Issend(writebuf,blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,datatype,MPIid[0],myid, MPI_COMM_GRMHD,&amp;request);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">// can&#39;t stall cpu=0 since only below has recv, but ok since cpu=0 stuck below until cpu=0 data needed again</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">else</span> MPI_Isend(writebuf,blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,datatype,MPIid[0],myid, MPI_COMM_GRMHD,&amp;request);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor"></span>      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.66 : %lld\n&quot;</span>,writebuf); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor"></span>      <span class="comment">// adjust offset to keep standard writebuf BUFFERMAP format with just an offset (offset keeps true memory area always as written part)</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a296cee7f0ff69dbc37345c5f5ed8f0ed">bufferoffset</a> -= (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>;<span class="comment">// or =-(long long int)datagot+(long long int)blinkptr-&gt;num</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="comment">// READFILE, so other CPU recvs from cpu=0</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="comment">// means we need to fill writebuf with what cpu=0 will send us</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="comment">// recv&#39;s will Wait below until data is coming.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor"></span>      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.65 : %lld\n&quot;</span>,writebuf); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor"></span>      MPI_Irecv(writebuf,blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,datatype,MPIid[0],myid, MPI_COMM_GRMHD,&amp;request);      </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor"></span>      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.66 : %lld %lld\n&quot;</span>,writebuf,blinkptr); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../dd/d46/mpidefs_8h.html#a296cee7f0ff69dbc37345c5f5ed8f0ed">bufferoffset</a>=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(-datagot);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }<span class="comment">// end if READFILE</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    datagot += (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    lastnum = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// now iterate to next node in list</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    blinkptr=(blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a279c79caaa6d7945fc75adc1e1796506">np</a>);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.67 : %lld\n&quot;</span>,blinkptr); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(blinkptr==NULL){</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      thisslavedone=1;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="comment">// then done with list, check to see if everything adds up</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;         ((readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>)&amp;&amp;(-<a class="code" href="../../dd/d46/mpidefs_8h.html#a296cee7f0ff69dbc37345c5f5ed8f0ed">bufferoffset</a>!=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns))</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;         ||((readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>)&amp;&amp;(-<a class="code" href="../../dd/d46/mpidefs_8h.html#a296cee7f0ff69dbc37345c5f5ed8f0ed">bufferoffset</a>!=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns-(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)lastnum))</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;         )</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;local total doesn&#39;t equal expected value\n got=%d demand=%d\n&quot;</span>,-<a class="code" href="../../dd/d46/mpidefs_8h.html#a296cee7f0ff69dbc37345c5f5ed8f0ed">bufferoffset</a>,(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;          myexit(10002);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 0.7\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor"></span>  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here .8\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">// for cpu=0, don&#39;t wait on local send/recv since cpu=0 needs to setup it&#39;s receives first (since cpu=0 sends to itself)</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// only do this if cpu=0 is just done with local data send/recv(i.e. dolocal==1) or cpu=0 is done (done0==1)</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// no way to decouple cpu=0 local from master, so master waits for local</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// first time hit, get initial node in list and reset counters</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span>((i==0)&amp;&amp;(j==0)&amp;&amp;(k==0)){</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      cpulinkptr=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a6a3789bd7a20d972bc209e81ea783878">cpulinkptr0</a>[whichdump];</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      datasofar0=0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      datasofarc0=0;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">// check to see if done with cpu=0 data (we use cpu=0 to continue grabbing data as needed)</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// wait until all data is grabbed from cpu=0 to send to disk before holding up here.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span>((myid==0)&amp;&amp;(bfi==(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns)){</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      done0=1;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">else</span> done0=0;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// wait until last read done.  Still can&#39;t use writebuf since will do last local cpu=0 assignment using writebuf after done with distribution of rest of data using cpu=0 to other cpus</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span>((myid==0)&amp;&amp;(thisslavedone)){</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      done0=1; <span class="comment">// then will be done after final read and grab for cpu=0 (then cpu=0&#39;s writebuf will be written to after all cpus done)</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">else</span> done0=0;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">// CPU==0 stuff</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordflow">if</span>((myid==0)&amp;&amp;((dolocal==1)||(done0==1))){</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">// We are ready to read or write from/to other cpus</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) jonio1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) jonio;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) jonio4 = (<span class="keywordtype">float</span> *) jonio;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) jonio8 = (<span class="keywordtype">double</span> *) jonio;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) jonio16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) jonio;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) jonio4i = (<span class="keywordtype">int</span> *) jonio;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) jonio8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) jonio;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// we need to loop over list until hit a marked end-cpu.  This will give us a chunk of data to sort for direct output</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// this is the offset to the sorted part of jonio</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    joniooffset=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#a21c62ebc3c9b9268b15e0ea4f7fff91b">joniosize</a>/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)2);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 2: joniooffset=%lld\n&quot;</span>,joniooffset); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// WRITEFILE</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      dofull=1;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordflow">while</span>(dofull){</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="preprocessor"></span>        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="comment">// determine amount of data to get from cpu group</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="comment">// limit the amount of data once doing last grab</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)datasofar0+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a21c62ebc3c9b9268b15e0ea4f7fff91b">joniosize</a>/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)2)&gt;(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns) datatogetc0=-(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)datasofar0+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">else</span> datatogetc0=<a class="code" href="../../dd/d46/mpidefs_8h.html#a21c62ebc3c9b9268b15e0ea4f7fff91b">joniosize</a>/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)2);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="comment">// new amount of data (that will be read total)</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        datasofarc0 += (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)datatogetc0;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        doset=1;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        doing0=0;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="comment">// every receieved dataset is kept in first half of jonio from start of jonio, sorted, then next data set received.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        datatoget0=0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">while</span>(doset){</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.4 : cpu=%d: datasofar0=%lld  datasofarc0=%lld\n&quot;</span>,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>,datasofar0,datasofarc0); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="preprocessor"></span>          datatoget0 += (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          <span class="keywordflow">if</span>(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>==0) doing0=1;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.5: %lld %d %d\n&quot;</span>,jonio,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.51: %lld %lld %lld %lld\n&quot;</span>,datatogetc0,<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1],<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2],<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="preprocessor"></span>          MPI_Irecv(jonio,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,datatype,MPIid[cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>],cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>,MPI_COMM_GRMHD,&amp;request0);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.515\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="preprocessor"></span>          <span class="comment">// have myid wait before continuing to make sure receive is complete</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;          MPI_Wait(&amp;request0,&amp;mpichstatus);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          <span class="comment">// easiest algorithm/mapping is done using loop over full sorted size, reduced per cpu by if statement and checked</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;          <span class="comment">//   for(sii=0;sii&lt;cpulinkptr-&gt;num;sii++){</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.52: datatogetc0=%lld\n&quot;</span>,datatogetc0); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.54: %d %d %d\n&quot;</span>,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a0d5d59cde1e1a32793842646ee151eec">ri</a>,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a94cb4a5d42be74aa7c7819b7aea01883">rj</a>,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#aafb5230213b571837d2ca73dbdd83388">rk</a>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;          <span class="comment">// repeat this loop until really get all of datatogetc0 from (multiple) CPUs</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;          <span class="comment">// The if(gi,gj,gk) below constrains the filling of jonio so that fills in global array with required data into correct array positions</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          uii=0;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;          <span class="keywordflow">for</span>(sii=0;sii&lt;datatogetc0;sii++){</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="comment">// uii: iteration count for accessing memory from received data</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="comment">// sii: iteration count for accessing (with joniooffset) where to store some of received data</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="comment">// ri : starting global (over all CPUs) i-location</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="comment">// rj : &quot;&quot; for j-location</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="comment">// rk : &quot;&quot; for k-location</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="comment">// sii : sorted index that iterates to include column data</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="comment">// mypos: number of grid positions (not including columns) iterated beyond starting (ri,rj,rk) position</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="comment">// gi : global (over all CPUs) i-location</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="comment">// gj : &quot;&quot; for j-location</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="comment">// gk : &quot;&quot; for k-location</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            mypos=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(sii/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns)) + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a0d5d59cde1e1a32793842646ee151eec">ri</a>) + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a94cb4a5d42be74aa7c7819b7aea01883">rj</a>)*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#aafb5230213b571837d2ca73dbdd83388">rk</a>)*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2];</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            gi=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)mypos%((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            gj=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)((mypos%((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]))/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]));</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            gk=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(mypos/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]));</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor"></span>            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.55: sii=%lld mypos=%lld  gi=%lld gj=%lld gk=%lld\n&quot;</span>,sii, mypos, gi,gj,gk); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;               (gi&gt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[1][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;               (gi&lt;=  <a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[1][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;               (gj&gt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[2][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;               (gj&lt;=  <a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[2][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;               (gk&gt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[3][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;               (gk&lt;=  <a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[3][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;               ){</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor"></span>              dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.56: did assign: sii=%lld joniooffset=%lld uii=%lld\n&quot;</span>,sii,joniooffset,uii); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;              <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) jonio1[sii+joniooffset]=jonio1[uii++];</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) jonio4[sii+joniooffset]=jonio4[uii++];</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) jonio8[sii+joniooffset]=jonio8[uii++];</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) jonio16[sii+joniooffset]=jonio16[uii++];</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) jonio4i[sii+joniooffset]=jonio4i[uii++];</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) jonio8i[sii+joniooffset]=jonio8i[uii++];</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          }<span class="comment">// end over sii</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 3.6\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;          <span class="comment">// check!</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;          <span class="comment">// see if local data total is as expected</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment"></span>          <span class="keywordflow">if</span>(uii!=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>)){</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;uii and num for this cpu not same, algorithm failure: uii=%d num=%d datatogetc0=%d\n&quot;</span>,uii,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,datatogetc0);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            myexit(10003);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;          }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;          <span class="keywordflow">if</span>(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a2cc61bb19195c7b9a2c4cc5f03705ed6">end</a>) doset=0;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;          cpulinkptr=cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a279c79caaa6d7945fc75adc1e1796506">np</a>;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        }<span class="comment">// end while(doset)</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="comment">// see if total data is as expected</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        datasofar0 += (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)datatoget0; <span class="comment">// diagnostic</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)datasofar0 != (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)datasofarc0){</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;cumulative data received via MPI and expected data is different: got=%d expected=%d\n&quot;</span>,datasofar0,datasofarc0);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          myexit(10004);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">// now take sorted part and write it to disk</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="comment">// now write out collected data using CPU=0</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">// write data to file</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment"></span>        <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) joniosubmit=(<span class="keywordtype">void</span>*) (jonio1+joniooffset);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) joniosubmit=(<span class="keywordtype">void</span>*) (jonio4+joniooffset);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) joniosubmit=(<span class="keywordtype">void</span>*) (jonio8+joniooffset);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) joniosubmit=(<span class="keywordtype">void</span>*) (jonio16+joniooffset);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) joniosubmit=(<span class="keywordtype">void</span>*) (jonio4i+joniooffset);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) joniosubmit=(<span class="keywordtype">void</span>*) (jonio8i+joniooffset);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>){</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          <span class="keywordflow">if</span>(numfiles==1) fwrite(joniosubmit, sizeofdatatype,datatoget0, *fp);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="keywordflow">for</span>(sii=0;sii&lt;datatoget0;sii++){</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;              <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) fwrite(&amp;jonio1[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fwrite(&amp;jonio4[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fwrite(&amp;jonio8[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fwrite(&amp;jonio16[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fwrite(&amp;jonio4i[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fwrite(&amp;jonio8i[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>){ <span class="comment">// properly ordered, so just dump it</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          <span class="keywordflow">for</span>(sii=0;sii&lt;datatoget0;sii++){</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;%c&quot;</span>,jonio1[sii+joniooffset]);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;%15.7g&quot;</span>,jonio4[sii+joniooffset]);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;%21.15g&quot;</span>,jonio8[sii+joniooffset]);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;%31.25Lg&quot;</span>,jonio16[sii+joniooffset]);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;%d&quot;</span>,jonio4i[sii+joniooffset]);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;%lld&quot;</span>,jonio8i[sii+joniooffset]);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <span class="keywordflow">if</span>(numfiles==1){</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;              <span class="keywordflow">if</span>((sii+1)%numcolumns) fprintf(fp[sii%numfiles],<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;              <span class="keywordflow">else</span> fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">else</span> fprintf(fp[sii%numfiles],<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">if</span>((done0==0)&amp;&amp;(doing0==1)) dofull=0; <span class="comment">// cpu==0 still needs to deal with it&#39;s own data</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="comment">// if wasn&#39;t locally doing cpu=0 by master, then can&#39;t exit yet, continue till cpu=0 local data needed by master</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">if</span>(cpulinkptr==NULL){</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          dofull=0; <span class="comment">// end of list</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          masterdone=1;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          <span class="keywordflow">if</span>(datasofar0 != (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns){</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;write: total data written not equal to expected amount: wrote=%lld expected=%lld\n&quot;</span>,datasofar0,(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            myexit(10005);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="comment">// otherwise continue</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(readwrite==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="comment">// READFILE</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      dofull=1;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">while</span>(dofull){</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="preprocessor"></span>        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 4\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="preprocessor"></span>        <span class="comment">// we read data into 2nd half of jonio (sorted part), then desort for one cpu, then continue for next cpu </span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="comment">// determine amount of data to get from file</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">// limit the amount of data once doing last grab</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">if</span>(datasofar0+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a21c62ebc3c9b9268b15e0ea4f7fff91b">joniosize</a>/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)2) &gt; (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns) datatogetc0 = -(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)datasofar0 + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">else</span> datatogetc0=<a class="code" href="../../dd/d46/mpidefs_8h.html#a21c62ebc3c9b9268b15e0ea4f7fff91b">joniosize</a>/2;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="comment">// new amount of data (that will be read total)</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        datasofarc0+=datatogetc0;      </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="preprocessor"></span>        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here1 : %lld %lld\n&quot;</span>,datatogetc0,datasofarc0); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="comment">// get data from file</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) joniosubmit=(<span class="keywordtype">void</span>*) (jonio1+joniooffset);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) joniosubmit=(<span class="keywordtype">void</span>*) (jonio4+joniooffset);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) joniosubmit=(<span class="keywordtype">void</span>*) (jonio8+joniooffset);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) joniosubmit=(<span class="keywordtype">void</span>*) (jonio16+joniooffset);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) joniosubmit=(<span class="keywordtype">void</span>*) (jonio4i+joniooffset);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) joniosubmit=(<span class="keywordtype">void</span>*) (jonio8i+joniooffset);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>){</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;          <span class="comment">// first let cpu=0 read data</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;          <span class="keywordflow">if</span>(numfiles==1) fread(joniosubmit, sizeofdatatype,datatogetc0,*fp);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">for</span>(sii=0;sii&lt;datatoget0;sii++){</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;              <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) fread(&amp;jonio1[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fread(&amp;jonio4[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fread(&amp;jonio8[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fread(&amp;jonio16[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fread(&amp;jonio4i[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fread(&amp;jonio8i[sii+joniooffset], sizeofdatatype,1, fp[sii%numfiles]);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>){ <span class="comment">// properly ordered, so just grab it</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;          <span class="keywordflow">for</span>(sii=0;sii&lt;datatogetc0;sii++){</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR){</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;              fscanf(fp[sii%numfiles],<span class="stringliteral">&quot;%hu&quot;</span>,&amp;short4char);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;              jonio1[sii+joniooffset]=short4char; <span class="comment">// convert to unsigned char</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fscanf(fp[sii%numfiles],<span class="stringliteral">&quot;%f&quot;</span>,&amp;jonio4[sii+joniooffset]);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fscanf(fp[sii%numfiles],<span class="stringliteral">&quot;%lf&quot;</span>,&amp;jonio8[sii+joniooffset]);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fscanf(fp[sii%numfiles],<span class="stringliteral">&quot;%Lf&quot;</span>,&amp;jonio16[sii+joniooffset]);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fscanf(fp[sii%numfiles],<span class="stringliteral">&quot;%d&quot;</span>,&amp;jonio4i[sii+joniooffset]);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fscanf(fp[sii%numfiles],<span class="stringliteral">&quot;%lld&quot;</span>,&amp;jonio8i[sii+joniooffset]);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        }<span class="comment">// end if TEXTOUTPUT</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="preprocessor"></span>        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here2\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="comment">// send data to other cpus (while(doset))</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="comment">// now that data is read into 2nd half of jonio, need to desort data into 1st half per cpu in a loop</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        datasent0=0;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        datatoget0=0;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        doset=1;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        doing0=0;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">while</span>(doset){</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 2.4\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;          <span class="keywordflow">if</span>(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>==0) doing0=1;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          datatoget0 += (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;          <span class="comment">// copy from 2nd half of jonio to first half the node cpu&#39;s data</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          uii=0;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          <span class="keywordflow">for</span>(sii=0;sii&lt;datatogetc0;sii++){</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="preprocessor"></span>            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here2.5: %lld\n&quot;</span>,sii); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            mypos=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sii/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns)) + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a0d5d59cde1e1a32793842646ee151eec">ri</a>) + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a94cb4a5d42be74aa7c7819b7aea01883">rj</a>)*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] + ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#aafb5230213b571837d2ca73dbdd83388">rk</a>)*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2];</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            gi=((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)mypos)%((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            gj=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)((((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)mypos)%((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)totalsize[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)totalsize[2]))/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)totalsize[1]));</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            gk=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)mypos)/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)totalsize[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)totalsize[2]));</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="preprocessor"></span>            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here2.6: %lld %lld\n&quot;</span>,gi,gj); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;               (gi&gt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[1][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;               (gi&lt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[1][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;               (gj&gt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[2][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;               (gj&lt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[2][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;               (gk&gt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[3][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])&amp;&amp;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;               (gk&lt;=<a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[3][cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>])</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;               ){</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="preprocessor"></span>              dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here2.7 %lld\n&quot;</span>,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;              <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) jonio1[uii++]=jonio1[sii+joniooffset];</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) jonio4[uii++]=jonio4[sii+joniooffset];</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) jonio8[uii++]=jonio8[sii+joniooffset];</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) jonio16[uii++]=jonio16[sii+joniooffset];</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) jonio4i[uii++]=jonio16[sii+joniooffset];</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) jonio8i[uii++]=jonio16[sii+joniooffset];</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            }<span class="comment">// end if within this CPUs data</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          }<span class="comment">// end over sii</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here3\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          <span class="comment">// check!</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          <span class="keywordflow">if</span>(uii != (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>)){</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;uii and num for this cpu not same, algorithm failure: uii=%d num=%d datatogetc0=%d\n&quot;</span>,uii,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,datatogetc0);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            myexit(10006);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;          }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here4\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);   </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="preprocessor"></span>          <span class="comment">// jonio is the unsorted bit here starting at index=0 (for all cpus)</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          MPI_Isend(jonio,cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>,datatype,MPIid[cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>],cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>,MPI_COMM_GRMHD,&amp;request0);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;          <span class="comment">// have myid wait before continuing to make sure receive is complete</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          <span class="comment">// alternative is to have many sends, but then need to desort all at once which isn&#39;t easy since cycling through link list one at a time only once (could store starter pointer, etc.)</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;          MPI_Wait(&amp;request0,&amp;mpichstatus);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          datasent0 += (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>); <span class="comment">// diagnostic</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;          <span class="keywordflow">if</span>(cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a2cc61bb19195c7b9a2c4cc5f03705ed6">end</a>) doset=0;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          cpulinkptr=cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a279c79caaa6d7945fc75adc1e1796506">np</a>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="preprocessor"></span>          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here5\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);   </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        }<span class="comment">// end while doset</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="comment">// check to see if total data is correct</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor"></span>        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here6\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);   </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        datasofar0 += (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)datatoget0; <span class="comment">// diagnostic</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)datasofar0 != (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)datasofarc0){</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;cumulative data received via MPI and expected data is different: got=%d expected=%d\n&quot;</span>,datasofar0,datasofarc0);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          myexit(10007);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)datasent0 != (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)datatoget0){</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;data sent doesn&#39;t match data read\n&quot;</span>);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;          myexit(10008);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordflow">if</span>((done0==0)&amp;&amp;(doing0==1)) dofull=0; <span class="comment">// cpu==0 still needs to deal with more reads for it&#39;s own data</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span>(cpulinkptr==NULL){</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          masterdone=1; <span class="comment">// i.e. don&#39;t come back</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;          dofull=0; <span class="comment">// end of list</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;          <span class="keywordflow">if</span>(datasofar0 != (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns){</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;read: total data written not equal to expected amount: wrote=%lld expected=%lld\n&quot;</span>,datasofar0,(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            myexit(10009);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;          }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        }<span class="comment">// end if NULL</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="comment">// otherwise continue</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="preprocessor"></span>        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here7\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);   </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      }<span class="comment">// end while dofull</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor"></span>      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here8\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);   </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    }<span class="comment">// end if READFILE</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  }<span class="comment">// end if myid==0 &amp;&amp; ((dolocal==0)||(doone==1))</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="preprocessor"></span>  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here 6\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="comment">// have myid wait before continuing so buffer can be released for more writing to</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">if</span>(dolocal) MPI_Wait(&amp;request,&amp;mpichstatus); <span class="comment">// myid==0 handled specially since also master, and can&#39;t wait, even if master done first in this function, since master may not require cpu=0 at all for its current node set </span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">//  logsfprintf(&quot;end mpiminmem_read\n&quot;);</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="preprocessor"></span>  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;got here9\n&quot;</span>); fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);   </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="keywordtype">void</span> mpiio_seperate(<span class="keywordtype">int</span> bintxt, <span class="keywordtype">int</span> sorted, <span class="keywordtype">int</span> stage,</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                    <span class="keywordtype">int</span> numcolumns, MPI_Datatype datatype,</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                    FILE ** fpptr, <span class="keywordtype">void</span> *jonio, <span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;{</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiio begin seperate\n&quot;</span>);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINEROMIO){</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// doesn&#39;t use jonioptr or bintxt or sorted</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">// headerbytesize no longer needed</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">if</span>(stage==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aaeeaa5570d0e43c90dd234b0254282e3">STAGE1</a>) mpiioromio_init_combine(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a87c1ed6ac8570d8269f37f511e98bcff">READROMIO</a>, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>,  0, <span class="stringliteral">&quot;&quot;</span>, numcolumns, datatype,&amp;writebuf,writebuf);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span>(stage==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a5b294b2a38519989044561129393a5c3">STAGE2</a>) mpiioromio_init_combine(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a3b39ba900b458cdb0985590b55a0ca0c">READFREEROMIO</a>, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>,  0, <span class="stringliteral">&quot;&quot;</span>, numcolumns, datatype,&amp;writebuf,writebuf);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINESIMPLE){</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="keywordflow">if</span>(sorted){</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#ad8ad9ab872473222640c636bde25e6db">mpiios_seperate</a>(bintxt, stage, datatype, numcolumns, fpptr, jonio, writebuf);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a750d9a32046c6604cda5ea418d6a3ce4">mpiiotu_seperate</a>(stage, datatype, numcolumns, fpptr, writebuf);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINEMINMEM){</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="comment">// do nothing on STAGE1</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordflow">if</span>(stage==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a5b294b2a38519989044561129393a5c3">STAGE2</a>) mpiiomin_final(numcolumns,fpptr, jonio, writebuf);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="preprocessor"></span>  logsfprintf(<span class="stringliteral">&quot;mpiio end seperate\n&quot;</span>);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordtype">void</span> mpiioromio_init_combine(<span class="keywordtype">int</span> operationtype, <span class="keywordtype">int</span> which,  <span class="keywordtype">long</span> headerbytesize, <span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> numcolumns,MPI_Datatype datatype, <span class="keywordtype">void</span> **writebufptr,<span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;{</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeofmemory;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> **writebuf16;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> **writebuf8;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> **writebuf4;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **writebuf1;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> **writebuf4i;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> **writebuf8i;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> romiocolumns;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> realfilename[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0947c0a3d28c188caa4497cce08539c9" title="maximum char size of filenames or directories or commands">MAXFILENAME</a>];</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="preprocessor">#if(USEMPI&amp;&amp;USEROMIO)</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor"></span>  <span class="keyword">static</span> MPI_Datatype newtype;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keyword">static</span> MPI_File fh;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keyword">static</span> MPI_Status status;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keyword">static</span> MPI_Request request;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">int</span> ndims, array_of_gsizes[4], array_of_distribs[4];</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> order, len;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> array_of_dargs[4], array_of_psizes[4];</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> bufcount, array_size;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordflow">if</span>(operationtype==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a3a03c459718a3a0b20ff3872636b8617">INITROMIO</a>){</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_init begin\n&quot;</span>);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="comment">// set dimensionality</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">// see if splitting into individual columns</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      romiocolumns=1;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      numfiles=1;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      romiocolumns=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor">#if(USEMPI&amp;&amp;USEROMIO)</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>((<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>==3)&amp;&amp;(romiocolumns&gt;1)){</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="comment">//create the distributed array filetype</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="comment">// this still works if any reduced dimensionality</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      ndims = 4;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      order = MPI_ORDER_C;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      array_of_gsizes[3] = romiocolumns;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      array_of_gsizes[2] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1];</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      array_of_gsizes[1] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2];</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      array_of_gsizes[0] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3];</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)romiocolumns*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      array_of_distribs[3] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      array_of_distribs[2] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      array_of_distribs[1] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      array_of_distribs[0] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      array_of_dargs[3] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      array_of_dargs[2] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      array_of_dargs[1] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      array_of_dargs[0] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      array_of_psizes[3]=1;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      array_of_psizes[2]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      array_of_psizes[1]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      array_of_psizes[0]=<a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>==2)&amp;&amp;(romiocolumns&gt;1)){</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="comment">//create the distributed array filetype</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      ndims = 3;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      order = MPI_ORDER_C;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      array_of_gsizes[2] = romiocolumns;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      array_of_gsizes[1] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1];</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      array_of_gsizes[0] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2];</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)romiocolumns*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      array_of_distribs[2] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      array_of_distribs[1] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      array_of_distribs[0] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      array_of_dargs[2] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      array_of_dargs[1] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      array_of_dargs[0] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      array_of_psizes[2]=1;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      array_of_psizes[1]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      array_of_psizes[0]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>==1)&amp;&amp;(romiocolumns&gt;1)){</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">//create the distributed array filetype</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      ndims = 1;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      order = MPI_ORDER_C;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      array_of_gsizes[1] = romiocolumns;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      array_of_gsizes[0] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1];</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)romiocolumns*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      array_of_distribs[1] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      array_of_distribs[0] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      array_of_dargs[1] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      array_of_dargs[0] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      array_of_psizes[1]=1;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      array_of_psizes[0]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>==3)&amp;&amp;(romiocolumns==1)){</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="comment">//create the distributed array filetype</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="comment">// this still works if any reduced dimensionality</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      ndims=3;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      order = MPI_ORDER_C;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      array_of_gsizes[2] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1];</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      array_of_gsizes[1] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2];</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      array_of_gsizes[0] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3];</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      array_of_distribs[2] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      array_of_distribs[1] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      array_of_distribs[0] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      array_of_dargs[2] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      array_of_dargs[1] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      array_of_dargs[0] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      array_of_psizes[2]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      array_of_psizes[1]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      array_of_psizes[0]=<a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">else</span>  <span class="keywordflow">if</span>((<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>==2)&amp;&amp;(romiocolumns==1)){</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="comment">//create the distributed array filetype</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      ndims=2;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      order = MPI_ORDER_C;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      array_of_gsizes[1] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1];</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      array_of_gsizes[0] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2];</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      array_of_distribs[1] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      array_of_distribs[0] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      array_of_dargs[1] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      array_of_dargs[0] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      array_of_psizes[1]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      array_of_psizes[0]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">else</span>  <span class="keywordflow">if</span>((<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>==1)&amp;&amp;(romiocolumns==1)){</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="comment">//create the distributed array filetype</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      ndims=1;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      order = MPI_ORDER_C;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      array_of_gsizes[0] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1];</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      array_of_distribs[0] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      array_of_dargs[0] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      array_of_psizes[0]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(romiocolumns==0){</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="comment">// write nothing actually</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      ndims=1;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      order = MPI_ORDER_C;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      array_of_gsizes[0] = 1;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      sizeofmemory = 0; <span class="comment">// 1*(long long int)sizeofdatatype;</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      array_of_distribs[0] = MPI_DISTRIBUTE_BLOCK;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      </div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      array_of_dargs[0] = MPI_DISTRIBUTE_DFLT_DARG;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      array_of_psizes[0]=1;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Shouldn&#39;t reach to end of ROMIO selection\n&quot;</span>);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      myexit(17872);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="preprocessor"></span>      </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">// initialize filename</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="comment">// must be same filename as in dump_gen() when opening files here, so header is included at top of the dump</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>&amp;&amp;(numcolumns&gt;1)){</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      sprintf(realfilename,<span class="stringliteral">&quot;%s-col%04d&quot;</span>,filename,<a class="code" href="../../dd/d46/mpidefs_8h.html#aa9fcdffa2d4ab0089eeb6a8bd3c6f8e3">romiocoliter</a>);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordflow">else</span> strcpy(realfilename,filename);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;     </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">// initialize grid and file handler for ROMIO</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="preprocessor">#if(USEMPI&amp;&amp;USEROMIO)</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="preprocessor"></span>    <span class="comment">// NOT using mapping MPIid[myid] below.  Using GRMHD layout rank &quot;myid&quot; that ensures that ROMIO writes correctly spatially no matter what MPI rank is.</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    MPI_Type_create_darray(<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>, myid, ndims, array_of_gsizes, </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                           array_of_distribs, array_of_dargs,</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                           array_of_psizes, order, datatype, &amp;newtype);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    MPI_Type_commit(&amp;newtype);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="preprocessor"></span>    MPI_Type_size(newtype, &amp;bufcount); <span class="comment">// ULTRASUPERGODMARK: bufcount is int limited to 2GB, while should be allowed to be larger.  Couldn&#39;t find info online about how to fix this and suggestions that 2GB is max buffer size of any MPI communication!  That&#39;s stupid, since ruins ROMIO ability.</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    sizeofmemory=bufcount; <span class="comment">//includes type</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    bufcount = bufcount/sizeofdatatype; <span class="comment">// number of elements of type</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">// could avoid use of MPI_Type_size() and set sizeofmemory and bufcount directly, but still bufcount must be integer when used in MPI functions below, so only helps by sizeofdatatype in size</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="preprocessor"></span>    <span class="comment">// then sizeofmemory already set</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    bufcount=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofmemory/(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// fail if MPI functions below can&#39;t handle buffer size</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">if</span>((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)romiocolumns*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype&gt;=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(2L*1024L*1024L*1024L) &amp;&amp; <span class="keyword">sizeof</span>(int)&lt;=4){</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;JCM couldn&#39;t figure out how to modify ROMIO so would work when sizeof(int)==4 and buffer size is &gt;2GB\n&quot;</span>);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      myexit(867546243);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="comment">// setup file handler</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="comment">// setup to append, in case wanted binary header at front</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">if</span>(which==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      MPI_File_open(MPI_COMM_GRMHD, realfilename, MPI_MODE_APPEND | MPI_MODE_RDWR, MPI_INFO_NULL, &amp;fh);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(which==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      MPI_File_open(MPI_COMM_GRMHD, realfilename, MPI_MODE_RDONLY , MPI_INFO_NULL, &amp;fh);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="comment">// this sets the distributed nature of the file writing</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">// http://www.mpi-forum.org/docs/mpi-20-html/node198.htm#Node198 : &quot;naive&quot; &quot;internal&quot; &quot;external32&quot;</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="comment">// GODMARK: rather than &quot;native&quot; can use MPI_Register_datarep() to create a conversion between &quot;native&quot; and other types for reading/writing</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">// but apparently can&#39;t produce formatted text output</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="comment">// MPI_Datarep_conversion_function() used too</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// http://www.mpi-forum.org/docs/mpi-20-html/node201.htm#Node201</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">// Note that for 64-bit  machines &quot;native&quot; and &quot;external32&quot; are not compatible</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="comment">// GODMARK: For now use &quot;native&quot; since &quot;external32&quot; not supported even as of 07/21/08 by MPICH2 or OpenMPI</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    MPI_File_set_view(fh, headerbytesize, datatype, newtype, <span class="stringliteral">&quot;native&quot;</span>, MPI_INFO_NULL);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">// now use &quot;external32&quot; so files are exactly well-defined for any system as in:</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="comment">// http://parallel.ru/docs/Parallel/mpi2/node200.html#Node200</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="comment">// perhaps my bin2txt program should use these MPI types too</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">// GODMARK: Avoid the below good feature since not supported in general</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="comment">//    MPI_File_set_view(fh, headerbytesize, datatype, newtype, &quot;external32&quot;, MPI_INFO_NULL);</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="comment">// all that needs to be done now is initialize and later fill writebuf with the data</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">// allocate memory for writebuf</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;   </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    </div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordflow">if</span>(datatype==MPI_UNSIGNED_CHAR){ writebuf1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **)writebufptr; }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_FLOAT){  writebuf4=(<span class="keywordtype">float</span> **)writebufptr; }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_DOUBLE){  writebuf8=(<span class="keywordtype">double</span>**)writebufptr; }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_DOUBLE){  writebuf16=(<span class="keywordtype">long</span> <span class="keywordtype">double</span>**)writebufptr; }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_INT){  writebuf4i=(<span class="keywordtype">int</span> **)writebufptr; }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_LONG_INT){  writebuf8i=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> **)writebufptr; }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span>(datatype==MPI_UNSIGNED_CHAR) *writebuf1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_FLOAT) *writebuf4=(<span class="keywordtype">float</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_DOUBLE) *writebuf8 =(<span class="keywordtype">double</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_DOUBLE) *writebuf16 =(<span class="keywordtype">long</span> <span class="keywordtype">double</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_INT) *writebuf4i=(<span class="keywordtype">int</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_LONG_INT) *writebuf8i=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;       ((datatype==MPI_UNSIGNED_CHAR)&amp;&amp;(*writebuf1 == NULL)) ||</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;       ((datatype==MPI_FLOAT)&amp;&amp;(*writebuf4 == NULL)) ||</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;       ((datatype==MPI_DOUBLE)&amp;&amp;(*writebuf8 == NULL)) ||</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;       ((datatype==MPI_LONG_DOUBLE)&amp;&amp;(*writebuf16 == NULL)) ||</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;       ((datatype==MPI_INT)&amp;&amp;(*writebuf4i == NULL)) ||</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;       ((datatype==MPI_LONG_LONG_INT)&amp;&amp;(*writebuf8i == NULL)) </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;       ){</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Can&#39;t initialize writebuf memory for mpiioromio\n&quot;</span>);</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      myexit(10010);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    }</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_init end\n&quot;</span>);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  }<span class="comment">// end if operationtype==INITROMIO</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="comment">// ROMIO examples</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="comment">// http://www.sesp.cse.clrc.ac.uk/Publications/paraio/paraio/paraio.html</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="comment">// http://www.sesp.cse.clrc.ac.uk/Publications/paraio/paraio/node53.html</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="comment">// GODMARK: Could use Asynchronous IO if using MPI-2</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="comment">// GODMARK: Could use non-blocking MPI_File_iread() and MPI_File_iwrite() with MPIO_Wait() if wanted to write while continuing processes</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="comment">// http://www.nersc.gov/nusers/resources/software/libs/io/mpiio.php</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="comment">// Collective: MPI_File_iread_all() ?</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="comment">// OR:</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="comment">// http://www-unix.mcs.anl.gov/mpi/www/www3/MPI_File_read_all_begin.html</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="comment">// int MPI_File_read_all_begin(MPI_File fh, void *buf, int count, MPI_Datatype datatype)</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment"></span>  <span class="comment">// http://www-unix.mcs.anl.gov/mpi/www/www3/MPI_File_read_all_end.html</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="comment">// int MPI_File_read_all_end(MPI_File fh, void *buf, MPI_Status *status)</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// better description:</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">// http://mpi.deino.net/mpi_functions/MPI_File_read_all_begin.html</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="preprocessor">#if(USEMPI&amp;&amp;USEROMIO)</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(operationtype==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a87c1ed6ac8570d8269f37f511e98bcff">READROMIO</a>){</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_seperate begin\n&quot;</span>);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a6340b2ca54752023c5e8ed82ef750ddd">BARRIERROMIOPRE</a>==1) MPI_Barrier(MPI_COMM_GRMHD); <span class="comment">// force barrier before begin writing so avoids large number of unexpected buffer space required.</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="preprocessor">#if(MPIVERSION&gt;=2)</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="preprocessor"></span>    <span class="comment">// non-blocking but need data from read immediately, so not taking advantage</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    MPI_File_read_all_begin(fh, writebuf, bufcount, datatype);</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    MPI_File_read_all_end(fh, writebuf, &amp;status);</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    MPI_File_close(&amp;fh);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="preprocessor"></span>    MPI_File_read_all(fh, writebuf, bufcount, datatype, &amp;status);</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    MPI_File_close(&amp;fh);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_seperate end\n&quot;</span>);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  }</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(operationtype==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a3b39ba900b458cdb0985590b55a0ca0c">READFREEROMIO</a>){</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_seperate_free begin\n&quot;</span>);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    free(writebuf);</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    MPI_Type_free(&amp;newtype);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_seperate_free end\n&quot;</span>);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordflow">else</span>  <span class="keywordflow">if</span>(operationtype==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ad18275c18442d214c5d593c553c08bd0">WRITECLOSEROMIO</a>){</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_combine begin\n&quot;</span>);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a6340b2ca54752023c5e8ed82ef750ddd">BARRIERROMIOPRE</a>==1) MPI_Barrier(MPI_COMM_GRMHD); <span class="comment">// force barrier before begin writing so avoids large number of unexpected buffer space required.</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">#if(MPIVERSION&gt;=2)</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="preprocessor"></span>    MPI_File_write_all_begin(fh, writebuf, bufcount, datatype);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="comment">// wait till later to end, close, free writebuf, and free newtype</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="preprocessor"></span>    <span class="comment">// now write the buffer:</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    MPI_File_write_all(fh, writebuf, bufcount, datatype, &amp;status);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    MPI_File_close(&amp;fh);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="comment">// free buffer and type</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    free(writebuf);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    MPI_Type_free(&amp;newtype);</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_combine end\n&quot;</span>);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  }</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(operationtype==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#adab978aded115a7ce2168927e056ff2f">WRITEENDROMIO</a>){</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor">#if(MPIVERSION&gt;=2)</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="preprocessor"></span>    logsfprintf(<span class="stringliteral">&quot;mpiioromio_combine writeend begin\n&quot;</span>);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="comment">// now write the buffer:</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    MPI_File_write_all_end(fh, writebuf, &amp;status);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="comment">//    logsfprintf(&quot;mpiioromio_combine 1\n&quot;);</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    MPI_File_close(&amp;fh);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="comment">//    logsfprintf(&quot;mpiioromio_combine 2: writebuf=%d\n&quot;,writebuf);</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="comment">// free buffer and type</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    free(writebuf);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="comment">//    logsfprintf(&quot;mpiioromio_combine 3\n&quot;);</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    MPI_Type_free(&amp;newtype);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiioromio_combine writeend end\n&quot;</span>);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="preprocessor"></span>    <span class="comment">// nothing to do</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="preprocessor">#endif // end if USEMPI&amp;&amp;USEROMIO</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;}</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="keywordtype">int</span> set_sizeofmemory(<span class="keywordtype">int</span> numbuff, <span class="keywordtype">int</span> sizeofdatatype, <span class="keywordtype">int</span> numcolumns, <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *sizeofmemory)</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;{</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <span class="comment">// can&#39;t trust that (int)ceil() along will be upper integer</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  *sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2fce9b6b2263a79b51a16a2fbe9da762">ROUND2LONGLONGINT</a>(ceil((<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a> * (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a> * (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a> * (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab0483bf9b1d809f53763479f4171b697">NUMBUFFERS</a>/(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)numcolumns))*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numbuff ; <span class="comment">// default</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;}</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="keywordtype">int</span> set_maxnumsize(<span class="keywordtype">int</span> numcolumns, <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *maxnumsize)</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;{</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  *maxnumsize=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2fce9b6b2263a79b51a16a2fbe9da762">ROUND2LONGLONGINT</a>(ceil(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2fce9b6b2263a79b51a16a2fbe9da762">ROUND2LONGLONGINT</a>(ceil((<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>*<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab0483bf9b1d809f53763479f4171b697">NUMBUFFERS</a>)/(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)numcolumns))*(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(numcolumns))));</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;}</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="keywordtype">int</span> set_numbuffers(<span class="keywordtype">int</span> numcolumns, <span class="keywordtype">int</span> *numbuffers)</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;{</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <span class="keywordtype">int</span> myval;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  myval=(int)<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab9580b14bde95d24bf120f19d052d0a8" title="rounds to definite integer (round() returns double and so isn&#39;t useful as an integer value)...">ROUND2INT</a>(ceil((<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)numcolumns/((<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>)));</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*N3&lt;numcolumns) *numbuffers=myval;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="keywordflow">else</span> *numbuffers=1;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;}</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> gcountmod(<span class="keywordtype">int</span> numcolumns)</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;{</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> myval;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  myval=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2fce9b6b2263a79b51a16a2fbe9da762">ROUND2LONGLONGINT</a>(ceil((<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)((<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)N3*(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)NUMBUFFERS/(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)numcolumns)))*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <span class="keywordflow">return</span>(myval);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;}</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div>
<div class="line"><a name="l01365"></a><span class="lineno"><a class="code" href="../../d0/d86/mpi__fileio_8c.html#ae39970d9d4ec8f83d2ea46cb961b9512"> 1365</a></span>&#160;<span class="preprocessor">#define DEBUGSINIT 0</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="keywordtype">void</span> mpiios_init(<span class="keywordtype">int</span> bintxt, <span class="keywordtype">int</span> sorted, FILE ** fp, <span class="keywordtype">int</span> which, <span class="keywordtype">int</span> headerbytesize, <span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> numcolumns,</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                 MPI_Datatype datatype, <span class="keywordtype">void</span> **jonioptr, <span class="keywordtype">void</span> **writebufptr)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;{</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> fakevar;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordtype">int</span> fakei;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  </div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeofmemory;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> **jonio16;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="keywordtype">double</span> **jonio8;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordtype">float</span> **jonio4;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **jonio1;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordtype">int</span> **jonio4i;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> **jonio8i;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> **writebuf16;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keywordtype">double</span> **writebuf8;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="keywordtype">float</span> **writebuf4;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **writebuf1;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keywordtype">int</span> **writebuf4i;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> **writebuf8i;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="keywordtype">char</span> newfilename[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0947c0a3d28c188caa4497cce08539c9" title="maximum char size of filenames or directories or commands">MAXFILENAME</a>];</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="keywordtype">int</span> trygettingfile;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="keywordflow">if</span>(datatype==MPI_UNSIGNED_CHAR){ jonio1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **)jonioptr; writebuf1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **)writebufptr; }</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_FLOAT){ jonio4=(<span class="keywordtype">float</span> **)jonioptr; writebuf4=(<span class="keywordtype">float</span> **)writebufptr; }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_DOUBLE){ jonio8=(<span class="keywordtype">double</span>**)jonioptr; writebuf8=(<span class="keywordtype">double</span>**)writebufptr; }</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_DOUBLE){ jonio16=(<span class="keywordtype">long</span> <span class="keywordtype">double</span>**)jonioptr; writebuf16=(<span class="keywordtype">long</span> <span class="keywordtype">double</span>**)writebufptr; }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_INT){ jonio4i=(<span class="keywordtype">int</span> **)jonioptr; writebuf4i=(<span class="keywordtype">int</span> **)writebufptr; }</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_LONG_INT){ jonio8i=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> **)jonioptr; writebuf8i=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> **)writebufptr; }</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiios_init begin\n&quot;</span>);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="comment">//  open files for non-ROMIO writing</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment"></span>  </div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">if</span>(myid==0){  <span class="comment">// total on CPU=0, always, since mpicombine=1</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    }</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;numfiles;i++){</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>&amp;&amp;(numfiles&gt;1)){</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        sprintf(newfilename,<span class="stringliteral">&quot;%s-col%04d&quot;</span>,filename,i); <span class="comment">// must be same name as in dump_gen()</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      }</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        sprintf(newfilename,<span class="stringliteral">&quot;%s&quot;</span>,filename);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="preprocessor">#define NUMTRYGETTINGFILE 3</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">for</span>(trygettingfile=0;trygettingfile&lt;NUMTRYGETTINGFILE;trygettingfile++){</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <span class="keywordflow">if</span> (which == <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab63ec178b2d4d9acb2141c5f2422036d">WRITEFILE</a>){</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>)         fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = fopen(newfilename, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>)      fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = fopen(newfilename, <span class="stringliteral">&quot;at&quot;</span>);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such bintxt=%d\n&quot;</span>,bintxt);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            myexit(62061);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;          }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;          <span class="comment">// file pointer set correctly upon append</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        }</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (which == <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;          <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>)     fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = fopen(newfilename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>)  fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = fopen(newfilename, <span class="stringliteral">&quot;rt&quot;</span>);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such bintxt=%d\n&quot;</span>,bintxt);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;            myexit(62062);</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;          }</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        }</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">if</span> (fp[i] == NULL) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>, <span class="stringliteral">&quot;error opening file: %s\n&quot;</span>, newfilename);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;          <span class="keywordflow">if</span>(trygettingfile==NUMTRYGETTINGFILE) myexit(62676);</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Pausing for disk to get into synch: %d\n&quot;</span>,trygettingfile);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            <span class="keywordflow">if</span>(MPIAVOIDFORK){</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;              <span class="comment">// compute a bit to fake a sleep</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;              fakevar=0.8;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="preprocessor">#define FAKENUM 100 // number of square roots to take to pause</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="preprocessor"></span>              <span class="keywordflow">for</span>(fakei=i;fakei&lt;=FAKENUM;fakei++){</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                fakevar=sqrt(fakevar);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;              }       </div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            }</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;              system(<span class="stringliteral">&quot;sleep 1&quot;</span>); <span class="comment">// or use something to pause for 1 second</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;          }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        }</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          <span class="comment">// then done with loop (ensure no inner loop and so set correct loop to end)</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;          trygettingfile=NUMTRYGETTINGFILE;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        }</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      }<span class="comment">// end if trygettingfile</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160; </div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="comment">// must set file pointer to after header</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">if</span> (which == <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac71325c6071d23f9a934a4780445950b">READFILE</a>){</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        fseek(fp[i],headerbytesize,SEEK_SET);</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      }</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    }<span class="comment">// end over numfiles</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  }<span class="comment">// end if myid==0</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  </div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="keywordflow">if</span> ( (sorted==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ac0732fd72573f5fa69a9ef066ef63f65">SORTED</a>)&amp;&amp;(myid == 0) ){  <span class="comment">// total on CPU=0 is stored in memory somehow for sorting before output</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="comment">// determine the memory needed for the mpicombinetype for cpu=0</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a242111ff46bde86789e819eccbb97e69">mpicombinetype</a>; <span class="comment">// initial action</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINESIMPLE){</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINEMINMEM){</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <span class="comment">// check this calculation against setuplinklist()&#39;s cpulist0 array size!</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <span class="comment">// 2 needed since need to read sequentially, then order it into the other buffer for writing</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      set_sizeofmemory(2,sizeofdatatype, numcolumns, &amp;sizeofmemory);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      <span class="keywordflow">if</span>(sizeofmemory&gt;(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns){</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>=MPICOMBINESIMPLE; <span class="comment">// then switch to simple method</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="comment">// need memory to be at least larger than number of columns (X2 for 2 buffers)</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      <span class="comment">// don&#39;t want to work with chunks smaller than # of columns, and all chunks should come in # of column chunks times some integer multiple</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      <span class="keywordflow">if</span>(sizeofmemory&lt;(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)2) sizeofmemory=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)2;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <span class="keywordflow">if</span>(sizeofmemory&lt;(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)2*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns){</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;problem, sizeofmemory=%lld &lt; %lld=2*numcolumns\n&quot;</span>,sizeofmemory,(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)2*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        myexit(102000);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    }</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a21c62ebc3c9b9268b15e0ea4f7fff91b">joniosize</a>=sizeofmemory/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype);</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;jonio sizeofmemory=%lld sizeofdatatype=%d\n&quot;</span>,sizeofmemory,sizeofdatatype);</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordflow">if</span>(datatype==MPI_UNSIGNED_CHAR) *jonio1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_FLOAT) *jonio4=(<span class="keywordtype">float</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_DOUBLE) *jonio8 =(<span class="keywordtype">double</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_DOUBLE) *jonio16 =(<span class="keywordtype">long</span> <span class="keywordtype">double</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_INT) *jonio4i=(<span class="keywordtype">int</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_LONG_INT) *jonio8i=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;       (datatype==MPI_UNSIGNED_CHAR)&amp;&amp;(*jonio1 == NULL) ||</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;       (datatype==MPI_FLOAT)&amp;&amp;(*jonio4 == NULL) ||</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;       (datatype==MPI_DOUBLE)&amp;&amp;(*jonio8 == NULL) ||</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;       (datatype==MPI_LONG_DOUBLE)&amp;&amp;(*jonio16 == NULL) ||</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;       (datatype==MPI_INT)&amp;&amp;(*jonio4i == NULL) ||</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;       (datatype==MPI_LONG_LONG_INT)&amp;&amp;(*jonio8i == NULL) </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;       ){</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>, <span class="stringliteral">&quot;Can&#39;t initialize jonio memory for mpiios_init\n&quot;</span>);</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      myexit(16010);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    }</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="preprocessor">#if(DEBUGSINIT)</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">      for(i=0;i&lt;sizeofmemory/datatype;i++){</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">      if(datatype==sizeof(long double)) (*jonio16)[i]=-10000.0000;</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">      if(datatype==sizeof(double)) (*jonio8)[i]=-10000.0000;</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">      if(datatype==sizeof(float)) (*jonio4)[i]=-10000.0000;</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment">      if(datatype==sizeof(unsigned char)) (*jonio1)[i]=100;</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment">      dualfprintf(fail_file,&quot;got here1\n&quot;);</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    logsfprintf(<span class="stringliteral">&quot;mpiios_init jonio: sizeofmemory=%lld sizeofdatatype=%d\n&quot;</span>,sizeofmemory,sizeofdatatype);</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  }</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="comment">// need to tell all CPUS the status of changed global vars</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  MPI_Bcast(&amp;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>,1,MPI_INT,MPIid[0], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="comment">// open per CPU writebuf</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINESIMPLE){</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    sizeofmemory = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a> * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a> * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N3 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns ;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  }</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>==MPICOMBINEMINMEM){</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="comment">// maximum cpu=0 could require under any case</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    set_sizeofmemory(1,sizeofdatatype, numcolumns, &amp;sizeofmemory);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordflow">if</span>(sizeofmemory&gt;(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N3*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns) sizeofmemory=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N3*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns; <span class="comment">// can&#39;t ask for more!</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordflow">if</span>(sizeofmemory&lt;(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sizeofdatatype*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns) sizeofmemory=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>; <span class="comment">// minimum, chunk at minimum of number of columns</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">if</span>(sizeofmemory&lt;(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>){</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;problem, sizeofmemory=%lld &lt; %lld=numcolumns\n&quot;</span>,sizeofmemory,(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      myexit(6900);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  }</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#ad921c3abce16f75dbceddd9115c21129">writebufsize</a>=sizeofmemory/((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)sizeofdatatype); <span class="comment">// never used currently</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="preprocessor">#if(DEBUGMINMEM)</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="preprocessor"></span>  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;writebuf sizeofmemory=%lld sizeofdatatype=%d\n&quot;</span>,sizeofmemory,sizeofdatatype);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="keywordflow">if</span>(datatype==MPI_UNSIGNED_CHAR) *writebuf1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_FLOAT) *writebuf4=(<span class="keywordtype">float</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_DOUBLE) *writebuf8 =(<span class="keywordtype">double</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_DOUBLE) *writebuf16 =(<span class="keywordtype">long</span> <span class="keywordtype">double</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_INT) *writebuf4i=(<span class="keywordtype">int</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_LONG_INT) *writebuf8i=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(sizeofmemory);</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;     (datatype==MPI_UNSIGNED_CHAR)&amp;&amp;(*writebuf1 == NULL) ||</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;     (datatype==MPI_FLOAT)&amp;&amp;(*writebuf4 == NULL) ||</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;     (datatype==MPI_DOUBLE)&amp;&amp;(*writebuf8 == NULL) ||</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;     (datatype==MPI_LONG_DOUBLE)&amp;&amp;(*writebuf16 == NULL) ||</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;     (datatype==MPI_INT)&amp;&amp;(*writebuf4i == NULL) ||</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;     (datatype==MPI_LONG_LONG_INT)&amp;&amp;(*writebuf8i == NULL) </div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;     ){</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>, <span class="stringliteral">&quot;Can&#39;t initialize writebuf memory for mpiios_init: datatype=%d sizeofmemory=%d\n&quot;</span>,datatype,sizeofmemory);</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    myexit(86726);</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  }</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="preprocessor">#if(DEBUGSINIT)</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="preprocessor"></span>  <span class="comment">/*</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">    for(i=0;i&lt;sizeofmemory/sizeofdatatype;i++){</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment">    if(datatype==sizeof(long double)) (*writebuf16)[i]=-10000.0000;</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">    if(datatype==sizeof(double)) (*writebuf8)[i]=-10000.0000;</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">    if(datatype==sizeof(float)) (*writebuf4)[i]=-10000.0000;</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">    if(datatype==sizeof(unsigned char)) (*writebuf1)[i]=100;</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">    dualfprintf(fail_file,&quot;got here2\n&quot;);</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="preprocessor"></span>  logsfprintf(<span class="stringliteral">&quot;mpiios_init end: sizeofmemory=%lld sizeofdatatype=%d\n&quot;</span>,sizeofmemory,sizeofdatatype);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;}</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="keywordtype">void</span> mpiiomin_final(<span class="keywordtype">int</span> numcolumns,FILE **fp, <span class="keywordtype">void</span> *jonio, <span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;{</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  free(writebuf);  <span class="comment">// writebuf used by each CPU</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    free(jonio);  <span class="comment">// used by CPU=0</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;numfiles;i++){</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      fclose(fp[i]);</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = NULL;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    }</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;}</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a83e18b4873b8b6552a9d0a2c900419c4">mpiios_combine</a>(<span class="keywordtype">int</span> bintxt, MPI_Datatype datatype, <span class="keywordtype">int</span> numcolumns,</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                    FILE ** fp, <span class="keywordtype">void</span> *jonio, <span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;{</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>, l, <a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>, mapvaluejonio, mapvaluetempbuf;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="preprocessor"></span>  MPI_Request rrequest;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  MPI_Request srequest;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">int</span> othercpupos[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a> + 1];</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *jonio1;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="keywordtype">float</span> *jonio4;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keywordtype">double</span> *jonio8;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *jonio16;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keywordtype">int</span> *jonio4i;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *jonio8i;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  </div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  </div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiios begin combine\n&quot;</span>);</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) jonio1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) jonio;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) jonio4 = (<span class="keywordtype">float</span> *) jonio;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) jonio8 = (<span class="keywordtype">double</span> *) jonio;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) jonio16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) jonio;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) jonio4i = (<span class="keywordtype">int</span> *) jonio;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) jonio8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) jonio;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  </div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="preprocessor"></span>  <span class="comment">// no need for tempbuf, works since first write to jonio is CPU=0&#39;s writebuf</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="keywordflow">if</span>(myid!=0) MPI_Isend(writebuf, <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a> * <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a> * N3 * numcolumns, datatype, MPIid[0], myid, MPI_COMM_GRMHD, &amp;srequest);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="keywordflow">for</span> (l = 0; l &lt; <a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>; l++) {</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      logsfprintf(<span class="stringliteral">&quot;on myid==0: mpiios combine: %d of numprocs=%d data=%lld\n&quot;</span>,l,numprocs,(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>) (<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a> * <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a> * N3 * numcolumns) );</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;      <span class="keywordflow">if</span>(l!=0){</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        MPI_Irecv(writebuf, <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a> * <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a> * N3 * numcolumns, datatype, MPIid[l], l, MPI_COMM_GRMHD, &amp;rrequest);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        MPI_Wait(&amp;rrequest, &amp;mpichstatus);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      othercpupos[1]=l%<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      othercpupos[2]=(int)((l%(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>))/<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>);</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      othercpupos[3]=(int)(l/(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*ncpux2));</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="comment">// now fill jonio with proper sequence (i.e. tiled mapping)</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>; k++) <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>; j++)</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                                 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>; i++)</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                                   <span class="keywordflow">for</span> (col = 0; col &lt; <a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>; col++) {</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                                     <span class="comment">// mapvaluejonio is global single-dimensional index for position in total CPU space - in C order for &quot;array[k][j][i]&quot;</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                                     <span class="comment">// Note that this storage mapping function forces disk to have i as fastest regardless of order stored in original array.</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                                     <span class="comment">// This is fully compatible with any ORDERSTORAGE choice since global arrays are still properly accessed and this mapping just forces writebuf to be filled or read with fixed mapping function as desirable, so that user can change ORDERSTORAGE without the files written being changed.</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                                     mapvaluejonio =</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                                       + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a> * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)ncpux2 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N2 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns * ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)k + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)othercpupos[3] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>)</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                                       + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a> * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns * ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)j + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)othercpupos[2] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N2)</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                                       + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns * ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)i + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)othercpupos[1] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>)</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                                       + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                                     <span class="comment">// mapvaluetempbuf is a single-buffer single-dimensional index for the position in the buffer in C-order</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                                     mapvaluetempbuf =</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                                       + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)k * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N2 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                                       + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)j * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                                       + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)i * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;     </div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                                     <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) jonio1[mapvaluejonio] = writebuf1[mapvaluetempbuf];</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) jonio4[mapvaluejonio] = writebuf4[mapvaluetempbuf];</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) jonio8[mapvaluejonio] = writebuf8[mapvaluetempbuf];</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) jonio16[mapvaluejonio] = writebuf16[mapvaluetempbuf];</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) jonio4i[mapvaluejonio] = writebuf4i[mapvaluetempbuf];</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) jonio8i[mapvaluejonio] = writebuf8i[mapvaluetempbuf];</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                                   }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    }</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="keywordflow">if</span>(myid!=0) MPI_Wait(&amp;srequest, &amp;mpichstatus);</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  free(writebuf);  <span class="comment">// writebuf used by each CPU</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    logsfprintf(<span class="stringliteral">&quot;on myid==0: mpiios combine: writing: %lld\n&quot;</span>,(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="comment">// now write out collected data using CPU=0</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    }</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>){</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      <span class="comment">// GODMARK: Below may be too large of a size for fwrite() to output</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="keywordflow">if</span>(numfiles==1) fwrite(jonio, sizeofdatatype,<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] * <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] * <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3] * numcolumns, *fp);</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;i++){</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) fwrite(&amp;jonio1[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fwrite(&amp;jonio4[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fwrite(&amp;jonio8[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fwrite(&amp;jonio16[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fwrite(&amp;jonio4i[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fwrite(&amp;jonio8i[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        }</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      }</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>){ <span class="comment">// properly ordered, so just dump it</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;i++){</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) fprintf(fp[i%numfiles],<span class="stringliteral">&quot;%c&quot;</span>,jonio1[i]);</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fprintf(fp[i%numfiles],<span class="stringliteral">&quot;%15.7g&quot;</span>,jonio4[i]);</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fprintf(fp[i%numfiles],<span class="stringliteral">&quot;%21.15g&quot;</span>,jonio8[i]);</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fprintf(fp[i%numfiles],<span class="stringliteral">&quot;%31.25Lg&quot;</span>,jonio16[i]);</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fprintf(fp[i%numfiles],<span class="stringliteral">&quot;%d&quot;</span>,jonio4i[i]);</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fprintf(fp[i%numfiles],<span class="stringliteral">&quot;%lld&quot;</span>,jonio8i[i]);</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        <span class="keywordflow">if</span>(numfiles==1){</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;          <span class="keywordflow">if</span>((i+1)%numcolumns) fprintf(*fp,<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;          <span class="keywordflow">else</span> fprintf(*fp,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        }</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="keywordflow">else</span>  fprintf(fp[i%numfiles],<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      }</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    }</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    logsfprintf(<span class="stringliteral">&quot;on myid==0: mpiios combine: freeing\n&quot;</span>);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    free(jonio);  <span class="comment">// used by CPU=0</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;numfiles;i++){</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      fclose(fp[i]);</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;      fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = NULL;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    }</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  }<span class="comment">// end if myid==0</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiios end combine\n&quot;</span>);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;}</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#ad8ad9ab872473222640c636bde25e6db">mpiios_seperate</a>(<span class="keywordtype">int</span> bintxt, <span class="keywordtype">int</span> stage, MPI_Datatype datatype, <span class="keywordtype">int</span> numcolumns,</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                     FILE ** fp, <span class="keywordtype">void</span> *jonio,</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                     <span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;{</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>, l, <a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>, mapvaluejonio, mapvaluetempbuf;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="preprocessor"></span>  MPI_Request rrequest;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  MPI_Request srequest;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">int</span> othercpupos[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a> + 1];</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *jonio1;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="keywordtype">float</span> *jonio4;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keywordtype">double</span> *jonio8;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *jonio16;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <span class="keywordtype">int</span> *jonio4i;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *jonio8i;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> short4char;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiios begin seperate\n&quot;</span>);</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) jonio1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) jonio;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) jonio4 = (<span class="keywordtype">float</span> *) jonio;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) jonio8 = (<span class="keywordtype">double</span> *) jonio;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) jonio16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) jonio;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) jonio4i = (<span class="keywordtype">int</span> *) jonio;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) jonio8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) jonio;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="keywordflow">if</span> (stage == <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aaeeaa5570d0e43c90dd234b0254282e3">STAGE1</a>) {</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      }</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      </div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>){</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <span class="comment">// first let cpu=0 read data</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <span class="comment">// GODMARK: Below may be too big for fread() to read</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="keywordflow">if</span>(numfiles==1) fread(jonio, sizeofdatatype,<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] * <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] * <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3] * numcolumns, *fp);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;          <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;i++){</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;            <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) fread(&amp;jonio1[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fread(&amp;jonio4[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE)  fread(&amp;jonio8[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fread(&amp;jonio16[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fread(&amp;jonio4i[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fread(&amp;jonio8i[i], sizeofdatatype,1, fp[i%numfiles]);</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;          }</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        }</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      }</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>){ <span class="comment">// properly ordered, so just dump it</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;i++){</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR){</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;            fscanf(fp[i%numfiles],<span class="stringliteral">&quot;%hu&quot;</span>,&amp;short4char);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;            jonio1[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=short4char; <span class="comment">// convert</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;          }</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fscanf(fp[i%numfiles],<span class="stringliteral">&quot;%f&quot;</span>,&amp;jonio4[i]);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fscanf(fp[i%numfiles],<span class="stringliteral">&quot;%lf&quot;</span>,&amp;jonio8[i]);</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fscanf(fp[i%numfiles],<span class="stringliteral">&quot;%Lf&quot;</span>,&amp;jonio16[i]);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fscanf(fp[i%numfiles],<span class="stringliteral">&quot;%d&quot;</span>,&amp;jonio4i[i]);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fscanf(fp[i%numfiles],<span class="stringliteral">&quot;%lld&quot;</span>,&amp;jonio8i[i]);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="comment">// writebuf is CPU=0&#39;s tempbuf for each CPU, including CPU=0, which is done last</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="keywordflow">for</span> (l = numprocs-1 ; l &gt;=0; l--) {</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        othercpupos[1]=l%<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        othercpupos[2]=(int)((l%(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*ncpux2))/<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        othercpupos[3]=(int)(l/(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*ncpux2));</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        <span class="comment">// now unfill jonio with proper sequence (i.e. tiled mapping)</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>; k++) <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>; j++) {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>; i++) {</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;              <span class="keywordflow">for</span> (col = 0; col &lt; <a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>; col++) {</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                <span class="comment">// mapvaluejonio is global single-dimensional index for position in total CPU space - in C order for &quot;array[k][j][i]&quot;</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                mapvaluejonio =</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                  + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a> * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)ncpux2 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N2 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns * ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)k + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)othercpupos[3] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>)</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                  + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a> * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns * ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)j + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)othercpupos[2] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N2)</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                  + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns * ((<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)i + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)othercpupos[1] * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>)</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                  + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                <span class="comment">// mapvaluetempbuf is a single-buffer single-dimensional index for the position in the buffer in C-order</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                mapvaluetempbuf =</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                  + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)k * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N2 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                  + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)j * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1 * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                  + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)i * (<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)numcolumns + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;     </div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                <span class="comment">// debug check</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                <span class="keywordflow">if</span>((mapvaluetempbuf&lt;0)||(mapvaluetempbuf&gt;=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N1*N2*N3*numcolumns)){</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;mapvaluetempbuf out of range: %d\n&quot;</span>,mapvaluetempbuf);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                  myexit(96726);</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                }</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                <span class="keywordflow">if</span>((mapvaluejonio&lt;0)||(mapvaluejonio&gt;=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3]*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns)){</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;mapvaluejonio out of range: %d\n&quot;</span>,mapvaluejonio);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                  myexit(6726);</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                }</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1[mapvaluetempbuf] = jonio1[mapvaluejonio];</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4[mapvaluetempbuf] = jonio4[mapvaluejonio];</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8[mapvaluetempbuf] = jonio8[mapvaluejonio];</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16[mapvaluetempbuf] = jonio16[mapvaluejonio];</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i[mapvaluetempbuf] = jonio4i[mapvaluejonio];</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i[mapvaluetempbuf] = jonio8i[mapvaluejonio];</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;              }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;            }</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;          }</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        <span class="keywordflow">if</span>(l!=0){</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;   </div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;          MPI_Isend(writebuf, N1 * N2 * N3 * numcolumns, datatype, MPIid[l], l, MPI_COMM_GRMHD, &amp;srequest);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;          MPI_Wait(&amp;srequest, &amp;mpichstatus);</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        }</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      }</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      free(jonio); <span class="comment">// done with jonio after loop</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    }</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      <span class="comment">// chosen CPU to receive data from CPU=0</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      </div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      MPI_Irecv(writebuf, N1 * N2 * N3 * numcolumns, datatype, MPIid[0], myid, MPI_COMM_GRMHD, &amp;rrequest);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      MPI_Wait(&amp;rrequest, &amp;mpichstatus); <span class="comment">// writebuf used until      </span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    }</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a5b294b2a38519989044561129393a5c3">STAGE2</a>) {</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    free(writebuf);</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      fclose(*fp);</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      *fp = NULL;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    }</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  }</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;  logsfprintf(<span class="stringliteral">&quot;mpiios end seperate\n&quot;</span>);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;}</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a47aed413ab62346af7d9b11e25fdc9ca">mpiiotu_combine</a>(MPI_Datatype datatype, <span class="keywordtype">int</span> numcolumns, FILE ** fp, <span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;{</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>, l, <a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="preprocessor"></span>  MPI_Request rrequest;</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  MPI_Request srequest;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">int</span> othercpupos[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a> + 1];</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;  </div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> bufferwritemap;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;  <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  </div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(myid!=0) MPI_Isend(writebuf, N1 * N2 * N3 * numcolumns, datatype, MPIid[0], myid, MPI_COMM_GRMHD, &amp;srequest);</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  <span class="keywordflow">if</span> (myid == 0) {   </div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    }</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="comment">// done in forward order, no need to use tempbuf since CPU=0&#39;s writebuf is first out</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="keywordflow">for</span> (l = 0; l &lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>; l++) {</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="keywordflow">if</span>(l!=0){</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        MPI_Irecv(writebuf, N1 * N2 * N3 * numcolumns, datatype, MPIid[l], l, MPI_COMM_GRMHD, &amp;rrequest);</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        MPI_Wait(&amp;rrequest, &amp;mpichstatus);</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      }</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <span class="comment">// now write writebuf</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <a class="code" href="../../dd/d5e/global_8loops_8diagnostics_8h.html#acaa43bf4740c8a5bda4efe428781401c">DUMPGENLOOP</a>{</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        <span class="keywordflow">for</span>(col=0;col&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;col++){</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;          bufferwritemap=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)col + (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns*((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)i+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)j+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N2*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;          <span class="keywordflow">if</span>(datatype== MPI_UNSIGNED_CHAR){</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;            fprintf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%c &quot;</span>,writebuf1[bufferwritemap]);</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;          }</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_FLOAT){</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;            fprintf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%15.7g &quot;</span>,writebuf4[bufferwritemap]);</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;          }</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_DOUBLE){</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            fprintf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%21.15g &quot;</span>,writebuf8[bufferwritemap]);</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;          }</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_DOUBLE){</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            fprintf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%31.25Lg &quot;</span>,writebuf16[bufferwritemap]);</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;          }</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_INT){</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            fprintf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%d &quot;</span>,writebuf4i[bufferwritemap]);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;          }</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_LONG_INT){</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            fprintf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%lld &quot;</span>,writebuf8i[bufferwritemap]);</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;          }</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;          <span class="keywordflow">if</span>(numfiles&gt;1) fprintf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        }</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <span class="keywordflow">if</span>(numfiles==1) fprintf(*fp,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      }</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    }    </div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  }</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  <span class="keywordflow">if</span>(myid!=0) MPI_Wait(&amp;srequest, &amp;mpichstatus);</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  free(writebuf);  <span class="comment">// writebuf used by each CPU</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;numfiles;i++){</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      fclose(fp[i]);</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = NULL;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    }</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  }</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;}</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a750d9a32046c6604cda5ea418d6a3ce4">mpiiotu_seperate</a>(<span class="keywordtype">int</span> stage, MPI_Datatype datatype, <span class="keywordtype">int</span> numcolumns,</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                      FILE ** fp,<span class="keywordtype">void</span> *writebuf)</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;{</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>, l, <a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="preprocessor"></span>  MPI_Request rrequest;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  MPI_Request srequest;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">int</span> othercpupos[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a> + 1];</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  <span class="keywordtype">void</span> *tempbuf;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  <span class="keywordtype">void</span> *sendbuf;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  <span class="keywordtype">int</span> numfiles;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tempbuf1;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  <span class="keywordtype">float</span> *tempbuf4;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  <span class="keywordtype">double</span> *tempbuf8;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *tempbuf16;</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <span class="keywordtype">int</span> *tempbuf4i;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *tempbuf8i;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *sendbuf1;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="keywordtype">float</span> *sendbuf4;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;  <span class="keywordtype">double</span> *sendbuf8;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">double</span> *sendbuf16;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  <span class="keywordtype">int</span> *sendbuf4i;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *sendbuf8i;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> short4char;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> bufferwritemap;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordflow">if</span>((tempbuf=malloc(sizeofdatatype*N1*N2*N3*numcolumns))==NULL){</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Can&#39;t open tempbuf in gammieio_sep\n&quot;</span>);</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      myexit(7566);</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    }</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) tempbuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) tempbuf;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) tempbuf4 = (<span class="keywordtype">float</span> *) tempbuf;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) tempbuf8 = (<span class="keywordtype">double</span> *) tempbuf;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) tempbuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) tempbuf;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) tempbuf4i = (<span class="keywordtype">int</span> *) tempbuf;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) tempbuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) tempbuf;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  }</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <span class="keywordflow">if</span> (stage == 1) {</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        numfiles=<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      }</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <span class="keywordflow">else</span> numfiles=1;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="keywordflow">for</span> (l = 0; l &lt; <a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>; l++) {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="keywordflow">if</span>(l==0){</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;          sendbuf=writebuf;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;          sendbuf1=writebuf1;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;          sendbuf4=writebuf4;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;          sendbuf8=writebuf8;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;          sendbuf4i=writebuf4i;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;          sendbuf8i=writebuf8i;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;          sendbuf=tempbuf;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;          sendbuf1=tempbuf1;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;          sendbuf4=tempbuf4;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;          sendbuf8=tempbuf8;</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;          sendbuf4i=tempbuf4i;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;          sendbuf8i=tempbuf8i;</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        }</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;        <a class="code" href="../../dd/d5e/global_8loops_8diagnostics_8h.html#acaa43bf4740c8a5bda4efe428781401c">DUMPGENLOOP</a> <span class="keywordflow">for</span> (col = 0; col &lt; <a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>; col++) {</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;          bufferwritemap=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)col+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns*((<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)i+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)j+(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)N1*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N2*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>);</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;          <span class="keywordflow">if</span>(datatype==MPI_UNSIGNED_CHAR){</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            fscanf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%hu&quot;</span>,&amp;short4char);</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;            sendbuf1[bufferwritemap]=short4char;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;          }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_FLOAT) fscanf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%f&quot;</span>,&amp;sendbuf4[bufferwritemap]);</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_DOUBLE) fscanf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%lf&quot;</span>,&amp;sendbuf8[bufferwritemap]);</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_DOUBLE) fscanf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%Lf&quot;</span>,&amp;sendbuf16[bufferwritemap]);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_INT) fscanf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%d&quot;</span>,&amp;sendbuf4i[bufferwritemap]);</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(datatype==MPI_LONG_LONG_INT) fscanf(fp[(bufferwritemap)%numfiles],<span class="stringliteral">&quot;%lld&quot;</span>,&amp;sendbuf8i[bufferwritemap]);</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;        }</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">if</span>(l!=0){</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;          MPI_Isend(sendbuf, N1 * N2 * N3 * numcolumns, datatype, MPIid[l], l,  MPI_COMM_GRMHD, &amp;srequest);</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;          <span class="comment">// have to wait before filling sendbuf buffer again for next CPU</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;          MPI_Wait(&amp;srequest, &amp;mpichstatus);</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      }</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      free(tempbuf);</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    }</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      MPI_Irecv(writebuf, N1 * N2 * N3 * numcolumns, datatype, MPIid[0], myid, MPI_COMM_GRMHD, &amp;rrequest);</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      MPI_Wait(&amp;rrequest, &amp;mpichstatus); <span class="comment">// writebuf used until</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    }</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == 2) {</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    free(writebuf);</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      <span class="keywordflow">for</span>(i=0;i&lt;numfiles;i++){</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        fclose(fp[i]);</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        fp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = NULL;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      }</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    }</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  }</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;}</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="keywordtype">int</span> getsizeofdatatype(MPI_Datatype datatype)</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;{</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) sizeofdatatype=<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> char);</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) sizeofdatatype=<span class="keyword">sizeof</span>(float);</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) sizeofdatatype=<span class="keyword">sizeof</span>(double);</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) sizeofdatatype=<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> double);</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) sizeofdatatype=<span class="keyword">sizeof</span>(int);</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG) sizeofdatatype=<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> int); <span class="comment">// sometimes different than (int)</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) sizeofdatatype=<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int);</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    myexit(8676);</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;  }</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="keywordflow">return</span>(sizeofdatatype);</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;}</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="keywordtype">void</span> mpimax(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a>*maxptr)</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;{</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;  <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> send;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  </div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;<span class="preprocessor"></span>  send = *maxptr;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  MPI_Allreduce(&amp;send, maxptr, 1, MPI_SFTYPE, MPI_MAX,MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="keywordtype">void</span> mpiimax(<span class="keywordtype">int</span>*maxptr)</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;{</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  <span class="keywordtype">int</span> send;</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  </div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="preprocessor"></span>  send = *maxptr;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  MPI_Allreduce(&amp;send, maxptr, 1, MPI_INT, MPI_MAX,MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;<span class="keywordtype">void</span> mpiisum(<span class="keywordtype">int</span>*sumptr)</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;{</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  <span class="keywordtype">int</span> send;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;  </div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="preprocessor"></span>  send = *sumptr;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  MPI_Allreduce(&amp;send, sumptr, 1, MPI_INT, MPI_SUM,MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="keywordtype">void</span> mpiFTYPEsum(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>*sumptr)</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;{</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> send;</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  </div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="preprocessor"></span>  send = *sumptr;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  MPI_Allreduce(&amp;send, sumptr, 1, MPI_FTYPE, MPI_SUM,MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="keywordtype">void</span> mpiisum0(<span class="keywordtype">int</span>*sumptr, <span class="keywordtype">int</span> recvid)</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;{</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="keywordtype">int</span> send;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  </div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="preprocessor"></span>  send = *sumptr;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  MPI_Reduce(&amp;send, sumptr, 1, MPI_INT, MPI_SUM,MPIid[recvid], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="keywordtype">void</span> mpildsum0(<span class="keywordtype">long</span> <span class="keywordtype">int</span>*sumptr, <span class="keywordtype">int</span> recvid)</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;{</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">int</span> send;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  </div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="preprocessor"></span>  send = *sumptr;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  MPI_Reduce(&amp;send, sumptr, 1, MPI_LONG, MPI_SUM,MPIid[recvid], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="keywordtype">void</span> mpimin(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a>*minptr)</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;{</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> send;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  </div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="preprocessor"></span>  send = *minptr;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  MPI_Allreduce(&amp;send, minptr, 1, MPI_SFTYPE, MPI_MIN,MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="keywordtype">void</span> mpifmin(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>*minptr)</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;{</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> send;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  </div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="preprocessor"></span>  send = *minptr;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;  MPI_Allreduce(&amp;send, minptr, 1, MPI_FTYPE, MPI_MIN,MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="keywordtype">void</span> prminmaxsum(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <span class="keywordtype">int</span> start,<span class="keywordtype">int</span> nmemb, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *maxptr, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>*minptr,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>*sumptr)</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;{</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,<a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>,pl;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> maxsend,minsend,sumsend;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;  <span class="keywordtype">int</span> domin,domax,dosum;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;  <span class="keywordflow">if</span>(maxptr==NULL) domax=0; <span class="keywordflow">else</span> domax=1;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keywordflow">if</span>(minptr==NULL) domin=0; <span class="keywordflow">else</span> domin=1;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;  <span class="keywordflow">if</span>(sumptr==NULL) dosum=0; <span class="keywordflow">else</span> dosum=1;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;  </div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    </div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    <span class="keywordflow">if</span>(domin) minptr[pl]=1E30;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <span class="keywordflow">if</span>(domax) maxptr[pl]=-1E30;</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    <span class="keywordflow">if</span>(dosum) sumptr[pl]=0;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  }</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  <a class="code" href="../../dd/d5e/global_8loops_8diagnostics_8h.html#acaa43bf4740c8a5bda4efe428781401c">DUMPGENLOOP</a>{</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <span class="keywordflow">if</span>(domax) <span class="keywordflow">if</span> (<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,i,j,k,pl) &gt; maxptr[pl]) maxptr[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,i,j,k,pl);</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;      <span class="keywordflow">if</span>(domin) <span class="keywordflow">if</span> (<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,i,j,k,pl) &lt; minptr[pl]) minptr[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,i,j,k,pl);</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;      <span class="keywordflow">if</span>(dosum) sumptr[pl]+=<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,i,j,k,pl);</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    }</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;  }</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){    </div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="keywordflow">if</span>(domax){</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      maxsend = maxptr[pl];</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      MPI_Allreduce(&amp;maxsend, &amp;maxptr[pl], 1, MPI_FTYPE, MPI_MAX, MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    }</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    <span class="keywordflow">if</span>(domin){</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;      minsend = minptr[pl];</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;      MPI_Allreduce(&amp;minsend, &amp;minptr[pl], 1, MPI_FTYPE, MPI_MIN, MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    }</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    <span class="keywordflow">if</span>(dosum){</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      sumsend = sumptr[pl];</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      MPI_Allreduce(&amp;sumsend, &amp;sumptr[pl], 1, MPI_FTYPE, MPI_SUM, MPI_COMM_GRMHD);</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    }</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;  }</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="keywordtype">void</span> myfwrite(<span class="keywordtype">int</span> bintxt, MPI_Datatype datatype, <span class="keywordtype">void</span> *ptr, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> nmemb, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, FILE**stream,<span class="keywordtype">void</span>*writebuf)</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;{</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keywordtype">void</span> *voidbuf;</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *ptr16;</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *ptr8;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *ptr4;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr1;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *ptr4i;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *ptr8i;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> streamnum;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  }</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) ptr1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr;</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) ptr4 = (<span class="keywordtype">float</span> *) ptr;</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) ptr8 = (<span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) ptr16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) ptr4i = (<span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) ptr8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  }</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4242e6dd75844f241d042e8f43c404e8">mpicombine</a>==0){</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>){ <span class="comment">// binaryoutput</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        fwrite((<span class="keywordtype">char</span>*)ptr+(sizeofdatatype*start), sizeofdatatype, nmemb, stream[0]);</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>+=nmemb;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      }</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;          streamnum=<a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;          fwrite((<span class="keywordtype">char</span>*)ptr+(sizeofdatatype*pl), sizeofdatatype, 1, stream[streamnum]);</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>++;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        }</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      }</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    }</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;    <span class="keywordflow">else</span>{ <span class="comment">// text output</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>) streamnum=<a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>;</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keywordflow">else</span> streamnum=0;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) fprintf(stream[streamnum],<span class="stringliteral">&quot;%c &quot;</span>,ptr1[pl]);</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fprintf(stream[streamnum],<span class="stringliteral">&quot;%15.7g &quot;</span>,ptr4[pl]);</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fprintf(stream[streamnum],<span class="stringliteral">&quot;%21.15g &quot;</span>,ptr8[pl]);</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fprintf(stream[streamnum],<span class="stringliteral">&quot;%31.25Lg &quot;</span>,ptr16[pl]);</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fprintf(stream[streamnum],<span class="stringliteral">&quot;%d &quot;</span>,ptr4i[pl]);</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fprintf(stream[streamnum],<span class="stringliteral">&quot;%lld &quot;</span>,ptr8i[pl]);</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>++;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;      }</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    }</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;  }</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  <span class="keywordflow">else</span>{ <span class="comment">// mpicombine==1</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>&amp;&amp;<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a125da10d4f20cf53facb2a408fdc3f52">USEROMIO</a>){ <span class="comment">// column splitting with ROMIO</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>==<a class="code" href="../../dd/d46/mpidefs_8h.html#aa9fcdffa2d4ab0089eeb6a8bd3c6f8e3">romiocoliter</a>){ <span class="comment">// only write if doing that column</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;          <span class="comment">// BUFFERMAP2 only depends on i,j, not column number</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>] = ptr1[pl];</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>] = ptr4[pl];</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>] = ptr8[pl];</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>] = ptr16[pl];</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>] = ptr4i[pl];</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>] = ptr8i[pl];</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;        }</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>++;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      }</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;    }</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    <span class="keywordflow">else</span>{ <span class="comment">// no ROMIO column splitting, just normal MPI buffer writing</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>] = ptr1[pl];</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>] = ptr4[pl];</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>] = ptr8[pl];</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>] = ptr16[pl];</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>] = ptr4i[pl];</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>] = ptr8i[pl];</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      }</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    }</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  }</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;}</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="keywordtype">void</span> myfread(<span class="keywordtype">int</span> bintxt, MPI_Datatype datatype, <span class="keywordtype">void</span> *ptr, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> nmemb, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, FILE**stream,<span class="keywordtype">void</span>*writebuf)</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;{</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="keywordtype">void</span> *voidbuf;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  <span class="keywordtype">int</span> sizeofdatatype;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *ptr16;</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *ptr8;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *ptr4;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr1;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *ptr4i;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *ptr8i;</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> short4char;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;  <span class="keywordtype">int</span> streamnum;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  sizeofdatatype=getsizeofdatatype(datatype);</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  }</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) ptr1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) ptr4 = (<span class="keywordtype">float</span> *) ptr;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) ptr8 = (<span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) ptr16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) ptr4i = (<span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) ptr8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;  }</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4242e6dd75844f241d042e8f43c404e8">mpicombine</a>==0){</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    <span class="keywordflow">if</span>(bintxt==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a69cca27144f7fe2d5e94b0b5fab2e0cb">BINARYOUTPUT</a>){</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>){</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        fread((<span class="keywordtype">char</span>*)ptr+(sizeofdatatype*start), sizeofdatatype, nmemb, stream[0]);</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>+=nmemb;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      }</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;        <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;          streamnum=<a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;          fread((<span class="keywordtype">char</span>*)ptr+(sizeofdatatype*pl), sizeofdatatype, 1, stream[streamnum]);</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>++;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;        }</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      }</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    }</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>) streamnum=<a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        <span class="keywordflow">else</span> streamnum=0;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR){</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;          fscanf(stream[streamnum],<span class="stringliteral">&quot;%hu&quot;</span>,&amp;short4char);</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;          ptr1[pl]=short4char;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        }</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) fscanf(stream[streamnum],<span class="stringliteral">&quot;%f&quot;</span>,&amp;ptr4[pl]);</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) fscanf(stream[streamnum],<span class="stringliteral">&quot;%lf&quot;</span>,&amp;ptr8[pl]);</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) fscanf(stream[streamnum],<span class="stringliteral">&quot;%Lf&quot;</span>,&amp;ptr16[pl]);</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) fscanf(stream[streamnum],<span class="stringliteral">&quot;%d&quot;</span>,&amp;ptr4i[pl]);</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) fscanf(stream[streamnum],<span class="stringliteral">&quot;%lld&quot;</span>,&amp;ptr8i[pl]);</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>++;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      }</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    }</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  }</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4867bbed91b81dce8e6b0738fcc1c9e7">docolsplit</a>&amp;&amp;<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a125da10d4f20cf53facb2a408fdc3f52">USEROMIO</a>){</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;      <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>==<a class="code" href="../../dd/d46/mpidefs_8h.html#aa9fcdffa2d4ab0089eeb6a8bd3c6f8e3">romiocoliter</a>){</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) ptr1[pl]=writebuf1[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>]; </div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_FLOAT) ptr4[pl]=writebuf4[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>]; </div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) ptr8[pl]=writebuf8[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>]; </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) ptr16[pl]=writebuf16[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>]; </div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_INT) ptr4i[pl]=writebuf4i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>]; </div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;          <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) ptr8i[pl]=writebuf8i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a11faa49713a6c4d585d3c4a0690c3247">BUFFERMAP2</a>]; </div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        }</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a03de3371898041006465df0ff8935c31" title="for data output required to be long long int in case integer is only 4 bytes and want &gt;2GB files...">nextbuf</a>++;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;      }</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    }</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) ptr1[pl]=writebuf1[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>]; </div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_FLOAT) ptr4[pl]=writebuf4[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>]; </div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) ptr8[pl]=writebuf8[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>]; </div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) ptr16[pl]=writebuf16[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>]; </div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_INT) ptr4i[pl]=writebuf4i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>]; </div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) ptr8i[pl]=writebuf8i[<a class="code" href="../../de/d1a/mympi_8global_8depmnemonics_8h.html#a51c0aed8447ae3ad47270989adf18df6">BUFFERMAP</a>]; </div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;      }</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  }</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;}</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="keywordtype">void</span> myset(MPI_Datatype datatype, <span class="keywordtype">void</span> *ptr, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> nmemb, <span class="keywordtype">void</span>*writebuf)</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;{</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *ptr16;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *ptr8;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *ptr4;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr1;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *ptr4i;</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *ptr8i;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  }</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) ptr1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) ptr4 = (<span class="keywordtype">float</span> *) ptr;</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) ptr8 = (<span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) ptr16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) ptr4i = (<span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) ptr8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  }</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;  <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="comment">// nextcol is the iterator here, a global variable currently</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++] = ptr1[pl];</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++] = ptr4[pl];</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++] = ptr8[pl];</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++] = ptr16[pl];</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++] = ptr4i[pl];</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++] = ptr8i[pl];</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;  }</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;}</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="keywordtype">void</span> myget(MPI_Datatype datatype, <span class="keywordtype">void</span> *ptr, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> nmemb, <span class="keywordtype">void</span>*writebuf)</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;{</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *writebuf16;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *writebuf8;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *writebuf4;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *writebuf1;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *writebuf4i;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *writebuf8i;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> *ptr16;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> *ptr8;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">float</span> *ptr4;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr1;</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> *ptr4i;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *ptr8i;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) writebuf1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) writebuf;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) writebuf4 = (<span class="keywordtype">float</span> *) writebuf;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) writebuf8 = (<span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) writebuf16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) writebuf;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) writebuf4i = (<span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) writebuf8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) writebuf;</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;  }</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;  <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) ptr1 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) ptr4 = (<span class="keywordtype">float</span> *) ptr;</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) ptr8 = (<span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) ptr16 = (<span class="keywordtype">long</span> <span class="keywordtype">double</span> *) ptr;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) ptr4i = (<span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) ptr8i = (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *) ptr;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such datatype=%d\n&quot;</span>,datatype);</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  }</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;  <span class="keywordflow">for</span>(pl=start;pl&lt;start+nmemb;pl++){</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    <span class="comment">// nextcol is the iterator here, a global variable currently</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <span class="keywordflow">if</span> (datatype == MPI_UNSIGNED_CHAR) ptr1[pl] = writebuf1[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++];</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_FLOAT) ptr4[pl] = writebuf4[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++];</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_DOUBLE) ptr8[pl] = writebuf8[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++];</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_DOUBLE) ptr16[pl] = writebuf16[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++];</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_INT) ptr4i[pl] = writebuf4i[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++];</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datatype == MPI_LONG_LONG_INT) ptr8i[pl] = writebuf8i[<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa08c121bb8ac9e2f6740060090c69dfe">nextcol</a>++];</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  }</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;}</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="keywordtype">int</span> init_linklists(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;{</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * blinkptr;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * cpulinkptr;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numlists;</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numcells;</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  <span class="keywordtype">int</span> maxnumcolumns;</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  <span class="comment">// Below shouldn&#39;t be modified for user purposes</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  <span class="comment">// setup number of buffers</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;  maxnumcolumns=0;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a199215088aa5278950fcc865a67e7019" title="these dump types also control period of output Period can be controlled for non-spatial dumps such as...">NUMDUMPTYPES</a>;i++){</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    <span class="keywordflow">if</span>(maxnumcolumns&lt;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2e66e534829f48770a2d3f6fdade7cc8">dnumcolumns</a>[i]) maxnumcolumns=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2e66e534829f48770a2d3f6fdade7cc8">dnumcolumns</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  }</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;  <span class="comment">// buffer must at least hold maxcolumns of data, and since buffer is only N1*N2*N3 big, make sure that at least NUMBUFFERS*N1*N2*N3&gt;maxnumcolumns</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  set_numbuffers(maxnumcolumns,&amp;NUMBUFFERS);</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;NUMDUMPTYPES;i++) if(dnumcolumns[i]&gt;0) setuplinklist(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2e66e534829f48770a2d3f6fdade7cc8">dnumcolumns</a>[i],i);</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  trifprintf(<span class="stringliteral">&quot;end setuplinklists: %d\n&quot;</span>,NUMDUMPTYPES);</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  <span class="comment">// setup link lists for setuplinklist()</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  trifprintf(<span class="stringliteral">&quot;start per cpu lists\n&quot;</span>);</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  <span class="comment">// check link lists</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a199215088aa5278950fcc865a67e7019" title="these dump types also control period of output Period can be controlled for non-spatial dumps such as...">NUMDUMPTYPES</a>;i++){</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2e66e534829f48770a2d3f6fdade7cc8">dnumcolumns</a>[i]&gt;0){</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      logfprintf(<span class="stringliteral">&quot;i=%d\n&quot;</span>,i);</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;      blinkptr=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20cfabf76fa7dff1137eeaf6508d6db3">blinkptr0</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;      numlists=0;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      numcells=0;</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <span class="keywordflow">while</span>(blinkptr!=NULL){</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        numcells+=blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;        <span class="comment">//      logfprintf(&quot;i=%d num=%d, numtotal=%d\n&quot;,i,blinkptr-&gt;num,numcells);</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        numlists++;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        blinkptr=blinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a279c79caaa6d7945fc75adc1e1796506">np</a>; <span class="comment">// next one</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;      }</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      logfprintf(<span class="stringliteral">&quot;i=%d numlists=%lld numcells=%lld\n&quot;</span>,i,numlists,numcells);</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      numlists=0;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    }</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  }</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  <span class="comment">// check cpu=0 link list</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    trifprintf(<span class="stringliteral">&quot;start cpu==0 lists\n&quot;</span>);</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a199215088aa5278950fcc865a67e7019" title="these dump types also control period of output Period can be controlled for non-spatial dumps such as...">NUMDUMPTYPES</a>;i++){</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2e66e534829f48770a2d3f6fdade7cc8">dnumcolumns</a>[i]&gt;0){</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        logfprintf(<span class="stringliteral">&quot;i=%d\n&quot;</span>,i);</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        cpulinkptr=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a6a3789bd7a20d972bc209e81ea783878">cpulinkptr0</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        numlists=0;</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        numcells=0;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        <span class="keywordflow">while</span>(cpulinkptr!=NULL){</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;          numcells+=cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>;</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;          <span class="comment">// logfprintf(&quot;i=%d num=%d, cpu=%d, li=%d, lj=%d, lk=%d, col=%d, numtotal=%lld\n&quot;,i,cpulinkptr-&gt;num,cpulinkptr-&gt;cpu,cpulinkptr-&gt;i,cpulinkptr-&gt;j,cpulinkptr-&gt;k,cpulinkptr-&gt;col,numcells);</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;          numlists++;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;          cpulinkptr=cpulinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a279c79caaa6d7945fc75adc1e1796506">np</a>; <span class="comment">// next one</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;        }</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;        logfprintf(<span class="stringliteral">&quot;i=%d numlists=%lld numcells=%lld\n&quot;</span>,i,numlists,numcells);</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        numlists=0;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;      }</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    }</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  }</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;}</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="keywordtype">int</span> setuplinklist(<span class="keywordtype">int</span> numcolumns,<span class="keywordtype">int</span> which)</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;{</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> gcount,lcount,numlinks;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,<a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>,<a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>,li,lj,lk,pi,pj,pk,pid,firstlink;</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * clinkptr0, *clinkptr;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * linkptr0for0, *linkptrfor0;</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *lcountfor0;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> firstlinkfor0;</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *firstlijk,*li0,*lj0,*lk0,*lcol0;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/da7/structblink.html#a0d5d59cde1e1a32793842646ee151eec">ri</a>,<a class="code" href="../../d8/da7/structblink.html#a94cb4a5d42be74aa7c7819b7aea01883">rj</a>,<a class="code" href="../../d8/da7/structblink.html#aafb5230213b571837d2ca73dbdd83388">rk</a>,<a class="code" href="../../d8/da7/structblink.html#afdb9601bdbb28cdddcee3d82a5eebfa5">rcol</a>;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> *cpulist0;</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numcpusinlist0,lcpu,itercpu,buffersize;</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> maxnumsize;</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  set_maxnumsize(numcolumns,&amp;maxnumsize);</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;  <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="comment">// cpulist0&#39;s size is maximum possible number of cpus in a list due to buffer size</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    <span class="comment">//    buffersize=(int)(ceil(ceil((FTYPE)(N1*N2*N3*NUMBUFFERS)/(FTYPE)numcolumns)*(FTYPE)(numcolumns)/(FTYPE)N1));</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    buffersize=<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;max cpus in a list=%lld\n&quot;</span>,buffersize); fflush(stderr);</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    <span class="keywordflow">if</span>((cpulist0=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)*buffersize))==NULL){</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate cpulist0\n&quot;</span>);</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;      myexit(10012);</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    }</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keywordflow">if</span>((lcountfor0=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)*numprocs))==NULL){</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate lcountfor0\n&quot;</span>);</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      myexit(10013);</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    }</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    <span class="keywordflow">if</span>((firstlijk=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)*numprocs))==NULL){</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate firstlijk\n&quot;</span>);</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;      myexit(10014);</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    }</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;    <span class="keywordflow">if</span>((li0=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)*numprocs))==NULL){</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate li0\n&quot;</span>);</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      myexit(10015);</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    }</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    <span class="keywordflow">if</span>((lj0=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)*numprocs))==NULL){</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate lj0\n&quot;</span>);</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      myexit(10016);</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    }</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    <span class="keywordflow">if</span>((lk0=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)*numprocs))==NULL){</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate lk0\n&quot;</span>);</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      myexit(10017);</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    }</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="keywordflow">if</span>((lcol0=(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)*numprocs))==NULL){</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate lcol0\n&quot;</span>);</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;      myexit(10018);</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    }</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;buffersize;i++){</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;      cpulist0[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=0;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;    }</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      lcountfor0[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=firstlijk[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=li0[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=lj0[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=lk0[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=lcol0[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=0;</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    }</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;  }</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;  numcpusinlist0=0;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  clinkptr0=NULL;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  gcount=0;</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  lcount=0;</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  numlinks=0;</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;  firstlink=1;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;  <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;    <span class="keywordflow">for</span>(itercpu=0;itercpu&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;itercpu++){  firstlijk[itercpu]=1; }</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    linkptr0for0=NULL;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    firstlinkfor0=1;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;  }</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;  <span class="comment">// general loop</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>*<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;k++)  <span class="keywordflow">for</span>(j=0;j&lt;ncpux2*<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;j++)  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;i++) <span class="keywordflow">for</span>(col=0;col&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a3a47380236d4eb5437b8fbce2d881756">numcolumns</a>;col++){</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;          <span class="comment">// relative local index</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;          li=i%<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;          lj=j%<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;          lk=k%<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;          <span class="comment">// cpu position number</span></div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;          pi=(i/(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N1);</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;          pj=(j/(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N2);</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;          pk=(k/(<span class="keywordtype">long</span> <span class="keywordtype">long</span> int)N3);</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;          <span class="comment">// cpu id for this data</span></div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;          pid=pk*ncpux2*<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>+pj*<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>+pi;</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;          <span class="keywordflow">if</span>(myid==pid) lcount++;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;          <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;            lcountfor0[pid]++;</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;            <span class="comment">// below is if we have need this cpu&#39;s data (pid) and need to mark starting point on full grid</span></div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;            <span class="keywordflow">if</span>(firstlijk[pid]){</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;              cpulist0[numcpusinlist0++]=pid;</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;              li0[pid]=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;              lj0[pid]=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;              lk0[pid]=<a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;              lcol0[pid]=<a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;              <span class="keywordflow">if</span>(col!=0){</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;                dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;col!=0 col=%lld, so chunking bad: numcolumns=%d which=%d\n&quot;</span>,col,numcolumns,which);</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                myexit(10019);</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;              }</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;              firstlijk[pid]=0;</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;            }</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;          }</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;          gcount++;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;          <span class="comment">//    if(myid==0){</span></div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;          <span class="comment">//  dualfprintf(fail_file,&quot;%lld %lld %lld %lld\n&quot;,numcpusinlist0,gcount,pid,cpulist0[numcpusinlist0]); fflush(fail_file);</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;          <span class="comment">// }</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;          <span class="comment">//    logfprintf(&quot;%lld %lld %lld %lld %lld %lld %lld %lld\n&quot;,li,lj,lk,pi,pj,pk,pid,lcount,gcount);</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;          <span class="comment">// 1st below if is to catch every buffer amount, while 2nd if part is needed to account for when the number of buffers is such that the last buffer isn&#39;t completely needed</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;          <span class="comment">// this should work for any numcolumns or NUMBUFFERS, even at very last zone no matter what</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;          <span class="comment">// chunk in minimum size of numcolumns</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;          <span class="keywordflow">if</span>((gcount%(gcountmod(numcolumns))==0)||(gcount==(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)<a class="code" href="../../dd/d46/mpidefs_8h.html#a38e1083345af2cf99e31d941f18b56ad">totalzones</a>*(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)numcolumns)){</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;            <span class="comment">// ok, so numcolumns can&#39;t exceed the buffer size, highly unlikely to happen, and checked for!</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;            <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;              <span class="comment">// must do in order determined to have data, not numerical order</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;              <span class="keywordflow">for</span>(itercpu=0;itercpu&lt;numcpusinlist0;itercpu++){</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                lcpu=cpulist0[itercpu];</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                <span class="keywordflow">if</span>(lcountfor0[lcpu]&gt;0){</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                  <span class="keywordflow">if</span>(itercpu==0){ <span class="comment">// first cpu in list</span></div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                    ri=li0[lcpu];</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                    rj=lj0[lcpu];</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;                    rk=lk0[lcpu];</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;                    rcol=lcol0[lcpu];</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;                  }</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                  <span class="keywordflow">if</span>(firstlinkfor0){</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                    linkptrfor0=linkptr0for0=addlink(NULL);</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                    firstlinkfor0=0;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                  }</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                    linkptrfor0=addlink(linkptrfor0);</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;                  }</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a029d9c7e7a1b5336167b9074aab14439">cpu</a>=lcpu;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>=lcountfor0[lcpu];</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#ad751b0e28d9c08f811b70a1af53cabc3">i</a>=li0[lcpu];</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a9e26c2cdaebe8faf853df86f56f320da">j</a>=lj0[lcpu];</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>=lk0[lcpu];</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#aaaa47ff390e238f90b7025573f0ee8a3">col</a>=lcol0[lcpu];</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a0d5d59cde1e1a32793842646ee151eec">ri</a>=<a class="code" href="../../d8/da7/structblink.html#a0d5d59cde1e1a32793842646ee151eec">ri</a>;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a94cb4a5d42be74aa7c7819b7aea01883">rj</a>=<a class="code" href="../../d8/da7/structblink.html#a94cb4a5d42be74aa7c7819b7aea01883">rj</a>;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#aafb5230213b571837d2ca73dbdd83388">rk</a>=<a class="code" href="../../d8/da7/structblink.html#aafb5230213b571837d2ca73dbdd83388">rk</a>;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#afdb9601bdbb28cdddcee3d82a5eebfa5">rcol</a>=<a class="code" href="../../d8/da7/structblink.html#afdb9601bdbb28cdddcee3d82a5eebfa5">rcol</a>;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;                  linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a2cc61bb19195c7b9a2c4cc5f03705ed6">end</a>=0;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;     </div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                  lcountfor0[lcpu]=0; <span class="comment">// reset counter for this id</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;                  firstlijk[lcpu]=1; <span class="comment">// reset starting value</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                }</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;                  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;wtf: shoudn&#39;t be here.  Maybe passed more CPUs to batch system (mpirun) than passed to code?\n&quot;</span>);</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;                  myexit(10020);</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;                }</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;              }</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;              <span class="comment">// the last link is here identified as the last in the series of cpus to communicate with.  There&#39;s at least one new link here!</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;              linkptrfor0-&gt;<a class="code" href="../../d8/da7/structblink.html#a2cc61bb19195c7b9a2c4cc5f03705ed6">end</a>=1;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;              numcpusinlist0=0; <span class="comment">// reset list of cpus for this list</span></div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;            }</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;            <span class="keywordflow">if</span>(lcount&gt;0){</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;              logfprintf(<span class="stringliteral">&quot;numcolumns=%d lcount=%lld\n&quot;</span>,numcolumns,lcount); </div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;              <span class="comment">// initialize another structure</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;              <span class="comment">// set previous structure value to this structure, set this next one to NULL</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;              <span class="keywordflow">if</span>(firstlink){</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;                clinkptr=clinkptr0=addlink(NULL);</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;                clinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>=lcount;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;                firstlink=0;</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;              }</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;              <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                clinkptr=addlink(clinkptr);</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                clinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a64a20876ae40d058bdfaa475e8b481be">num</a>=lcount;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;              }</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;              lcount=0;</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;            }</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;          }<span class="comment">// otherwise continue</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        }      <span class="comment">// now we have a link list for each cpu that determines how long each next buffer is that needs to be sent to cpu=0</span></div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a20cfabf76fa7dff1137eeaf6508d6db3">blinkptr0</a>[which]=clinkptr0;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a6a3789bd7a20d972bc209e81ea783878">cpulinkptr0</a>[which]=linkptr0for0;</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;}</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * addlink(<span class="keyword">struct</span> <a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> * clinkptr)</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;{</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> *pb;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  pb=(<span class="keyword">struct </span><a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a> *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d8/da7/structblink.html" title="none of below blink integers should be nearly as large as 32-bit signed integer can handle...">blink</a>));</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;  pb-&gt;<a class="code" href="../../d8/da7/structblink.html#a279c79caaa6d7945fc75adc1e1796506">np</a>=NULL; <span class="comment">// terminate list</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  <span class="comment">// set last link&#39;s pointer to this new structure</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;  <span class="keywordflow">if</span>(clinkptr!=NULL) clinkptr-&gt;<a class="code" href="../../d8/da7/structblink.html#a279c79caaa6d7945fc75adc1e1796506">np</a>=pb;</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  <span class="keywordflow">return</span>(pb);</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;}</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:34 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
