<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: fluxctstag.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fluxctstag.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d0/dde/fluxctstag_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;decs.h&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> rescale_calc_stagfield_full(<span class="keywordtype">int</span> *Nvec, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR2INTERP],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR2INTERP]);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="code" href="../../d0/de6/fluxvpot_8funcdeclare_8h.html#aecb3f613a7cb3bbb42fff2dbee5d65a1">   72</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#aecb3f613a7cb3bbb42fff2dbee5d65a1" title="This vpot2field function is for staggered method to evolve quasi-deaveraged fields (i...">vpot2field_staggeredfield</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*A)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pfield)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ufield)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR])</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;{</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">int</span> Nvec[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#if(FIELDSTAGMEM==0)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor"></span>  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Set FIELDSTAGMEM==1 to do FLUXCTSTAG\n&quot;</span>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  myexit(7158915);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">/* flux-staggered */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// note A_i is always at CORN1,2,3 (edges) for any method, so init.c remains the same</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// all comments same as for centered field -- only change is no averaging of A_i to faces from edges (CORN1,2,3)</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  Nvec[0]=0;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  Nvec[1]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  Nvec[2]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  Nvec[3]=<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// now with double-quasi-deaveraged A_i compute B^i</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// use Nvec in case 1-D then if Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1 then don&#39;t assign dir field since constant in time and not zero as would be determined here</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// pfield should be from de-(laterally)-averaged ufield at FACE1,2,3</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// since nowait&#39;ed above (because each loop sets ufield,pfield for each dir that don&#39;t depend upon eachother), need barrier here at end to stop before continuing (implied in parallel reigon)</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#pragma omp parallel </span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordtype">int</span> dir;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> igdetgnosing[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">int</span> odir1,odir2;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> geomfdontuse[NDIM];</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgeomf[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>; <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a7518365209531b952c067f47c80777c2" title="COMPFULLLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPFULL</a>; <span class="comment">// doesn&#39;t depend upon dir, but blockijk must be private</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// generally ptr&#39;s are different inside parallel block</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) ptrgeomf[jj]=&amp;(geomfdontuse[jj]);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    dir=1;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    get_odirs(dir,&amp;odir1,&amp;odir2);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span>(!(Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1)){</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="comment">// ufield doesn&#39;t require geometry</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>)  = +(<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#afec1004eeb57ccd1533a59331c76fe1f" title="do-nothing functions">NOAVGCORN_1</a>(A[3],i,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3e64aa2cd3c5e0933e74fa4e7a925570">jp1mac</a>(j),k)-<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#afec1004eeb57ccd1533a59331c76fe1f" title="do-nothing functions">NOAVGCORN_1</a>(A[3],i,j,k))/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[2]);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>) += -(<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#afec1004eeb57ccd1533a59331c76fe1f" title="do-nothing functions">NOAVGCORN_1</a>(A[2],i,j,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#aafe7c78a2d0713ddc9a4f1c61764e3b9">kp1mac</a>(k))-<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#afec1004eeb57ccd1533a59331c76fe1f" title="do-nothing functions">NOAVGCORN_1</a>(A[2],i,j,k))/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[3]);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgeomf[dir]);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgeomf[dir]);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        igdetgnosing[dir] = ptrgeomf[dir]-&gt;igdetnosing;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pfield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir)  = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir)*igdetgnosing[dir];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }<span class="comment">// end if</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    dir=2;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    get_odirs(dir,&amp;odir1,&amp;odir2);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span>(!(Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1)){</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>)  = +(<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ac7bdcd216d9cb36e127714c454a2a3fc">NOAVGCORN_2</a>(A[1],i,j,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#aafe7c78a2d0713ddc9a4f1c61764e3b9">kp1mac</a>(k))-<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ac7bdcd216d9cb36e127714c454a2a3fc">NOAVGCORN_2</a>(A[1],i,j,k))/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[3]);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>) += -(<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ac7bdcd216d9cb36e127714c454a2a3fc">NOAVGCORN_2</a>(A[3],<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a27e1e0a92af691ffd03d7e9d0a628392">ip1mac</a>(i),j,k)-<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ac7bdcd216d9cb36e127714c454a2a3fc">NOAVGCORN_2</a>(A[3],i,j,k))/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[1]);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgeomf[dir]);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgeomf[dir]);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        igdetgnosing[dir] = ptrgeomf[dir]-&gt;igdetnosing;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pfield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir)  = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir)*igdetgnosing[dir];</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    dir=3;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    get_odirs(dir,&amp;odir1,&amp;odir2);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span>(!(Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1)){</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>)  = +(<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ad294836835312e70c47c93a054a5bfac">NOAVGCORN_3</a>(A[2],<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a27e1e0a92af691ffd03d7e9d0a628392">ip1mac</a>(i),j,k)-<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ad294836835312e70c47c93a054a5bfac">NOAVGCORN_3</a>(A[2],i,j,k))/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[1]);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>) += -(<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ad294836835312e70c47c93a054a5bfac">NOAVGCORN_3</a>(A[1],i,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3e64aa2cd3c5e0933e74fa4e7a925570">jp1mac</a>(j),k)-<a class="code" href="../../d8/d7d/global_8fieldmacros_8h.html#ad294836835312e70c47c93a054a5bfac">NOAVGCORN_3</a>(A[1],i,j,k))/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[2]);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgeomf[dir]);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgeomf[dir]);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        igdetgnosing[dir] = ptrgeomf[dir]-&gt;igdetnosing;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pfield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir)  = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ufield,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir)*igdetgnosing[dir];</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }<span class="comment">// end full parallel region (with implied barrier)</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,ufield, 0);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,pfield, 0);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a4e3d76c6ad125b8199948408c262e3a1">  203</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a77a38ff10f7d1d0a073866bd154c52b6" title="wrapper for: 1) interpolate FACE 2 CORN 2) loop over dimensions setting field flux dimension-by-dimen...">fluxcalc_fluxctstag</a>(<span class="keywordtype">int</span> stage,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                        <span class="keywordtype">int</span> initialstep, <span class="keywordtype">int</span> finalstep,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pl_ct)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pr_ct)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR2INTERP],</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                        <span class="comment">//   FTYPE (*pbcorn)[COMPDIM][NUMCS][NSTORE1+SHIFTSTORE1][NSTORE2+SHIFTSTORE2][NSTORE3+SHIFTSTORE3],</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pvbcorn)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>][<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>+1][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>],</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*wspeed)[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>],</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prc)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                        <span class="keyword">struct</span> <a class="code" href="../../d1/d83/structof__state.html" title="state structure">of_state</a> (*fluxstatecent)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3],</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                        <span class="keyword">struct</span> <a class="code" href="../../d1/d83/structof__state.html" title="state structure">of_state</a> (*fluxstate)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#acecb4a1a3cc5a2447852be5a5d74cab2">NUMLEFTRIGHT</a>],</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*geomcorn)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][NSTORE3+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>],</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                        <span class="keywordtype">int</span> *Nvec, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dqvec[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*fluxvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac14b9db972c66ce6df62cb4d4faa6ded">NSPECIAL</a>],</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*vpot)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][NSTORE3+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>],</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                        <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *CUf, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *CUnew, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> fluxdt, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> fluxtime, <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *cent2faceloop, <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> (*face2cornloop)[NDIM][NDIM]</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        )</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;{</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a985ee116306b4011810334ae93900493" title="INPUTS: Nvec, pr, primface_l[dir], primface_r[dir] OUTPUTS: pbcorn[dir][side], pvcorn[dir][side][side...">interpolate_prim_face2corn</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primface_l)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primface_r)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                                 <span class="comment">//     FTYPE (*pbcorn)[COMPDIM][NUMCS][NSTORE1+SHIFTSTORE1][NSTORE2+SHIFTSTORE2][NSTORE3+SHIFTSTORE3],</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                 <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pvbcorn)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][NSTORE3+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>][<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>+1][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>],</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                 <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *cent2faceloop, <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> (*face2cornloop)[NDIM][NDIM],</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                 <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prc)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                 <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                 <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                 <span class="keywordtype">int</span> *Nvec, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dqvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP]);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">int</span> dir;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">int</span> idel, jdel, kdel, face;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">int</span> is, ie, js, je, ks, ke;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a2dd789bf1402bef72523cdb69e85806e" title="use global pbcorninterp and pvcorninterp at CORN1,2,3 to obtain EMFs at CORN1,2,3 NO interpolation of...">fluxcalc_fluxctstag_emf_1d</a>(<span class="keywordtype">int</span> stage, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> odir1, <span class="keywordtype">int</span> odir2, <span class="keywordtype">int</span> is, <span class="keywordtype">int</span> ie, <span class="keywordtype">int</span> js, <span class="keywordtype">int</span> je, <span class="keywordtype">int</span> ks, <span class="keywordtype">int</span> ke, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*fluxvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac14b9db972c66ce6df62cb4d4faa6ded">NSPECIAL</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> CUf, <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> (*face2cornloop)[NDIM],</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                 <span class="comment">//     FTYPE (*pbcorn)[COMPDIM][NUMCS][NSTORE1+SHIFTSTORE1][NSTORE2+SHIFTSTORE2][NSTORE3+SHIFTSTORE3],</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                 <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pvbcorn)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][NSTORE3+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>][<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>+1][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>],</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                 <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*wspeed)[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3]);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">int</span> edgedir, odir1,odir2;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">//  static int firsttime=1;</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordtype">int</span> enerregion;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">int</span> *localenerpos;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// forCOMPZSLOOP:</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// avoid looping over region outside active+ghost grid</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// good because somewhat general and avoid bad inversions, etc.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  enerregion=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada79b005f9c0caf71f9365c1e16d8c80">TRUEGLOBALWITHBNDENERREGION</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  localenerpos=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad41a84c69f5ec4a51492e96b4dc61ac4">enerposreg</a>[enerregion];</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="comment">// first obtain pbinterp and pvinterp (point CORN1,2,3 quantities) from pl_ct and pr_ct (FACE1,2,3 quantities)</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">// This can&#39;t be done per dimension since flux needs multi-D quantities for 2D Riemann problem...hence why stored and outside dimenloop</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"></span>  <a class="code" href="../../d0/dde/fluxctstag_8c.html#a985ee116306b4011810334ae93900493" title="INPUTS: Nvec, pr, primface_l[dir], primface_r[dir] OUTPUTS: pbcorn[dir][side], pvcorn[dir][side][side...">interpolate_prim_face2corn</a>(<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>, pl_ct, pr_ct, pvbcorn, cent2faceloop, face2cornloop,prc,pleft,pright,Nvec,dqvec);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// LOOP OVER EDGES (corresponds to EMF,edge directions, NOT face directions)</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a8cbb473515f18fcae523329c93f140dc">DIMENLOOP</a>(dir){</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    edgedir=dir;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// other dimensions</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// will be setting flux associated with d_t(Bodir1) and d_t(Bodir2) and setting flux(Bdir)-&gt;0</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    get_odirs(dir,&amp;odir1,&amp;odir2);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// skip to next dir if 1D such that EMF[dir] not needed since always cancels with itself</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// assumes set to 0 and if set to 0 once then always 0 (assume set to 0 in </span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span>(Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1){</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="comment">//      if(firsttime){</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="comment">// then ensure that really 0 and should remain 0 for entire evolution</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="comment">// don&#39;t need to set this except once assuming no other code sets to non-zero</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="comment">// No!  If those directions are 0 then flux isn&#39;t defined nor used</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="comment">//COMPZSLOOP( -N1BND, N1-1+N1BND, -N2BND, N2-1+N2BND, -N3BND, N3-1+N3BND ){</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="comment">//   MACP1A1(fluxvec,odir1,i,j,k,B1-1+odir2)=MACP1A1(fluxvec,odir2,i,j,k,B1-1+odir1)=MACP1A1(fluxvec,dir,i,j,k,B1-1+dir)=0.0;</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="comment">// }</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="comment">//      }</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">//loop over the interfaces where fluxes are computed -- atch, useCOMPZSLOOP( is, ie, js, je, ks, ke ) { ... }</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// since looping over edges (emfs) and flux loop different than emf loop, then expand loops so consistent with both fluxes corresponding to that emf</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    is=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2949e234d496b691cf10c1e4a4ff9b32">emffluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aefa679918e336291a5fb0e5cfd0dc269">FIS</a>];</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    ie=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2949e234d496b691cf10c1e4a4ff9b32">emffluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9efa612e7e6b889d1fd42e644bf3cce">FIE</a>];</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    js=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2949e234d496b691cf10c1e4a4ff9b32">emffluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a141f293b4491fd91a765cc74553edbea">FJS</a>];</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    je=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2949e234d496b691cf10c1e4a4ff9b32">emffluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a82364cc36a73d5f4c269b5ad8b9f0dd4">FJE</a>];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    ks=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2949e234d496b691cf10c1e4a4ff9b32">emffluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab2806eafbffb43c634853ab47d7fd7d7">FKS</a>];</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    ke=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2949e234d496b691cf10c1e4a4ff9b32">emffluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8de59f913fa18843ee34d376002f5bbc">FKE</a>];</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// dir corrsponds to *edge,emf* NOT face</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// CUf[2] is for flux updates</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a0163a499c88dd8b07688e3dbd7007f0e">MYFUN</a>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a2dd789bf1402bef72523cdb69e85806e" title="use global pbcorninterp and pvcorninterp at CORN1,2,3 to obtain EMFs at CORN1,2,3 NO interpolation of...">fluxcalc_fluxctstag_emf_1d</a>(stage, <a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>, dir, odir1, odir2, is, ie, js, je, ks, ke, fluxvec, CUf[2], face2cornloop[edgedir],pvbcorn,wspeed),<span class="stringliteral">&quot;flux.c:fluxcalc()&quot;</span>, <span class="stringliteral">&quot;fluxcalc_fluxctstag_1d&quot;</span>, dir);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">#if(PRODUCTION==0)</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor"></span>    trifprintf(<span class="stringliteral">&quot;%d&quot;</span>,dir);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor"></span>  }<span class="comment">// end DIMENLOOP(dir)</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor"></span>  bound_flux(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[1],fluxvec[2],fluxvec[3], 0);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>&gt;1) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[1], 0);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>&gt;1) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[2], 0);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>&gt;1) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[3], 0);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor"></span>  <span class="comment">// SUPERDEBUG: shouldn&#39;t be needed -- test</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;nstep=%ld steppart=%d\n&quot;</span>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#abc22cc0afe0fb7e6d806c41b87fac58b">LOOPF_23</a>{ <span class="comment">// debug only</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;j=%d emf[0]=%21.15g emf[N1]=%21.15g diff=%21.15g\n&quot;</span>,j,<a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(fluxvec,1,0,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>),<a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(fluxvec,1,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>),<a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(fluxvec,1,0,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>)-<a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(fluxvec,1,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>));</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">//MACP1A1(fluxvec,1,N1,j,k,B2)=MACP1A1(fluxvec,1,0,j,k,B2);</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">//    MACP1A1(fluxvec,2,N1,j,k,B1)=-MACP1A1(fluxvec,1,0,j,k,B2);</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">//    MACP1A1(fluxvec,1,N1,j,k,B2)=-MACP1A1(fluxvec,2,N1,j,k,B1);</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">//=-MACP1A1(fluxvec,2,N1,j,k,B1)=</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a10c2a32787a08dc5ca8ee25788232ab5" title="whether to redefine fields from A_i during evolution currently only done after each full timestep to ...">EVOLVEWITHVPOT</a>&gt;0 ||  <a class="code" href="../../da/d3e/definit_8h.html#a3a15a632c4a89c05af66b680733eb82c" title="whether to track and dump A_i the vector potential">TRACKVPOT</a>&gt;0){</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// Evolve A_i</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    evolve_vpotgeneral(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a11c4e99e1493d0c1914ad1ab313ea472">FLUXB</a>, stage, initialstep, finalstep, <a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>, Nvec, fluxvec, NULL, CUf, CUnew, fluxdt, fluxtime, vpot);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordtype">int</span> fluxvpot_modifyemfsuser=0;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  fluxvpot_modifyemfsuser=(<a class="code" href="../../da/d3e/definit_8h.html#a10c2a32787a08dc5ca8ee25788232ab5" title="whether to redefine fields from A_i during evolution currently only done after each full timestep to ...">EVOLVEWITHVPOT</a>&gt;0 ||  <a class="code" href="../../da/d3e/definit_8h.html#a3a15a632c4a89c05af66b680733eb82c" title="whether to track and dump A_i the vector potential">TRACKVPOT</a>&gt;0)&amp;&amp;(<a class="code" href="../../da/d3e/definit_8h.html#afa19081fb8e10c244016def1fe8f3ff7" title="more often makes sense to modify A_i and not EMF_i, since want A_i to be smooth so Bstag^i is compute...">MODIFYEMFORVPOT</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a996c6fb8bf888f7814a6109ec1140198" title="for MODIFYEMFORVPOT">MODIFYEMF</a> || <a class="code" href="../../da/d3e/definit_8h.html#afa19081fb8e10c244016def1fe8f3ff7" title="more often makes sense to modify A_i and not EMF_i, since want A_i to be smooth so Bstag^i is compute...">MODIFYEMFORVPOT</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a96c09590fd9cd1bd2355d61dab5325cc">MODIFYVPOT</a>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">if</span>(fluxvpot_modifyemfsuser==0){<span class="comment">// if didn&#39;t already call adjust_emfs() in fluxvpot above, have to allow user to be able to still modify emfs calling function directly</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">// User &quot;boundary conditions&quot; to modify EMFs/FLUXes</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    adjust_fluxctstag_emfs(fluxtime,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>,Nvec,fluxvec);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">//  firsttime=0;</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a2dd789bf1402bef72523cdb69e85806e">  394</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a2dd789bf1402bef72523cdb69e85806e" title="use global pbcorninterp and pvcorninterp at CORN1,2,3 to obtain EMFs at CORN1,2,3 NO interpolation of...">fluxcalc_fluxctstag_emf_1d</a>(<span class="keywordtype">int</span> stage, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> odir1, <span class="keywordtype">int</span> odir2, <span class="keywordtype">int</span> is, <span class="keywordtype">int</span> ie, <span class="keywordtype">int</span> js, <span class="keywordtype">int</span> je, <span class="keywordtype">int</span> ks, <span class="keywordtype">int</span> ke, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*fluxvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac14b9db972c66ce6df62cb4d4faa6ded">NSPECIAL</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> CUf, <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> (*face2cornloop)[NDIM],</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                               <span class="comment">//          FTYPE (*pbcorn)[COMPDIM][NUMCS][NSTORE1+SHIFTSTORE1][NSTORE2+SHIFTSTORE2][NSTORE3+SHIFTSTORE3],</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                               <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pvbcorn)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][NSTORE3+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>][<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>+1][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>],</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                               <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*wspeed)[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3])</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;{</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordtype">int</span> idel1,jdel1,kdel1;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordtype">int</span> idel2,jdel2,kdel2;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordtype">int</span> Nvec[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">// get direction offsets for array accesses</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment"></span>  Nvec[0]=0;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  Nvec[1]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  Nvec[2]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  Nvec[3]=<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  idel1 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir1][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a158ca926457b2c62875830147141748e">FIDEL</a>];</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  jdel1 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir1][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a90b513fe9dd3d28100473a9c72f3bda3">FJDEL</a>];</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  kdel1 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir1][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada7f7c41064faa66235ca2a6e49ec5e9">FKDEL</a>];</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  idel2 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir2][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a158ca926457b2c62875830147141748e">FIDEL</a>];</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  jdel2 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir2][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a90b513fe9dd3d28100473a9c72f3bda3">FJDEL</a>];</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  kdel2 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir2][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada7f7c41064faa66235ca2a6e49ec5e9">FKDEL</a>];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="comment">// flux loop : Extra &quot;expand&quot; zone for the purpose of averaging flux to get emf at corner.  Only used by field components, see flux_ct().</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="comment">// This loop is over interfaces where fluxes are evaluated -- atch</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">//#if((SIMULBCCALC==2)&amp;&amp;(TYPE2==1))</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">//  COMPFZLOOP(is,js,ks)</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">//#else</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">//#endif</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#pragma omp parallel </span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k,pl,pliter;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomdontuse;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeom=&amp;gdetgeomdontuse;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">int</span> m,l;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> emf2d[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>-1][<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>-1],c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>][<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>-1];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dB[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>-1],ctop[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>-1];</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> emffinal;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> geomcornodir1,geomcornodir2;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> topwave[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>-1],bottomwave[<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>-1];</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>; <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a8de37da93c3462c536ef830f2fbaee61" title="forced to be a computational loop, so start/stop cannot already have shifts in them (which is normal ...">OPENMP3DLOOPSETUP</a>(is,ie,js,je,ks,ke);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordtype">int</span> fluxmethodlocal;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> cmaxfactorodir1;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> cmaxfactorodir2;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> cminfactorodir1;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> cminfactorodir2;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize))</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="comment">// defaults</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      fluxmethodlocal=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a6b32259475937e434b03862c64fb86a3">fluxmethod</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>]; <span class="comment">// assume all B&#39;s are same.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      cmaxfactorodir1=1.0;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      cmaxfactorodir2=1.0;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      cminfactorodir1=1.0;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      cminfactorodir2=1.0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#if(OUTERRADIALSUPERFAST)</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor"></span>      <span class="comment">// force effective superfast condition on outer radial boundaries</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/dbf/metric_8h.html#abd133696cea6c0c1397c24e925e5039a">ISBLACKHOLEMCOORD</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>)){</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">if</span>(dir==3 &amp;&amp; odir1==1 &amp;&amp; <a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[1]+i==<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]){ fluxmethodlocal=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9961b06ca0e8af348eeb5595c5965902">HLLFLUX</a>; cminfactorodir1=0.0; }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">if</span>(dir==3 &amp;&amp; odir2==1 &amp;&amp; <a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[1]+i==<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1]){ fluxmethodlocal=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9961b06ca0e8af348eeb5595c5965902">HLLFLUX</a>; cminfactorodir2=0.0; }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">if</span>(dir==3 &amp;&amp; odir1==1 &amp;&amp; <a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[1]+i==0){ fluxmethodlocal=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9961b06ca0e8af348eeb5595c5965902">HLLFLUX</a>; cmaxfactorodir1=0.0; }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">if</span>(dir==3 &amp;&amp; odir2==1 &amp;&amp; <a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[1]+i==0){ fluxmethodlocal=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9961b06ca0e8af348eeb5595c5965902">HLLFLUX</a>; cmaxfactorodir2=0.0; }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">// pvcorninterp and pbcorninterp are defined to be used like below initializaiton in set_arrays.c</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="comment">//    for(pl2=1;pl2&lt;=COMPDIM;pl2++) for(pl=1;pl&lt;=COMPDIM;pl++) for(m=0;m&lt;NUMCS+1;m++) for(l=0;l&lt;NUMCS;l++)  GLOBALMACP1A3(pvbcorninterp,pl2,i,j,k,pl,m,l)=valueinit;</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="comment">// pvcorn must contain velocity in same frame as field primitive in order to avoid interpolating yet another set of quantities (even can&#39;t do just 1 extra since 2 directions to interpolate from and no way to keep symmetry of interpolations without doing 2 extras and (e.g.) averaging)</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="comment">// assume final EMF being too large for the local field ($B^2-E^2&gt;0$ or $\gamma^2\sim B^2/(B^2-E^2)$) will not be a problem since extra EMF at CORN would only increase field</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">// not formally inconsistent since didn&#39;t interpolate other velocity or field to same location</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="comment">//  for each edge/EMF (dir):</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="comment">//     1) There are 2 values for fields in each directions (odir1,odir2)</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="comment">//     2) There are 2x2 values for velocities in directions (odir1,odir2)</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="comment">//     3) Need to work out where interpolated quantities go</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="comment">// </span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="comment">// unsure if signature and overall sign will be right -- GODMARK</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="comment">// i,j,k should already be taken into account (i.e. no offsets to add)</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="comment">// emf in dir direction</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">for</span>(m=0;m&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>;m++) <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>;l++){</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          <span class="comment">// emf[+- in odir1][+- in odir2]</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          <span class="comment">// velocity in same positions as emf</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          <span class="comment">// for example, emf3[+-x][+-y] = By[+-x]*vx[+-x][+-y] - Bx[+-y]*vy[+-x][+-y]</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          <span class="comment">// below requires velocity to be lab-frame 3-velocity consistent with lab-frame 3-field primitive</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          <span class="comment">// see fluxct.c for signature definition of EMF and flux</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          <span class="comment">// m%3+1 gives next 1-&gt;2,2-&gt;3,3-&gt;1</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          <span class="comment">// 3-(4-m)%3 = (dir+1)%3+1 gives previous 1-&gt;3,2-&gt;1,3-&gt;2</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;          <span class="comment">// so odir1 is forward cyclic</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;          <span class="comment">// so odir2 is backward cyclic</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;          <span class="comment">// notice that the emf in total uses 4 fields and 4*2 velocities for 12 total quantities</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          <span class="comment">// not all pbcorn[][?] positions are used (have 3 only need 2 per dir)</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          <span class="comment">// pvcorn[which corner][which component in pl form][+-odir1][+-odir2]</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          <span class="comment">// pbcorn[which corner][which component in pl form][+-remaining direction that is not corn nor pl-dir]</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          emf2d[m][l] = </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="comment">//     + MACP3A0(pbcorn,dir,B1-1+odir2,m,i,j,k)*MACP4A0(pvcorn,dir,U1-1+odir1,m,l,i,j,k) </span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <span class="comment">//     - MACP3A0(pbcorn,dir,B1-1+odir1,l,i,j,k)*MACP4A0(pvcorn,dir,U1-1+odir2,m,l,i,j,k);</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            + <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir2,NUMCS,m)*<a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir1,m,l) </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            - <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir1,NUMCS,l)*<a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir2,m,l);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="comment">// get wave speeds (these are not interpolated yet to CORNER, they start at FACE regardless of STOREWAVESPEEDS==1,2)</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="comment">// note wspeed has NO sign information (for any case, including as set by global_vchar())</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">// c[CMIN,CMAX][0=odir1,1=odir2]</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="comment">// need to determine i,j,k to choose based upon odir value</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="comment">// -?del? since going from FACE to CORN</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">// del2 for c2d[][0] since wspeed[odir1] is wave going in odir1-direction, whereas other wavespeed to MAX with is in other (odir2) direction</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordflow">if</span>(Nvec[odir1]&gt;1){</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][0] = fabs(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir1,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>,i,j,k),+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir1,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>,i-idel2,j-jdel2,k-kdel2))))*cminfactorodir1;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][0] = fabs(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir1,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>,i,j,k),+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir1,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>,i-idel2,j-jdel2,k-kdel2))))*cmaxfactorodir1;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="comment">// GODMARK: shoud just set the offending wavespeed (associated with non-existing dimensional direction) to 1.0 so don&#39;t have this conditional</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="comment">// then speed doesn&#39;t matter, not set, so scale-out</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][0] = 1.0;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][0] = 1.0;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keywordflow">if</span>(Nvec[odir2]&gt;1){</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][1] = fabs(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir2,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>,i,j,k),+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir2,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>,i-idel1,j-jdel1,k-kdel1))))*cminfactorodir2;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][1] = fabs(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir2,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>,i,j,k),+<a class="code" href="../../df/d1c/global_8storage_8h.html#adc9c4ccd956c29eac8db8bd9ba946f38">MACP3A0</a>(wspeed,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>,odir2,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>,i-idel1,j-jdel1,k-kdel1))))*cmaxfactorodir2;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="comment">// then speed doesn&#39;t matter, not set, so scale-out</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][1] = 1.0;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][1] = 1.0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      ctop[0]    = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][0],c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][0]);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      ctop[1]    = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(c2d[CMIN][1],c2d[CMAX][1]);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="comment">// compute conserved dissipation term </span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="comment">// &quot;upper&quot; minus &quot;lower&quot; fields</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="comment">// dB[?] corresponds to ? meaning field direction, not interpolation or any other direction</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="comment">// dB[0] corresponds to dB[&quot;odir1&quot;]</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="comment">//      dB[0] = MACP3A0(pbcorn,dir,B1-1+odir1,1,i,j,k) - MACP3A0(pbcorn,dir,B1-1+odir1,0,i,j,k) ;</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      dB[0] = <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir1,NUMCS,1) - <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir1,NUMCS,0) ;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="comment">// dB[1] corresponds to dB[&quot;odir2&quot;]</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">//      dB[1] = MACP3A0(pbcorn,dir,B1-1+odir2,1,i,j,k) - MACP3A0(pbcorn,dir,B1-1+odir2,0,i,j,k) ;</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      dB[1] = <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir2,NUMCS,1) - <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,dir,i,j,k,odir2,NUMCS,0) ;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="comment">// compute emf</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="comment">// Del Zanna et al. (2003) has opposite sign in equations 44,45 since they define the electric field (E_i) whereas we define EMF=-gdet E_i</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="comment">// see fluxct.c comments</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="comment">// Sign of dissipative term is as for HLL flux, which since EMF and flux have different sign relationships for each direction/field, we have:</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="comment">// </span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="comment">// emf_1 = B^3 v^2 - B^2 v^3 = F2[B3] or -F3[B2]  : Dissipative terms: -(dB3) and +(dB2)</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="comment">// emf_2 = B^1 v^3 - B^3 v^1 = F3[B1] or -F1[B3]  : Dissipative terms: -(dB1) and +(dB3)</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="comment">// emf_3 = B^2 v^1 - B^1 v^2 = F1[B2] or -F2[B1]  : Dissipative terms: -(dB2) and +(dB1)</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="comment">// So since dissipative term order is EMF[edgedir] += dB[odir1]  + dB[odir2]</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="comment">// then we have:</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">// edgedir=1 odir1=2 odir2=3 , so need -dB[1] and +dB[0]</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="comment">// edgedir=2 odir1=3 odir2=1 , so need -dB[1] and +dB[0]</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">// edgedir=3 odir1=1 odir2=2 , so need -dB[1] and +dB[0]</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">// so same formula for all EMFs</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="comment">// below topwave[] are positive definite but could be 0.0 and then HLLFLUX formula not right</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      topwave[0]=c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][0] + c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][0];</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      topwave[1]=c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][1] + c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][1];</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">if</span>( (fluxmethodlocal==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9961b06ca0e8af348eeb5595c5965902">HLLFLUX</a>) &amp;&amp; (topwave[0]&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>) &amp;&amp; (topwave[1]&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>) ){</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        bottomwave[0]=1.0/topwave[0];</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        bottomwave[1]=1.0/topwave[1];</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">// HLL</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        emffinal = </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;          <span class="comment">// non-dissipative term</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          + (</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;             +c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][0]*c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][1]*emf2d[0][0]  <span class="comment">// emf has -odir1 -odir2, so wavespeed has +odir1 +odir2</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;             +c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][0]*c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][1]*emf2d[0][1]  <span class="comment">// emf has -odir1 +odir2, so wavespeed has +odir1 -odir2</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;             +c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][0]*c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][1]*emf2d[1][0]  <span class="comment">// emf has +odir1 -odir2, so wavespeed has -odir1 +odir2</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;             +c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][0]*c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][1]*emf2d[1][1]  <span class="comment">// emf has +odir1 +odir2, so wavespeed has -odir1 -odir2</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;             )*bottomwave[0]*bottomwave[1]</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;          <span class="comment">// dissipative terms</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          - <a class="code" href="../../d8/d5b/defs_8general_8h.html#a34256ac1b9f15cac78b574deef3397c1">EMFDISSIPATION</a>*(</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;             <span class="comment">// dB has d(B[odir2]) so wavespeed has +-odir1  (note d(B[odir1]) for +-odir1 is 0 due to divb=0) (i.e. otherwise would be 4 dissipation terms for 2D Riemann problem)</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;             c2d[CMIN][0]*c2d[CMAX][0]*bottomwave[0]*dB[1]</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;             )</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          + <a class="code" href="../../d8/d5b/defs_8general_8h.html#a34256ac1b9f15cac78b574deef3397c1">EMFDISSIPATION</a>*(</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;             <span class="comment">// dB has d(B[odir1]) so wavespeed has +-odir2  (note d(B[odir2]) for +-odir2 is 0 due to divb=0) (i.e. otherwise would be 4 dissipation terms for 2D Riemann problem)</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;             c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a41349685ec12c0ae4978fbb9780f7a1b">CMIN</a>][1]*c2d[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af54f93f6144a25245050831c9fe45a57">CMAX</a>][1]*bottomwave[1]*dB[0]</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;             )</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;          ;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">else</span>{ <span class="comment">// assume if not HLL then LAXF since only 2 methods for this routine</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment">// LAXF</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="comment">// dB and ctop flip odir&#39;s due to divb=0(i.e. otherwise would be 4 dissipation terms for 2D Riemann problem)</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        emffinal =</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          + 0.25*(emf2d[0][0]+emf2d[0][1]+emf2d[1][0]+emf2d[1][1])</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          - <a class="code" href="../../d8/d5b/defs_8general_8h.html#a34256ac1b9f15cac78b574deef3397c1">EMFDISSIPATION</a>*0.50*(ctop[0]*dB[1] - ctop[1]*dB[0]);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="comment">// set the fluxes (final flux is expected to have geometry on it)</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="comment">// B inside pbcorn was setup with geometry</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="comment">// assume that if on singularity where gdet=0 then interpolation gave good value on singularity</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="comment">// GODMARK: seems like issue with choice of how to treat gdet is related to presence (or not) of line current on singularity</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">//          For example, for POLARAXIS E_z will not be 0 if first used gdet and then interpolated, while if used gdet afterwards then will be 0</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="comment">//          Same ambiguity exists in fluxct.c</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">#if(CORNGDETVERSION==1)</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="preprocessor"></span>      <span class="comment">// even though only want geom.e, geom.e calculation could depend upon many things</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a872dfd0c4407ee5b6ff2a6b9bea3b2f0">get_geometry_geomeonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1068bcf25c9f187a8db0f422e0af64c8">CORN1</a>-1+dir, ptrgdetgeom); <span class="comment">// get geometry at CORN[dir] where emf is located</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="comment">// GODMARK: why use ptrgeom-&gt;e here and ptrgeom-&gt;g in most other places?</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      geomcornodir1=ptrgdetgeom-&gt;EOMFUNCMAC(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+odir1); <span class="comment">// which field ptrgeom-&gt;e doesn&#39;t matter as mentioned below</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      geomcornodir2=ptrgdetgeom-&gt;EOMFUNCMAC(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+odir2);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="preprocessor"></span>      geomcornodir1=1.0;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      geomcornodir2=1.0;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="preprocessor">#if(0) // DEBUG:</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>(i==26 &amp;&amp; j==40 &amp;&amp; k==0){</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ORIG: emf2d[1][1]=%21.15g emf2d[1][0]=%21.15g emf2d[0][1]=%21.15g emf2d[0][0]=%21.15g ctop[0]=%21.15g  ctop[1]=%21.15g dB[0]=%21.15g  dB[1]=%21.15g emffinal=%21.15g gdetcorn3=%21.15g\n&quot;</span>,emf2d[1][1],emf2d[1][0],emf2d[0][1],emf2d[0][0],ctop[0],ctop[1],dB[0],dB[1],emffinal,ptrgdetgeom-&gt;gdet);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ORIG: c2d[CMIN][0]=%21.15g c2d[CMAX][0]=%21.15g c2d[CMIN][1]=%21.15g c2d[CMAX][1]=%21.15g\n&quot;</span>,c2d[CMIN][0],c2d[CMAX][0],c2d[CMIN][1],c2d[CMAX][1]);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="comment">// see fluxct.c for definitions of signature</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="comment">// e.g. edgedir=3 gives F[1][B2]=E3 and F[2][B1]=-E3  F[3][B3]=0, which is correct.</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="comment">// Checked that correct for all edgedir&#39;s</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">// notice that geometries for field-type primitive must all be same for field since otherwise emf ptrgeom-&gt;e factor has a mixed association</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="keywordflow">if</span>(Nvec[odir1]&gt;1) <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(fluxvec,odir1,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+odir2) = + emffinal*geomcornodir2;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">if</span>(Nvec[odir2]&gt;1) <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(fluxvec,odir2,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+odir1) = - emffinal*geomcornodir1;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="keywordflow">if</span>(Nvec[dir]&gt;1) <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(fluxvec,dir,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir)     =   0.0;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="preprocessor">#if((WHICHEOM==WITHNOGDET)&amp;&amp;(NOGDETB1&gt;0)||(NOGDETB2&gt;0)||(NOGDETB3&gt;0))</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="preprocessor"></span>      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Makes no sense to have field with different geometry factor since flux,emf mixes those factors\n&quot;</span>);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      myexit(196826);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="comment">// done!</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    }<span class="comment">// end 3D LOOP</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  }<span class="comment">// end parallel region</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor"></span>  bound_flux(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[1],fluxvec[2],fluxvec[3], 0);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>&gt;1) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[1], 0);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>&gt;1) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[2], 0);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>&gt;1) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,fluxvec[3], 0);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;}</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#aaec26a518629175ecceefbaf6c84225e">  714</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#aaec26a518629175ecceefbaf6c84225e" title="wrapper for continuous interpolation for FACE_to_CENT">slope_lim_continuous_e2z</a>(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dq)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *face2centloop)</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;{</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a8dd1a8200cac33bfd5c4520a76285d69">slope_lim_linetype_c2e</a>(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> whichprimtype, <span class="keywordtype">int</span> interporflux, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*stencilvar)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP]);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a0d50fd876f4e61d909a1e006bac28387" title="whether primreal is p2interp can&#39;t assume this is true in general (e.g.">slope_lim_pointtype</a>(<span class="keywordtype">int</span> interporflux, <span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> pl, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> loc, <span class="keywordtype">int</span> continuous, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dq)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP]);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="comment">// TODOMARK: Can take discrete derivative so edge quantity at center, then c2e fully correct, and correctly interpolates as continuous.</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">// Like:</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="comment">//       0      1      2      3</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">//   B1     B1     B1     B1     B1 </span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="comment">//-&gt;   dB1    dB1    dB1    dB1</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="comment">//-&gt; interpolate as center to face giving:</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">//-&gt;  dl dr  dl dr  dl dr  dl dr  dl dr</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="comment">//-&gt; Now have left-right face values as well as center value of dB</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){ <span class="comment">// probably only pl=B1+dir-1;</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="comment">// difference oriented on difference in dir, otherwise full</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  }</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="comment">// SUPERGODMARK: preal is located at CENT always, but p2interp will be at FACE, so have to average preal inside to get correct location</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="comment">// SUPERGODMARK: Use continuous version, overrides use of (e.g.) PARALINE in favor of MC continuous.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a92ba38bd3818ec93d78ff7b9df352006">OLDNONCONT</a>==1 &amp;&amp; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6585d9bd1143ceccd32022319c48bb3c" title="defines which limiters are for interpline.c (rest are for interppoint.c)">LINEINTERPTYPE</a>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[dir]) ){ <span class="comment">// this overrides lim, but lim must still be set properly</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    get_loop(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1bd5713562c8e9b82b408577c3cbe021">INTERPLINETYPE</a>, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4f9c5397adf85a1e434b88e22078b5ff">ENOINTERPTYPE</a>, dir, face2centloop);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="comment">// 1 below means primitives instead of conserved quantities (used for loops)</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">// GODMARK: ENOMARK: pstag below may only contain field so can&#39;t be used for pressure indicator</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">// GODMARK: set_interppoint() inside this function sets starting and ending position for loops, and as set c2e always needs more than e2c for obtaining flux, so leaving as for c2e is fine for now</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a8dd1a8200cac33bfd5c4520a76285d69">slope_lim_linetype_c2e</a>(realisinterp, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#adfffac9f0ada9db5f6423d8db6397ad2">ENOPRIMITIVE</a>, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4f9c5397adf85a1e434b88e22078b5ff">ENOINTERPTYPE</a>, dir, idel, jdel, kdel, primreal, NULL, p2interp, pleft, pright);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">// ENOMARK: for ENO should really  use special _e2c_cont() function that assumes continuity is required GODMARK</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">//    slope_lim_linetype_e2c_cont(realisinterp, ENOPRIMITIVE, ENOINTERPTYPE, dir, idel, jdel, kdel, primreal, NULL, p2interp, pcent);</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// Should really interpolate such that continuous GODMARK</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// GODMARK: set_interppoint() inside this function sets starting and ending position for loops, and as set c2e always needs more than e2c for obtaining flux, so leaving as for c2e is fine for now</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordtype">int</span> loc;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordtype">int</span> continuous;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a92ba38bd3818ec93d78ff7b9df352006">OLDNONCONT</a>){</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      continuous=0;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>+dir-1;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      continuous=1;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    get_loop(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1c4cf01a4f5bf62d08861d2c0a8e3cac">INTERPPOINTTYPE</a>, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4f9c5397adf85a1e434b88e22078b5ff">ENOINTERPTYPE</a>, dir, face2centloop);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a0d50fd876f4e61d909a1e006bac28387" title="whether primreal is p2interp can&#39;t assume this is true in general (e.g.">slope_lim_pointtype</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4f9c5397adf85a1e434b88e22078b5ff">ENOINTERPTYPE</a>, realisinterp, pl, dir, loc, continuous, idel, jdel, kdel, primreal, p2interp, dq, pleft, pright); <span class="comment">// GODMARK: overwritting dq from other type of interpolation</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="comment">// TODOMARK: Then after interpolation, just sum-up from left-most-edge-value using derivative at edge to get centered quantities</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">// Get final values by doing:</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">// for linear interpolations, is continuous linear function within cell</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="comment">// Bc = Bfl + (3.0/8.0)*dl + (1.0/8.0)*dr</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="comment">// for parabolic interpolations, is continous parabolic function within cell</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">// Bc = Bfl + (1.0/3.0)*dB + (5.0/24.0)*dl - (1.0/24.0)*dr</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="comment">// assumes original interpolation of dB properly reduces in shocks, so in shock one reduces down to possibly DONOR so dl=dr=0</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,pleft, 0);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,pright, 0);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;}</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno"><a class="code" href="../../d0/de6/fluxvpot_8funcdeclare_8h.html#aa31dd83c96936277334c62e2098dd51d">  812</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a3c59ef3a54b18bbaf4970c13995dadfc" title="wrapper for taking staggered conserved field quantity and obtaining centered field quantity upoint en...">interpolate_ustag2fieldcent</a>(<span class="keywordtype">int</span> stage, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> boundtime, <span class="keywordtype">int</span> timeorder, <span class="keywordtype">int</span> numtimeorders, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*preal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*upoint)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pcent)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR])</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;{</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a6cd90dff56319085b32bc57c0c8b3cfd" title="this function called in initbase.c and during advance() here ustag is point value if dimension doesn&#39;...">ustagpoint2pstag</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*upoint)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR]);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a5e3dcbe89d6f8a9384cafb58afd7dbf4" title="interpolates field at FACE to field at CENT assuming field along itself is continuous">interpolate_pfield_face2cent</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*preal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ucent)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pcent)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *face2centloop, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dqvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prc)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <span class="keywordtype">int</span> *Nvec);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> face2cent[NDIM];</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordtype">int</span> finalstep;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dqvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR2INTERP];</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordtype">int</span> Nvec[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,boundtime,upoint, 0);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">// setup spatial sizes</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  Nvec[0]=0;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  Nvec[1]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  Nvec[2]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  Nvec[3]=<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="comment">// setup dq&#39;s if needed</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="comment">// called by advance() that doesn&#39;t have dq1,dq2,dq3 passed to it (yet), so access global dq1,dq2,dq3</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  dqvec[1]=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(dq1);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  dqvec[2]=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(dq2);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  dqvec[3]=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(dq3);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">// Actually updates field using conserved update (and inverts field)</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="comment">// next use of pstagscratch by fluxcalc() will be correct (see  setup_rktimestep() commends for RK4)</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <a class="code" href="../../d0/dde/fluxctstag_8c.html#a6cd90dff56319085b32bc57c0c8b3cfd" title="this function called in initbase.c and during advance() here ustag is point value if dimension doesn&#39;...">ustagpoint2pstag</a>(upoint,pstag);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordflow">if</span>(timeorder==numtimeorders-1) finalstep=1; <span class="keywordflow">else</span> finalstep=0;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">// Bound pstag</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="comment">// must bound pstag at FACE1,2,3 so enough boundary zones to interpolate to get field at CENT</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="comment">// note that unlike other conserved quantities, since field trivially inverted there is no issue with possible failure modes or fixups, so only need to bound once</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">// That is, we always update field as required for divb=0</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="comment">// bound_pstag() takes care of which quantities to bound (only bounding B1,B2,B3)</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#a6f4b963a50a7288964f01775f2f18bb9" title="normal bounding of staggered primitives">bound_pstag</a>(stage, finalstep, boundtime, preal, pstag, upoint, USEMPI);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">// note that ustag isn&#39;t bounded, but is used for divb calculation, which is thus only valid at active CENT cells -- but that&#39;s all that&#39;s in normal dumps unless FULLOUTPUT is used</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="comment">// pstagescratch should contain result of deaverage_ustag2pstag() -- gets utoinvert ready for inversion using guess pb</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="comment">// other quantities in utoinvert are unchanged by this function (and if needed de-averaging this didn&#39;t do it!)</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <a class="code" href="../../d0/dde/fluxctstag_8c.html#a5e3dcbe89d6f8a9384cafb58afd7dbf4" title="interpolates field at FACE to field at CENT assuming field along itself is continuous">interpolate_pfield_face2cent</a>(preal,pstag,upoint,pcent,face2cent,dqvec,<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(prc),<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pleft),<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pright),Nvec);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,boundtime,pcent);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// pstagscratch is at FACE1,2,3 and is primary field variable</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// pfield is at CENT and is dependent field variable</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// This means pstagscratch must be bounded as a flux1,2,3</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">// In MPI use pstag with boundflux()</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="comment">// In user bound, user must treat field differently knowing where field is located</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">// pfield at CENT does NOT need to be bounded itself since pstag is bounded and then interpolated in extended off-dir range in interpolate_pfield_face2cent() that uses slope_lim_continuous_e2z()</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// So only need to bound pstag like a flux -- need to bound before FACE_2_CENT interpolation</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="comment">// now have field at CENT wherever needed for both EMF at CORN1,2,3  AND  have enough for normal fluxes at faces</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="comment">// Note don&#39;t use CENT field to get field in direction of flux of any quantity -- revert to existing staggered value</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">// This is why don&#39;t need to bound the field at CENT</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a7412e36cf3d5e7d33fc25ccc5112eba0">  907</a></span>&#160;<span class="preprocessor">#define USTAG2PSTAGCONSTRAINEDLOOP 1 // should be 1</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00912"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a6cd90dff56319085b32bc57c0c8b3cfd">  912</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a6cd90dff56319085b32bc57c0c8b3cfd" title="this function called in initbase.c and during advance() here ustag is point value if dimension doesn&#39;...">ustagpoint2pstag</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ustag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR])</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;{</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordtype">int</span> Nvec[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  Nvec[0]=0;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  Nvec[1]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  Nvec[2]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  Nvec[3]=<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="comment">// get pstag from unew</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">// p should be de-averaged field at FACE1,2,3</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor">#pragma omp parallel </span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#aa0b35fa62bf99b1fb71d2318548fcac4" title="U staggered field to P staggered field OPTMARK: presume this function gets inlined.">ustag2pstag</a>(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <span class="keywordtype">int</span> k, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ustag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR]);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keyword">extern</span> <span class="keywordtype">void</span> get_stag_startendindices(<span class="keywordtype">int</span> *loop, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> *is,<span class="keywordtype">int</span> *ie,<span class="keywordtype">int</span> *js,<span class="keywordtype">int</span> *je,<span class="keywordtype">int</span> *ks,<span class="keywordtype">int</span> *ke);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k,pl,pliter;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d8/d9b/structof__loop.html#a597df6eb1502e8c4ee0ee78453b1976c">dir</a>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> igdetgnosing;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d8/d9b/structof__loop.html#aa065ad97b11c89b7a5edd54e2bbe433b">is</a>,<a class="code" href="../../d8/d9b/structof__loop.html#a7e290b9d135e07f75235db53680f64ae">ie</a>,<a class="code" href="../../d8/d9b/structof__loop.html#a3991c392bde0f5726882a22fc0366b76">js</a>,<a class="code" href="../../d8/d9b/structof__loop.html#a21ddbfdd15788badc149326ffd59ead2">je</a>,<a class="code" href="../../d8/d9b/structof__loop.html#a09fe3cf49e575a68dc5661c5bec4d5e9">ks</a>,<a class="code" href="../../d8/d9b/structof__loop.html#acfe34553561e82d1ea0a255e6d60e9c1">ke</a>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomfdontuse[NDIM];</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomf[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="comment">// generally ptr&#39;s are different inside parallel block</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) ptrgdetgeomf[jj]=&amp;(gdetgeomfdontuse[jj]);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="preprocessor">#if(USTAG2PSTAGCONSTRAINEDLOOP==0)</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// Not well-constrained</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a8cbb473515f18fcae523329c93f140dc">DIMENLOOP</a>(dir){</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      pl=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a7518365209531b952c067f47c80777c2" title="COMPFULLLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPFULL</a>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait // &quot;nowait&quot; ok because each pstag[B1,B2,B3] set independently</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="comment">// get geometry for face pre-interpolated values</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgdetgeomf[dir]); <span class="comment">// FACE1,FACE2,FACE3 each</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgdetgeomf[dir]);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        igdetgnosing = ptrgdetgeomf[dir]-&gt;igdetnosing;      </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl)  = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ustag,i,j,k,pl)*igdetgnosing;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      }</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    }</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="preprocessor">#else // else if constrained loops</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">// well-constrained to only update pstag where really want update</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// This ensures don&#39;t modify pstag outside well-defined box that defines current computational space</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">// do pl==B1</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    pl=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    dir=1;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    get_stag_startendindices(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab5c60dcb37b1f7e5642525031cd5cbcf">Uconsevolveloop</a>, dir, &amp;is,&amp;ie,&amp;js,&amp;je,&amp;ks,&amp;ke);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">//  dualfprintf(fail_file,&quot;dir=%d is=%d ie=%d js=%d je=%d ks=%d ke=%d\n&quot;,dir,is,ie,js,je,ks,ke);</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a8de37da93c3462c536ef830f2fbaee61" title="forced to be a computational loop, so start/stop cannot already have shifts in them (which is normal ...">OPENMP3DLOOPSETUP</a>(is,ie,js,je,ks,ke);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait // &quot;nowait&quot; ok because each pstag[B1,B2,B3] set independently</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="preprocessor"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <a class="code" href="../../d0/dde/fluxctstag_8c.html#aa0b35fa62bf99b1fb71d2318548fcac4" title="U staggered field to P staggered field OPTMARK: presume this function gets inlined.">ustag2pstag</a>(dir, i, j, k, ustag,pstag);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="comment">// do pl==B2</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    pl=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    dir=2;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    get_stag_startendindices(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab5c60dcb37b1f7e5642525031cd5cbcf">Uconsevolveloop</a>, dir, &amp;is,&amp;ie,&amp;js,&amp;je,&amp;ks,&amp;ke);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">//  dualfprintf(fail_file,&quot;dir=%d is=%d ie=%d js=%d je=%d ks=%d ke=%d\n&quot;,dir,is,ie,js,je,ks,ke);</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a8de37da93c3462c536ef830f2fbaee61" title="forced to be a computational loop, so start/stop cannot already have shifts in them (which is normal ...">OPENMP3DLOOPSETUP</a>(is,ie,js,je,ks,ke);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="preprocessor"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <a class="code" href="../../d0/dde/fluxctstag_8c.html#aa0b35fa62bf99b1fb71d2318548fcac4" title="U staggered field to P staggered field OPTMARK: presume this function gets inlined.">ustag2pstag</a>(dir, i, j, k, ustag,pstag);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="comment">// do pl==B3</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    pl=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    dir=3;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    get_stag_startendindices(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab5c60dcb37b1f7e5642525031cd5cbcf">Uconsevolveloop</a>, dir, &amp;is,&amp;ie,&amp;js,&amp;je,&amp;ks,&amp;ke);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">//  dualfprintf(fail_file,&quot;dir=%d is=%d ie=%d js=%d je=%d ks=%d ke=%d\n&quot;,dir,is,ie,js,je,ks,ke);</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a8de37da93c3462c536ef830f2fbaee61" title="forced to be a computational loop, so start/stop cannot already have shifts in them (which is normal ...">OPENMP3DLOOPSETUP</a>(is,ie,js,je,ks,ke);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="preprocessor"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <a class="code" href="../../d0/dde/fluxctstag_8c.html#aa0b35fa62bf99b1fb71d2318548fcac4" title="U staggered field to P staggered field OPTMARK: presume this function gets inlined.">ustag2pstag</a>(dir, i, j, k, ustag,pstag);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="preprocessor"></span>  }<span class="comment">// end parallel region (with implicit barrier)</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,pstag);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;}</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#aa0b35fa62bf99b1fb71d2318548fcac4"> 1048</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#aa0b35fa62bf99b1fb71d2318548fcac4" title="U staggered field to P staggered field OPTMARK: presume this function gets inlined.">ustag2pstag</a>(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <span class="keywordtype">int</span> k, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ustag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR])</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;{</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> igdetgnosing;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomfdontuse[NDIM];</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomf[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="comment">// assign memory</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) ptrgdetgeomf[jj]=&amp;(gdetgeomfdontuse[jj]);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  pl=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="comment">// get geometry for face pre-interpolated values</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgdetgeomf[dir]); <span class="comment">// FACE1,FACE2,FACE3 each</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgdetgeomf[dir]);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  igdetgnosing = ptrgdetgeomf[dir]-&gt;igdetnosing;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl)  = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ustag,i,j,k,pl)*igdetgnosing;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;}</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">// if not rescaling, then default is to interpolate \detg B^i rather than B^i -- more accurate for field-aligned flows (e.g. monopole)</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">// 0 : don&#39;t use gdet rescale.  Use normal rescale or no rescale.</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">// 1 : use gdet rescale</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">// 2 : use gdet rescale dependent on SPC coordinates.  \detg B1 alone 1-dir, B2 along 2-dir, and B3 along 3-dir (but \detg B3 just as fine)</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">// \detg B1 alone 1-dir for typical split-monopolar type field.</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">// B2 along 2-dir because B2 and B2hat are regular near pole and division by near-zero would be inaccurate at pole. Assumes B2 flips sign across pole in correct sense in boundary cells as viewed by active cells.  Also for EMF_1 or EMF_3 wouldn&#39;t make sense unless also interpolated \detg v2 that makes no sense either.</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">// B3 or \detg B3 along 3-dir is same.</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">// 1 might be fine because this is only used for face2cent, and using &quot;1&quot; instead of &quot;2&quot; allows even jumps in B2 (e.g. due to sign change) across the pole so CENT version of B2 higher order.</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">// However, experimentally found 1 leads to MANY more hot-&gt;entropy reductions.  So should use &quot;2&quot;</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#ae3f4e22e1f3f3e3282a1bfe18d55566e"> 1091</a></span>&#160;<span class="comment"></span><span class="preprocessor">#define IFNOTRESCALETHENUSEGDET 1</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01093"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#ad8fd7dcbbe819d42544e2e663b13fb13"> 1093</a></span>&#160;<span class="preprocessor">#define IFNOTRESCALETHENUSEGDETswitch(dir) (IFNOTRESCALETHENUSEGDET==1 || (IFNOTRESCALETHENUSEGDET==2 &amp;&amp; (ISSPCMCOORD(MCOORD)==0 || ISSPCMCOORD(MCOORD)==1 &amp;&amp; (dir==1 || dir==3))))</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> rescale_calc_stagfield_full(<span class="keywordtype">int</span> *Nvec, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP])</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;{</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordtype">int</span> nprlocalstart,nprlocalend;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordtype">int</span> nprlocallist[MAXNPR];</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="comment">// save choice for interpolations so can restore global variables after done</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    nprlocalstart=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    nprlocalend=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ae3d8ba1d892944d94ad9f496a3fb3566" title="goes over all/any npr lists for copying one list to another">PMAXNPRLOOP</a>(pl) nprlocallist[pl]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[pl];</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="preprocessor">#pragma omp parallel OPENMPGLOBALPRIVATEFORSTATEANDGEOMINTERPFULLNPR2INTERP // requires full copyin() changes npr2interp stuff</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordtype">int</span> pl,dir;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomfdontuse[NDIM];</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomf[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomfdontuse[NDIM];</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomf[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keyword">extern</span> <span class="keywordtype">int</span> rescale(<span class="keywordtype">int</span> which, <span class="keywordtype">int</span> dir, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>*newvar);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>; <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a7518365209531b952c067f47c80777c2" title="COMPFULLLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPFULL</a>;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="comment">// generally ptr&#39;s are different inside parallel block</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">// assign memory</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) ptrgeomf[jj]=&amp;(geomfdontuse[jj]);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) ptrgdetgeomf[jj]=&amp;(gdetgeomfdontuse[jj]);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="comment">// LOOP over faces (dimensions)</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a8cbb473515f18fcae523329c93f140dc">DIMENLOOP</a>(dir){ <span class="comment">// dimen loop because rescale() is at different locations</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="comment">//    odir1=dir%3+1;</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="comment">//    odir2=(dir+1)%3+1;</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="comment">//    if(Nvec[dir]==1 || (Nvec[dir]!=1 &amp;&amp; (Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1) ) ) continue; // later will copy if no such dimension or such dimension but other dimensions don&#39;t exist so field must be constant</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">if</span>(Nvec[dir]==1) <span class="keywordflow">continue</span>; <span class="comment">// later will copy if no such dimension</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      pl=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>=0; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0]=pl; <span class="comment">// B1,B2,B3 each</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) // NO, rescale() may set arbitrary p2interp&#39;s //nowait // p2interp[B1,B2,B3] set independently</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="preprocessor">#if(RESCALEINTERPFLUXCTSTAG &amp;&amp; RESCALEINTERP)</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="preprocessor"></span>        <span class="comment">// get geometry for face pre-interpolated values</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgeomf[dir]); <span class="comment">// FACE1,FACE2,FACE3 each</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        rescale(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aaafc209f4d4766edff6689f6e99445a1">DORESCALE</a>,dir,<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(pstag,i,j,k),ptrgeomf[dir],<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(p2interp,i,j,k));</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="preprocessor"></span>        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,pl) = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#ad8fd7dcbbe819d42544e2e663b13fb13">IFNOTRESCALETHENUSEGDETswitch</a>(dir)){</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;          <span class="comment">// get geometry for face pre-interpolated values</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;          <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgdetgeomf[dir]); <span class="comment">// FACE1,FACE2,FACE3 each</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,pl) *= (ptrgdetgeomf[dir]-&gt;gdet);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        }   </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      }<span class="comment">// end COMPFULLLOOP</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    }<span class="comment">// end over dirs</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  }<span class="comment">// end parallel region (with implicit barrier)</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="comment">// restore choice for interpolations from global variables</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="preprocessor">#pragma omp parallel</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="preprocessor"></span>  { <span class="comment">// must set npr2interp stuff inside parallel region since threadprivate</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>=nprlocalstart;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>=nprlocalend;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ae3d8ba1d892944d94ad9f496a3fb3566" title="goes over all/any npr lists for copying one list to another">PMAXNPRLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[pl]=nprlocallist[pl];</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;}</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a5e3dcbe89d6f8a9384cafb58afd7dbf4"> 1227</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a5e3dcbe89d6f8a9384cafb58afd7dbf4" title="interpolates field at FACE to field at CENT assuming field along itself is continuous">interpolate_pfield_face2cent</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*preal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ucent)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pcent)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *face2centloop, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dqvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prc)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <span class="keywordtype">int</span> *Nvec)</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;{</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR2INTERP];</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="keywordtype">int</span> nprlocalstart,nprlocalend;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="keywordtype">int</span> nprlocallist[MAXNPR];</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">// PROCEDURE:</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="comment">// 1) save interp list</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="comment">// 2) setup which quantities to interpolate</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// 3) rescale pstag (no need to unrescale since have separate memory for p2interp)</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">// 4) interpolate rescaled pstag (p2interp)</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">// 5) obtain pcent from dq or pleft/pright for simple interpolation/averaging method</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">// 6) copy fields if not interpolated/rescaled</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">// 7) restore interp list</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">// GODMARK: in 1D don&#39;t have to interpolate face2cent for field in dir-direction since has to be constant</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="comment">// save choice for interpolations so can restore global variables after done</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    nprlocalstart=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    nprlocalend=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ae3d8ba1d892944d94ad9f496a3fb3566" title="goes over all/any npr lists for copying one list to another">PMAXNPRLOOP</a>(pl) nprlocallist[pl]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[pl];</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">// rescale before interpolation</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a5219ecc2cdb7b068078fc30ffe491d64">RESCALEINTERPFLUXCTSTAG</a> &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#a6e5bd3275c7cd42b0c6da5a7a44ee5f0">RESCALEINTERP</a> || <a class="code" href="../../d0/dde/fluxctstag_8c.html#ae3f4e22e1f3f3e3282a1bfe18d55566e">IFNOTRESCALETHENUSEGDET</a>){</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    p2interp=prc; <span class="comment">// it&#39;s different</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="comment">// rescale or multiply by \sqrt{-g}</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    rescale_calc_stagfield_full(Nvec, pstag,p2interp);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  }</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    p2interp=pstag; <span class="comment">// it&#39;s itself</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  }</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="comment">// LOOP OVER FACES for each dimension</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="comment">// Peform interpolation on point quantity (even for ENO/FV method a2c_perps would be used before here)</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="preprocessor">#pragma omp parallel OPENMPGLOBALPRIVATEFORGEOMNPR2INTERP</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keyword">extern</span> <span class="keywordtype">int</span> choose_limiter(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> pl);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#aaec26a518629175ecceefbaf6c84225e" title="wrapper for continuous interpolation for FACE_to_CENT">slope_lim_continuous_e2z</a>(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dq)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *face2centloop);</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordtype">int</span> idel,jdel,kdel;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordtype">int</span> dir;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordtype">int</span> locallim;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> pstore_l[NPR2INTERP],pstore_r[NPR2INTERP];</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *p2interp_l,*p2interp_r;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p_l[NPR2INTERP], p_r[NPR2INTERP];</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordtype">int</span> usedq;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordtype">int</span> realisinterp;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordtype">int</span> odir1,odir2;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> igdetgnosing;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keywordtype">int</span> is,ie,js,je,ks,ke;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomcdontuse;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomc=&amp;geomcdontuse;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomfdontuse[NDIM];</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomf[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomcdontuse;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomc=&amp;gdetgeomcdontuse;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomfdontuse[NDIM];</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomf[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ucentgdet;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="comment">// assign memory</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) ptrgeomf[jj]=&amp;(geomfdontuse[jj]);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) ptrgdetgeomf[jj]=&amp;(gdetgeomfdontuse[jj]);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="comment">// Setup rescale pointer reference</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="preprocessor">#if(RESCALEINTERPFLUXCTSTAG &amp;&amp; RESCALEINTERP)</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="preprocessor"></span>    p2interp_l=pstore_l; <span class="comment">// then need separate storage</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    p2interp_r=pstore_r;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="preprocessor"></span>    p2interp_l=p_l; <span class="comment">// p2interp_? is final p_?</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    p2interp_r=p_r;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="comment">// GODMARK:  for now use standard interpolation and just force continuity by averaging (probably leads to unstable algorithm)</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a8cbb473515f18fcae523329c93f140dc">DIMENLOOP</a>(dir){</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      <span class="comment">//   odir1=dir%3+1;</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <span class="comment">//   odir2=(dir+1)%3+1;</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      <span class="comment">// for TESTNUMBER 1002, stag, recon, below causes peak of B2/B3 to be smaller -- NO IDEA WHY SUPERGODMARK</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      <span class="comment">// for same test, stag, fv method has small peak even with Nvec[dir]==1 only</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="comment">//if(Nvec[dir]==1 || (Nvec[dir]!=1 &amp;&amp; (Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1) ) ) continue; // later will copy if no such dimension or such dimension but other dimensions don&#39;t exist so field must be constant</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      <span class="comment">// setup which quantity to interpolate</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      pl = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>=0; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0]=pl; <span class="comment">// B1,B2,B3 each for each dir=1,2,3</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      <span class="keywordflow">if</span>(Nvec[dir]==1){</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="comment">// Copy if no such dimension or such dimension but other dimensions don&#39;t exist so field must be constant</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="comment">// copy over those things not interpolating (and hence not rescalig either)</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="comment">// unlike FACE_to_EDGE, these degenerate cases result in a trivial copy from the fake FACE to CENT</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="comment">// what&#39;s constant is \detg B^i, not B^i, so need geometry if field along 1D dir with no other dimensions</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="comment">// no idel,jdel,kdel for simplicity</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a7518365209531b952c067f47c80777c2" title="COMPFULLLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPFULL</a>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) nowait // don&#39;t wait for each dir since independent and all memory written to (and used in later loops) is independent for each dir.</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="preprocessor"></span>        <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;          <span class="keywordflow">if</span>(pcent!=NULL){</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pcent,i,j,k,pl)=<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;          }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;          <span class="comment">// get ucent if required</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;          <span class="keywordflow">if</span>(ucent!=NULL){<span class="comment">// OPTMARK: Is this expensive?</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            <span class="comment">// Note: If WHICHEOM==WITHNOGDET and turned off \detg for fields, then staggered method doesn&#39;t work, so ok to assume gdet below and assume standard primitive field such that \detg B^i = conserved quantity</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, ptrgdetgeomc); <span class="comment">// final quantity is at CENT</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ucent,i,j,k,pl)  = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl)*(ptrgdetgeomc-&gt;gdet); <span class="comment">// exactly correct (even for ENO/FV)</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;          }<span class="comment">// end if ucent!=NULL</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        }<span class="comment">// end 3D LOOP</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      }</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="keywordflow">else</span>{ <span class="comment">// Then Nvec[dir]!=1, so should treat field generally along this direction</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;   </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        <span class="comment">// get loop details</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        idel = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a158ca926457b2c62875830147141748e">FIDEL</a>];</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        jdel = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a90b513fe9dd3d28100473a9c72f3bda3">FJDEL</a>];</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        kdel = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[dir][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada7f7c41064faa66235ca2a6e49ec5e9">FKDEL</a>];</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="comment">// interpolate    </span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment"></span>        realisinterp=0; <span class="comment">// since only dealing with fields</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <a class="code" href="../../d0/dde/fluxctstag_8c.html#aaec26a518629175ecceefbaf6c84225e" title="wrapper for continuous interpolation for FACE_to_CENT">slope_lim_continuous_e2z</a>(realisinterp, dir, idel, jdel, kdel, preal, p2interp, dqvec[dir], pleft, pright, &amp;(face2centloop[dir]));</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  </div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <span class="comment">// get p_l p_r</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment"></span>        <span class="comment">//</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="comment">// interpolate primitive using slope (dq) or directly from pleft and pright</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="comment">// For FV: p_left, p_right (indexed by grid cell #) -&gt; p2interp_l, p2interp_r (indexed by interface #) -- atch comment</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        <span class="comment">// always do since p2interp is good and dq/pleft/pright should have stored quantities or just-computed quantities</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="comment">// Assume for now that limiter is not per i,j,k but only per dir (unlike normal interpolation)</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="comment">// no HORIZONSUPERFAST here</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        locallim=choose_limiter(dir, 0,0,0,pl);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        usedq = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a95b083f21944c381bcaaf6c8749fbcad">usedqarray</a>[locallim];</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    </div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="comment">// using COMPZSLOOP since final CENT quantity is used wherever centered primitive is needed for flux (which is sometimes transverse direction)</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="comment">// do maximal loop but avoid going out of bounds when accessing dqvec,pleft,pright</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="comment">// NOW do constrained loop</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        get_inversion_startendindices(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab5c60dcb37b1f7e5642525031cd5cbcf">Uconsevolveloop</a>,&amp;is,&amp;ie,&amp;js,&amp;je,&amp;ks,&amp;ke);</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a8de37da93c3462c536ef830f2fbaee61" title="forced to be a computational loop, so start/stop cannot already have shifts in them (which is normal ...">OPENMP3DLOOPSETUP</a>(is,ie,js,je,ks,ke);</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) </span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="preprocessor">        OPENMP3DLOOPBLOCK{</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="preprocessor"></span>          <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="preprocessor">#if(OLDNONCONT)</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="preprocessor"></span>          <span class="comment">// note that interpolation from FACE_to_CENT is different than from FACE_to_EDGE or CENT_to_FACE</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;          <span class="comment">// if not rescaling or auto-gdet rescaling, then p2interp_? is already really p_?, otherwise p2interp_? is separate memory from p_?</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;          <span class="keywordflow">if</span>(usedq){</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            p2interp_l[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,pl) + 0.5 * <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(dqvec,dir,i,j,k,pl);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            p2interp_r[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i + idel,j + jdel,k + kdel,pl) - 0.5 * <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(dqvec,dir,i + idel,j + jdel,k + kdel,pl);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;          }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;            p2interp_l[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pright,i,j,k,pl);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            p2interp_r[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pleft,i+idel,j+jdel,k+kdel,pl);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;          }</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="preprocessor"></span>          <span class="comment">// note that interpolation from FACE_to_CENT is different than from FACE_to_EDGE or CENT_to_FACE</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          <span class="comment">// if not rescaling or auto-gdet rescaling, then p2interp_? is already really p_?, otherwise p2interp_? is separate memory from p_?</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;          <span class="keywordflow">if</span>(usedq){</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            p2interp_r[pl] = p2interp_l[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,pl) + 0.5 * <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(dqvec,dir,i,j,k,pl);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;          }</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            p2interp_r[pl] = p2interp_l[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pright,i,j,k,pl); <span class="comment">// left at same i,j,k just set equal to right, so can ignore left.</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;          }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;          <span class="comment">// TEST ddq=0 equiv or behavior like Athena that just averages the faces so Bi along i is assumed to be piece-wise continuous linear</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;          <span class="comment">//   p2interp_r[pl] = p2interp_l[pl] = 0.5*(MACP0A1(p2interp,i,j,k,pl) + MACP0A1(p2interp,i+idel,j+jdel,k+kdel,pl));</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160; </div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;          <span class="comment">// after interpolation, unrescale from p2interp to normal primitive </span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment"></span><span class="preprocessor">#if(RESCALEINTERPFLUXCTSTAG &amp;&amp; RESCALEINTERP)</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="preprocessor"></span>          <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, ptrgeomc); <span class="comment">// final quantity is at CENT</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;          rescale(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae1a9ec504edd656084eeaad1a0b9496">UNRESCALE</a>,dir,p_l,ptrgeomc,p2interp_l);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;          rescale(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae1a9ec504edd656084eeaad1a0b9496">UNRESCALE</a>,dir,p_r,ptrgeomc,p2interp_r);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;          <span class="keywordflow">if</span>(ucent!=NULL) <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ucent,i,j,k,pl)  = 0.5*(p_l[pl]+p_r[pl])*(ptrgeomc-&gt;gdet); <span class="comment">// exactly correct (even for ENO/FV)</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="preprocessor">#elif(IFNOTRESCALETHENUSEGDET)</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="preprocessor"></span>          <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, ptrgdetgeomc); <span class="comment">// final quantity is at CENT</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;   </div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#ad8fd7dcbbe819d42544e2e663b13fb13">IFNOTRESCALETHENUSEGDETswitch</a>(dir)){</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgdetgeomc);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            igdetgnosing=ptrgdetgeomc-&gt;igdetnosing;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            ucentgdet=1.0;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          }</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            igdetgnosing=1.0;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            ucentgdet=(ptrgdetgeomc-&gt;gdet);</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;          }</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;          <span class="comment">// Assign \detg B^i (must come before p_{lr} mod since p2interp_{lr} pointer = p_{lr} pointer</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;          <span class="keywordflow">if</span>(ucent!=NULL) <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ucent,i,j,k,pl)=0.5*(p2interp_l[pl]+p2interp_r[pl])*ucentgdet; <span class="comment">// go ahead and assign ucent if this method</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;          <span class="comment">// now get B^i from \detg B^i</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;          <span class="comment">// remove \detg used during interpolation</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;          p_l[pl] = p2interp_l[pl]*igdetgnosing;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;          p_r[pl] = p2interp_r[pl]*igdetgnosing;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="preprocessor"></span>          <span class="comment">// otherwise p2interp_{l,r} are really just pointing to p_l and p_r</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;          <span class="keywordflow">if</span>(ucent!=NULL){</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, ptrgdetgeomc); <span class="comment">// final quantity is at CENT</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            <span class="comment">// Note: If WHICHEOM==WITHNOGDET and turned off \detg for fields, then staggered method doesn&#39;t work, so ok to assume gdet below and assume standard primitive field such that \detg B^i = conserved quantity</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ucent,i,j,k,pl)  = 0.5*(p2interp_l[pl]+p2interp_r[pl])*(ptrgdetgeomc-&gt;gdet); <span class="comment">// exactly correct (even for ENO/FV)</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;          }</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;   </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;          <span class="keywordflow">if</span>(pcent!=NULL){</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            <span class="comment">// now set pcent -- GODMARK -- should interpolate such that only 1 continuous value</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            <span class="comment">// Must preserve divb in 1D Riemann problem, so B^{dir} must be continuous</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            <span class="comment">// Yes, should use larger stencil and interpolate such that constant. Essentially choose</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            <span class="comment">// large stencil and effectively choosing which points we trust (not necessarily local points)</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pcent,i,j,k,pl)=0.5*(p_l[pl]+p_r[pl]);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;          }</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        }<span class="comment">// endCOMPZSLOOP</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      }<span class="comment">// end if N&gt;1</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    }<span class="comment">// end DIMENLOOP</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  }<span class="comment">// end parallel region (with implicit barrier)  </span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="comment">// restore choice for interpolations from global variables</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="preprocessor">#pragma omp parallel</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="preprocessor"></span>  { <span class="comment">// must set npr2interp stuff inside parallel region since threadprivate</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>=nprlocalstart;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>=nprlocalend;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ae3d8ba1d892944d94ad9f496a3fb3566" title="goes over all/any npr lists for copying one list to another">PMAXNPRLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[pl]=nprlocallist[pl];</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  }</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(pcent!=NULL) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,pcent);</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="keywordflow">if</span>(ucent!=NULL) <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,ucent);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;}</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div>
<div class="line"><a name="l01560"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#ad6aa918442f7768dff3c099ba353ee64"> 1560</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#ad6aa918442f7768dff3c099ba353ee64" title="slope_lim_face2corn() is provided p2interp and returns pleft/pright differs from slope_lim() by range...">slope_lim_face2corn</a>(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dq)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *face2cornloop)</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;{</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a8dd1a8200cac33bfd5c4520a76285d69">slope_lim_linetype_c2e</a>(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> whichprimtype, <span class="keywordtype">int</span> interporflux, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*stencilvar)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP]);</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a0d50fd876f4e61d909a1e006bac28387" title="whether primreal is p2interp can&#39;t assume this is true in general (e.g.">slope_lim_pointtype</a>(<span class="keywordtype">int</span> interporflux, <span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> pl, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> loc, <span class="keywordtype">int</span> continuous, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dq)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP]);</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordtype">int</span> interporflux;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a41163ae4887e295df142ae7fc9b4829c">extrazones4emf</a>){</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    interporflux=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#af568274249bf58693854019c37efeb31">ENOINTERPTYPE4EMF</a>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    </div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    interporflux=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4f9c5397adf85a1e434b88e22078b5ff">ENOINTERPTYPE</a>;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  }</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="comment">// SUPERGODMARK: primreal is located at CENT always, but p2interp can be at FACE in orthogonal direction, so have to average preal inside to get correct location</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordflow">if</span>( <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6585d9bd1143ceccd32022319c48bb3c" title="defines which limiters are for interpline.c (rest are for interppoint.c)">LINEINTERPTYPE</a>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[dir]) ){ <span class="comment">// this overrides lim, but lim must still be set properly</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">// ENOPRIMITIVE below means primitives instead of conserved quantities</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    get_loop(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1bd5713562c8e9b82b408577c3cbe021">INTERPLINETYPE</a>, interporflux, dir, face2cornloop);</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a8dd1a8200cac33bfd5c4520a76285d69">slope_lim_linetype_c2e</a>(realisinterp, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#adfffac9f0ada9db5f6423d8db6397ad2">ENOPRIMITIVE</a>, interporflux, dir, idel, jdel, kdel, primreal, NULL, p2interp, pleft, pright);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordtype">int</span> loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>+dir-1; <span class="comment">// CENT relative to direction of interpolation, but FACE1+dir-1 relative to primreal</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordtype">int</span> continuous=0;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    get_loop(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1c4cf01a4f5bf62d08861d2c0a8e3cac">INTERPPOINTTYPE</a>, interporflux, dir, face2cornloop);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <a class="code" href="../../d5/d2f/flux_8funcdeclare_8h.html#a0d50fd876f4e61d909a1e006bac28387" title="whether primreal is p2interp can&#39;t assume this is true in general (e.g.">slope_lim_pointtype</a>(interporflux,realisinterp, pl, dir, loc, continuous, idel, jdel, kdel, primreal, p2interp, dq, pleft, pright);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    }</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  }</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,pleft);</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,pright);</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;}</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div>
<div class="line"><a name="l01675"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a8d82691453c3286480b086f2d5ba47b6"> 1675</a></span>&#160;<span class="preprocessor">#define INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELD 2</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div>
<div class="line"><a name="l01691"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a63a7e2ed3141710a592e3568ace82601"> 1691</a></span>&#160;<span class="preprocessor">#define INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELDswitchuniboth(facedir,interpdir) (INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELD==1 || (INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELD==2 &amp;&amp; (ISSPCMCOORD(MCOORD)==0 || ISSPCMCOORD(MCOORD)==1 &amp;&amp; (facedir==1 &amp;&amp; (interpdir==1 || interpdir==3) || facedir==2 &amp;&amp; (interpdir==1 || interpdir==3) ||  facedir==3 &amp;&amp; (interpdir==1 || interpdir==3)   )))) // GODMARK: Want to allow interpdir==2 with facedir==3, but not working yet.</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div>
<div class="line"><a name="l01707"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a2cf628a7536b4c32b1bb2cdf28264085"> 1707</a></span>&#160;<span class="preprocessor">#define INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITY 0</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01712"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a7b6083b579b04d33e0a69a4a84ef461e"> 1712</a></span>&#160;<span class="preprocessor">#define INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITYswitchuniboth(facedir,odir) (INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITY==1 || (INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITY==2 &amp;&amp; (ISSPCMCOORD(MCOORD)==0 || ISSPCMCOORD(MCOORD)==1 &amp;&amp; (odir==1 || odir==3) )))</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#a985ee116306b4011810334ae93900493"> 1724</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#a985ee116306b4011810334ae93900493" title="INPUTS: Nvec, pr, primface_l[dir], primface_r[dir] OUTPUTS: pbcorn[dir][side], pvcorn[dir][side][side...">interpolate_prim_face2corn</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primface_l)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primface_r)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                               <span class="comment">//FTYPE (*pbcorn)[COMPDIM][NUMCS][NSTORE1+SHIFTSTORE1][NSTORE2+SHIFTSTORE2][NSTORE3+SHIFTSTORE3],</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                               <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pvbcorn)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][NSTORE3+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>][<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>+1][<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>],</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                               <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *cent2faceloop, <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> (*face2cornloop)[NDIM][NDIM],</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                               <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prc)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                               <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                               <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP],</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                               <span class="keywordtype">int</span> *Nvec, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dqvec[NDIM])[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP])</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;{</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR2INTERP];</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <span class="keywordtype">int</span> nprlocalstart,nprlocalend;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <span class="keywordtype">int</span> nprlocallist[MAXNPR];</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;  <span class="comment">// GODMARK: face2corn duplicates cent2face if in 1D</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="comment">// This causes FLUXCTSTAG method to be slightly slower than FLUXCTTOTH method even in 1D, and somewhat still in 2D since comparing simple averaging with full interpolation</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="comment">// save choice for interpolations</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  {</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    nprlocalstart=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    nprlocalend=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ae3d8ba1d892944d94ad9f496a3fb3566" title="goes over all/any npr lists for copying one list to another">PMAXNPRLOOP</a>(pl) nprlocallist[pl]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[pl];</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  }</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="comment">// Procedure: (follow interpolate_pfield_face2cent() above)</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  <span class="comment">// 1) Take primface_l and primface_2 and convert velocity term (have all components) to lab-frame 3-velocity (can&#39;t modify primface!!) -- so need another space? (vconemf?) FTYPE BASEMACP0A1(vconemf,N?M,...,NDIM-1);</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="comment">// 2) rescale() can be setup, but only for field since rescale() assumes input is primitive and after interpolation wouldn&#39;t be able to recover lab-frame 3-velocity cmponents if were using primitive velocity (unless WHICHVEL=VEL3, rarely used so no code for that special case when rescale() could be used)</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="comment">// 3) For each of 3 edges, interpolate up and down (into pleft,pright) from each 1 FACE to 2 different CORNs</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  <span class="comment">// 4) take interpolated pleft,pright and form p_l and p_r type quantities inside pbcorn[] and pvcorn[]</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="comment">// 5) </span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">// Interpolation list:</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="comment">// FACE1: B1 -&gt; +-C2 and +-C3   l/r V2 -&gt; lr/+-C3   l/r V3 -&gt; lr/+-C2</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="comment">// FACE2: B2 -&gt; +-C1 and +-C3   l/r V1 -&gt; lr/+-C3   l/r V3 -&gt; lr/+-C1</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  <span class="comment">// FACE3: B3 -&gt; +-C1 and +-C2   l/r V1 -&gt; lr/+-C2   l/r V2 -&gt; lr/+-C1</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="comment">// loop over each edge(CORN1,2,3), interpolating in both odir1,odir2 directions and if that odir1,2 direction has N[odir1,2]==1, then just copy instead of interpolate</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="comment">// only have 1 dq,pleft,pright for NPR2INTERP quantities</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="comment">// sort above list by edge(C1,C2,C3):</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  <span class="comment">//  +-C1: FACE2 B2 interpolated in dir=3 ...........</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="comment">// interpolate dimension-by-dimension to allow future optimizations based upon memory localization</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="comment">// also this allows feeding in primface_l and primface_r directly</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="comment">// total of 6 sets of interpolations</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;  <span class="comment">// note have chosen to mix velocity,field interpolations with certain symmetry.  In the end this means velocity is interpolated along its own direction only -- maybe not best?</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  <span class="comment">// note primface_l[i][Bi]=primface_r[i][Bi]</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="comment">// note not using many of the primface_l and primface_r (e.g. primface_lr[1][B2] -- cross fields since less local compared to directly evolved staggered field), but others are simply not used</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  <span class="comment">// +-dir=1 : FACE2_to_CORN3 1 B2 &amp; 2 V1 (primface_l[2][B2] and primface_lr[2][U1]) , FACE3_to_CORN2 1 B3, 2 V1 (primface_l[3][B3] and primface_lr[3][U1])</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  <span class="comment">// +-dir=2 : FACE1_to_CORN3 1 B1 &amp; 2 V2 (primface_l[1][B1] and primface_lr[1][U2]) , FACE3_to_CORN1 1 B3, 2 V2 (primface_l[3][B3] and primface_lr[3][U2])</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="comment">// +-dir=3 : FACE1_to_CORN2 1 B1 &amp; 2 V3 (primface_l[1][B1] and primface_lr[1][U3]) , FACE2_to_CORN1 1 B2, 2 V3 (primface_l[2][B2] and primface_lr[2][U3])</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <span class="comment">// before computing EMF, need to convert velocity primitive to something consistent with field primitive frame</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  <span class="comment">// i.e. B^i (lab-frame 3-field) is normal field primitive, so use v^i (lab-frame 3-velocity) for velocity</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="comment">// otherwise number of interpolations increases to 2*4 extra per edge(CORN) since need symmetric value of the other velocity or uu0 if sending ucon</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="comment">// so just send lab-frame 3-velocity v^i as consistent with lab-frame field B^i in Faraday,Maxwell tensors</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  <span class="comment">// instead of using rescale(), just assume always better to inteprolate gdet B^i since the flux is conserved</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="preprocessor">#define NUMSTAGINTERP 6</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define BFACEINTERP 0</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define BFACEINTERPODIR1 0</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define BLFACEINTERP 0 // same as BFACEINTERP</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define BRFACEINTERP 1 // only used if Nvec[dir]==1 [No, but used to hold non-gdet applied version if required]</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define BFACEINTERPODIR2 1 // used to hold standard B field, not gdet*B, in case required.</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VLODIR1INTERP 2</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VRODIR1INTERP 3</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VLODIR2INTERP 4</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VRODIR2INTERP 5</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="preprocessor">#if(NUMSTAGINTERP&gt;NPR2INTERP)</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#error &quot;Cannot have NUMSTAGINTERP&gt;NPR2INTERP.  Create new memory space if have to.&quot;</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="comment">// holds quantities prepared for interpolation with space used as listed above</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  p2interp=prc;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160; </div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="comment">// Loop over faces that contains the original interpolation so only have to compute \detg B^i and v^i once instead of multiple times for each +-dir=1,2,3</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="comment">// FACE1: B1 -&gt; +-C2 and +-C3   l/r V2 -&gt; lr/+-C3   l/r V3 -&gt; lr/+-C2</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="comment">// FACE2: B2 -&gt; +-C1 and +-C3   l/r V1 -&gt; lr/+-C3   l/r V3 -&gt; lr/+-C1</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  <span class="comment">// FACE3: B3 -&gt; +-C1 and +-C2   l/r V1 -&gt; lr/+-C2   l/r V2 -&gt; lr/+-C1</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="preprocessor">#pragma omp parallel OPENMPGLOBALPRIVATEFORUCONANDGEOMNPR2INTERP</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#ad6aa918442f7768dff3c099ba353ee64" title="slope_lim_face2corn() is provided p2interp and returns pleft/pright differs from slope_lim() by range...">slope_lim_face2corn</a>(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> idel, <span class="keywordtype">int</span> jdel, <span class="keywordtype">int</span> kdel, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*primreal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*p2interp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dq)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pleft)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pright)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR2INTERP], <span class="keyword">struct</span> <a class="code" href="../../d8/d9b/structof__loop.html">of_loop</a> *face2cornloop);</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordtype">int</span> idel,jdel,kdel;</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    <span class="keywordtype">int</span> idel1,jdel1,kdel1;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="keywordtype">int</span> idel2,jdel2,kdel2;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomfdontuse;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomf=&amp;geomfdontuse;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomfdontuse;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomf=&amp;gdetgeomfdontuse;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomcdontuse;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomc=&amp;gdetgeomcdontuse;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> gdetgeomcorndontuse;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#a91ee2a91251b6d836d6cd3505d4d0a68">of_gdetgeom</a> *ptrgdetgeomcorn=&amp;gdetgeomcorndontuse;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordtype">int</span> dir,interpdir,edgedir;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordtype">int</span> locallim;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> pstore_l[NPR2INTERP],pstore_r[NPR2INTERP];</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *p2interp_l,*p2interp_r;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p_l[NPR2INTERP], p_r[NPR2INTERP];</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keywordtype">int</span> enerregion;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="keywordtype">int</span> *localenerpos;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="keywordtype">int</span> odir1,odir2;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keywordtype">int</span> EMFodir1,EMFodir2;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/d83/structof__state.html" title="state structure">of_state</a> ql,qr;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/d83/structof__state.html" title="state structure">of_state</a> *ptrql,*ptrqr;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> igdetgnosing,igdetgnosingvel;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordtype">int</span> usedq;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordtype">int</span> whichodir;</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordtype">int</span> BFACEINTERPCURRENT;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <span class="keywordtype">int</span> Aodir1,Aodir2;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keywordtype">int</span> Bodir1,Bodir2;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordtype">int</span> Codir1,Codir2;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="keywordtype">int</span> Dodir1,Dodir2;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="keyword">extern</span> <span class="keywordtype">int</span> choose_limiter(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> pl);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordtype">int</span> realisinterp;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordtype">int</span> is,ie,js,je,ks,ke;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prface_l,*prface_r;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="comment">// default state pointer (from now on below code should only use ptrql,ptrqr</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    ptrql=&amp;ql;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    ptrqr=&amp;qr;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    p2interp_l=pstore_l;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    p2interp_r=pstore_r;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="comment">// Loop over faces</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment"></span>    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a8cbb473515f18fcae523329c93f140dc">DIMENLOOP</a>(dir){</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      <span class="comment">// other dimensions</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;      get_odirs(dir,&amp;odir1,&amp;odir2);</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      <span class="comment">//  if(Nvec[odir1]==1 &amp;&amp; Nvec[odir2]==1) then EMF[dir]==0, but still copy over results in accordance with this routine since results here are for other EMFs</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      <span class="comment">// for example, if 2D in dirs=1,2 and 1-D in dir=3, then FACE3 still gives EMF1,EMF2 whose differences in dirs=1,2 is used for evolution</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      <span class="comment">// later explicit interpolations are avoided if interpdir is 1-D</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="comment">// get direction offsets for array accesses</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="comment"></span>      idel1 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir1][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a158ca926457b2c62875830147141748e">FIDEL</a>];</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      jdel1 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir1][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a90b513fe9dd3d28100473a9c72f3bda3">FJDEL</a>];</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      kdel1 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir1][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada7f7c41064faa66235ca2a6e49ec5e9">FKDEL</a>];</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;  </div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      idel2 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir2][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a158ca926457b2c62875830147141748e">FIDEL</a>];</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      jdel2 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir2][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a90b513fe9dd3d28100473a9c72f3bda3">FJDEL</a>];</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      kdel2 = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3b45f45c6ed9393abcf05daa2f4d9d95">fluxloop</a>[odir2][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada7f7c41064faa66235ca2a6e49ec5e9">FKDEL</a>];</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      <span class="comment">// Convert and store primitive into p2interp[] -- these are *all* the quantities needed from this face-dir</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;%d %d : %d %d : %d %d\n&quot;,cent2faceloop[dir].is, cent2faceloop[dir].ie, cent2faceloop[dir].js, cent2faceloop[dir].je, cent2faceloop[dir].ks, cent2faceloop[dir].ke);</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="comment">// Was using:</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      <span class="comment">//     COMPZSLOOP( -N1BND, N1-1+N1BND, -N2BND, N2-1+N2BND, -N3BND, N3-1+N3BND ){</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="comment">// But, need loops to be controlled to don&#39;t access beyond where left-right faces set since ucon can fail with arbitrary input or nan&#39;s unlike other types of calculations</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="comment">// cent2faceloop is over CENT positions, which now since accessing the faces needs to be transcribed to FACE values interior to those CENT values</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="comment">// One shifts up in interpdir (dir) flux direction because interpolated -1 extra CENT cell and N CENT cell to get flux at 0 and N.</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      <span class="comment">// Note that +SHIFT term just translates pleft/pright type locations to p_l/p_r type locations</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      is=cent2faceloop[dir].<a class="code" href="../../d8/d9b/structof__loop.html#aa065ad97b11c89b7a5edd54e2bbe433b">is</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>*(dir==1);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      ie=cent2faceloop[dir].<a class="code" href="../../d8/d9b/structof__loop.html#a7e290b9d135e07f75235db53680f64ae">ie</a>;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      js=cent2faceloop[dir].<a class="code" href="../../d8/d9b/structof__loop.html#a3991c392bde0f5726882a22fc0366b76">js</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>*(dir==2);</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      je=cent2faceloop[dir].<a class="code" href="../../d8/d9b/structof__loop.html#a21ddbfdd15788badc149326ffd59ead2">je</a>;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      ks=cent2faceloop[dir].<a class="code" href="../../d8/d9b/structof__loop.html#a09fe3cf49e575a68dc5661c5bec4d5e9">ks</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>*(dir==3);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      ke=cent2faceloop[dir].<a class="code" href="../../d8/d9b/structof__loop.html#acfe34553561e82d1ea0a255e6d60e9c1">ke</a>;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a8de37da93c3462c536ef830f2fbaee61" title="forced to be a computational loop, so start/stop cannot already have shifts in them (which is normal ...">OPENMP3DLOOPSETUP</a>(is,ie,js,je,ks,ke);</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) </span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="preprocessor">      OPENMP3DLOOPBLOCK{</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="preprocessor"></span>        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        <span class="comment">// setup which primeface_l and primeface_r to use</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        <span class="comment">// if Nvec[dir]==1, handled specially later</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        prface_l=<a class="code" href="../../df/d1c/global_8storage_8h.html#a4589594cbb3d23d258245b68273e6df6">MACP1A0</a>(primface_l,dir,i,j,k);</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        prface_r=<a class="code" href="../../df/d1c/global_8storage_8h.html#a4589594cbb3d23d258245b68273e6df6">MACP1A0</a>(primface_r,dir,i,j,k);</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160; </div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="comment">// get geometry for face pre-interpolated values</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160; </div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="preprocessor">#if(STOREFLUXSTATE==0)</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="preprocessor"></span>        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgeomf); <span class="comment">// at face[dir]</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <span class="comment">// VELs: note don&#39;t use velocity in &quot;dir&quot; direction</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="comment">// LEFTVEL: compute and store v^i at face (input to ucon_calc() is primitive list as correct in primface_l,r)</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a0163a499c88dd8b07688e3dbd7007f0e">MYFUN</a>(<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#afc93fd4a6f7a2b87a9315d5fba5a529c">ucon_calc</a>(prface_l, ptrgeomf, ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>, ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aad8be02577d0aa545b36e596e8b50ee9">others</a>) ,<span class="stringliteral">&quot;flux.c:interpolate_face2corn()&quot;</span>, <span class="stringliteral">&quot;ucon_calc()&quot;</span>, 1);</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        <span class="comment">// RIGHTVEL: compute and store v^i at face</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a0163a499c88dd8b07688e3dbd7007f0e">MYFUN</a>(<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#afc93fd4a6f7a2b87a9315d5fba5a529c">ucon_calc</a>(prface_r, ptrgeomf, ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>, ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aad8be02577d0aa545b36e596e8b50ee9">others</a>) ,<span class="stringliteral">&quot;flux.c:interpolate_face2corn()&quot;</span>, <span class="stringliteral">&quot;ucon_calc()&quot;</span>, 2);</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <span class="comment">// really only need i,j,k in geomf for get_stateforfluxcalc(), unless doing INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELD!=0</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        ptrgeomf-&gt;i=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        ptrgeomf-&gt;j=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        ptrgeomf-&gt;k=k;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        ptrgeomf-&gt;p=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir; <span class="comment">// &quot;p&quot; not used by get_stteforfluxcalc(), but ISLEFT/ISRIGHT is w.r.t. just offset from face but located at the position of the face</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <a class="code" href="../../de/d8c/phys_8c.html#a92cd9cc63c782c0d94699d639aa48f69" title="wrapper for choosing to get state by computing it or from global array notice that ptrgeom-&gt;p inputte...">get_stateforfluxcalc</a>(dir, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a93fbad007ae41e79ed82d2d0f8edd936">ISLEFT</a>, prface_l, ptrgeomf, &amp;ptrql);</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <a class="code" href="../../de/d8c/phys_8c.html#a92cd9cc63c782c0d94699d639aa48f69" title="wrapper for choosing to get state by computing it or from global array notice that ptrgeom-&gt;p inputte...">get_stateforfluxcalc</a>(dir, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aeae4fc4a74dcfd09eb6457c22dd288a1">ISRIGHT</a>, prface_r, ptrgeomf, &amp;ptrqr);</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        <span class="comment">// Just always do to avoid complicated conditional</span></div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgdetgeomf); <span class="comment">// at face[dir]</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a9e34adecc2a71c951e606ebfc5a28c08">BFACEINTERPODIR2</a>) = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#ae6ed40148cabc456621d6933ec3df1fb">BFACEINTERPODIR1</a>) = prface_l[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir]; <span class="comment">// note that prface_l[dir]=prface_r[dir] at face[dir]</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        <span class="comment">// p2interp located at face[dir] before interpolation, so gdet should be there</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        <span class="comment">// BFACE: compute and store \detg B^i and prepare for 2-way interpolation of that single field (notice that primface_l,r same for face field</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        <span class="comment">// note that since interpolating \detg B^i, don&#39;t have to unrescale because can just use this to obtain EMF w/ gdet</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        <span class="comment">// odir1 and odir2 here refer to possible choices for interpdir, which is always different than [and transverse to] dir.</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a63a7e2ed3141710a592e3568ace82601" title="1 and 2 don&#39;t work for unknown reasons (code eventually crashes due to polar region) for nsdipole pro...">INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELDswitchuniboth</a>(dir,odir1)){</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#ae6ed40148cabc456621d6933ec3df1fb">BFACEINTERPODIR1</a>) *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        }</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a63a7e2ed3141710a592e3568ace82601" title="1 and 2 don&#39;t work for unknown reasons (code eventually crashes due to polar region) for nsdipole pro...">INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELDswitchuniboth</a>(dir,odir2)){</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a9e34adecc2a71c951e606ebfc5a28c08">BFACEINTERPODIR2</a>) *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        }</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <span class="comment">// VELs: note don&#39;t use velocity in &quot;dir&quot; direction</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        <span class="comment">// GODMARK: Could/Should allow application of rescale on v^i, such as gdet.  This would allow (e.g.) SPC to handle uu3 and B3 the same with gdet, so that interpolation doesn&#39;t operate on divergent quantity and operates consistently on these so EMF1 is correctly cancels terms.</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        <span class="comment">// LEFTVEL: compute and store v^i at face (input to ucon_calc() is primitive list as correct in primface_l,r)</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a24a6f3029e7e388a535e504ae445e5db">VLODIR1INTERP</a>) = (ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[odir1])/(ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]);</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a4cc437c3c61a6de9dacf891074ed356d">VLODIR2INTERP</a>) = (ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[odir2])/(ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]);</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <span class="comment">// RIGHTVEL: compute and store v^i at face</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a2e7cb1cb42049f0ddc60d71de4b6aa6a">VRODIR1INTERP</a>) = (ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[odir1])/(ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]);</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a8e87e2358ab147d4dae194ebfeb83e5b">VRODIR2INTERP</a>) = (ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[odir2])/(ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <span class="comment">// See comments related to switch prior to this whole function</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a7b6083b579b04d33e0a69a4a84ef461e" title="e.g.">INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITYswitchuniboth</a>(dir,odir1)){</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a24a6f3029e7e388a535e504ae445e5db">VLODIR1INTERP</a>) *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a2e7cb1cb42049f0ddc60d71de4b6aa6a">VRODIR1INTERP</a>) *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        }</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a7b6083b579b04d33e0a69a4a84ef461e" title="e.g.">INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITYswitchuniboth</a>(dir,odir2)){</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a4cc437c3c61a6de9dacf891074ed356d">VLODIR2INTERP</a>) *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,<a class="code" href="../../d0/dde/fluxctstag_8c.html#a8e87e2358ab147d4dae194ebfeb83e5b">VRODIR2INTERP</a>) *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        }</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      </div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      }<span class="comment">// end COMPZSLOOP</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;      <span class="comment">// now send relevant terms in p2interp to interpolator for each odir1,odir2 directions</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="comment">// MACP4A0(pvcorn,corner/emf/edge dir,i,j,k,which velocity,l/r,u/d)</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      <span class="comment">// note that emf[+- in EMFodir1][+- in EMFodir2] implies pvcorn[l/r][u/d] =  pvcorn[l/r in EMFodir1][u/d in EMFodir2] since have matching [l][m] when accessing emf[] and pvcorn[] where in this comment edgedir=dir and odir1 and odir2 are interpdir and dir (order?)</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;      <span class="comment">// translation:</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      <span class="comment">// in EMF calculation function:</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="comment">//   edgedir=1 odir1=2 odir2=3</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      <span class="comment">//   edgedir=2 odir1=3 odir2=1</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;      <span class="comment">//   edgedir=3 odir1=1 odir2=2</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <span class="comment">// in this function for interpdir=odir1 interpolation:</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      <span class="comment">//   face dir=1 odir1=interpdir=2 odir2=edgedir=3  EMFodir1=1  EMFodir2=2</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      <span class="comment">//   face dir=2 odir1=interpdir=3 odir2=edgedir=1  EMFodir1=2  EMFodir2=3</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      <span class="comment">//   face dir=3 odir1=interpdir=1 odir2=edgedir=2  EMFodir1=3  EMFodir2=1</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="comment">// Hence, EMFodir1 is facedir and EMFodir2 is interpdir</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;      <span class="comment">// in this function for interpdir=odir2 interpolation:</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <span class="comment">//   face dir=1 odir2=interpdir=3 odir1=edgedir=2  EMFodir1=3  EMFodir2=1</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="comment">//   face dir=2 odir2=interpdir=1 odir1=edgedir=3  EMFodir1=1  EMFodir2=2</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="comment">//   face dir=3 odir2=interpdir=2 odir1=edgedir=1  EMFodir1=2  EMFodir2=3</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      <span class="comment">// Hence, EMFodir1 is interpdir and EMFodir2 is facedir</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      <span class="comment">// So need to define EMFodir1 and EMFodir2 from edgedir</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      <span class="comment">// Loop over other directions not in face-dir</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <span class="keywordflow">for</span>(whichodir=0;whichodir&lt;=1;whichodir++){</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        <span class="keywordflow">if</span>(whichodir==0){ <span class="comment">// whichodir==0 arbitrarily corresponds to interpdir=odir1</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment"></span>          <span class="comment">// interpolate in odir1 direction (places quantities at edge/emf/corner odir2)</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>=0;</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>=2; <span class="comment">// 3 things</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0]=<a class="code" href="../../d0/dde/fluxctstag_8c.html#ae6ed40148cabc456621d6933ec3df1fb">BFACEINTERPODIR1</a>; <span class="comment">// always interpdir field</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;          BFACEINTERPCURRENT=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0];</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;          <span class="comment">// ODIR? should be same as interpdir</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[1]=<a class="code" href="../../d0/dde/fluxctstag_8c.html#a24a6f3029e7e388a535e504ae445e5db">VLODIR1INTERP</a>; <span class="comment">// hence [1] is for previous p_l</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[2]=<a class="code" href="../../d0/dde/fluxctstag_8c.html#a2e7cb1cb42049f0ddc60d71de4b6aa6a">VRODIR1INTERP</a>; <span class="comment">// hence [2] is for previous p_r</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;          <span class="comment">// face is dir, and interpolation direction and edge direction are orthogonal to that</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;          interpdir=odir1;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;          edgedir=odir2;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;          <span class="comment">// del&#39;s associated with interpolation direction</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;          idel=idel1;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;          jdel=jdel1;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;          kdel=kdel1;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        }</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;          <span class="comment">// interpolate in odir2 direction (places quantities at edge/emf/corner odir1)</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>=0;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>=2; <span class="comment">// 3 things</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0]=<a class="code" href="../../d0/dde/fluxctstag_8c.html#a9e34adecc2a71c951e606ebfc5a28c08">BFACEINTERPODIR2</a>; <span class="comment">// always interpdir field</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;          BFACEINTERPCURRENT=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0];</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;          <span class="comment">// ODIR? should be same as interpdir</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[1]=<a class="code" href="../../d0/dde/fluxctstag_8c.html#a4cc437c3c61a6de9dacf891074ed356d">VLODIR2INTERP</a>; <span class="comment">// hence [1] is for previous p_l</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;          <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[2]=<a class="code" href="../../d0/dde/fluxctstag_8c.html#a8e87e2358ab147d4dae194ebfeb83e5b">VRODIR2INTERP</a>; <span class="comment">// hence [2] is for previous p_r</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;          interpdir=odir2;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;          edgedir=odir1;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;          <span class="comment">// del&#39;s associated with interpolation direction</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;          idel=idel2;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;          jdel=jdel2;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;          kdel=kdel2;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <span class="comment">// set EMFodir&#39;s</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment"></span>        get_odirs(edgedir,&amp;EMFodir1,&amp;EMFodir2);</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        <span class="comment">//    Setup access to emf-like quantities that have 3-dimensions and going to 2-dimensions</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="keywordflow">if</span>(EMFodir1==interpdir){</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;          <span class="comment">// then first entry should contain 0/1 for *current* interpolation</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;          <span class="comment">// then EMFodir1 is interpdir corresponding to direction for current interpolation</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;          <span class="comment">// then EMFodir2 is face-dir corresponding to direction for previous interpolation</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;          Aodir1=0; Aodir2=0;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;          Bodir1=1; Bodir2=0;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;          Codir1=0; Codir2=1;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;          Dodir1=1; Dodir2=1;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        }</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;          <span class="comment">// then first entry should contain 0/1 for *previous* interpolation</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;          <span class="comment">// then EMFodir1 is face-dir corresponding to direction for previous interpolation</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;          <span class="comment">// then EMFodir2 is interpdir corresponding to direction for current interpolation</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;          Aodir1=0; Aodir2=0;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;          Bodir1=0; Bodir2=1;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;          Codir1=1; Codir2=0;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;          Dodir1=1; Dodir2=1;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        }</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;        <span class="comment">// interpolate    </span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <span class="comment">// GODMARK: Note put primface_l[dir] (yes, face-dir) into slope_lim as a &quot;good primitive&quot; to be used for shock or other indicators -- should really use average of primface_l and primface_r for symmetry considerations -- otherwise not used -- ENOMARK</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        <span class="comment">// only really do interpolation if dimension exists ...</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="comment"></span>        <span class="comment">//  (Nvec[interpdir]&gt;1 &amp;&amp; (! (Nvec[edgedir]==1 &amp;&amp; Nvec[dir]==1) ))      // ... or even if dimension exists but orthogonal dimensions do not then just copy over result -- need to modify more things to do this</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;        <span class="comment">//      if(Nvec[interpdir]&gt;1){</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        <span class="comment">// if Nvec[dir]==1, then that face quantity is really a centered quantity in some CORN plane.  See below for how assignment is done.</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <span class="keywordflow">if</span>(!(Nvec[interpdir]==1 || Nvec[dir]==1&amp;&amp;Nvec[interpdir]!=1   )){</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;          realisinterp=0; <span class="comment">// since only ever limited set of quantities</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;          <a class="code" href="../../d0/dde/fluxctstag_8c.html#ad6aa918442f7768dff3c099ba353ee64" title="slope_lim_face2corn() is provided p2interp and returns pleft/pright differs from slope_lim() by range...">slope_lim_face2corn</a>(realisinterp, interpdir,idel,jdel,kdel,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>,p2interp,dqvec[interpdir],pleft,pright, &amp;(face2cornloop[edgedir][EMFodir1][EMFodir2]));</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        }</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        <span class="comment">// get p_l p_r</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment"></span>        <span class="comment">//</span></div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        <span class="comment">// interpolate primitive using slope (dq) or directly from pleft and pright</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        <span class="comment">// Assume for now that limiter is not per i,j,k but only per dir (unlike normal interpolation) (also no pl dependence)</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        <span class="comment">// no HORIZONSUPERFAST here</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        locallim=choose_limiter(interpdir, 0,0,0,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>);</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        usedq = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a95b083f21944c381bcaaf6c8749fbcad">usedqarray</a>[locallim];</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        <span class="comment">// face2corn is at effective-CENT relative to edgedir</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        <span class="comment">// loop below will be at effective-FACEs, so extended in interpdir direction</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        <span class="comment">// One shifts up in interpdir direction because interpolated -1 extra &quot;CENT&quot; cell and N &quot;CENT&quot; cell to get corner at 0 and N.</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="keywordflow">if</span>(!(Nvec[interpdir]==1|| Nvec[dir]==1&amp;&amp;Nvec[interpdir]!=1  )){</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;          is=face2cornloop[edgedir][EMFodir1][EMFodir2].<a class="code" href="../../d8/d9b/structof__loop.html#aa065ad97b11c89b7a5edd54e2bbe433b">is</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>*(interpdir==1);</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;          ie=face2cornloop[edgedir][EMFodir1][EMFodir2].<a class="code" href="../../d8/d9b/structof__loop.html#a7e290b9d135e07f75235db53680f64ae">ie</a>;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;          js=face2cornloop[edgedir][EMFodir1][EMFodir2].<a class="code" href="../../d8/d9b/structof__loop.html#a3991c392bde0f5726882a22fc0366b76">js</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>*(interpdir==2);</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;          je=face2cornloop[edgedir][EMFodir1][EMFodir2].<a class="code" href="../../d8/d9b/structof__loop.html#a21ddbfdd15788badc149326ffd59ead2">je</a>;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;          ks=face2cornloop[edgedir][EMFodir1][EMFodir2].<a class="code" href="../../d8/d9b/structof__loop.html#a09fe3cf49e575a68dc5661c5bec4d5e9">ks</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>*(interpdir==3);</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;          ke=face2cornloop[edgedir][EMFodir1][EMFodir2].<a class="code" href="../../d8/d9b/structof__loop.html#acfe34553561e82d1ea0a255e6d60e9c1">ke</a>;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        }</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;          <span class="comment">// since just copying, revert to locations where interpolated CENT -&gt; FACE</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;          <span class="comment">// Note that +SHIFT term just translates pleft/pright type locations to p_l/p_r type locations</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;          is=cent2faceloop[interpdir].<a class="code" href="../../d8/d9b/structof__loop.html#aa065ad97b11c89b7a5edd54e2bbe433b">is</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>*(interpdir==1);</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;          ie=cent2faceloop[interpdir].<a class="code" href="../../d8/d9b/structof__loop.html#a7e290b9d135e07f75235db53680f64ae">ie</a>;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;          js=cent2faceloop[interpdir].<a class="code" href="../../d8/d9b/structof__loop.html#a3991c392bde0f5726882a22fc0366b76">js</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>*(interpdir==2);</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;          je=cent2faceloop[interpdir].<a class="code" href="../../d8/d9b/structof__loop.html#a21ddbfdd15788badc149326ffd59ead2">je</a>;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;          ks=cent2faceloop[interpdir].<a class="code" href="../../d8/d9b/structof__loop.html#a09fe3cf49e575a68dc5661c5bec4d5e9">ks</a> + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>*(interpdir==3);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;          ke=cent2faceloop[interpdir].<a class="code" href="../../d8/d9b/structof__loop.html#acfe34553561e82d1ea0a255e6d60e9c1">ke</a>;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;          <span class="comment">//   is=-N1BND+idel;</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;          <span class="comment">//   ie=N1-1+N1BND;</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;          <span class="comment">//   js=-N2BND+jdel;</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;          <span class="comment">//   je=N2-1+N2BND;</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;          <span class="comment">//   ks=-N3BND+kdel;</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;          <span class="comment">//   ke=N3-1+N3BND;</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <span class="comment">// dualfprintf(fail_file,&quot;edgedir=%d EMFodir1=%d EMFodir2=%d :: is=%d ie=%d js=%d je=%d ks=%d ke=%d\n&quot;,edgedir,EMFodir1,EMFodir2,is,ie,js,je,ks,ke);</span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160; </div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        <span class="comment">// OPENMP3DLOOPSETUP( -N1BND+idel, N1-1+N1BND, -N2BND+jdel, N2-1+N2BND, -N3BND+kdel, N3-1+N3BND );</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a8de37da93c3462c536ef830f2fbaee61" title="forced to be a computational loop, so start/stop cannot already have shifts in them (which is normal ...">OPENMP3DLOOPSETUP</a>(is,ie,js,je,ks,ke);</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize)) //nowait // Don&#39;t wait since each direction is independent // NO: use of pleft, pright, and some use of p2interp (that depend on each dir) from loop above makes not possible to use &quot;nowait&quot;</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="preprocessor"></span>        <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;   </div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;          <span class="comment">// if(Nvec[interpdir]&gt;1 &amp;&amp; (! (Nvec[edgedir]==1 &amp;&amp; Nvec[dir]==1) ))</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;          <span class="comment">// if(Nvec[interpdir]&gt;1){</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;          <span class="keywordflow">if</span>(!(Nvec[interpdir]==1|| Nvec[dir]==1&amp;&amp;Nvec[interpdir]!=1  )){</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;            <span class="keywordflow">if</span>(usedq){</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;              <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                <span class="comment">// FACE_to_CORN interpolation is same as if doing CENT_to_EDGE from point of view of indicies to use and pleft,pright assignments</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                p2interp_l[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i - idel,j - jdel,k - kdel,pl) + 0.5 * <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(dqvec,interpdir,i - idel,j - jdel,k - kdel,pl);</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                p2interp_r[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,pl) - 0.5 * <a class="code" href="../../df/d1c/global_8storage_8h.html#aa8b43b4fc3603af92ea833ece0a76c00">MACP1A1</a>(dqvec,interpdir,i,j,k,pl);</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;              }</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;            }</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;              <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                p2interp_l[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pright,i-idel,j-jdel,k-kdel,pl);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                p2interp_r[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pleft,i,j,k,pl);</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;              }</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;            }</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;          }</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Nvec[interpdir]==1){</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            <span class="comment">// if no interpolation, just copy result from pre-interpolated p2interp[] avoiding,bypassing dq,pleft,pright</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;              p2interp_r[pl] = p2interp_l[pl] = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(p2interp,i,j,k,pl);</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;            }</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;          }</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Nvec[dir]==1&amp;&amp;Nvec[interpdir]!=1){</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            <span class="comment">// if interpolation already done, just copy over left-right values from cent2face operation</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;            <span class="comment">// E.g. If N1==1 and dir==1, then B1,v2 are already interpolated with interpdir==2 to CORN3=FACE2 *and* B1,v3 are already interpolated with interpdir==3 to CORN2=FACE3.</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;            <span class="comment">// E.g. If N2==1 and dir==2, then B2,v1 are already interpolated with interpdir==1 to CORN3=FACE1 *and* B2,v3 are already interpolated with interpdir==3 to CORN1=FACE3.</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;            <span class="comment">// E.g. If N3==1 and dir==3, then B3,v1 are already interpolated with interpdir==1 to CORN2=FACE1 *and* B3,v2 are already interpolated with interpdir==2 to CORN1=FACE2.</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;            <span class="comment">// </span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;            <span class="comment">// Since face is the corner we want, so same ptrgeomf is good.  That is, FACE1-1+dir = desired CORN.</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;            <span class="comment">// But needed to change l/r dir from &quot;dir&quot; to &quot;interpdir&quot;</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;            <span class="comment">// Have to compute v^i=u^i/u^t here since didn&#39;t know interpdir in earlier part of this whole function</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            prface_l=<a class="code" href="../../df/d1c/global_8storage_8h.html#a4589594cbb3d23d258245b68273e6df6">MACP1A0</a>(primface_l,interpdir,i,j,k);</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;            prface_r=<a class="code" href="../../df/d1c/global_8storage_8h.html#a4589594cbb3d23d258245b68273e6df6">MACP1A0</a>(primface_r,interpdir,i,j,k);</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            <span class="comment">// get geometry for face pre-interpolated values</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="preprocessor">#if(STOREFLUXSTATE==0)</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="preprocessor"></span>            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgeomf); <span class="comment">// at face[dir]=CORN(perp to dir and interpdir)</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;            <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a0163a499c88dd8b07688e3dbd7007f0e">MYFUN</a>(<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#afc93fd4a6f7a2b87a9315d5fba5a529c">ucon_calc</a>(prface_l, ptrgeomf, ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>, ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aad8be02577d0aa545b36e596e8b50ee9">others</a>) ,<span class="stringliteral">&quot;flux.c:interpolate_face2corn()&quot;</span>, <span class="stringliteral">&quot;ucon_calc()&quot;</span>, 1);</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a0163a499c88dd8b07688e3dbd7007f0e">MYFUN</a>(<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#afc93fd4a6f7a2b87a9315d5fba5a529c">ucon_calc</a>(prface_r, ptrgeomf, ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>, ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aad8be02577d0aa545b36e596e8b50ee9">others</a>) ,<span class="stringliteral">&quot;flux.c:interpolate_face2corn()&quot;</span>, <span class="stringliteral">&quot;ucon_calc()&quot;</span>, 2);</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;            ptrgeomf-&gt;i=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;            ptrgeomf-&gt;j=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;            ptrgeomf-&gt;k=k;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;            ptrgeomf-&gt;p=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir; <span class="comment">// &quot;p&quot; not used by get_stateforfluxcalc()</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;            <a class="code" href="../../de/d8c/phys_8c.html#a92cd9cc63c782c0d94699d639aa48f69" title="wrapper for choosing to get state by computing it or from global array notice that ptrgeom-&gt;p inputte...">get_stateforfluxcalc</a>(interpdir, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a93fbad007ae41e79ed82d2d0f8edd936">ISLEFT</a>, prface_l, ptrgeomf, &amp;ptrql);</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;            <a class="code" href="../../de/d8c/phys_8c.html#a92cd9cc63c782c0d94699d639aa48f69" title="wrapper for choosing to get state by computing it or from global array notice that ptrgeom-&gt;p inputte...">get_stateforfluxcalc</a>(interpdir, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aeae4fc4a74dcfd09eb6457c22dd288a1">ISRIGHT</a>, prface_r, ptrgeomf, &amp;ptrqr);</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;            <span class="comment">// Just always do to avoid complicated conditional</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;            <span class="comment">// as when storing, still at original face locations already interpolated/computed during normal flux calculation</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>-1+dir, ptrgdetgeomf); <span class="comment">// at face[dir]</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;            <span class="comment">// now copy over values</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            p2interp_l[BFACEINTERPCURRENT] = prface_l[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir];</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;            p2interp_r[BFACEINTERPCURRENT] = prface_r[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+dir];</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;            <span class="comment">// applying gdet if just copying result so same application of factors as when setting up p2interp[]</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a63a7e2ed3141710a592e3568ace82601" title="1 and 2 don&#39;t work for unknown reasons (code eventually crashes due to polar region) for nsdipole pro...">INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELDswitchuniboth</a>(dir,interpdir)){</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;              p2interp_l[BFACEINTERPCURRENT] *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;              p2interp_r[BFACEINTERPCURRENT] *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;            }</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            <span class="comment">// [1,2] are from previous (i.e. face) interpolation.  But if Nvec[dir=facedir]=1, then those are same values</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            <span class="comment">// as above setup has, always dealing with v^{interpdir}</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;            <span class="comment">// here, the l,r indicate across interpdir (not dir as otherwise when requiring interpolation)</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;            p2interp_l[<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[1]] = p2interp_l[npr2interplist[2]] = (ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[interpdir])/(ptrql-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]);</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;            p2interp_r[npr2interplist[1]] = p2interp_r[npr2interplist[2]] = (ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[interpdir])/(ptrqr-&gt;<a class="code" href="../../d1/d83/structof__state.html#aab723d3c7c2c48b7246cc7d7d5379eed">ucon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]);</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;            <span class="comment">// applying gdet if just copying result so same application of factors as when setting up p2interp[]</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a7b6083b579b04d33e0a69a4a84ef461e" title="e.g.">INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITYswitchuniboth</a>(dir,odir1) &amp;&amp; npr2interplist[1]==<a class="code" href="../../d0/dde/fluxctstag_8c.html#a24a6f3029e7e388a535e504ae445e5db">VLODIR1INTERP</a> || <a class="code" href="../../d0/dde/fluxctstag_8c.html#a7b6083b579b04d33e0a69a4a84ef461e" title="e.g.">INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITYswitchuniboth</a>(dir,odir2) &amp;&amp; npr2interplist[1]==<a class="code" href="../../d0/dde/fluxctstag_8c.html#a4cc437c3c61a6de9dacf891074ed356d">VLODIR2INTERP</a>){</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;              p2interp_l[npr2interplist[1]] *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;              p2interp_l[npr2interplist[2]] *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;              p2interp_r[npr2interplist[1]] *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;              p2interp_r[npr2interplist[2]] *= (ptrgdetgeomf-&gt;gdet);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            }</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;          }</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Shouldn&#39;t reach here in fluxctstag.c\n&quot;</span>);</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            myexit(837434873);</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;          }</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;          <span class="comment">// DONE with interpolations or copies</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;          <span class="comment">// Set lab-frame 3-magnetic field at CORN</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;          <span class="comment">// MACP1A3(pbcorn,corner/emf/edge dir,i,j,k,which field,+-present interpdir)</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;          <span class="keywordtype">int</span> didsetigdet;</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;          didsetigdet=0;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a63a7e2ed3141710a592e3568ace82601" title="1 and 2 don&#39;t work for unknown reasons (code eventually crashes due to polar region) for nsdipole pro...">INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELDswitchuniboth</a>(dir,interpdir)==1 &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#ab601983a7018cfc747e01fe520e31784" title="whether to specify gdet at end when setting EMF or to have internal to variables before averaging...">CORNGDETVERSION</a>==1){     </div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1068bcf25c9f187a8db0f422e0af64c8">CORN1</a>-1+edgedir, ptrgdetgeomcorn); <span class="comment">// at CORN[dir]</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;            <span class="comment">// then unrescale field since will multiply geometry once have final EMF (avoids line currents)</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgdetgeomcorn);</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;            igdetgnosing = ptrgdetgeomcorn-&gt;igdetnosing;</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;            didsetigdet=1;</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;          }</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a63a7e2ed3141710a592e3568ace82601" title="1 and 2 don&#39;t work for unknown reasons (code eventually crashes due to polar region) for nsdipole pro...">INCLUDEGDETINTRANSVERSEINTERPLATIONOFFIELDswitchuniboth</a>(dir,interpdir)==0 &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#ab601983a7018cfc747e01fe520e31784" title="whether to specify gdet at end when setting EMF or to have internal to variables before averaging...">CORNGDETVERSION</a>==0){</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;            <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1068bcf25c9f187a8db0f422e0af64c8">CORN1</a>-1+edgedir, ptrgdetgeomcorn); <span class="comment">// at CORN[dir]</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;            <span class="comment">// then add gdet now since will not multiply geometry once have final EMF</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;            igdetgnosing = ptrgdetgeomcorn-&gt;gdet; <span class="comment">// here igdet really is just geom</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;          }</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;            <span class="comment">// nothing to do</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;            igdetgnosing = 1.0;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;          }</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;          <span class="comment">//   MACP3A0(pbcorn,edgedir,B1-1+dir,0,i,j,k) = p2interp_l[npr2interplist[0]]*igdetgnosing;</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;          <span class="comment">//   MACP3A0(pbcorn,edgedir,B1-1+dir,1,i,j,k) = p2interp_r[npr2interplist[0]]*igdetgnosing;</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,edgedir,i,j,k,dir,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>,0) = p2interp_l[<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0]]*igdetgnosing;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,edgedir,i,j,k,dir,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3299de85771e134921ac37c7b5b2c9b8" title="for wavespeeds.c and fluxcompute.c">NUMCS</a>,1) = p2interp_r[<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[0]]*igdetgnosing;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;          <span class="comment">// Set lab-frame 3-velocity at CORN</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;          <span class="comment">//      pvcorn[EMFdir][i][j][k][whichvel][l/r in EMFodir1][u/d in EMFodir2]</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;          <span class="comment">// for example:</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;          <span class="comment">// edgedir=1: EMFodir1=2 EMFodir2=3 then emf[0][0] is emf[left for EMFodir1][left for EMFodir2]</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;          <span class="comment">// so if interpolated in 2-dir and EMFodir1==2, then emf[0/1 filled with current p_l and p_r][0/1 filled with previous p_l p_r]</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;          <span class="comment">// de-applying any gdet factor</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../d0/dde/fluxctstag_8c.html#a7b6083b579b04d33e0a69a4a84ef461e" title="e.g.">INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITYswitchuniboth</a>(dir,odir1) &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[1]==<a class="code" href="../../d0/dde/fluxctstag_8c.html#a24a6f3029e7e388a535e504ae445e5db">VLODIR1INTERP</a> || <a class="code" href="../../d0/dde/fluxctstag_8c.html#a7b6083b579b04d33e0a69a4a84ef461e" title="e.g.">INCLUDEGDETINTRANSVERSEINTERPLATIONOFVELOCITYswitchuniboth</a>(dir,odir2) &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[1]==<a class="code" href="../../d0/dde/fluxctstag_8c.html#a4cc437c3c61a6de9dacf891074ed356d">VLODIR2INTERP</a>){</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            <span class="keywordflow">if</span>(didsetigdet){</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;              igdetgnosingvel=igdetgnosing;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            }</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;              <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a29d77750db58af63e128049ca865c364">get_geometry_gdetonly</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1068bcf25c9f187a8db0f422e0af64c8">CORN1</a>-1+edgedir, ptrgdetgeomcorn); <span class="comment">// at CORN[dir]</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;              <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#adcfebf340c9017d7989eb3bdd344da45">set_igdetsimple</a>(ptrgdetgeomcorn);</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;              igdetgnosingvel = ptrgdetgeomcorn-&gt;igdetnosing;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;            }</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;          }</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;          <span class="keywordflow">else</span> igdetgnosingvel=1.0;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;          <span class="comment">// npr2interplist[1,2] constains [u,d for velocity in interpdir direction] </span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,edgedir,i,j,k,interpdir,Aodir1,Aodir2) = p2interp_l[<a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[1]] *= igdetgnosingvel; <span class="comment">// current p_l for previous p_l </span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,edgedir,i,j,k,interpdir,Bodir1,Bodir2) = p2interp_r[npr2interplist[1]] *= igdetgnosingvel; <span class="comment">// current p_r for previous p_l</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,edgedir,i,j,k,interpdir,Codir1,Codir2) = p2interp_l[npr2interplist[2]] *= igdetgnosingvel; <span class="comment">// current p_l for previous p_r</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#aa4615d85097737f545319e5d35d99b6a">MACP1A3</a>(pvbcorn,edgedir,i,j,k,interpdir,Dodir1,Dodir2) = p2interp_r[npr2interplist[2]] *= igdetgnosingvel; <span class="comment">// current p_r for previous p_r</span></div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        }<span class="comment">// endCOMPZSLOOP</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  </div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      }<span class="comment">// end loop over (whichodir) other directions // at end of loop, have pbcorn,pvcorn for this 1 face interpolated to 2 corners</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      </div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    }<span class="comment">// end DIMENLOOP // at end of loop, have pbcorn,pvcorn for 3 edges</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;  }<span class="comment">// end over parallel region (and implied barrier)</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  <span class="comment">// restore choice for interpolations</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="comment"></span><span class="preprocessor">#pragma omp parallel</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="preprocessor"></span>  { <span class="comment">// must set npr2interp stuff inside parallel region since threadprivate</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0698381e35c41efe1e8e744c563346ca" title="for choosing range of PLOOPINTERP type arrays">npr2interpstart</a>=nprlocalstart;</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#ab8d17d77cf16ec7a4448add3fc8710f8">npr2interpend</a>=nprlocalend;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ae3d8ba1d892944d94ad9f496a3fb3566" title="goes over all/any npr lists for copying one list to another">PMAXNPRLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a647235f9afd0ad17f188ed43fe23997f">npr2interplist</a>[pl]=nprlocallist[pl];</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;  }</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  return(0);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;}</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/dde/fluxctstag_8c.html#aa169cb1999412f2e2460012cc5d7a804" title="pure DONOR version: upoint is input staggered updated field that needs to be converted to pstag and t...">interpolate_ustag2fieldcent_donor</a></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="comment">//int interpolate_ustag2fieldcent</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"><a class="code" href="../../d0/dde/fluxctstag_8c.html#aa169cb1999412f2e2460012cc5d7a804"> 2467</a></span>&#160;(<span class="keywordtype">int</span> stage, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> boundtime, <span class="keywordtype">int</span> timeorder, <span class="keywordtype">int</span> numtimeorders, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*preal)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*upoint)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pcent)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][NSTORE3][NPR])</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;{</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k,pl;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;  <span class="keywordtype">int</span> ii,jj,kk;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomcdontuse;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomc=&amp;geomcdontuse;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomfdontuse;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomf=&amp;geomfdontuse;</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomfudontuse;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomfu=&amp;geomfudontuse;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;  <span class="keywordtype">int</span> finalstep;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="comment">//  COMPFULLLOOP{</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <span class="comment">// must carefully replace pstag only on specific locations</span></div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="preprocessor">#define MYOCOMPLOOPF3 for(k=SHIFTX3DN;k&lt;=N3-1+SHIFT3+SHIFTX3UP;k++)</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MYOCOMPLOOPF2 for(j=SHIFTX2DN;j&lt;=N2-1+SHIFT2+SHIFTX2UP;j++)</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MYOCOMPLOOPF1 for(i=SHIFTX1DN;i&lt;=N1-1+SHIFT1+SHIFTX1UP;i++)</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MYOCOMPLOOPF MYOCOMPLOOPF3 MYOCOMPLOOPF2 MYOCOMPLOOPF1</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  <a class="code" href="../../d0/dde/fluxctstag_8c.html#a2573dacddc2bce532e78a55d7c21c201">MYOCOMPLOOPF</a>{</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl){</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>+pl-<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>, ptrgeomf);</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      <span class="comment">// first convert staggered upoint to pstag</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl)=<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(upoint,i,j,k,pl)*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ptrgeomf-&gt;gdet)/(fabs(ptrgeomf-&gt;gdet)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      <span class="comment">// GODMARK: Some problem with gdet not being 0 on axis!!  Leads to pstag[B2]=-2E50, but apparently overwritten?</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    }</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  }</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  <span class="comment">//  COMPZLOOP{</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  <span class="comment">//    dualfprintf(fail_file,&quot;DEATH1: i=%d j=%d k=%d :: %21.15g %21.15g %21.15g\n&quot;,i,j,k,MACP0A1(pstag,i,j,k,B1),MACP0A1(pstag,i,j,k,B2),MACP0A1(pstag,i,j,k,B3));</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  <span class="comment">// bound new pstag</span></div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;  <span class="keywordflow">if</span>(timeorder==numtimeorders-1) finalstep=1; <span class="keywordflow">else</span> finalstep=0;</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  <a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#a6f4b963a50a7288964f01775f2f18bb9" title="normal bounding of staggered primitives">bound_pstag</a>(stage, finalstep, boundtime, preal, pstag, upoint, USEMPI);</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <span class="comment">//  COMPFULLLOOP{</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;  <span class="comment">//    dualfprintf(fail_file,&quot;DEATH2: i=%d j=%d k=%d :: %21.15g %21.15g %21.15g\n&quot;,i,j,k,MACP0A1(pstag,i,j,k,B1),MACP0A1(pstag,i,j,k,B2),MACP0A1(pstag,i,j,k,B3));</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  <span class="comment">// now can define everything from pstag</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;  <span class="comment">// GODMARK: this defines pcent and upoint on larger domain than normal code, so may mask problem.</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;  <span class="comment">//  COMPFULLLOOP{</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <span class="comment">// correctly similar constrained loop as in normal code:</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;  <span class="keywordtype">int</span> is,ie,js,je,ks,ke;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  get_inversion_startendindices(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab5c60dcb37b1f7e5642525031cd5cbcf">Uconsevolveloop</a>,&amp;is,&amp;ie,&amp;js,&amp;je,&amp;ks,&amp;ke);</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  <a class="code" href="../../df/da8/global_8comploops_8h.html#a2b7f7897952112ccf758296b31563ae2" title="can use COMPZSLOOP if don&#39;t care about extra calculations SASMARK SECTIONMARK: modified is/ie...">COMPZSLOOP</a>(is,ie,js,je,ks,ke){</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, ptrgeomc);</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl){</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>+pl-<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>, ptrgeomf);</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      <span class="keywordflow">if</span>(pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>){</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        ii=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a27e1e0a92af691ffd03d7e9d0a628392">ip1mac</a>(i);</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        jj=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        kk=k;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      }</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>){</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        ii=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        jj=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a3e64aa2cd3c5e0933e74fa4e7a925570">jp1mac</a>(j);</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        kk=k;</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      }</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>){</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        ii=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        jj=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        kk=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#aafe7c78a2d0713ddc9a4f1c61764e3b9">kp1mac</a>(k);</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      }</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      <span class="keywordflow">if</span>(ii==i &amp;&amp; jj==j &amp;&amp; kk==k){</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        <span class="comment">// then just copy</span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pcent,i,j,k,pl)=<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl);</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;      }</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <span class="comment">// now &quot;interpolate&quot; pstag -&gt; pcent</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(ii, jj, kk, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>+pl-<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>, ptrgeomfu);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        <span class="comment">// below consistent with interpolate_ustag2fieldcent(), but can try different way </span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pcent,i,j,k,pl)=0.5*( <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl)*(ptrgeomf-&gt;gdet/ptrgeomc-&gt;gdet) + <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,ii,jj,kk,pl)*(ptrgeomfu-&gt;gdet/ptrgeomc-&gt;gdet));</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;      }</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      <span class="comment">// finally get conserved quantity at CENT for inversion</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(upoint,i,j,k,pl)=<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pcent,i,j,k,pl)*(ptrgeomc-&gt;gdet);</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    }<span class="comment">// end over pl</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  }<span class="comment">// end loop</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:33 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
