<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: interppoint.para.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">interppoint.para.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/d30/interppoint_8para_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;decs.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d6c/para__and__paraenohybrid_8h.html" title="macros/definitions for interppoint.para.c and interpline.para.c">para_and_paraenohybrid.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keywordtype">void</span> parainitchecks(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordtype">int</span> dimen;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a8cbb473515f18fcae523329c93f140dc">DIMENLOOP</a>(dimen){</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dc/d6c/para__and__paraenohybrid_8h.html#a0ea868d9eaf12e9764936addf10f376f" title="Noticed with MCSTEEP that allowing extremum causes catastrophic problems with torus problem with fiel...">PARAGENDQALLOWEXTREMUM</a> &amp;&amp; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4f08471d27464c32d301f3c4a2f06f50" title="defines limiters that are WENO/ENO">WENOINTERPTYPE</a>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[dimen])){</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      <span class="comment">// if PARAMODWENO==1 implied, but if 0 allow since doesn&#39;t matter if doing weno with PARAGENDQALLOWEXTREMUM==1</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      <span class="comment">// then ok</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a9efbdb319435873a6f7afe3f8e816c8d">PARAMODWENO</a>==1 &amp;&amp; <a class="code" href="../../dc/d6c/para__and__paraenohybrid_8h.html#a0ea868d9eaf12e9764936addf10f376f" title="Noticed with MCSTEEP that allowing extremum causes catastrophic problems with torus problem with fiel...">PARAGENDQALLOWEXTREMUM</a>==0 &amp;&amp; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4f08471d27464c32d301f3c4a2f06f50" title="defines limiters that are WENO/ENO">WENOINTERPTYPE</a>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[dimen])){</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;WARNING: PARAGENDQALLOWEXTREMUM==0 for hybrid method, will be less accurate for turbulent regions\n&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dc/d6c/para__and__paraenohybrid_8h.html#a0ea868d9eaf12e9764936addf10f376f" title="Noticed with MCSTEEP that allowing extremum causes catastrophic problems with torus problem with fiel...">PARAGENDQALLOWEXTREMUM</a>==1 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[dimen]==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a4a9bbfdf5f09030f9a6e13286d150201">PARA</a>){</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ERROR: PARAGENDQALLOWEXTREMUM==1 but not WENO-based limiter -- will be less stable in stiff regions (e.g. near horizon). Use PARALINE instead.\n&quot;</span>);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      myexit(34643463);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[dimen]==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5399643dd70f2026909e4c6b5eef50d6">PARAFLAT</a>){</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;WARNING: PARAFLAT inefficient compared to PARALINE, suggested to use PARALINE instead\n&quot;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#a6f45f925dd7972198f6ef41de42374df">   56</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/d30/interppoint_8para_8c.html#a6f45f925dd7972198f6ef41de42374df" title="lout/rout is left and right sides of cell note how used in step_ch.c to get appropriate interface val...">para</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordtype">int</span> mm ;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dq0[5];</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm, Dqc, Dqp, aDqm,aDqp,aDqc,s,l,r,qa, qd, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a204451e8ec20e7512e65a0b10cd19797">qe</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// shifted dq</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  dq=dq0+2;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">/*CW1.7 */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">for</span>(mm=-1 ; mm&lt;=1 ; mm++) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    Dqm = 2.0 *(y[mm]-y[mm-1]);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    Dqp = 2.0 *(y[mm+1]-y[mm]);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    Dqc = 0.5 *(y[mm+1]-y[mm-1]);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;       <span class="comment">//CW1.8</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">else</span> dq[mm]=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">/* CW1.6 */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  l=0.5*(y[0]+y[-1])-(dq[0]-dq[-1])/6.0;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  r=0.5*(y[1]+y[0])-(dq[1]-dq[0])/6.0;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  qa=(r-y[0])*(y[0]-l);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  qd=(r-l);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  qe=6.0*(y[0]-0.5*(l+r));</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">if</span> (qa &lt;=0. ) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    l=y[0];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    r=y[0];</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> (qd*(qd-qe)&lt;0.0) l=3.0*y[0]-2.0*r;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (qd*(qd+qe)&lt;0.0) r=3.0*y[0]-2.0*l;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  *lout=l;   <span class="comment">//a_L,j</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  *rout=r;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">//*dw=r-l;                      //CW1.5</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">//*w6=6.0*(y[0]-0.5*(l+r));</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="keywordtype">void</span> para2(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;{</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordtype">int</span> mm ;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dq0[5];</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm, Dqc, Dqp, Dqvanl,aDqm,aDqp,aDqc,aDqvanl,s,l,r,qa, qd, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a204451e8ec20e7512e65a0b10cd19797">qe</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">// shifted dq</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  dq=dq0+2;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">/*CW1.7 */</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">for</span>(mm=-1 ; mm&lt;=1 ; mm++) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    Dqm = 2.0 *(y[mm]-y[mm-1]);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    Dqp = 2.0 *(y[mm+1]-y[mm]);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    Dqc = 0.5 *(y[mm+1]-y[mm-1]);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#if(PARA2LIM == VANL) </span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor"></span>    Dqvanl=2.0*Dqm*Dqp/(Dqm+Dqp);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    aDqvanl=fabs(Dqvanl);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;       <span class="comment">//CW1.8</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">else</span> dq[mm]=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,aDqvanl),<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#elif(PARA2LIM == PMC)</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;       <span class="comment">//CW1.8</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">else</span> dq[mm]=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MC)</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor"></span>    dq[mm] =Dqc;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">/* CW1.6 */</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  l=0.5*(y[0]+y[-1])-(dq[0]-dq[-1])/6.0;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  r=0.5*(y[1]+y[0])-(dq[1]-dq[0])/6.0;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">    l=max(min(y[0],y[-1]),l);</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">    l=min(max(y[0],y[-1]),l);</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">    r=max(min(y[0],y[1]),r);</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">    r=min(max(y[0],y[1]),r);</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  qa=(r-y[0])*(y[0]-l);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  qd=(r-l);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  qe=6.0*(y[0]-0.5*(l+r));</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">if</span> (qa &lt;=0. ) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    l=y[0];</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    r=y[0];</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (qd*(qd-qe)&lt;0.0) l=3.0*y[0]-2.0*r;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (qd*(qd+qe)&lt;0.0) r=3.0*y[0]-2.0*l;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  *lout=l;   <span class="comment">//a_L,j</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  *rout=r;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">//*dw=r-l;                      //CW1.5</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">//*w6=6.0*(y[0]-0.5*(l+r));</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordtype">void</span> para3(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;{</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">int</span> mm ;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dq0[5];</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm, Dqc, Dqp, Dqvanl,aDqm,aDqp,aDqc,aDqvanl,s,l,r,qa, qd, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a204451e8ec20e7512e65a0b10cd19797">qe</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// shifted dq</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  dq=dq0+2;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">/*CW1.7 */</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">for</span>(mm=-1 ; mm&lt;=1 ; mm++) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    Dqm = 2.0 *(y[mm]-y[mm-1]);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    Dqp = 2.0 *(y[mm+1]-y[mm]);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    Dqc = 0.5 *(y[mm+1]-y[mm-1]);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#if(PARA2LIM == VANL) </span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor"></span>    Dqvanl=2.0*Dqm*Dqp/(Dqm+Dqp);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    aDqvanl=fabs(Dqvanl);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">else</span> dq[mm] = -aDqvanl*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">//else dq[mm]=min(min(aDqc,aDqvanl),min(aDqm,aDqp))*sign(Dqc);</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MC)</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;       <span class="comment">//CW1.8</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">else</span> dq[mm]=-<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MINM)</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (s&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm&lt;aDqp) dq[mm] = -aDqm*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">else</span> dq[mm]=-aDqp*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="preprocessor">#elif(PARA2LIM == NLIM) //w/o slope limiter</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor"></span>    <span class="comment">//if(s&lt;=0.) dq[mm] = 0.; // DONOR</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    dq[mm] = Dqc;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">/* CW1.6 */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  l=0.5*(y[0]+y[-1])-(dq[0]-dq[-1])/6.0;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  r=0.5*(y[1]+y[0])-(dq[1]-dq[0])/6.0;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  l=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(y[0],y[-1]),l);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  l=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(y[0],y[-1]),l);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  r=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(y[0],y[1]),r);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  r=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(y[0],y[1]),r);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  qa=(r-y[0])*(y[0]-l);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  qd=(r-l);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  qe=6.0*(y[0]-0.5*(l+r));</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">    if (qa &lt;=0. ) {</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">    l=y[0];</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">    r=y[0];</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">    else if (qd*(qd-qe)&lt;0.0) l=3.0*y[0]-2.0*r;</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">    else if (qd*(qd+qe)&lt;0.0) r=3.0*y[0]-2.0*l;</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">    *lout=l;   //a_L,j</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">    *rout=r;</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">if</span> (qa &lt;=0. ) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    *lout=y[0];</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    *rout=y[0];</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  }  </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    *lout = l;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    *rout = r;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">//2.0 at top/bottom of a steep gradient </span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">if</span> (qd*(qd-qe)&lt;0.0) *lout=3.0*y[0]-2.0*r;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">else</span> *lout = l;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">if</span> (qd*(qd+qe)&lt;0.0) *rout=3.0*y[0]-2.0*l;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">else</span> *rout = r;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">//*dw=r-l;                      //CW1.5</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">//*w6=6.0*(y[0]-0.5*(l+r));</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keywordtype">void</span> para4_old(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;{</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordtype">int</span> mm ;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dq0[5];</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm, Dqc, Dqp, Dqvanl,aDqm,aDqp,aDqc,aDqvanl,s,l,r,qa, qd, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a204451e8ec20e7512e65a0b10cd19797">qe</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d8/ddd/interppoint_8c.html#a70f54bffe6df5f410a43980f4aa83971" title="limited slopes using 3 points Gives slope that will be assumed to be located at same location as yc –...">slope_lim_3points</a>(<span class="keywordtype">int</span> reallim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yc, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yr,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">// shifted dq</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  dq=dq0+2;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">/*CW1.7 */</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">for</span>(mm=-1 ; mm&lt;=1 ; mm++) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    Dqm = 2.0 *(y[mm]-y[mm-1]);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    Dqp = 2.0 *(y[mm+1]-y[mm]);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    Dqc = 0.5 *(y[mm+1]-y[mm-1]);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#if(PARA2LIM == VANL) </span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor"></span>    Dqvanl=2.0*Dqm*Dqp/(Dqm+Dqp);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    aDqvanl=fabs(Dqvanl);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">//else dq[mm] = aDqvanl*sign(Dqc);</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">else</span> dq[mm]=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,aDqvanl),<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MC)</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Jon&#39;s version</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    dq[mm]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7bc6460ed54e2c644d2531ef4ee7864c">MINMOD</a>(Dqc,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7bc6460ed54e2c644d2531ef4ee7864c">MINMOD</a>(Dqm,Dqp));</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Xioyue&#39;s version</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;       <span class="comment">//CW1.8</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">else</span> dq[mm]= <a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MINM_STEEPENER)</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// Xioyue&#39;s version (steepeneed version of MINM)</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (s&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm&lt;aDqp) dq[mm] = aDqm*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">else</span> dq[mm]=aDqp*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MINM) // no steepener, normal MINM</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Jon&#39;s version</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    dq[mm] = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7bc6460ed54e2c644d2531ef4ee7864c">MINMOD</a>(0.5*Dqm,0.5*Dqp); <span class="comment">// no steepening    </span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">#elif(1)</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Jon&#39;s steep version</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (s&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm&lt;aDqp) dq[mm] = aDqm*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">else</span> dq[mm]=aDqp*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">#elif(0)</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Xioyue&#39;s version</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (s&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm&lt;aDqp) dq[mm] = 0.5*aDqm*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">else</span> dq[mm]=0.5*aDqp*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="preprocessor">#elif(PARA2LIM == NLIM) //w/o slope limiter</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    dq[mm] = Dqc;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="preprocessor">#if(JONPARAREDUCE)</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="preprocessor"></span>  <span class="comment">//  if(pl==U1){</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">if</span>(pl!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>){</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;       (fabs(dq[-1]-dq[0])/(fabs(dq[-1])+fabs(dq[0])+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>)&gt;0.1)||</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;       (fabs(dq[1]-dq[0])/(fabs(dq[1])+fabs(dq[0])+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>)&gt;0.1)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;       ){</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <a class="code" href="../../d8/ddd/interppoint_8c.html#a70f54bffe6df5f410a43980f4aa83971" title="limited slopes using 3 points Gives slope that will be assumed to be located at same location as yc –...">slope_lim_3points</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d03669552f78d096bbf4e8719f6718">MINM</a>, y[-1], y[0], y[1], dq);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      *lout =y[0] - 0.5* (*dq);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      *rout=y[0] + 0.5* (*dq);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">/* CW1.6 */</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="comment">// modified as per Matt&#39;s paper</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  l=0.5*(y[0]+y[-1])-(dq[0]-dq[-1])/8.0;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  r=0.5*(y[1]+y[0])-(dq[1]-dq[0])/8.0;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  l=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(y[0],y[-1]),l);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  l=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(y[0],y[-1]),l);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  r=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(y[0],y[1]),r);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  r=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(y[0],y[1]),r);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">// modified as per Matt&#39;s paper</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  qa=(r-y[0])*(y[0]-l);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  qd=(r-l);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  qe=6.0*(y[0]-0.5*(l+r));</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">if</span> (qa &lt;=0. ) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    l=y[0];</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    r=y[0];</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (qd*(qd-qe)&lt;0.0) </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      l=3.0*y[0]-2.0*r;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (qd*(qd+qe)&lt;0.0) </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      r=3.0*y[0]-2.0*l;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  *lout=l;   <span class="comment">//a_L,j</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  *rout=r;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">//  *dqleft=dq[-1];</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="comment">//  *dqcenter=dq[0];</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">//  *dqright=dq[1];</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#a81145bfdcc8fd5a5a8cf78886cf2673b">  405</a></span>&#160;<span class="preprocessor">#define DO4MONO 0 // whether to add-back-in some trend that one removed -- not working yet in this code</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00407"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#a085b68c3a899fe50592c8ad03b789428">  407</a></span>&#160;<span class="preprocessor">#define OVERRIDEWITHMINM 1</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordtype">void</span> parajon(<span class="keywordtype">int</span> ii, <span class="keywordtype">int</span> jj, <span class="keywordtype">int</span> kk, <span class="keywordtype">int</span> loc, <span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;{</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordtype">int</span> mm;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dq0[10];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm, Dqc, Dqp, Dqvanl,aDqm,aDqp,aDqc,aDqvanl,s,l,r,qa, qd, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a204451e8ec20e7512e65a0b10cd19797">qe</a>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d8/ddd/interppoint_8c.html#a70f54bffe6df5f410a43980f4aa83971" title="limited slopes using 3 points Gives slope that will be assumed to be located at same location as yc –...">slope_lim_3points</a>(<span class="keywordtype">int</span> reallim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yc, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yr,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordtype">void</span> jonparasmooth_compute(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dqrange, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq1, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq2, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout, <span class="keywordtype">int</span> *smooth);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordtype">int</span> smooth=0;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordtype">int</span> a_whichdq[10];</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> a_y4mono[10];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y4mono;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordtype">int</span> *whichdq;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">int</span> dqrange=2;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordtype">int</span> usepara;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> s0;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordtype">int</span> iii,jjj,kkk;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm4mono,Dqc4mono,Dqp4mono;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> s4mono;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> aDqm4mono,aDqc4mono,aDqp4mono;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordtype">int</span> shifti=(dir==1);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordtype">int</span> shiftj=(dir==2);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordtype">int</span> shiftk=(dir==3);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="comment">// shifted dq</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  dq=dq0+dqrange;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  whichdq=a_whichdq+dqrange;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="preprocessor">#if(DO4MONO)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="preprocessor"></span>  y4mono=a_y4mono+dqrange;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="comment">// get true function</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">for</span>(mm=-2 ; mm&lt;=2 ; mm++) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    iii=ii+shifti*mm;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    jjj=jj+shiftj*mm;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    kkk=kk+shiftk*mm;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    y4mono[mm] = y[mm]*GLOBALMACP1A0(pother,RHOCENTA+pl,iii,jjj,kkk);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">/*CW1.7 */</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  s0=1.0;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">for</span>(mm=-1 ; mm&lt;=1 ; mm++) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    Dqm = 2.0 *(y[mm]-y[mm-1]);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    Dqp = 2.0 *(y[mm+1]-y[mm]);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    Dqc = 0.5 *(y[mm+1]-y[mm-1]);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor">#if(DO4MONO)</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="preprocessor"></span>    <span class="comment">// 4mono version</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    Dqm4mono = 2.0 *(y4mono[mm]-y4mono[mm-1]);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    Dqp4mono = 2.0 *(y4mono[mm+1]-y4mono[mm]);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    Dqc4mono = 0.5 *(y4mono[mm+1]-y4mono[mm-1]);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="preprocessor"></span>    <span class="comment">// normal version</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    Dqm4mono = Dqm;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    Dqp4mono = Dqp;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    Dqc4mono = Dqc;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// check what slope is chosen</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span>(fabs(Dqc4mono)&lt;=fabs(Dqm4mono) &amp;&amp; fabs(Dqc4mono)&lt;=fabs(Dqp4mono)){</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="comment">// central picked .. is fine</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      whichdq[mm]=0;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fabs(Dqm4mono)&lt;=fabs(Dqp4mono) &amp;&amp; fabs(Dqm4mono)&lt;=fabs(Dqc4mono)){</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="comment">// check if really want to steepen</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      whichdq[mm]=-1;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fabs(Dqp4mono)&lt;=fabs(Dqm4mono) &amp;&amp; fabs(Dqp4mono)&lt;=fabs(Dqc4mono)){</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      whichdq[mm]=+1;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      whichdq[mm]=+1; <span class="comment">// GODMARK: Shouldn&#39;t really get here</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    aDqm4mono = fabs(Dqm4mono) ;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    aDqp4mono = fabs(Dqp4mono) ;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    aDqc4mono = fabs(Dqc4mono) ;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    s4mono = Dqm4mono*Dqp4mono;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span>(s4mono&lt;=0) s0=-1;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="preprocessor">#if(OVERRIDEWITHMINM || PARA2LIM == MINM) // no steepener, normal MINM</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="preprocessor"></span>    <span class="comment">// in stiff regime, MINM is more stable than other schemes with steepeners</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (s4mono&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm4mono&lt;aDqp4mono) dq[mm] = 0.5*Dqm;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">else</span> dq[mm]=0.5*Dqp;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="preprocessor">#elif(PARA2LIM == VANL) </span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="preprocessor"></span>    <span class="comment">// NOT DONE for 4mono method</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    Dqvanl=2.0*Dqm*Dqp/(Dqm+Dqp);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    aDqvanl=fabs(Dqvanl);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">if</span> (s4mono &lt;=0.) dq[mm]=0.;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">else</span> dq[mm]=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,aDqvanl),<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MC)</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> (s4mono &lt;=0.) dq[mm]=0.;       <span class="comment">//CW1.8</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm4mono&lt;aDqp4mono &amp;&amp; aDqm4mono&lt;aDqc4mono) dq[mm] = Dqm;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqp4mono&lt;aDqm4mono &amp;&amp; aDqp4mono&lt;aDqc4mono) dq[mm] = Dqp;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">else</span> dq[mm]=Dqc;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MINM_STEEPENER)</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">// Xioyue&#39;s version (steepeneed version of MINM)</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> (s4mono&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm4mono&lt;aDqp4mono) dq[mm] = Dqm;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">else</span> dq[mm]=Dqp;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">#elif(PARA2LIM == NLIM) //w/o slope limiter</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="preprocessor"></span>    dq[mm] = Dqc;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// no matter what dqrange is, just go from -1..1  </span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  usepara=0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">for</span>(mm=-1 ; mm&lt;=1 ; mm++) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    usepara+=(whichdq[mm]==0);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">//  if(usepara==3 &amp;&amp; s0&gt;=0.0){</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">//  if(usepara==3 &amp;&amp; s0&gt;=0.0 &amp;&amp; 0){ // ONLY  MINMOD</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordflow">if</span>(usepara==3 &amp;&amp; s0&gt;=0.0){</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">// then use interior parabola and be done</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    *lout=(1./8.)*(6.0*y[0]+3.0*y[-1]-y[1]);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    *rout=(1./8.)*(6.0*y[0]-y[-1]+3.0*y[1]);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">// then just use 2nd order</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    *lout=y[0]-0.5*dq[0];</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    *rout=y[0]+0.5*dq[0];</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;}</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#abe1b655c3bd8c6e3ac699e6cedb03c18">  571</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/d30/interppoint_8para_8c.html#abe1b655c3bd8c6e3ac699e6cedb03c18" title="doesn&#39;t use dq">para4</a>(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;{</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordtype">void</span> para4gen(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dqrange, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <span class="keywordtype">int</span> *smooth);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keywordtype">void</span> checkparamonotonicity(<span class="keywordtype">int</span> smooth, <span class="keywordtype">int</span> dqrange, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *ddq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lin, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dq0[5];</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordtype">int</span> dqrange;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> a_ddq[7];</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *ddq;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordtype">int</span> mm;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordtype">int</span> smooth;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  dqrange=3;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">// shifted dq</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  dq=dq0+2;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  ddq=a_ddq+3; <span class="comment">// shifted sufficiently</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  para4gen(realisinterp,dqrange, pl,y,lout,rout,dq,&amp;smooth);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">for</span>(mm=-dqrange/2+1;mm&lt;=dqrange/2;mm++){</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    ddq[mm] = dq[mm] - dq[mm-1];</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  checkparamonotonicity(smooth, dqrange, pl, y, ddq, dq, lout, rout, lout, rout);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="preprocessor">#if(PARAGENDQALLOWEXTREMUM==0)</span></div>
<div class="line"><a name="l00604"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#a55b45648be3704cae8fc42f1d7a04c86">  604</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define PARAGENMINMOD(a,b) MINMOD(a,b)</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define PARAGENMINMOD(a,b) MINMODB(a,b)</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="keywordtype">void</span> para4gen(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dqrange, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <span class="keywordtype">int</span> *smooth)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;{</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordtype">int</span> mm ;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> a_dq1[10],a_dq2[10];</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq1,*dq2;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm, Dqc, Dqp, Dqvanl,aDqm,aDqp,aDqc,aDqvanl,s,l,r;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d8/ddd/interppoint_8c.html#a70f54bffe6df5f410a43980f4aa83971" title="limited slopes using 3 points Gives slope that will be assumed to be located at same location as yc –...">slope_lim_3points</a>(<span class="keywordtype">int</span> reallim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yc, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> yr,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqparacenterleft,Dqparacenterright;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqsteep;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ddql,ddqr;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordtype">void</span> paracont(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ddq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *facecont);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordtype">void</span> jonparasmooth_compute(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dqrange, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq1, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq2, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout, <span class="keywordtype">int</span> *smooth);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// Procedure:</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// 1) First obtain limited slopes (above)</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="comment">// 2) Assume l,r obtained from 3rd order polynomial for points or quartic for averages</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="comment">// 3) steepen or flatten solution</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="comment">// 4) Check monotonicity: </span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="comment">//    Condition 1: If y[0] is a local max or local min compared to l,r, then set l=r=y[0]</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">//    Condition 2: If parabola fit through l,y[0],r is non-monotonic, then if non-monotonic region is near l, then modify r until derivative of parabola at l is 0.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">// shifted dq (sufficiently shifted)</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  dq1=a_dq1+dqrange;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  dq2=a_dq2+dqrange;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="comment">// setup defaults</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  *smooth=0;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="preprocessor">#if(JONPARASTEEP)</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">// first check if 3rd order polynomial will have derivative at center of cell that MC says doesn&#39;t need steepening</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  mm=0;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  Dqm = 2.0 *(y[mm]-y[mm-1]);   <span class="comment">// steepened</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  Dqp = 2.0 *(y[mm+1]-y[mm]);   <span class="comment">// steepened</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">//  Dqc = 0.5 *(y[mm+1]-y[mm-1]); // normal</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="comment">// Note that the factors of 3 (and 6) cause asymmetries at roundoff-error</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  Dqparacenterleft =  (+0.5*y[0]-y[-1]    +y[-2]/6.0+y[1]/3.0); <span class="comment">// used to get a_{j-1/2}</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  Dqparacenterright = (-0.5*y[0]-y[-1]/3.0+y[1] -    y[2]/6.0); <span class="comment">// used to get a_{j+1/2}</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="comment">// see if para will use centered slope that is not steepened enough compared to MC</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">// first compare Dqp and Dqm</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  Dqsteep=<a class="code" href="../../df/d30/interppoint_8para_8c.html#a55b45648be3704cae8fc42f1d7a04c86">PARAGENMINMOD</a>(Dqm,Dqp);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">//    *dq=PARAGENMINMOD(Dqc,PARAGENMINMOD(Dqm,Dqp));</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">// now compare centered with steepened Dqsteep value</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="keywordflow">if</span>(fabs(Dqparacenterleft)&gt;fabs(Dqsteep) &amp;&amp; fabs(Dqparacenterright)&gt;fabs(Dqsteep)){</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    *lout = y[0] - 0.5* Dqsteep;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    *rout = y[0] + 0.5* Dqsteep;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">//dualfprintf(fail_file,&quot;USEDSTEEP\n&quot;);</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// else PARA is ok to use</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="comment">//dualfprintf(fail_file,&quot;USEDPARA\n&quot;);</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">// get slopes</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="comment">// Dqm(0) = 2.0*(dq1[0])</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">// Dqp(0) = 2.0*(dq1[1]) // so need to go 1 farther to get all needed Dqp&#39;s</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordflow">for</span>(mm=-dqrange/2 ; mm&lt;=dqrange/2 ; mm++) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    dq1[mm] = (y[mm]-y[mm-1]); <span class="comment">// slope centered at cell face</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    dq2[mm] = 0.5 *(y[mm+1]-y[mm-1]); <span class="comment">// slope centered at cell center</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  mm=dqrange/2+1; <span class="comment">// get last dq1 (can&#39;t do in loop above since +1 would mean dq2 beyond data range</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  dq1[mm] = (y[mm]-y[mm-1]); <span class="comment">// slope centered at cell face</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// Determine monotonized slopes</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="comment">/*CW1.7 */</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">for</span>(mm=-dqrange/2 ; mm&lt;=dqrange/2 ; mm++) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    Dqm = 2.0 *dq1[mm];   <span class="comment">// steepened</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    Dqp = 2.0 *dq1[mm+1]; <span class="comment">// steepened</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    Dqc = dq2[mm];        <span class="comment">// normal</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="preprocessor">#if(PARA2LIM == VANL) </span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="preprocessor"></span>    Dqm*=0.5; <span class="comment">// desteepen</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    Dqp*=0.5; <span class="comment">// desteepen</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    Dqvanl=2.0*s/(Dqm+Dqp);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">//    aDqvanl=fabs(Dqvanl);</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">//    aDqm = fabs(Dqm) ;</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">//    aDqp = fabs(Dqp) ;</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">//    aDqc = fabs(Dqc) ;</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment">// true VANL:</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">else</span> dq[mm] = Dqvanl*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// Xioyue was using MC-VANL combo of some kind</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="comment">//    else dq[mm] = aDqvanl*sign(Dqc);</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">//    else dq[mm]=min(min(aDqc,aDqvanl),min(aDqm,aDqp))*sign(Dqc);</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MC)</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="preprocessor">#if(1)</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Jon&#39;s version</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    dq[mm]=<a class="code" href="../../df/d30/interppoint_8para_8c.html#a55b45648be3704cae8fc42f1d7a04c86">PARAGENMINMOD</a>(Dqc,<a class="code" href="../../df/d30/interppoint_8para_8c.html#a55b45648be3704cae8fc42f1d7a04c86">PARAGENMINMOD</a>(Dqm,Dqp));</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Xioyue&#39;s version</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">if</span> (s &lt;=0.) dq[mm]=0.;       <span class="comment">//CW1.8</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">else</span> dq[mm]= <a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqc,<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(aDqm,aDqp))*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MINM_STEEPENER)</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">// Xioyue&#39;s version (steepeneed version of MINM)</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span> (s&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm&lt;aDqp) dq[mm] = aDqm*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">else</span> dq[mm]=aDqp*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="preprocessor">#elif(PARA2LIM == MINM) // no steepener, normal MINM</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="preprocessor">#if(1)</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Jon&#39;s version</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    dq[mm] = <a class="code" href="../../df/d30/interppoint_8para_8c.html#a55b45648be3704cae8fc42f1d7a04c86">PARAGENMINMOD</a>(0.5*Dqm,0.5*Dqp); <span class="comment">// no steepening    </span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="preprocessor">#elif(0)</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Jon&#39;s steep version</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span> (s&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm&lt;aDqp) dq[mm] = aDqm*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">else</span> dq[mm]=aDqp*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="preprocessor">#elif(0)</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Xioyue&#39;s version</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    s = Dqm*Dqp;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    aDqm = fabs(Dqm) ;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    aDqp = fabs(Dqp) ;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    aDqc = fabs(Dqc) ;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (s&lt;=0.) dq[mm] = 0.;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aDqm&lt;aDqp) dq[mm] = 0.5*aDqm*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">else</span> dq[mm]=0.5*aDqp*<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(Dqc);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="preprocessor">#elif(PARA2LIM == NLIM) //w/o slope limiter</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    dq[mm] = Dqc;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="preprocessor"></span>  }<span class="comment">// end loop over mm&#39;s</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#if(JONPARASMOOTH)</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="preprocessor"></span>  jonparasmooth_compute(realisinterp,dqrange,pl,y,dq1,dq2,lout,rout,smooth);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordflow">if</span>(*smooth) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="preprocessor"></span>  *smooth=0;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="preprocessor">#if(JONPARAREDUCE)</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="preprocessor"></span>  <span class="comment">//  if(pl==U1){</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordflow">if</span>(pl!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>){</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;       (fabs(dq[-1]-dq[0])/(fabs(dq[-1])+fabs(dq[0])+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>)&gt;0.1)||</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;       (fabs(dq[1]-dq[0])/(fabs(dq[1])+fabs(dq[0])+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>)&gt;0.1)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;       ){</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <a class="code" href="../../d8/ddd/interppoint_8c.html#a70f54bffe6df5f410a43980f4aa83971" title="limited slopes using 3 points Gives slope that will be assumed to be located at same location as yc –...">slope_lim_3points</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d03669552f78d096bbf4e8719f6718">MINM</a>, y[-1], y[0], y[1], dq);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      *lout =y[0] - 0.5* (*dq);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      *rout=y[0] + 0.5* (*dq);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor">#if(WHICHLIMITERTOUSEFORLR==0)</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="comment">// Obtain continuous solution at interface</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">// CW1.6 for obtaining a_{j+1/2} using quartic polynomial, but slopes have been replaced with limited slopes</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="comment">// GODMARK: This step could be done once for entire line of data</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  ddql=(dq[0]-dq[-1]);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  ddqr=(dq[1]-dq[0]);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  paracont(ddql, &amp;y[0], &amp;l);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  paracont(ddqr, &amp;y[1], &amp;r);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="preprocessor"></span>  <span class="comment">// doesn&#39;t seem to be within CW!</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  l=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(y[0],y[-1]),l);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  l=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(y[0],y[-1]),l);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  r=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(y[0],y[1]),r);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  r=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(y[0],y[1]),r);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  *lout = l;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  *rout = r;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor">#elif(WHICHLIMITERTOUSEFORLR==1)</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="comment">// notice that this results in discontinuous solution at each interface already, unlike para method</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  *lout = y[0] - 0.5*dq[0];</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  *rout = y[0] + 0.5*dq[0];</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="comment">// differs from normal MC,MINM, etc. by computing dq&#39;s that will be used later for steepener, fattener, and parabolic check</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="comment">// Note that MC is actually 3rd order acccurate (error term O(dx^3)) because linear l,r gives same answer as parabola!</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keywordtype">void</span> jonparasmooth_compute(<span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dqrange, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq1, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq2, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout, <span class="keywordtype">int</span> *smooth)</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;{</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordtype">int</span> usepara=0;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordtype">int</span> mm;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Dqm,Dqp,Dqc;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">int</span> a_whichdq[10];</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordtype">int</span> *whichdq;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  whichdq=a_whichdq+dqrange;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordflow">for</span>(mm=-dqrange/2 ; mm&lt;=dqrange/2 ; mm++) {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    Dqm = 2.0 *dq1[mm];   <span class="comment">// steepened</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    Dqp = 2.0 *dq1[mm+1]; <span class="comment">// steepened</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    Dqc = dq2[mm];        <span class="comment">// normal</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span>(fabs(Dqc)&lt;=fabs(Dqm) &amp;&amp; fabs(Dqc)&lt;=fabs(Dqp)){</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="comment">// central picked .. is fine</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      whichdq[mm]=0;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fabs(Dqm)&lt;=fabs(Dqp) &amp;&amp; fabs(Dqm)&lt;=fabs(Dqc)){</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="comment">// check if really want to steepen</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      whichdq[mm]=-1;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fabs(Dqp)&lt;=fabs(Dqm) &amp;&amp; fabs(Dqp)&lt;=fabs(Dqc)){</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      whichdq[mm]=+1;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      whichdq[mm]=+1; <span class="comment">// GODMARK: Shouldn&#39;t really get here</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordflow">if</span>(realisinterp==1 &amp;&amp; pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a> &amp;&amp; dqrange&gt;=5){</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="comment">// check steepened slopes to ensure really want to steepen</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="comment">//  for(mm=-dqrange/2+1 ; mm&lt;=dqrange/2-1 ; mm++) {</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">for</span>(mm=-2 ; mm&lt;=2 ; mm++) {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      usepara+=(whichdq[mm]==0);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">if</span>(usepara==5){</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="comment">// then use interior parabola and be done</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      *lout=(1./8.)*(6.0*y[0]+3.0*y[-1]-y[1]);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      *rout=(1./8.)*(6.0*y[0]-y[-1]+3.0*y[1]);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      *smooth=1;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="comment">// else use para as normal</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">// check steepened slopes to ensure really want to steepen</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="comment">//  for(mm=-dqrange/2+1 ; mm&lt;=dqrange/2-1 ; mm++) {</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">for</span>(mm=-1 ; mm&lt;=1 ; mm++) {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      usepara+=(whichdq[mm]==0);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">if</span>(usepara==3){</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <span class="comment">// then use interior parabola and be done</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      *lout=(1./8.)*(6.0*y[0]+3.0*y[-1]-y[1]);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      *rout=(1./8.)*(6.0*y[0]-y[-1]+3.0*y[1]);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      *smooth=1;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="comment">// else use para as normal</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  *smooth=0;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;}</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keywordtype">void</span> paracont(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ddq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *facecont)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;{</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> avgpointcoef;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="preprocessor">#if(AVGINPUT)</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="preprocessor"></span>  <span class="comment">// /6 is result of passing through points from differential of average values in each cell</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  avgpointcoef=1.0/6.0;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  *facecont=0.5*(y[0]+y[-1])-ddq*avgpointcoef;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="preprocessor"></span>  avgpointcoef=1.0/8.0;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="comment">// consistent with Matt&#39;s paper</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="comment">// assume passing quartic polynomial through points y[-2,-1,0,1,2]</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="comment">// see PARA_interpolation_checks.nb</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  *facecont=0.5*(y[0]+y[-1])-ddq*avgpointcoef;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;}</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div>
<div class="line"><a name="l00985"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#ab9b3f994d408e603724217224dac915b">  985</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/d30/interppoint_8para_8c.html#ab9b3f994d408e603724217224dac915b" title="PARA starts with continuous 3rd order polynomial (4th order through averages if used) using monotoniz...">paracontsmooth</a>(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *facecont, <span class="keywordtype">int</span> *smooth)</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;{</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ddqtest[4];</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keywordtype">int</span> whichmax;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> maxddq;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> qc,qd,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a204451e8ec20e7512e65a0b10cd19797">qe</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="preprocessor">#if(AVGINPUT)</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="preprocessor"></span>  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;NOT SETUP\n&quot;</span>);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  myexit(249678346);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="preprocessor"></span>  <span class="comment">// PARAFLAT has enough points for this</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  ddqtest[0]=y[-1]-2*y[-2]+y[-3];</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  ddqtest[1]=y[0]-2*y[-1]+y[-2];</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  ddqtest[2]=y[1]-2*y[0]+y[-1];</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  ddqtest[3]=y[2]-2*y[1]+y[0];</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  *smooth=0;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">// get biggest ddq</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  maxddq=0.0;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;=3;i++){</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">if</span>(fabs(ddqtest[i])&gt;maxddq){</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      maxddq=ddqtest[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      whichmax=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">// normalize ddq&#39;s</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;=3;i++){</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    ddqtest[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=ddqtest[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]/maxddq; <span class="comment">// Then 1.0 will be that ddq that is max</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="comment">// value of ddq should be same as largest ddq within some percent error</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  *smooth=1;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;=3;i++){</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordflow">if</span>(ddqtest[i]&lt;-0.1) *smooth=0;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordflow">if</span>(pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aacb3eec923047fe7ddf3eda070c600d9">U1</a>){</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="keywordflow">if</span>(!*smooth){</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;NOTSMOOTH\n&quot;</span>);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="keywordflow">for</span>(i=0;i&lt;=3;i++) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ddqtest[%d]=%g maxddq=%g whichmax=%d\n&quot;</span>,i,ddqtest[i],maxddq,whichmax);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="comment">//  if( (sign(ddqtest[0])==sign(ddqtest[1]) &amp;&amp; sign(ddqtest[1])==sign(ddqtest[2]) &amp;&amp; sign(ddqtest[2])==sign(ddqtest[3])){</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="comment">// always compute in case used later regardless of smoothness measurement</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  *facecont = (1./16.)*(9.*y[0]+9*y[-1]-y[-2]-y[1]);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="comment">//    *smooth=1;</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="comment">//}</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[0])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1]) &amp;&amp; <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2]) &amp;&amp; <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[3])){</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">if</span>(pl==2){</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;GOOD :: %g %g %g %g :: %d %d %d\n&quot;</span>,</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                  <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[0]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[3])</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                  ,<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[0])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[3])</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                  );</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  }</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span>(pl==2){</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;BAD::: %g %g %g %g :: %d %d %d\n&quot;</span>,</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                  <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[0]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[3])</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                  ,<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[0])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[1])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2]),<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[2])==<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddqtest[3])</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                  );</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  }</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;}</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="keywordtype">void</span> checkparamonotonicity(<span class="keywordtype">int</span> smooth, <span class="keywordtype">int</span> dqrange, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *ddq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lin, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lout, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rout)</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;{</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> a6COEF;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> qa,qb,qd,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a204451e8ec20e7512e65a0b10cd19797">qe</a>;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r,l;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordtype">int</span> numddq;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  l = *lin;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  r = *<a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="preprocessor">#if(PARAGENDQALLOWEXTREMUM)</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordflow">if</span>(smooth) qb=1;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// (dq[0]-dq[-1]) is defined as ddq[0]</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">//  ddqr=(dq[1]-dq[0]) is ddq[1]</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    qb=0.0;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    numddq=0;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">for</span>(i=-dqrange/2+1;i&lt;=dqrange/2;i++){</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      qb+=<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(ddq[i]);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      numddq++;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="comment">// check that ddq&#39;s all same sign</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordflow">if</span>(fabs(qb)&gt;(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)numddq-0.1) qb=1.0; <span class="comment">// 0.1 is just to avoid machine precision issue</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">else</span> qb=-1.0;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  }</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (smooth){</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    *lout=*lin;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    *rout=*<a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="comment">// now perform the limiting procedures that create the discontinuities</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="comment">// Condition 1: monotonicity for l,y[0],r. qa&gt;0 if monotonic</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  qa=(r-y[0])*(y[0]-l);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="comment">// modify Condition 1 as in Duez et al. (2005)</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="comment">// allow nonmonotonic behavior if the second derivative doesn&#39;t change sign around the center</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="comment">// GODMARK: actually should check 2 derivatives in each direction!  Then need PARAFLAT for extra values</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="comment">// CW: \delta a_j</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  qd=(r-l);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="preprocessor">#if(AVGINPUT)</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="preprocessor"></span>  <span class="comment">// CW: a_{6,j} in CW, which is for averages:</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  a6COEF=6.0;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  qe=a6COEF*(y[0]-0.5*(l+r));</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="preprocessor"></span>  <span class="comment">// for points need: see PARA_interpolation_checks.nb</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="comment">// parabola has solution y = l + (x-xl)*(qd + a6*(1-(x-xl))) with a6 = 4(y_0-1/2(l+r)) for points</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  a6COEF=4.0;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  qe=a6COEF*(y[0]-0.5*(l+r));</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="preprocessor">#if(PARAGENDQALLOWEXTREMUM)</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (qa &lt;=0.0 &amp;&amp; qb&lt;=0.0 )</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (qa &lt;=0.0)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="preprocessor"></span>      { <span class="comment">// Condition 1</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="preprocessor">#if(NONMONOLIM==0)</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="preprocessor"></span>        l=y[0];</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        r=y[0];</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="preprocessor">#elif(NONMONOLIM==1)</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="preprocessor"></span>        <span class="comment">// makes no sense to reduce all the way to DONOR since to second order can still have monotonic result, so use MONO result in this case and assume flatten result</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="comment">// appears to be too speculative as results in  more failures at horizon with PARA2LIM==MC</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        l = y[0] - 0.5* dq[0];</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        r = y[0] + 0.5* dq[0];</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(1){</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="comment">// Condition 2</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="comment">// qe can be positive or negative still here even though qa&gt;0</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="keywordflow">if</span>     (qd*(qd-qe)&lt;0.0)  l = (-(2.0+a6COEF)*r + 2.0*a6COEF*y[0])/(a6COEF-2.0);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(qd*(qd+qe)&lt;0.0)  r = (-(2.0+a6COEF)*l + 2.0*a6COEF*y[0])/(a6COEF-2.0);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="comment">// else no change needed</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <span class="comment">//    else{</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;Problem with limiting condition 2\n&quot;);</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <span class="comment">//    }</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <span class="comment">// Xiaoyue&#39;s verison:</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <span class="comment">//    if (qd*(qd-qe)&lt;0.0) l=3.0*y[0]-2.0*r;</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="comment">//    if (qd*(qd+qe)&lt;0.0) r=3.0*y[0]-2.0*l;</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="preprocessor">#if(PARAGENDQALLOWEXTREMUM)</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="preprocessor"></span>  <span class="comment">// recompute monotonicity to confirm didn&#39;t screw it up:</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  qa=(r-y[0])*(y[0]-l);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="comment">// qb is not changed!</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">if</span> (qa &lt;=0. &amp;&amp; qb&lt;=0.0 ) { <span class="comment">// Condition 1 again</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">// with Duez allowance of non-monotonic behavior, this gets triggered if l,r change -- otherwise wouldn&#39;t have been triggered</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    l=y[0];</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    r=y[0];</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  }</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="comment">// assign output</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  *lout=l;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  *rout=r;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;}</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div>
<div class="line"><a name="l01205"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#af36824cae5f3156fa6da09c3536c7785"> 1205</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/d30/interppoint_8para_8c.html#af36824cae5f3156fa6da09c3536c7785" title="used when lim=PARAFLAT">parapl</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> loc, <span class="keywordtype">int</span> realisinterp, <span class="keywordtype">int</span> dir, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **yrealpl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **ypl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *loutpl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *routpl)</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;{</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dq0[NPR2INTERP][8];</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq[NPR2INTERP];</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y,*yreal;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keywordtype">void</span> parasteep(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *l, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *r);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="keywordtype">void</span> paraflatten(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Fi, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *l, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *r);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../df/d30/interppoint_8para_8c.html#ac3af1cc044a6058812c512179cbb090a" title="Get pressure Note this is quite inefficient since operating per-point get same pressure for entire li...">getPressure</a>(<span class="keywordtype">int</span> whicheom, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> loc, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **yrealpl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P);</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> a_P[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ae0e74bb53eb81cca7ca1271ad395d563" title="how many sets of EOMs (MHD or MHD+RAD)">NUMTRUEEOMSETS</a>][10];</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ae0e74bb53eb81cca7ca1271ad395d563" title="how many sets of EOMs (MHD or MHD+RAD)">NUMTRUEEOMSETS</a>],*P[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ae0e74bb53eb81cca7ca1271ad395d563" title="how many sets of EOMs (MHD or MHD+RAD)">NUMTRUEEOMSETS</a>];</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  Ficalc(<span class="keywordtype">int</span> dir, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Fi[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ae0e74bb53eb81cca7ca1271ad395d563" title="how many sets of EOMs (MHD or MHD+RAD)">NUMTRUEEOMSETS</a>];</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="keywordtype">int</span> dqrange;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> a_ddq[7];</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *ddq;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordtype">int</span> mm;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="keywordtype">int</span> smooth;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordtype">int</span> whicheom;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="comment">// consistent with PARAFLAT using 7 points</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  dqrange = 5; <span class="comment">// dq&#39;s will exist from -2,-1,0,1,2 and ddq computed from -2,-1,0,1</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="comment">// shift P</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="keywordflow">for</span>(whicheom=0;whicheom&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ae0e74bb53eb81cca7ca1271ad395d563" title="how many sets of EOMs (MHD or MHD+RAD)">NUMTRUEEOMSETS</a>;whicheom++){</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    P[whicheom]=a_P[whicheom] + 4; <span class="comment">// P accessed from -3..3 ( shifted sufficiently)</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="comment">// shift dq</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    dq[pl]=dq0[pl]+4; <span class="comment">// shifted sufficiently</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  ddq=a_ddq+3; <span class="comment">// shifted sufficiently</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">// assume velocity is istelf</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">// KORALTODO: need Ficalc for radiation by itself!</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  V[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>] = yrealpl[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aacb3eec923047fe7ddf3eda070c600d9">U1</a>+dir-1];</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="preprocessor">#if(RADSHOCKFLAT&amp;&amp;EOMRADTYPE!=EOMRADNONE)</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="preprocessor"></span>  V[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af1a7c8e357fefc78efe71526c0630a61">EOMSETRAD</a>] = yrealpl[URAD1+dir-1];</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="comment">// get pressures for all points since needed for reduction or steepening</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="preprocessor">#if( DOPPMREDUCE || DOPPMCONTACTSTEEP)</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span>(whicheom=0;whicheom&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ae0e74bb53eb81cca7ca1271ad395d563" title="how many sets of EOMs (MHD or MHD+RAD)">NUMTRUEEOMSETS</a>;whicheom++){</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keywordflow">if</span>(whicheom==<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af1a7c8e357fefc78efe71526c0630a61">EOMSETRAD</a> &amp;&amp; <a class="code" href="../../d4/d96/global_8nondepmnemonics_8rad_8h.html#a9ae397a98225a4645e8e3d718889a232">RADSHOCKFLAT</a> || whicheom==<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>) <a class="code" href="../../df/d30/interppoint_8para_8c.html#ac3af1cc044a6058812c512179cbb090a" title="Get pressure Note this is quite inefficient since operating per-point get same pressure for entire li...">getPressure</a>(whicheom,i, j, k, loc, yrealpl, P[whicheom]);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">// computed only once for all variables</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="keywordflow">for</span>(whicheom=0;whicheom&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ae0e74bb53eb81cca7ca1271ad395d563" title="how many sets of EOMs (MHD or MHD+RAD)">NUMTRUEEOMSETS</a>;whicheom++){</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordflow">if</span>(whicheom==<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af1a7c8e357fefc78efe71526c0630a61">EOMSETRAD</a> &amp;&amp; <a class="code" href="../../d4/d96/global_8nondepmnemonics_8rad_8h.html#a9ae397a98225a4645e8e3d718889a232">RADSHOCKFLAT</a> || whicheom==<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>){</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="preprocessor">#if( DOPPMREDUCE )</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="preprocessor"></span>      Fi[whicheom] = Ficalc(dir,V[whicheom],P[whicheom]);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="preprocessor"></span>      Fi[whicheom] = 0.0;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  }</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="comment">// Loop over variables and get interpolated left/right values within cell</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aab6810240acb620a739b7d36b9ca24e3">PINTERPLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    y=ypl[pl];</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    yreal=yrealpl[pl];</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="comment">// get continuous solution    </span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    para4gen(realisinterp,dqrange,pl,y,&amp;loutpl[pl],&amp;routpl[pl],dq[pl],&amp;smooth);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="preprocessor">#if(DOPPMCONTACTSTEEP)</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a43791f6c1915cf7bfe3a02a4502510e4">RADFULLPL</a>(pl)&amp;&amp;<a class="code" href="../../d4/d96/global_8nondepmnemonics_8rad_8h.html#a9ae397a98225a4645e8e3d718889a232">RADSHOCKFLAT</a>) parasteep(dir,pl,V[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af1a7c8e357fefc78efe71526c0630a61">EOMSETRAD</a>],P[EOMSETRAD],ypl[pl],dq[pl],&amp;loutpl[pl],&amp;routpl[pl]);</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a43791f6c1915cf7bfe3a02a4502510e4">RADFULLPL</a>(pl)) parasteep(dir,pl,V[<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>],P[EOMSETMHD],ypl[pl],dq[pl],&amp;loutpl[pl],&amp;routpl[pl]);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="preprocessor">#if( DOPPMREDUCE )</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a43791f6c1915cf7bfe3a02a4502510e4">RADFULLPL</a>(pl)&amp;&amp;<a class="code" href="../../d4/d96/global_8nondepmnemonics_8rad_8h.html#a9ae397a98225a4645e8e3d718889a232">RADSHOCKFLAT</a>) paraflatten(dir,pl,ypl[pl],Fi[EOMSETRAD],&amp;loutpl[pl],&amp;routpl[pl]);</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a43791f6c1915cf7bfe3a02a4502510e4">RADFULLPL</a>(pl)) paraflatten(dir,pl,ypl[pl],Fi[EOMSETMHD],&amp;loutpl[pl],&amp;routpl[pl]);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="comment">// finally check monotonicity of the parabola and create discontinuities if non-monotonic</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="comment">// FLASH equations 51 -&gt; 53 for points or averages</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">for</span>(mm=-dqrange/2+1;mm&lt;=dqrange/2;mm++){</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      ddq[mm] = dq[pl][mm] - dq[pl][mm-1];</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    }</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    checkparamonotonicity(smooth, dqrange, pl, ypl[pl], ddq, dq[pl], &amp;loutpl[pl], &amp;routpl[pl], &amp;loutpl[pl], &amp;routpl[pl]);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="preprocessor">#if(NONMONOLIM&gt;0 &amp;&amp; DOPPMREDUCE)</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="preprocessor"></span>    <span class="comment">// then flatten again</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a43791f6c1915cf7bfe3a02a4502510e4">RADFULLPL</a>(pl)&amp;&amp;<a class="code" href="../../d4/d96/global_8nondepmnemonics_8rad_8h.html#a9ae397a98225a4645e8e3d718889a232">RADSHOCKFLAT</a>) paraflatten(dir,pl,ypl[pl],Fi[EOMSETRAD],&amp;loutpl[pl],&amp;routpl[pl]);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a43791f6c1915cf7bfe3a02a4502510e4">RADFULLPL</a>(pl)) paraflatten(dir,pl,ypl[pl],Fi[EOMSETMHD],&amp;loutpl[pl],&amp;routpl[pl]);</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  }</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;}</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="keywordtype">void</span> paraflatten(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Fi, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *l, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *r)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;{</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="comment">// FLASH Equation 49,50</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  *l = Fi * y[0] + ( 1.0 - Fi ) * (*l);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  *r = Fi * y[0] + ( 1.0 - Fi ) * (*r);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;}</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ftilde( <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> shift, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Vabs, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Pabs)</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;{</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ftilde,Ftilde1,Ftilde2;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sp;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>, *P;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> P2diff,Pbottom;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="comment">// shift as needed</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  P = Pabs + shift;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  V = Vabs + shift;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="comment">// FLASH Equation 43 (pressure jump)</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  P2diff=P[2]-P[-2];</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  Pbottom=<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(P2diff)/(fabs(P2diff)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>); <span class="comment">// singularity avoidance but keeps signature</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  Sp = (P[1] - P[-1]) * Pbottom ;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="comment">// FLASH Equation 45 (shock must have sufficient pressure jump)</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  Ftilde = <a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>( 0, <a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>( 1.0, 10.0 * (Sp - <a class="code" href="../../dc/d6c/para__and__paraenohybrid_8h.html#a5588ae260e9757e8666dfbcdc83cd175">SP0</a>) ) );</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <span class="comment">// FLASH Equation 46 (shock must have pressure jump)</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  Ftilde1 = fabs(P[1] - P[-1]) / (<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(fabs(P[1]), fabs(P[-1]))+ <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a> );</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  Ftilde *= ( (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(Ftilde1&gt;=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a987db2b5d50589e097378a13c5d87fef">THIRD</a>) );</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="comment">//  if(Ftilde1&lt;THIRD) Ftilde=0.0;</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="comment">// FLASH Equation 47 (shock must have convergence)</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  Ftilde2 = V[1] - V[-1];</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  Ftilde *= ( (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(Ftilde2&lt;=0.0) );</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="comment">//  if(Ftilde2&gt;0.0) Ftilde=0.0;</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Ftilde=%21.15g\n&quot;,Ftilde);</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  </div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordflow">return</span>( Ftilde );</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;}</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div>
<div class="line"><a name="l01371"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#a7062672ca1e90e610cbc25324d63ade6"> 1371</a></span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../df/d30/interppoint_8para_8c.html#a7062672ca1e90e610cbc25324d63ade6">divftilde</a>( <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> shift, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Vabs, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Pabs)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;{</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ftilde,Ftilde1,Ftilde2;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sv;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>, *P;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V2diff,Vbottom;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="comment">// shift as needed</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  P = Pabs + shift;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  V = Vabs + shift;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="comment">// (flow divergence)</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  Sv = fabs(V[1] - V[-1]) / ( fabs(V[1]) + fabs(V[-1]) + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a> );</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="comment">// (flow divergence must be sufficient)</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  Ftilde = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../dc/d6c/para__and__paraenohybrid_8h.html#a765db608a4b2d0b1ee5d0e038de7b656">SV0</a>,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(+1.0,Sv));</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  Ftilde2 = V[1] - V[-1];</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  Ftilde *= ( (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(Ftilde2&gt;=0.0) );</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  </div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keywordflow">return</span>( Ftilde );</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;}</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  Ficalc(<span class="keywordtype">int</span> dir, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P)</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;{</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ftilde( <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> shift, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="keywordtype">int</span> signdP;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Fi;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  signdP = (P[1] - P[-1] &gt; 0) * 2 - 1;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="comment">// FLASH Equation 48</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  Fi = <a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>( ftilde(dir, 0, V,P), ftilde(dir, -signdP, V,P) );</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">return</span>(Fi);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;}</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  Divcalc(<span class="keywordtype">int</span> dir, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Fi, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P)</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;{</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../df/d30/interppoint_8para_8c.html#a7062672ca1e90e610cbc25324d63ade6">divftilde</a>( <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> shift, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Vabs, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Pabs);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ftilde( <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> shift, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keywordtype">int</span> signdV;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Div;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  signdV = (V[1] - V[-1] &gt; 0) * 2 - 1;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  Div = <a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>( <a class="code" href="../../df/d30/interppoint_8para_8c.html#a7062672ca1e90e610cbc25324d63ade6">divftilde</a>(dir, 0, V,P), <a class="code" href="../../df/d30/interppoint_8para_8c.html#a7062672ca1e90e610cbc25324d63ade6">divftilde</a>(dir, -signdV, V,P) );</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="comment">// now put back actual scale</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  Div *= (V[1] - V[-1]);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">return</span>(Div);</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;}</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div>
<div class="line"><a name="l01433"></a><span class="lineno"><a class="code" href="../../df/d30/interppoint_8para_8c.html#ac3af1cc044a6058812c512179cbb090a"> 1433</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/d30/interppoint_8para_8c.html#ac3af1cc044a6058812c512179cbb090a" title="Get pressure Note this is quite inefficient since operating per-point get same pressure for entire li...">getPressure</a>(<span class="keywordtype">int</span> whicheom, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> loc, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **yrealpl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P)</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;{</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordtype">int</span> mm;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="preprocessor">#if(RADSHOCKFLAT&amp;&amp;EOMRADTYPE!=EOMRADNONE)</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> tautot[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],tautotmax;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomdontuse;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom=&amp;geomdontuse;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i,j,k,loc,ptrgeom);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> prreal[NPR];</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="keywordtype">int</span> pl;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// need pressure over full range from -3..3</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keywordflow">for</span>(mm=-<a class="code" href="../../d8/d5b/defs_8general_8h.html#adedce549d7ca97c62ec54f15549703eb">interporder</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5399643dd70f2026909e4c6b5eef50d6">PARAFLAT</a>]/2;mm&lt;=<a class="code" href="../../d8/d5b/defs_8general_8h.html#adedce549d7ca97c62ec54f15549703eb">interporder</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5399643dd70f2026909e4c6b5eef50d6">PARAFLAT</a>]/2;mm++){</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    P[mm] = 0.0;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordflow">if</span>(whicheom==<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>){</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      P[mm] += pressure_rho0_u_simple(i, j, k, loc, yrealpl[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>][mm],yrealpl[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>][mm]);</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    }</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="preprocessor">#if(RADSHOCKFLAT&amp;&amp;EOMRADTYPE!=EOMRADNONE)</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(whicheom==<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#af1a7c8e357fefc78efe71526c0630a61">EOMSETRAD</a> || whicheom==<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#adb456e768bc8848a978ac49b06194bbd">EOMSETMHD</a>){</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="comment">// add radiation pressure to total pressure if optically thick</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9a6208806fc4ab23123b02f9e89557dc" title="always goes over all conserved">PALLREALLOOP</a>(pl) prreal[pl]=yrealpl[pl][mm]; <span class="comment">// reorder</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <span class="comment">//      calcfull_tautot(prreal, ptrgeom, tautot, &amp;tautotmax);</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      <a class="code" href="../../df/d21/global_8funcdeclare_8rad_8h.html#a5943065ab3d5b4e9f4f691db499b588f" title="calculates total opacity over dx[]">calc_tautot</a>(prreal, ptrgeom, NULL, tautot, &amp;tautotmax); <span class="comment">// very accurate tautot not necessary, so use Tgas=Trad assumption in opacity</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      P[mm] += <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(tautotmax,1.0)*(4.0/3.0-1.0)*yrealpl[PRAD0][mm]; <span class="comment">// KORALNOTE: recall pressure just along diagonal and no velocity in R^\mu_\nu</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    }</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;}</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="keywordtype">void</span> parasteep(<span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *l, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *r)</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;{</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  <span class="keywordtype">int</span> odir1,odir2;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keywordtype">void</span> parasteepgen(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> etai, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *l, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *r);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> etaicalc(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P);</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> etai;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="preprocessor">#if(DOPPMSTEEPVARTYPE==0)</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>)</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="preprocessor">#elif(DOPPMSTEEPVARTYPE==1)</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="preprocessor"></span>    <span class="comment">// define orthogonal directions for field steepening</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    odir1=dir%3+1;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  odir2=(dir+1)%3+1;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="keywordflow">if</span>(pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a> || pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>+odir1-1 || pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>+odir2-1)</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="comment">// get contact indicator</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      etai=etaicalc(pl,y,V,P);</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <span class="comment">// get steepend values</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      parasteepgen(pl, etai, V, P, y, dq, l, r);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    }</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;}</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="keywordtype">void</span> parasteepgen(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> etai, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *l, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *r)</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;{</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="keywordtype">void</span> pr_contact_compute(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prld, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prrd);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> prld, prrd;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> l0,<a class="code" href="../../d9/de9/coord_8c.html#a54081391e09395407d47aec84f3d97c9">r0</a>;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> lmc,rmc;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> mceta;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="comment">// compute anti-disspiative left,right values</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  pr_contact_compute(pl,y,dq,&amp;prld,&amp;prrd);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">// switch to MC for original l,r states if steepening      </span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  mceta=4.0*<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>( 0.25 - etai,0.0 );</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  lmc = y[0] - 0.5*dq[0];</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  rmc = y[0] + 0.5*dq[0];</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  l0 = (*l) * mceta  + lmc*(1.0-mceta);</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  r0 = (*r) * mceta  + rmc*(1.0-mceta);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  </div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="comment">// assign steepened density value</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  *l = l0 * ( 1.0 - etai ) + prld*etai;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  *r = r0 * ( 1.0 - etai ) + prrd*etai;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <span class="comment">// else make no changes to l,r   </span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  </div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;}</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="keywordtype">void</span> pr_contact_compute(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prld, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prrd)</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;{</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <span class="comment">// equation 33 and 34 in FLASH</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  *prld=y[-1]+0.5*dq[-1];</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  *prrd=y[+1]-0.5*dq[+1];</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;}</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> etaicalc(<span class="keywordtype">int</span> pl, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *y, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *P)</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;{</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> delta2l,delta2r;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> etatilde;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> etai;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ddcoef;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordtype">int</span> ii;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Pjump,dB,Bmean;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> prjumpfactor;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ifinf;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> cs2;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="keywordtype">int</span> mm;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <span class="keywordtype">int</span> mmstart,mmend;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> max3P,min3P,min3y;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="comment">// y is accessed from y[-2..2]</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="comment">// P,dq is accessed via dq[-1,0,1]</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="preprocessor">#if(AVGINPUT)</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="preprocessor"></span>  ddcoef=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afd003d597d6fa5e7e56f35ad70716925">SIXTH</a>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="preprocessor"></span>  ddcoef=1.0/8.0;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="comment">// equation 35 in FLASH</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  ii=-1;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  delta2l=ddcoef*( (y[ii+1]-y[ii]) - (y[ii] - y[ii-1]) );</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="comment">// equation 35 in FLASH</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  ii=1;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  delta2r=ddcoef*( (y[ii+1]-y[ii]) - (y[ii] - y[ii-1]) );</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="comment">// equation 36 in FLASH</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="comment">// sign of denominator is important</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="comment">// we multiply by conditionall that is 0 or 1</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <span class="keywordflow">if</span>(fabs(y[1]-y[-1])&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>){</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    etatilde=(-(delta2r-delta2l)/(y[1]-y[-1]));</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  }</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="keywordflow">else</span> etatilde=0.0;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="comment">// below can lead to asymmetries</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <span class="comment">//ifinf = ((FTYPE)(fabs(y[1]-y[-1])&lt;0.5*SMALL)); // inf avoidance</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="comment">//etatilde=(-(delta2r-delta2l)/(y[1]-y[-1] + ifinf*SMALL));</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="comment">// Pressure jump</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  max3P=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  min3P=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a38eb76aa0a9a1bb1dac30c75be4a05b6">BIG</a>;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  min3y=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a38eb76aa0a9a1bb1dac30c75be4a05b6">BIG</a>;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="comment">//  for(mm=-2;mm&lt;=2;mm++){</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="comment">// upwinded extension of check</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="comment">//  if(V[0]&gt;0.0){ mmstart=-2; mmend=1; }</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="comment">//  else if(V[0]&lt;0.0) {  mmstart=-1; mmend=2; }</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="comment">//  else {  mmstart=-1; mmend=1; }</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  mmstart=-1; mmend=1;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <span class="keywordflow">for</span>(mm=mmstart;mm&lt;=mmend;mm++){</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">if</span>(mm==0) <span class="keywordflow">continue</span>; <span class="comment">// when wanting original method</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    max3P=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(max3P,fabs(P[mm]));</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    min3P=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(min3P,fabs(P[mm]));</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    min3y=<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(min3y,fabs(y[mm]));</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  }</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  min3P+=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  <span class="comment">//  min3y=min(min(fabs(y[-1]),fabs(y[1])),fabs(y[0]));</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  <span class="comment">//Pjump=fabs(P[1]-P[-1])/(min(fabs(P[1]),fabs(P[-1]))+SMALL);</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="comment">// need more strict and extensive pressure jump check</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  Pjump=fabs(max3P - min3P)/min3P;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160; </div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="comment">// consistently use energy density like term</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="keywordflow">if</span>(pl&gt;=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a> &amp;&amp; pl&lt;=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>){</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    dB = y[1]-y[-1];</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    Bmean = 0.5*(y[-1] + y[1]); <span class="comment">// mean field</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="comment">//    prp1sq=0.5*y[1]*y[1]*sign(y[1]); // magnetic pressure</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="comment">//    prm1sq=0.5*y[-1]*y[-1]*sign(y[-1]);</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    prjumpfactor=fabs(dB)/(fabs(Bmean)+fabs(dB)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;dB=%21.15g Bmean=%21.15g prjumpfactor=%21.15g\n&quot;,dB,Bmean,prjumpfactor);</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    prjumpfactor=fabs(y[1]-y[-1])/min3y;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="comment">// check effective c_s given Pressure leaks into steepened density region</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="comment">// ensure contributes negligibly to dynamics</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="comment">//    cs2 = max3P/min3y;</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="comment">// want cs2 dt^2/dx^2 &lt;&lt; 1 to avoid steepening leading to velocity comparable to whatever Courant condition is limited by</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="comment">// relativistic check</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="comment">// don&#39;t change energy per baryon by much</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="comment">// if pressure is relatively flat</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <span class="comment">//    cs2m1check = (cs2 &lt; 5.0 * fabs(P[-1])/fabs(y[-1]));</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="comment">//    cs20check = (cs2 &lt; 5.0 * fabs(P[0])/fabs(y[0]));</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="comment">//    cs2p1check = (cs2 &lt; 5.0 * fabs(P[1])/fabs(y[1]));</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  <span class="comment">// equation 39 in FLASH (not a shock)</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  <span class="comment">//  if( Pjump &gt; 0.1*prjumpfactor) etatilde=0.0;</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  etatilde *= (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)( Pjump &lt;= 0.1*prjumpfactor);</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="comment">// equation 37 in FLASH (to avoid triggering on numerical noise)</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  <span class="comment">//  if(prjumpfactor&lt;0.01) etatilde=0.0;</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  etatilde *=  (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(prjumpfactor&gt;=0.01);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="comment">//  etatilde *=  (FTYPE)(prjumpfactor&gt;=0.1);</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="comment">// equation 38 in FLASH (really a contact)</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="comment">//if(delta2l*delta2r&gt;0.0) etatilde=0.0;</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  etatilde *=  (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(delta2l*delta2r&lt;=0.0);</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="comment">// equation 40 in FLASH</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  etai=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(0.0,<a class="code" href="../../dc/dc2/f2c_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(20.0*(etatilde-0.05),1.0));</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  <span class="keywordflow">return</span>(etai);</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;}</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:34 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
