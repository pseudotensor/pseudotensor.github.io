<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: init.tools.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">init.tools.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/d15/init_8tools_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;decs.h&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">extern</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d60/init_8c.html#ae15d3674b53c9a0694b9d9fada53882a">normglobal</a>;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d60/init_8c.html#af368410e101431cce1434ff7d03e71c2">inittypeglobal</a>; <span class="comment">// for bounds to communicate detail of what doing</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d60/init_8c.html#a74ea4028cbfdf95bd0fef05776ea65e2">init_dsandvels</a>(<span class="keywordtype">int</span> inittype, <span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> *whichvel, <span class="keywordtype">int</span> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ab29c7802084b56a574b83eb818d2fdda">whichcoord</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> time, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <span class="keywordtype">int</span> k, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pstag);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#ab098f74777b7eb79e2c39c9ccb33aef4">   17</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#ab098f74777b7eb79e2c39c9ccb33aef4">setRin_withchecks</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;{</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>,rminus;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  Rhor=rhor_calc(0);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  *rin=<a class="code" href="../../d9/de9/coord_8c.html#ae0931a086386bdc85e72a8601fffd0d2" title="there&#39;s probably a way to do this in general probably can root find to get this set Rin so horizon ex...">setRin</a>(<a class="code" href="../../d9/de9/coord_8c.html#a2f39db7b2d9cb7ea17ff2813438bd32c" title="set i(horizon)">setihor</a>());</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="comment">//  (*rin) = 0.98 * Rhor;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  trifprintf(<span class="stringliteral">&quot;R0=%21.15g Rhor=%21.15g Rin=%21.15g Rout=%21.15g ihor=%d MBH=%g\n&quot;</span>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa4c9c8191d78fb683d1b8947f026afcb">R0</a>,Rhor,(*rin),<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2b3e48ba92bae56a9925460125e78367">Rout</a>,<a class="code" href="../../d9/de9/coord_8c.html#a2f39db7b2d9cb7ea17ff2813438bd32c" title="set i(horizon)">setihor</a>(),<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordflow">if</span>((*rin)&lt;<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa4c9c8191d78fb683d1b8947f026afcb">R0</a>){</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Wrong Rin calculation\n&quot;</span>);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    myexit(34968346);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">if</span>((*rin)&lt;0.0){</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Very Poor Rin&lt;0 calculation\n&quot;</span>);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    myexit(34968347);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  rminus=rhor_calc(1);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span>((*rin)&lt;rminus){</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Rin&lt;r_- : Poor Rin calculation: %g %g\n&quot;</span>,*rin,rminus);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    myexit(34968348);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">if</span>((*rin)&gt;Rhor){</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Rin&gt;r_+ : Poor Rin calculation: %g %g\n&quot;</span>,*rin,Rhor);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    myexit(34968349);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">// some very common, but not completely general, user-type functions for init.c</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a5eee58cad761c614d45fee966671016f">   53</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a5eee58cad761c614d45fee966671016f">user1_prepre_init_specific_init</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// choice// GODMARK: not convenient location, but needed for init_mpi()</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#ab6ed54cec8c2547f4280b86f34426cb5" title="for only grmhd code">periodicx1</a>=0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#a504b3e0d6a16870176bb4555e95642c7">periodicx2</a>=0;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#if(N3!=1)</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../dd/d46/mpidefs_8h.html#a5e966c43d71ea8ef3cd3fb6e5e4c00d8">periodicx3</a>=1;<span class="comment">// GODMARK: periodic in \phi for 3D spherical polar</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../dd/d46/mpidefs_8h.html#a5e966c43d71ea8ef3cd3fb6e5e4c00d8">periodicx3</a>=0;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>){</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// assume if production always want binary data with text header</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a04767aafce2d594a681b4d39134050c8">binaryoutput</a>=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aeda769b56bd2fdb9ee4b9db524f753b5">MIXEDOUTPUT</a>; <span class="comment">// choice: mixed or binary</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keywordtype">int</span> user1_init_conservatives(<span class="keywordtype">int</span> *fieldfrompotential, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Utemp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*U)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR])</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) trifprintf(&quot;fieldfrompotential[%d]=%d\n&quot;,pl-<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>+1,fieldfrompotential[pl-B1+1]);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  trifprintf(&quot;begin <a class="code" href="../../d8/d60/init_8c.html#aa713da528acf03316bf98c126912e3ee">init_conservatives</a>\n&quot;);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  pi2Uavg(fieldfrompotential, prim, pstag, Utemp, U);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  trifprintf(&quot;end <a class="code" href="../../d8/d60/init_8c.html#aa713da528acf03316bf98c126912e3ee">init_conservatives</a>\n&quot;);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  return(0);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a89494c256d771673c25721f6cf08b002">   95</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a89494c256d771673c25721f6cf08b002">user1_post_init_specific_init</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;{</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// globally used parameters set by specific initial condition routines, reran for restart as well *after* all other calculations</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a538f4ebe3434f76ec67690f0651b53e7">UTOPRIMVERSION</a> = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#abeac8c89d7fa922563d79f9278b4d44d" title="8: Jon 1D/2D final version – can handle non-rel problems">UTOPRIMJONNONRELCOMPAT</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">//  UTOPRIMVERSION =   UTOPRIM5D1;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">//    UTOPRIMVERSION =   UTOPRIM2DFINAL;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a60a56d597a9ac5107d281c13e35e03f1">  108</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a60a56d597a9ac5107d281c13e35e03f1">user1_init_global</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;{</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a813cffebecba4a98b088087f80250ba0">DODIAGEVERYSUBSTEP</a> = 0;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a73deb5caf870e00d9b50f194357000dd">SAFE</a>=1.3;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">//  cour = 0.9;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">//  cour=0.8;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#ab95415a19b94c9c8b05a1a1d1be4ce40">cour</a> = 0.4999;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// NOTEMARK on cour</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// Changed to cour=0.5 because noticed that with STOREWAVESPEEDS==1 that extremely unstable with 0.8 near pole due to larger or smaller wave speeds from max-averaging from CENT to FACE1/2/3.  While may be inconsistency in Riemann solution, LAXF is simply a diffusive solution so shouldn&#39;t be so dependent upon exact wave speed.  Noticed that with one setup where instability appeared (large radii 512x32 type run) that forcing timestep to be like STOREWAVESPEEDS==0 led to much more stable solution, but still kinda unstable to a saturation point.  That was with cour=0.83*0.8=664.  For safety, use cour=0.4999.  In any case, this is motivated by fact that only with cour&lt;0.5 will Riemann waves from interface not intersect by a single timestep, and only with non-intersecting waves does Riemann solution make sense.  So cour&gt;0.5 is really too aggressive.  Still keep multi-dimen effective courant reducer since that&#39;s there for different reasons of multi-dimen stability issues.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// NOTEMARK on cour</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// For standard non-tilted torus model at a=0.9375 in fully 3D with 64x64x8 resolution.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// As of 07/26/2012, I have found cour=0.4999 leads to ~40k &quot;entropy and bad&quot; or &quot;Failed to find&quot; SOFT errors and no hard failures (i.e. &quot;cold and bad&quot;).  But, cour=0.8 leads to only 21K non-hard failures but gets 1 or 2 hard failures.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// So overall cour=0.4999 more trustable to evolve velocity, but more frequently fails to evolve densities.</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// Also  while a single Riemann fan won&#39;t go reach into another cell with cour&gt;0.5 &amp;&amp; cour&lt;1.0, the Riemann fans from each cells collide for anything using cour&gt;=0.5.  And so in that case the average state isn&#39;t at all like what the Riemann solver predicts.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// ENO-RELATED STUFF</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"></span>  </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a618d1d6042e7d435e9439a0bbd7a9048">INVERTFROMAVERAGEIFFAILED</a> = 1;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0d5e1b767182dfc4e2a3f89a9173d1ef">LIMIT_AC_PRIM_FRAC_CHANGE</a> = 1;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a43991f234455e5f1169b75f14dede420">MAX_AC_PRIM_FRAC_CHANGE</a> = 0.1;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#aeba423594eef8c67de9f06010b7fed5e">LIMIT_AC_FRAC_CHANGE</a>=0; <span class="comment">// CHANGINGMARK: avoiding complication for now</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">// have to make consistent with weno-minimization for fluxes</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#aecc5caf8e100de1cd41a733def1f83fb">MAX_AC_FRAC_CHANGE</a>=0.2;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// need MAXBND==17 if not evolving point field and doing full WENO5BND</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">// test1103 N1=8 is smallest tried and new simple_ limiting works at 10% very well</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="comment">//dofluxreconevolvepointfield=0;</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// only need MAXBND==11 like normal higher-order method (like FV method)</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#ad5c8369abdf1833b4afc10d11d52b537">dofluxreconevolvepointfield</a>=1;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a71b7c970651a395e2500645e74862abc">DOEVOLVERHO</a>){</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">//avgscheme[1]=avgscheme[2]=avgscheme[3]=WENO5BND;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">//  lim[1] = lim[2] = lim[3] = WENO5BND;</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[1] = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[2] = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[3] = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a888099cf1c2f69f87cbd878ce5983af2">PARALINE</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#acb6f71700ed482e84b69ee6bec92c303">avgscheme</a>[1]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#acb6f71700ed482e84b69ee6bec92c303">avgscheme</a>[2]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#acb6f71700ed482e84b69ee6bec92c303">avgscheme</a>[3]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aecdd356ed1a28e3325b6608f353cdc8f" title="ordered from most diffusive to least diffusive, so can start high and go down if needed 0 should be r...">DONOR</a>; <span class="comment">// CHANGINGMARK</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">//lim[1] = lim[2] = lim[3] = MC; // CHANGINGMARK</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a55732148d2616d6d1f5d2abbe8710850">DOENOFLUX</a> = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#adacaaf8526353cfe870206f0cf4d2ca7" title="for DOENOFLUX: 0: no ENO flux reconstruction 1: reconstruct F for finite difference rep...">NOENOFLUX</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">//DOENOFLUX = ENOFLUXRECON; // CHANGINGMARK</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">//DOENOFLUX = ENOFINITEVOLUME;</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a55732148d2616d6d1f5d2abbe8710850">DOENOFLUX</a> == <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a81c6be7c38a1e29b40efa57ca47d0d02">ENOFLUXRECON</a>){</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="comment">// below applies to all fluxes</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a13fd1bc27b6fdc0978d4cbc7cd9bdaec">do_transverse_flux_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a13fd1bc27b6fdc0978d4cbc7cd9bdaec">do_transverse_flux_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="comment">// below used for re-averaging of field in advance.c for dBhat/dt method</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a42a3e0ccdd6805791cf169d439d305d6">do_conserved_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a42a3e0ccdd6805791cf169d439d305d6">do_conserved_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a55732148d2616d6d1f5d2abbe8710850">DOENOFLUX</a> == <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac634a307561f486f9df8ba8a67c21c19">ENOFINITEVOLUME</a>){</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a13fd1bc27b6fdc0978d4cbc7cd9bdaec">do_transverse_flux_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a13fd1bc27b6fdc0978d4cbc7cd9bdaec">do_transverse_flux_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a619bd249bee29e34eb58716b9b88dc8a">do_source_integration</a>[pl] = 0;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a619bd249bee29e34eb58716b9b88dc8a">do_source_integration</a>[pl] = 0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a42a3e0ccdd6805791cf169d439d305d6">do_conserved_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a42a3e0ccdd6805791cf169d439d305d6">do_conserved_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="comment">//    do_conserved_integration[B1-1+DIRZ] = 1;</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a11c4e99e1493d0c1914ad1ab313ea472">FLUXB</a> = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0b6762cef74e396f50a83864bb53fb6c">FLUXCTSTAG</a>;  <span class="comment">// CHANGINGMARK</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">//  FLUXB = FLUXCTHLL;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">//FLUXB = FLUXCTTOTH;</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">//  TIMEORDER=2;</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae202d8b69a0ef3f07651368c3de9ca25">TIMEORDER</a>=4;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">//  TIMEORDER=3;</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a10228b0cb639e1d94eded72900312334">TIMETYPE</a>=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a56de233d8b42babd780f075b155863fa">TIMEEXPLICIT</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">// PALLLOOP(pl) fluxmethod[pl]= HLLFLUX;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a6b32259475937e434b03862c64fb86a3">fluxmethod</a>[pl]= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa677868bf00f1ed7013d1e3992d15236" title="mnemonics for flux method (Riemann solver) ordered from most diffusive to least diffusive, so can back track 0 should be reasonable most diffusive">LAXFFLUX</a>; <span class="comment">// generally more robust than HLLFLUX for various reasons</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">//  UTOPRIMVERSION=UTOPRIM5D1;</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a538f4ebe3434f76ec67690f0651b53e7">UTOPRIMVERSION</a> = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#abeac8c89d7fa922563d79f9278b4d44d" title="8: Jon 1D/2D final version – can handle non-rel problems">UTOPRIMJONNONRELCOMPAT</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">//  UTOPRIMVERSION = UTOPRIM1DFINAL;</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a87e5572748e4cc27373e50bd78e6f2e8">EOMTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6f6094bc467dc61f9490ad7e1de63580">EOMFFDE</a>||<a class="code" href="../../da/d3e/definit_8h.html#a87e5572748e4cc27373e50bd78e6f2e8">EOMTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a30a753538ac3bf4801ac123a37dfcc57">EOMFFDE2</a>){</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// PARA and TO=4 and HLL not trustable in FFDE so far</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[1] =<a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[2]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a817404fd8a61abc2300c378e1eb2d122">lim</a>[3]= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a71d9e511e7e302cd831e83581219e70d">MC</a>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae202d8b69a0ef3f07651368c3de9ca25">TIMEORDER</a>=2;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a10228b0cb639e1d94eded72900312334">TIMETYPE</a>=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a56de233d8b42babd780f075b155863fa">TIMEEXPLICIT</a>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// below applies to all fluxes</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a13fd1bc27b6fdc0978d4cbc7cd9bdaec">do_transverse_flux_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a13fd1bc27b6fdc0978d4cbc7cd9bdaec">do_transverse_flux_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// below used for re-averaging of field in advance.c for dBhat/dt method</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a42a3e0ccdd6805791cf169d439d305d6">do_conserved_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a42a3e0ccdd6805791cf169d439d305d6">do_conserved_integration</a>[pl] = 1;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a6b32259475937e434b03862c64fb86a3">fluxmethod</a>[pl]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa677868bf00f1ed7013d1e3992d15236" title="mnemonics for flux method (Riemann solver) ordered from most diffusive to least diffusive, so can back track 0 should be reasonable most diffusive">LAXFFLUX</a>; <span class="comment">// generally more robust than HLLFLUX</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">//    FLUXB = FLUXCTTOTH;</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a11c4e99e1493d0c1914ad1ab313ea472">FLUXB</a> = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0b6762cef74e396f50a83864bb53fb6c">FLUXCTSTAG</a>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">//    UTOPRIMVERSION=UTOPRIM2DFINAL;</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a538f4ebe3434f76ec67690f0651b53e7">UTOPRIMVERSION</a> = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#abeac8c89d7fa922563d79f9278b4d44d" title="8: Jon 1D/2D final version – can handle non-rel problems">UTOPRIMJONNONRELCOMPAT</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// whether/which ENO used to interpolate fluxes</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">//    DOENOFLUX = ENOFINITEVOLUME;</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a55732148d2616d6d1f5d2abbe8710850">DOENOFLUX</a>= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#adacaaf8526353cfe870206f0cf4d2ca7" title="for DOENOFLUX: 0: no ENO flux reconstruction 1: reconstruct F for finite difference rep...">NOENOFLUX</a>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">//DOENOFLUX=ENOFLUXRECON;</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  ranc(1,0); <span class="comment">// no MPI method yet, so just pure randomization</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">/* some physics parameters */</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a5db33bd66a02c92d495409fd6d6c7459" title="GLOBAL PARAMETERS SECTION.">gam</a> = 4. / 3.;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a5a991b7bb31c346421e7caea2bfb239a">cooling</a>=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e514517da1689d80685be5708f92604" title="Choices for cooling function.">NOCOOLING</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>]=<a class="code" href="../../da/d3e/definit_8h.html#a537ea156403ef6d3c02745333ecc50d8">OUTFLOW</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>]=<a class="code" href="../../da/d3e/definit_8h.html#ae81381343e0c525e13866d873d9deb52">POLARAXIS</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>]=<a class="code" href="../../da/d3e/definit_8h.html#ae81381343e0c525e13866d873d9deb52">POLARAXIS</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>]=<a class="code" href="../../da/d3e/definit_8h.html#af36821ad7b93ab31dcfaaa25e134fdf0">PERIODIC</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>]=<a class="code" href="../../da/d3e/definit_8h.html#af36821ad7b93ab31dcfaaa25e134fdf0">PERIODIC</a>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>]=<a class="code" href="../../da/d3e/definit_8h.html#a537ea156403ef6d3c02745333ecc50d8">OUTFLOW</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">//  rescaletype=1;</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  rescaletype=4;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0fe8d3c7642e667dd8ae3635506c4273">BSQORHOLIMIT</a>=1E2; <span class="comment">// was 1E2 but latest BC test had 1E3 // CHANGINGMARK</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2ac5e41aa897e1fa82d748b7e38b9c6a">BSQOULIMIT</a>=1E3; <span class="comment">// was 1E3 but latest BC test had 1E4</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a29e0b9f4e26a839ec5b98c698e90ca17">UORHOLIMIT</a>=1E3;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a> = 1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-4;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a5f145b29adcf588cf7f2821cb5c9302f">UUMIN</a> = 1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-6;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a51ef12e4cafc4a8fe70374c37f57d565">GAMMAMAXRAD</a>=10000.0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a5bd9da451f108352614cbc457524c5b0">ERADLIMIT</a>=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a13f615d7832e3abc6abd54325112daf3">UUMINLIMIT</a>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">// below floor model is only used if rescaletype!=4</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>]==<a class="code" href="../../da/d3e/definit_8h.html#a16777f88a9e111cec44faacfcdac776b">FIXEDOUTFLOW</a>){ <span class="comment">// then doing bondi inflow</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// avoids constant floor activation -- trying to be more physical</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7b1907984bc130eb01fe29d3fc3c064b">prfloorcoef</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a>/100.0;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7b1907984bc130eb01fe29d3fc3c064b">prfloorcoef</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a5f145b29adcf588cf7f2821cb5c9302f">UUMIN</a>/100.0;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7b1907984bc130eb01fe29d3fc3c064b">prfloorcoef</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7b1907984bc130eb01fe29d3fc3c064b">prfloorcoef</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a5f145b29adcf588cf7f2821cb5c9302f">UUMIN</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a516ad1adc872921939df143a56a721af">BCtype</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>]=<a class="code" href="../../da/d3e/definit_8h.html#a537ea156403ef6d3c02745333ecc50d8">OUTFLOW</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">//  rescaletype=1;</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  rescaletype=4;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0fe8d3c7642e667dd8ae3635506c4273">BSQORHOLIMIT</a>=1E2; <span class="comment">// was 1E2 but latest BC test had 1E3 // CHANGINGMARK</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2ac5e41aa897e1fa82d748b7e38b9c6a">BSQOULIMIT</a>=1E3; <span class="comment">// was 1E3 but latest BC test had 1E4</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a29e0b9f4e26a839ec5b98c698e90ca17">UORHOLIMIT</a>=1E3;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a> = 1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-4;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a5f145b29adcf588cf7f2821cb5c9302f">UUMIN</a> = 1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-6;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">/* dumping frequency, in units of M */</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">int</span> idt;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">for</span>(idt=0;idt&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a199215088aa5278950fcc865a67e7019" title="these dump types also control period of output Period can be controlled for non-spatial dumps such as...">NUMDUMPTYPES</a>;idt++) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2edf04580f3ba6725fface8987e5f533">DTdumpgen</a>[idt]=50.0;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">// ener period</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2edf04580f3ba6725fface8987e5f533">DTdumpgen</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa5ccd621a6172085ece31d82bcc8b137">ENERDUMPTYPE</a>] = 2.0;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">/* image file frequ., in units of M */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2edf04580f3ba6725fface8987e5f533">DTdumpgen</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5ac2ad23e08b25711595c0fb5c947b32">IMAGEDUMPTYPE</a>] = 2.0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// fieldline locked to images so can overlay</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2edf04580f3ba6725fface8987e5f533">DTdumpgen</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a97ea019f07cba4150c05e16963cc19fc">FIELDLINEDUMPTYPE</a>] = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2edf04580f3ba6725fface8987e5f533">DTdumpgen</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5ac2ad23e08b25711595c0fb5c947b32">IMAGEDUMPTYPE</a>];</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">/* debug file */</span>  </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a2edf04580f3ba6725fface8987e5f533">DTdumpgen</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2c12cae74d126a1b19949c92a7973223">DEBUGDUMPTYPE</a>] = 50.0;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// DTr = .1 ; /* restart file frequ., in units of M */</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">/* restart file period in steps */</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a6650077e624189283a8fc864f948d3b5">DTr</a> = 3000;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#ab1151b6a19a26b4041e46379df81be9e">DTfake</a>=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(1,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a6650077e624189283a8fc864f948d3b5">DTr</a>/10);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a19a363a93267c97a3d521293fc39d942">tf</a>=2E3; <span class="comment">// very problem dependent, should override</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">// assumes normalized density</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="keywordtype">int</span> user1_init_atmosphere(<span class="keywordtype">int</span> *whichvel, <span class="keywordtype">int</span>*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ab29c7802084b56a574b83eb818d2fdda">whichcoord</a>,<span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <span class="keywordtype">int</span> k, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#ae7ab77d7e616dc02fba121a009b48c27">pr</a>)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;{</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> realgeomdontuse;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrrealgeom=&amp;realgeomdontuse;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> pratm[NPR];</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, ptrrealgeom); <span class="comment">// true coordinate system</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  set_atmosphere(-1,<a class="code" href="../../da/d3e/definit_8h.html#a3d14480f30d39eff4e51ae8bc93df56f" title="whether we use ultimately precise inversion or &quot;workable&quot; inversion precision (see utoprim&#39;s for ho...">WHICHVEL</a>,ptrrealgeom,pratm); <span class="comment">// set velocity in chosen WHICHVEL frame in any coordinate system</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span>(pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>]&lt;pratm[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>]){</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) pr[pl]=pratm[pl];</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  *whichvel=<a class="code" href="../../da/d3e/definit_8h.html#a3d14480f30d39eff4e51ae8bc93df56f" title="whether we use ultimately precise inversion or &quot;workable&quot; inversion precision (see utoprim&#39;s for ho...">WHICHVEL</a>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  *whichcoord=<a class="code" href="../../d2/dbf/metric_8h.html#a401668353c0216165cf6f1c7b2d34e94">PRIMECOORDS</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  return(0);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a77551ab2581efdbaf170dfca073ff9ab">  332</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a77551ab2581efdbaf170dfca073ff9ab">user1_init_primitives</a>(<span class="keywordtype">int</span> inittype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ucons)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*vpot)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Bhat)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*panalytic)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstaganalytic)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*vpotanalytic)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+SHIFTSTORE3], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Bhatanalytic)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR],</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                          <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*F1)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac14b9db972c66ce6df62cb4d4faa6ded">NSPECIAL</a>],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*F2)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR+NSPECIAL],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*F3)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR+NSPECIAL], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Atemp)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+SHIFTSTORE3])</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordtype">int</span> whichvel, <a class="code" href="../../dc/dd2/newcodediff_8txt.html#ab29c7802084b56a574b83eb818d2fdda">whichcoord</a>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordtype">int</span> initreturn;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordtype">int</span> i = 0, j = 0, k = 0, l;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r,th,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d8/d60/init_8c.html#a91bb22ba17c7bb75ad2d8d9fa0594549">normalize_densities</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR]);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d8/d60/init_8c.html#a5622ff1892053efcbc8cb4f0d3b179f7">normalize_field</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ucons)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*vpot)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+SHIFTSTORE3], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Bhat)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR]);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordtype">int</span> init_atmosphere(<span class="keywordtype">int</span> *whichvel, <span class="keywordtype">int</span> *whichcoord, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pr);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// Assign primitive variables</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"></span>  trifprintf(<span class="stringliteral">&quot;Assign primitives\n&quot;</span>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// assume we start in bl coords and convert to KSprim</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">// so field defined when get to floor model (fixup)</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  init_3dnpr_fullloop(0.0,prim);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">// assume we start in bl coords and convert to KSprim</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"></span><span class="preprocessor">#pragma omp parallel private(i,j,k,initreturn,whichvel,whichcoord) OPENMPGLOBALPRIVATEFULL</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a7518365209531b952c067f47c80777c2" title="COMPFULLLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPFULL</a>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize))</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="preprocessor"></span>    <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      initreturn=<a class="code" href="../../d8/d60/init_8c.html#a74ea4028cbfdf95bd0fef05776ea65e2">init_dsandvels</a>(inittype, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, &amp;whichvel, &amp;whichcoord,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,i,j,k,<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k),<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(pstag,i,j,k)); <span class="comment">// request densities for all computational centers // t is ok here for initialization</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordflow">if</span>(initreturn&gt;0){</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init_primitives()&quot;</span>, <span class="stringliteral">&quot;init_dsandvels()&quot;</span>, 1);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">else</span> <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a0163a499c88dd8b07688e3dbd7007f0e">MYFUN</a>(<a class="code" href="../../de/df8/initbase_8c.html#a7665bb79a8aea27c4ea4d7e58fd83c19" title="used to transform from one coordinate system to PRIMECOORDS when acting on pstag, only relevant for m...">transform_primitive_vB</a>(whichvel, whichcoord, i,j,k, prim, pstag),<span class="stringliteral">&quot;init.c:init_primitives&quot;</span>,<span class="stringliteral">&quot;transform_primitive_vB()&quot;</span>,0);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="comment">// force dummy entropy variable to be same as ug so restart file consistent -- even if not used by the code.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">if</span>(ENTROPY&gt;=0){</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,ENTROPY)=<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  }<span class="comment">// end parallel region</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// assign rough pstag value in case not using vector potential</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a11c4e99e1493d0c1914ad1ab313ea472">FLUXB</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0b6762cef74e396f50a83864bb53fb6c">FLUXCTSTAG</a>){</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="preprocessor">#pragma omp parallel private(i,j,k,initreturn,whichvel,whichcoord) OPENMPGLOBALPRIVATEFULL</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a7518365209531b952c067f47c80777c2" title="COMPFULLLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPFULL</a>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize))</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a0163a499c88dd8b07688e3dbd7007f0e">MYFUN</a>(<a class="code" href="../../d3/d72/fluxvpot_8c.html#ab97fececaef834dd354d1b4ecf39a174" title="this assigns rough pstag value from p in case not using vector potential">assignrough_primitive_pstag</a>(i,j,k, prim, pstag, ucons),<span class="stringliteral">&quot;init.c:init_primitives&quot;</span>,<span class="stringliteral">&quot;transform_primitive_vB()&quot;</span>,0);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }<span class="comment">// end parallel region</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="comment">// normalize density if wanted</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"></span>  <span class="comment">// at this point densities are still standard, so just send &quot;prim&quot;</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  trifprintf(<span class="stringliteral">&quot;Normalize densities\n&quot;</span>);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="../../d8/d60/init_8c.html#a91bb22ba17c7bb75ad2d8d9fa0594549">normalize_densities</a>(prim);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="comment">// Define an atmosphere if wanted</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a71b7c970651a395e2500645e74862abc">DOEVOLVERHO</a>||<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#abc7fe8413995280e1b65fa54885bf547">DOEVOLVEUU</a>){</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// normalized atmosphere</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    trifprintf(<span class="stringliteral">&quot;Add atmosphere\n&quot;</span>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="preprocessor">#pragma omp parallel private(i,j,k,initreturn,whichvel,whichcoord) OPENMPGLOBALPRIVATEFULL</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a865b7d98f1e7cba888ee63d052621383" title="COMPZLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPZLOOP</a>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize))</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        initreturn=init_atmosphere(&amp;whichvel, &amp;whichcoord,i,j,k,<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k));</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">if</span>(initreturn&gt;0){</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init_primitives()&quot;</span>, <span class="stringliteral">&quot;init_atmosphere()&quot;</span>, 1);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(initreturn==-1){</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;          <span class="comment">// then do nothing -- no atmosphere</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">else</span>{ <span class="comment">// initreturn==0</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;          <span class="comment">// transform from whichcoord to MCOORD</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/transforms_8c.html#a5eb01df8f2e210c8611a8320dc983a9d" title="assumes all centered quantities (so for FLUXB==FLUXCTSTAG assumes operates on centered field versions...">bl2met2metp2v</a>(whichvel, whichcoord,<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k), i,j,k) &gt;= 1){</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;bl2ks2ksp2v()&quot;</span>, 1);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      }<span class="comment">// end 3D LOOP</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    }<span class="comment">// end parallel region</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// Set analytics</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor">#if(ANALYTICMEMORY)</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="preprocessor"></span>  <span class="comment">// copy over initial solution as analytic solution</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">// NEEDED FOR BOUND in case uses panalytic</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="comment">// NOTEMARK: Sasha: I also noticed that when using analytic solution, the default code behavior upon restart is to save the prims at the time of restart into panalytic array.  It might be better instead to save the actual initial conditions into panalytic, which is what I do in my version of the code.  I left the original default behavior unchanged.</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  copy_prim2panalytic(prim,panalytic,pstag,pstaganalytic,vpot,vpotanalytic,Bhat,Bhatanalytic);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="comment">// Fixup and Bound variables since some primitive quantities may have changed</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="comment">// These may be used to define vector potential below</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// Also setup pre_fixup() type quantities</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordflow">if</span>(0){</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">//dump pre-fixup&#39;ed version</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pdump)=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pglobal);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">if</span> (dump(9999) &gt;= 1){</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;unable to print dump file\n&quot;</span>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  trifprintf(<span class="stringliteral">&quot;Fixup #1\n&quot;</span>);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="preprocessor">#if(FIXUPAFTERINIT)</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(fixup(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,prim,ucons,0)&gt;=1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;fixup()&quot;</span>, 1);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">if</span>(0){</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">//dump post-fixup&#39;ed version</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pdump)=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pglobal);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">if</span> (dump(99988) &gt;= 1){</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;unable to print dump file\n&quot;</span>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    trifprintf(<span class="stringliteral">&quot;Bound #1\n&quot;</span>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordtype">int</span> finalstep=1; <span class="comment">//  modifies initial ucum-like-primitives</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#addca75a18cc861326a321565a2e81aa0" title="normal bounding of non-staggered primitives">bound_prim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,finalstep,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,prim, pstag, Bhat, USEMPI) &gt;= 1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;bound_prim()&quot;</span>, 1); <span class="comment">// t is ok here</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">if</span>(0){</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">//dump post-bound version</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pdump)=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pglobal);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">if</span> (dump(9998) &gt;= 1){</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;unable to print dump file\n&quot;</span>);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  trifprintf(<span class="stringliteral">&quot;pre_interpolate_and_advance #1\n&quot;</span>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">// now fully bounded, initialize interpolations in case interpolate using prim/pstag data</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  pre_interpolate_and_advance(prim);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">// SUPERGODMARK TODO</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  trifprintf(<span class="stringliteral">&quot;pre_fixup #1\n&quot;</span>);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">if</span>(pre_fixup(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,prim)&gt;=1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;pre_fixup()&quot;</span>, 1);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">// Initialize field from vector potential</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="preprocessor">#if(1)</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="preprocessor"></span>  trifprintf(<span class="stringliteral">&quot;init_vpot #1\n&quot;</span>);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <a class="code" href="../../d3/d72/fluxvpot_8c.html#a90699a18ede8b7f112c0078512804ec1" title="initialize vector potential given user function assumes normal non-staggered field in pr Notice that ...">init_vpot</a>(prim,pstag,ucons,vpot,Bhat,F1,F2,F3,Atemp);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  trifprintf(<span class="stringliteral">&quot;normalize_field #1\n&quot;</span>);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <a class="code" href="../../d8/d60/init_8c.html#a5622ff1892053efcbc8cb4f0d3b179f7">normalize_field</a>(prim,pstag,ucons,vpot,Bhat); <span class="comment">// normalizes p and pstag and unew and vpot if tracked</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="preprocessor"></span>  <span class="comment">// no field</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  trifprintf(<span class="stringliteral">&quot;init_zero_field #1\n&quot;</span>);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <a class="code" href="../../d3/d72/fluxvpot_8c.html#aa3e468208ad1695107c1d12714618ba1" title="zero-out field for primitives (and pstag too)">init_zero_field</a>(prim,pstag,ucons,vpot,Bhat);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">if</span>(1){</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="preprocessor">#pragma omp parallel private(i,j,k) OPENMPGLOBALPRIVATEFULL</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a1389db2daf5bd9e94918090c253a16c9">OPENMP3DLOOPVARSDEFINE</a>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a7518365209531b952c067f47c80777c2" title="COMPFULLLOOP equivalent for OpenMP.">OPENMP3DLOOPSETUPFULL</a>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="preprocessor">#pragma omp for schedule(OPENMPSCHEDULE(),OPENMPCHUNKSIZE(blocksize))</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="preprocessor"></span>      <a class="code" href="../../d5/d7b/global_8openmploops_8h.html#a9e48537d3cb58cc3a3765b8a18b43b15" title="Oddly, performance changes by 10% when changing how start and stop blockijk (and fixing how used too ...">OPENMP3DLOOPBLOCK</a>{</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a96983b0c56e836f50cb7c1af16f59fb6">OPENMP3DLOOPBLOCK2IJK</a>(i,j,k);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <a class="code" href="../../d8/d60/init_8c.html#a4e121b9448ac1adaa7608206369f9ea5">init_postvpot</a>(i, j, k, <a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k), <a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(pstag,i,j,k), <a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(ucons,i,j,k));</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }<span class="comment">// end parallel region</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  }</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="preprocessor">#if(ANALYTICMEMORY)</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="preprocessor"></span>  <span class="comment">// copy over initial solution as analytic solution</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="comment">// NEEDED FOR BOUND in case uses panalytic</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  trifprintf(<span class="stringliteral">&quot;copy_prim2panalytic #1\n&quot;</span>);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  copy_prim2panalytic(prim,panalytic,pstag,pstaganalytic,vpot,vpotanalytic,Bhat,Bhatanalytic);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">// Fixup and Bound variables since some primitive quantities may have changed</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="comment">// These may be used to define vector potential below</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="comment">// Also setup pre_fixup() type quantities</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">// BOUND AGAIN IN CASE USING PANALYTIC TO BOUND!</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keywordflow">if</span>(0){</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">//dump pre-fixup version2</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pdump)=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pglobal);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">if</span> (dump(9997) &gt;= 1){</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;unable to print dump file\n&quot;</span>);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  trifprintf(<span class="stringliteral">&quot;Fixup #2\n&quot;</span>);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">#if(FIXUPAFTERINIT)</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(fixup(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,prim,ucons,0)&gt;=1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;fixup()&quot;</span>, 1);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    trifprintf(<span class="stringliteral">&quot;Bound #2\n&quot;</span>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">int</span> finalstep=1; <span class="comment">//  modifies initial ucum-like-primitives</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/dad/bounds_8funcdeclare_8h.html#a91fe5c4370e3292a19e7f794797a407f" title="normal bounding of all primitives">bound_allprim</a>(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,finalstep,0.0,prim,pstag,ucons, USEMPI) &gt;= 1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;bound_allprim()&quot;</span>, 1);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordflow">if</span>(0){</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="comment">//dump post-fixup&#39;ed version2</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pdump)=<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(pglobal);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (dump(9996) &gt;= 1){</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;unable to print dump file\n&quot;</span>);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="comment">// Set EOSextras related to keeping table result consistent</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#ad7d4ae935d29d9f729e14124b737a430" title="which EOS (EoS) (equation of state) to use">WHICHEOS</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac8c53bdabe3bb26474339d60e0e7b644">KAZFULL</a>){</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    trifprintf(<span class="stringliteral">&quot;EOSextra\n&quot;</span>);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#a615c1d48363ecaa0866f1c0fd337b780">FULLLOOP</a>{</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="comment">// then store pressure</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="comment">// assume standard inversion at loc=CENT</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      GLOBALMACP0A1(EOSextraglobal,i,j,k,PGASGLOBAL)=<a class="code" href="../../d8/d67/eos_8c.html#a62fa304d208e1263d8d681524057a723" title="p(rho0, u) (needed to get initial guess for W)">pressure_rho0_u</a>(<a class="code" href="../../da/d3e/definit_8h.html#ad7d4ae935d29d9f729e14124b737a430" title="which EOS (EoS) (equation of state) to use">WHICHEOS</a>,<a class="code" href="../../df/d1c/global_8storage_8h.html#a5dd5a282922755d8516bcbf69ccfa767">GLOBALMAC</a>(EOSextraglobal,i,j,k),<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO),<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>));</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="comment">// now fully bounded, initialize interpolations in case interpolate using prim/pstag data</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  trifprintf(<span class="stringliteral">&quot;pre_interpolate_and_advance #2\n&quot;</span>);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  pre_interpolate_and_advance(prim);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  trifprintf(<span class="stringliteral">&quot;pre_fixup #2\n&quot;</span>);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordflow">if</span>(pre_fixup(<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>,prim)&gt;=1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;pre_fixup()&quot;</span>, 1);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;}</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a3750bc790613bc6c8c805af0f1b839c8">  661</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a3750bc790613bc6c8c805af0f1b839c8">user1_init_vpot2field_user</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> time, <span class="keywordtype">int</span> *fieldfrompotential, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*A)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ucons)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Bhat)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR])</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;{</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k,pl,pliter;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordtype">int</span> toreturn;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">int</span> set_fieldfrompotential(<span class="keywordtype">int</span> *fieldfrompotential);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;   </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">// uses ptemparray as temporary variable</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="comment">// use PLOOP (not PLOOPBONLY) since rho,u,etc. used for interpolation in some cases</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  copy_3dnpr_fullloop(prim,<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(ptemparray));</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  set_fieldfrompotential(fieldfrompotential);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="comment">// obtain primitive magnetic field from vector potential</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="comment">// uses ptemparray as temporary variable.  Uses emf as temporary variable.</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  toreturn=<a class="code" href="../../d3/d72/fluxvpot_8c.html#ae6b2ad4cd0debf5b89ba8a9e471d6977" title="assumes normal field p pleft used as temp var if FLUXB==FLUXCTSTAG assigns conserved field in UEVOLVE...">vpot2field</a>(time, A,<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(ptemparray),pstag,ucons,Bhat,<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(F1),<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(F2),<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(F3),<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(emf),<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(ulastglobal));</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// Can override vector potential choice for some field components, like B3 in axisymmetry</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="comment">// see init.sasha.c</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">// Can override vector potential choice for some field components, like B3 in axisymmetry</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">// see init.sasha.c</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">if</span>(fieldfrompotential[1]==1 &amp;&amp; fieldfrompotential[2]==1 &amp;&amp; fieldfrompotential[3]==1){</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">// copy back</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">// don&#39;t override</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment"></span>    copy_3d_fieldonly_fullloop(<a class="code" href="../../df/d1c/global_8storage_8h.html#ad89dafa5d772b862a44b0f576983ead3" title="shifted pointer (a_s_) wrappers Couldn&#39;t figure out how to macrofy a_s_ or a_, so when changing have ...">GLOBALPOINT</a>(ptemparray),prim);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomdontuse;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom=&amp;geomdontuse;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordtype">int</span> loc;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#a615c1d48363ecaa0866f1c0fd337b780">FULLLOOP</a>{</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9afde1f1647e18e733406a1566b8b550">PLOOPBONLY</a>(pl){</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">if</span>(fieldfrompotential[pl-<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>+1]==1){</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;          <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,pl) =  GLOBALMACP0A1(ptemparray,i,j,k,pl);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a11c4e99e1493d0c1914ad1ab313ea472">FLUXB</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0b6762cef74e396f50a83864bb53fb6c">FLUXCTSTAG</a>) loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>+(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          <span class="keywordflow">else</span> loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i,j,k,loc,ptrgeom);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          <span class="keywordflow">if</span>(pstag!=NULL){</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl) =  <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,pl); <span class="comment">// don&#39;t use pstag since vpot2field() overwrites pstag.  Ok, since assume user only avoids vpot if constant in 1D.</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;          }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;          <span class="keywordflow">if</span>(ucons!=NULL){</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(ucons,i,j,k,pl) =  ptrgeom-&gt;EOMFUNCMAC(pl) * <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,pl); <span class="comment">// don&#39;t use pstag since vpot2field() overwrites pstag.  Ok, since assume user only avoids vpot if constant in 1D.</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            <span class="comment">//            dualfprintf(fail_file,&quot;i=%d pl=%d pstag=%g ucons=%g\n&quot;,i,pl,MACP0A1(pstag,i,j,k,pl),MACP0A1(ucons,i,j,k,pl));</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;          <span class="keywordflow">if</span>(Bhat!=NULL){</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(Bhat,i,j,k,pl) =  ptrgeom-&gt;EOMFUNCMAC(pl) * <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(pstag,i,j,k,pl);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">return</span>(toreturn);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;}</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">// assumes we are fed the true densities</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">// OPENMPOPTMARK: Too user specific to worry about optimizing</span></div>
<div class="line"><a name="l00730"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a25126ce7fee3ea2ef35a18754153a8e7">  730</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a25126ce7fee3ea2ef35a18754153a8e7">user1_normalize_densities</a>(<span class="keywordtype">int</span> eqline, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *parms, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a7227657576b1f3c9107c013a05d4ede0">rhomax</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#aabbf7bb3b3b1ccacec70254038441bd9">umax</a>)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;{</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],r,th;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>,<a class="code" href="../../d8/d60/init_8c.html#a131cd7e2d8513bb2ee7983d59cac4b84">rhodisk</a>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  *rhomax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  *umax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  rin=parms[0];</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  rhodisk=parms[1];</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <a class="code" href="../../df/da8/global_8comploops_8h.html#afca0c679f7f4d211de239537a2cd685b" title="below are not original multi-D combindations, just renamings that have no control over order of dimen...">COMPZLOOP</a> {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    bl_coord_ijk_2(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, X, V);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    r=V[1];</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    th=V[2];</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO) &gt; *rhomax)   *rhomax = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">if</span>(eqline){</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>) &gt; *umax &amp;&amp; (r &gt; rin))    *umax = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>) &gt; *umax )    *umax = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="comment">// Find max over all MPI procs</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment"></span>  mpimax(rhomax);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  mpimax(umax);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  trifprintf(<span class="stringliteral">&quot;rhomax: %21.15g umax: %21.15g\n&quot;</span>, *rhomax, *umax);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="comment">// Normalize densities</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <a class="code" href="../../df/da8/global_8comploops_8h.html#afca0c679f7f4d211de239537a2cd685b" title="below are not original multi-D combindations, just renamings that have no control over order of dimen...">COMPZLOOP</a>{</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO) *= rhodisk/(*rhomax);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>)  *= rhodisk/(*rhomax);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">// Reset maximum u and rho as consistent with renormalization</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  *umax *= rhodisk/(*rhomax);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  *rhomax = <a class="code" href="../../d8/d60/init_8c.html#a131cd7e2d8513bb2ee7983d59cac4b84">rhodisk</a>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;}</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">// assumes we are fed the true densities</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">// OPENMPOPTMARK: No benefit from OpenMP due to critical region required</span></div>
<div class="line"><a name="l00796"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a99d88ff8c97a6782ceed7c8836d09e58">  796</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a99d88ff8c97a6782ceed7c8836d09e58">user1_getmax_densities</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR],<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a7227657576b1f3c9107c013a05d4ede0">rhomax</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#aabbf7bb3b3b1ccacec70254038441bd9">umax</a>)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;{</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],r,th;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  *rhomax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  *umax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#ac8b973bce4dcedb06b10ea23d7fe6d4a">ZLOOP</a>{</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    bl_coord_ijk_2(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, X, V);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    r=V[1];</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    th=V[2];</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;rho=%g u=%g\n&quot;,MACP0A1(prim,i,j,k,RHO),MACP0A1(prim,i,j,k,UU));</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;     </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO) &gt; *rhomax)   *rhomax = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>) &gt; *umax )    *umax = <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="comment">// Find max over all MPI procs</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment"></span>  mpimax(rhomax);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  mpimax(umax);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  trifprintf(<span class="stringliteral">&quot;rhomax: %21.15g umax: %21.15g\n&quot;</span>, *rhomax, *umax);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;}</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">// assumes we are fed the true densities</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">// OPENMPOPTMARK: No benefit from OpenMP due to critical region required</span></div>
<div class="line"><a name="l00836"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a00572d03d39f206e7c0f4ed940a554c5">  836</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a00572d03d39f206e7c0f4ed940a554c5">user1_getmax_densities_full</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR],<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a7227657576b1f3c9107c013a05d4ede0">rhomax</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#aabbf7bb3b3b1ccacec70254038441bd9">umax</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a90111676a9e4ce79852e6178a553a5fc">uradmax</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#ae35b404bb7883cd1847128079cc77b1f">utotmax</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a484196c6fda79aaa60c90a7104158264">pmax</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#aa50a6e0ec3968a7ce5ad91168024d31b">pradmax</a>, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#af077f75608e60c62168e6a27575257b9">ptotmax</a>)</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;{</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],r,th;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  *rhomax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  *umax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  *uradmax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  *utotmax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  *pmax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  *pradmax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  *ptotmax=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utot,<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,prad,ptot;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#ac8b973bce4dcedb06b10ea23d7fe6d4a">ZLOOP</a>{</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    bl_coord_ijk_2(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, X, V);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    r=V[1];</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    th=V[2];</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;     </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pr = &amp;<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,0);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> (pr[RHO] &gt; *rhomax)   *rhomax = pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>];</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">if</span> (pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>] &gt; *umax )    *umax = pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>];</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">if</span> (pr[URAD0] &gt; *uradmax )    *uradmax = pr[URAD0];</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    utot = pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>]+pr[URAD0]; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">if</span> (utot &gt; *utotmax )    *utotmax = utot;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    p=pressure_rho0_u_simple(i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>,pr[RHO],pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>]);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    prad=pr[URAD0]*(4.0/3.0-1.0);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    ptot=p+prad; <span class="comment">// meaningful as a pressure as diagonal term in stress.</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> (p &gt; *pmax )    *pmax = <a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> (prad &gt; *pmax )    *pradmax = prad;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">if</span> (ptot &gt; *ptotmax )    *ptotmax = ptot;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="comment">// Find max over all MPI procs</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment"></span>  mpimax(rhomax);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  mpimax(umax);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  mpimax(uradmax);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  mpimax(utotmax);</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  mpimax(pmax);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  mpimax(pradmax);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  mpimax(ptotmax);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  trifprintf(<span class="stringliteral">&quot;rhomax: %21.15g umax: %21.15g uradmax: %21.15g utotmax: %21.15g pmax: %21.15g pradmax: %21.15g ptotmax: %21.15g\n&quot;</span>, *rhomax, *umax, *uradmax, *utotmax, *pmax, *pradmax, *ptotmax);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;}</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">// get maximum b^2 and p_g and minimum of beta</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">// OPENMPOPTMARK: No benefit from OpenMP due to critical region required and too user specific</span></div>
<div class="line"><a name="l00898"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#ab9289a2b656528d3cb568771217738cb">  898</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#abbd4925df619affe5614041fab6c2ff0">user1_get_maxes</a>(<span class="keywordtype">int</span> eqslice, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *parms, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a3738650e20639a3eb92a1a651159e4cd">bsq_max</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *ptot_max, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *beta_min)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;{</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> bsq_ij,ptot_ij,beta_ij;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomdontuse;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom=&amp;geomdontuse;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a9a663b46497bd8f1608c548396d23320">dxdxp</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r,th;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keywordtype">int</span> gotnormal;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>,rout,THETAEQ;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordtype">int</span> loc;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  rin=parms[0];</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  rout=parms[1];</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  THETAEQ=parms[2];</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="keywordflow">if</span>(rout&lt;=rin) rout=2.0*<a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>; <span class="comment">// default (a bit model dependent -- user should really have set rout)</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;rin=%g rout=%g THETAEQ=%g\n&quot;</span>,rin,rout,THETAEQ);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  bsq_max[0] = <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  ptot_max[0]= 0.;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  beta_min[0]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  gotnormal=0; <span class="comment">// to check if ever was in location where wanted to normalize</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#ac8b973bce4dcedb06b10ea23d7fe6d4a">ZLOOP</a> {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, loc, ptrgeom);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pr = &amp;<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,0);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    bl_coord_ijk_2(i, j, k, loc, X, V);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    r=V[1];</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    th=V[2];</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">//    if(0&amp;&amp;eqslice){</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span>(eqslice){</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;     </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <span class="comment">//      FTYPE THETAEQ=0.3;</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">if</span>((r&gt;rin&amp;&amp;r&lt;rout)&amp;&amp;(fabs(th-M_PI*0.5)&lt;THETAEQ)){</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        gotnormal=1;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a837cc5e285c9e98d2b74a324352b0117">bsq_calc</a>(<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k), ptrgeom, &amp;bsq_ij) &gt;= 1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;bsq_calc()&quot;</span>, 1);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="keywordflow">if</span> (bsq_ij &gt; bsq_max[0])      bsq_max[0] = bsq_ij;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        ptot_ij=pressure_rho0_u_simple(i,j,k,loc,<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO),<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>));</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a99ba7daf58b283bc831b8f507f5873a4" title="#define EOMTYPE EOMCOLDGRMHD">EOMRADTYPE</a>!=<a class="code" href="../../d4/d96/global_8nondepmnemonics_8rad_8h.html#a993e29ef4139116d822d89bccb92180d" title="radiation equations of motion">EOMRADNONE</a>) ptot_ij += pr[URAD0]*(4.0/3.0-1.0);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">if</span> (ptot_ij &gt; ptot_max[0])      ptot_max[0] = ptot_ij;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        beta_ij=ptot_ij/(bsq_ij*0.5);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordflow">if</span> (beta_ij &lt; beta_min[0])      beta_min[0] = beta_ij;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="keywordflow">if</span>(r&gt;rin &amp;&amp; r&lt;rout){</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        gotnormal=1;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a837cc5e285c9e98d2b74a324352b0117">bsq_calc</a>(<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k), ptrgeom, &amp;bsq_ij) &gt;= 1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;bsq_calc()&quot;</span>, 1);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <span class="keywordflow">if</span> (bsq_ij &gt; bsq_max[0])      bsq_max[0] = bsq_ij;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        ptot_ij=pressure_rho0_u_simple(i,j,k,loc,<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO),<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>));</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a99ba7daf58b283bc831b8f507f5873a4" title="#define EOMTYPE EOMCOLDGRMHD">EOMRADTYPE</a>!=<a class="code" href="../../d4/d96/global_8nondepmnemonics_8rad_8h.html#a993e29ef4139116d822d89bccb92180d" title="radiation equations of motion">EOMRADNONE</a>) ptot_ij += pr[URAD0]*(4.0/3.0-1.0);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordflow">if</span> (ptot_ij &gt; ptot_max[0])      ptot_max[0] = ptot_ij;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        beta_ij=ptot_ij/(bsq_ij*0.5);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">if</span> (beta_ij &lt; beta_min[0])      beta_min[0] = beta_ij;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  }</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  mpiisum(&amp;gotnormal);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">if</span>(gotnormal==0){</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Never found place to normalize field\n&quot;</span>);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>==1 &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>==1){</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#ac8b973bce4dcedb06b10ea23d7fe6d4a">ZLOOP</a> {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        bl_coord_ijk_2(i, j, k, loc, X, V);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <a class="code" href="../../d9/de9/coord_8c.html#a0672d8c0ee4ff07c7265d0ecbc365cdc" title="normally-used dxdxp[i,j,k] = dV/dX">dxdxprim_ijk</a>(i, j, k, loc, dxdxp);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        r=V[1];</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        th=V[2];</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;i=%d j=%d k=%d V[1]=%21.15g dxdxp[1][1]*dx[1]=%21.15g dx[1]=%21.15g\n&quot;</span>,i,j,k,V[1],dxdxp[1][1]*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[1],dx[1]);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      }</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    }</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    myexit(111);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  mpimax(bsq_max);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  mpimax(ptot_max);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  mpimin(beta_min);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;}</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">// 0: maxes method</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">// 1: betamin</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#aa02089ff959b26ec5e1ad8f05f25cbb5"> 1007</a></span>&#160;<span class="preprocessor">#define FIELDBETANORMMETHOD 1</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">// assumes normal field definition</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#af422330f01b143bf1de8b2e2413fe28d"> 1010</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#af422330f01b143bf1de8b2e2413fe28d">user1_normalize_field</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d60/init_8c.html#a355acd73443366a551c12ccc7eab9f52">beta</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ucons)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*vpot)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Bhat)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR])</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;{</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d60/init_8c.html#a3738650e20639a3eb92a1a651159e4cd">bsq_max</a>, norm, beta_act;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> myptotmax;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> betamin;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d8/d60/init_8c.html#ad10623d5c2fc6a304322571f638ef538">get_maxes</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *bsq_max, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *myptotmax, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *beta_min);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a87e5572748e4cc27373e50bd78e6f2e8">EOMTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6f6094bc467dc61f9490ad7e1de63580">EOMFFDE</a>||<a class="code" href="../../da/d3e/definit_8h.html#a87e5572748e4cc27373e50bd78e6f2e8">EOMTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a30a753538ac3bf4801ac123a37dfcc57">EOMFFDE2</a>) <span class="keywordflow">return</span>(0); <span class="comment">// do nothing</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="comment">// get initial maximum</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <a class="code" href="../../d8/d60/init_8c.html#ad10623d5c2fc6a304322571f638ef538">get_maxes</a>(prim, &amp;bsq_max, &amp;myptotmax, &amp;betamin);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  trifprintf(<span class="stringliteral">&quot;initial bsq_max: %21.15g ptotmax: %21.15g betamin=%21.15g\n&quot;</span>, bsq_max,myptotmax,betamin);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="preprocessor">#if(FIELDBETANORMMETHOD==0)</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="preprocessor"></span>  <span class="comment">// get normalization parameter</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  beta_act = myptotmax / (0.5 * <a class="code" href="../../d8/d60/init_8c.html#a3738650e20639a3eb92a1a651159e4cd">bsq_max</a>);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  norm = sqrt(beta_act / beta);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="preprocessor">#elif(FIELDBETANORMMETHOD==1)</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor"></span>  beta_act = betamin;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  norm = sqrt(beta_act / beta);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="preprocessor"></span>  trifprintf(<span class="stringliteral">&quot;initial beta: %21.15g (should be %21.15g) norm=%21.15g\n&quot;</span>, beta_act,beta,norm);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="comment">// not quite right since only correct static field energy, not moving field energy</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <a class="code" href="../../d3/d72/fluxvpot_8c.html#aae186e320fe407d9eaa12c671035eb05" title="renormalize field using user norm GODMARK: in reality should renormalize A_i and then recompute and c...">normalize_field_withnorm</a>(norm, prim, pstag, ucons, vpot, Bhat);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="comment">// get new maxes to check if beta is correct</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <a class="code" href="../../d8/d60/init_8c.html#ad10623d5c2fc6a304322571f638ef538">get_maxes</a>(prim, &amp;bsq_max, &amp;myptotmax, &amp;betamin);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  trifprintf(<span class="stringliteral">&quot;new initial bsq_max: %21.15g ptotmax: %21.15g betamin=%21.15g\n&quot;</span>, bsq_max,myptotmax,betamin);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#if(FIELDBETANORMMETHOD==0)</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="preprocessor"></span>  beta_act = myptotmax / (0.5 * <a class="code" href="../../d8/d60/init_8c.html#a3738650e20639a3eb92a1a651159e4cd">bsq_max</a>);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="preprocessor">#elif(FIELDBETANORMMETHOD==1)</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="preprocessor"></span>  beta_act = betamin;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="preprocessor"></span>  trifprintf(<span class="stringliteral">&quot;final beta: %21.15g (should be %21.15g)\n&quot;</span>, beta_act,beta);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;}</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="preprocessor">#if(EOMTYPE==EOMGRMHD||EOMTYPE==EOMCOLDGRMHD||EOMTYPE==EOMENTROPYGRMHD)</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#afec8940c5630482cc8714c2fb9f2501e"> 1056</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NORMALIZEFIELDMETHOD 0 // choice</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="preprocessor"></span><span class="comment">// 0 : by sigma</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">// 1 : by b^2\sim B^2</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NORMALIZEFIELDMETHOD 1 // no choice</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">// assumes normal field definition for NSBH problem</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a2b021bfb1a7f7c64def1a19133cc3c27"> 1065</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a2b021bfb1a7f7c64def1a19133cc3c27">user1_normalize_field_sigma</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> sigma0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> bpole, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*pstag)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ucons)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*vpot)[<a class="code" href="../../df/d1c/global_8storage_8h.html#a917a6677d5e3b38aa54aa577978bf823" title="123">NSTORE1</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a1c452bce7a227fd9f2c8f937a3c7841c">SHIFTSTORE1</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#adfe8c351b7f60e189dbd9bfca47af5c5">SHIFTSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>+<a class="code" href="../../df/d1c/global_8storage_8h.html#a6dc540b0373d80d3ea2db53d03a9fa72">SHIFTSTORE3</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Bhat)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR])</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;{</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> sigma_pole, bsq_pole, norm;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a7aac8098faa119fe90215c67f988c0d4">user1_get_sigmabsq_atpole</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *sigma_pole, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *bsq_pole);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="comment">// get initial maximum</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <a class="code" href="../../d5/de1/global_8inits_8h.html#a7aac8098faa119fe90215c67f988c0d4">user1_get_sigmabsq_atpole</a>(prim, &amp;sigma_pole,&amp;bsq_pole);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  trifprintf(<span class="stringliteral">&quot;initial sigma_pole: %21.15g bsq_pole: %21.15g\n&quot;</span>, sigma_pole,bsq_pole);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../df/d15/init_8tools_8c.html#afec8940c5630482cc8714c2fb9f2501e">NORMALIZEFIELDMETHOD</a>==0){</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">// get normalization parameter (uses final sigma to set field strength)</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    norm = sqrt(sigma0/sigma_pole);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    trifprintf(<span class="stringliteral">&quot;initial sigma_pole: %21.15g (should be %21.15g) norm=%21.15g\n&quot;</span>, sigma_pole,sigma0,norm);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../df/d15/init_8tools_8c.html#afec8940c5630482cc8714c2fb9f2501e">NORMALIZEFIELDMETHOD</a>==1){</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="comment">// get normalization parameter (uses final sigma to set field strength)</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    norm = sqrt(bpole*bpole/bsq_pole);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    trifprintf(<span class="stringliteral">&quot;initial bsq_pole: %21.15g (should be %21.15g) norm=%21.15g\n&quot;</span>, bsq_pole,bpole*bpole,norm);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="comment">// not quite right since only correct static field energy, not moving field energy</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <a class="code" href="../../d3/d72/fluxvpot_8c.html#aae186e320fe407d9eaa12c671035eb05" title="renormalize field using user norm GODMARK: in reality should renormalize A_i and then recompute and c...">normalize_field_withnorm</a>(norm, prim, pstag, ucons, vpot, Bhat);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="comment">// get new maxes to check if normalization is correct</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <a class="code" href="../../d5/de1/global_8inits_8h.html#a7aac8098faa119fe90215c67f988c0d4">user1_get_sigmabsq_atpole</a>(prim, &amp;sigma_pole,&amp;bsq_pole);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  trifprintf(<span class="stringliteral">&quot;new initial sigma_pole: %21.15g bsq_pole: %21.15g\n&quot;</span>, sigma_pole,bsq_pole);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../df/d15/init_8tools_8c.html#afec8940c5630482cc8714c2fb9f2501e">NORMALIZEFIELDMETHOD</a>==0){</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    trifprintf(<span class="stringliteral">&quot;initial sigma_pole: %21.15g (should be %21.15g) norm=%21.15g\n&quot;</span>, sigma_pole,sigma0,norm);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../df/d15/init_8tools_8c.html#afec8940c5630482cc8714c2fb9f2501e">NORMALIZEFIELDMETHOD</a>==1){</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    trifprintf(<span class="stringliteral">&quot;initial bsq_pole: %21.15g (should be %21.15g) norm=%21.15g\n&quot;</span>, bsq_pole,bpole*bpole,norm);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="comment">// for use when calling init_vpot_user later</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="comment">// if called this twice, need both renormalizations as multiplied by each other</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <a class="code" href="../../d8/d60/init_8c.html#ae15d3674b53c9a0694b9d9fada53882a">normglobal</a>*=norm;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">// normalize densities after field has been normalized</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a2ad6b8c362247ede9057a807af67ba33"> 1114</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a2ad6b8c362247ede9057a807af67ba33">user1_normalize_densities_postnormalizefield</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a0263684ebff8e72a2f0de1861393595f">SFTYPE</a> time, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR])</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;{</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomdontuse;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom=&amp;geomdontuse;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a9a663b46497bd8f1608c548396d23320">dxdxp</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r,th;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="keywordtype">int</span> loc;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d5b/defs_8general_8h.html#abf002e87ba3ed4d3c9dcc98216e6d9d6">R</a>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> bsq_ij,sigma_ij;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> sigmahot_ij;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> uorho;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="comment">// LOOP</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#a615c1d48363ecaa0866f1c0fd337b780">FULLLOOP</a>{</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, loc, ptrgeom);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    bl_coord_ijk_2(i, j, k, loc, X, V);</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    r=V[1];</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    th=V[2];</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    R=r*sin(th);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordflow">if</span>(1){</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a837cc5e285c9e98d2b74a324352b0117">bsq_calc</a>(<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k), ptrgeom, &amp;bsq_ij) &gt;= 1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;bsq_calc()&quot;</span>, 1);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="comment">// \sigma \sim \mu \sim b^2/(2\rho_0)</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      sigma_ij=bsq_ij/(2.0*fabs(<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>));</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keywordflow">if</span>(sigma_ij&gt;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0fe8d3c7642e667dd8ae3635506c4273">BSQORHOLIMIT</a>*0.5){</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;RENORMDEN1: %d %d %d %21.15g %21.15g\n&quot;</span>,i,j,k,sigma_ij,<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO));</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO)*=sigma_ij/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0fe8d3c7642e667dd8ae3635506c4273">BSQORHOLIMIT</a>*0.5);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="comment">// \sigma \sim \mu \sim b^2/(2u)</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      sigmahot_ij=bsq_ij/(2.0*fabs(<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>))+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="keywordflow">if</span>(sigmahot_ij&gt;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2ac5e41aa897e1fa82d748b7e38b9c6a">BSQOULIMIT</a>*0.5){</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;RENORMDEN2: %d %d %d %21.15g %21.15g\n&quot;</span>,i,j,k,sigmahot_ij,<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>));</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>)*=sigmahot_ij/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a2ac5e41aa897e1fa82d748b7e38b9c6a">BSQOULIMIT</a>*0.5);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      }</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="comment">// u/\rho_0</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      uorho=<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>)/(fabs(<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO))+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="keywordflow">if</span>(uorho&gt;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a29e0b9f4e26a839ec5b98c698e90ca17">UORHOLIMIT</a>){</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;RENORMDEN3: %d %d %d %21.15g %21.15g %21.15g\n&quot;</span>,i,j,k,uorho,<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO),<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>));</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO)*=uorho/<a class="code" href="../../d8/d5b/defs_8general_8h.html#a29e0b9f4e26a839ec5b98c698e90ca17">UORHOLIMIT</a>;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      }</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <span class="comment">// old, stupid, maybe:</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <span class="comment">//      MACP0A1(prim,i,j,k,RHO)*=normglobal*normglobal;</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="comment">//      MACP0A1(prim,i,j,k,UU)*=normglobal*normglobal;</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    }</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  }</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;}</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">// get \sigma at pole of NS</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a7aac8098faa119fe90215c67f988c0d4"> 1190</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/de1/global_8inits_8h.html#a7aac8098faa119fe90215c67f988c0d4">user1_get_sigmabsq_atpole</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*prim)[<a class="code" href="../../df/d1c/global_8storage_8h.html#ad1398d310d3072da1a781925d63e61b2">NSTORE2</a>][<a class="code" href="../../df/d1c/global_8storage_8h.html#a6763b3a393c2900fc4a186bfbe6f3bb5">NSTORE3</a>][NPR], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *sigma_pole, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *bsq_pole)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;{</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> bsq_ij,sigma_ij;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> geomdontuse;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom=&amp;geomdontuse;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a9a663b46497bd8f1608c548396d23320">dxdxp</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r,th;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="keywordtype">int</span> gotnormal;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d60/init_8c.html#a00f77d9a8d223672e72eba98838f5e2e">rin</a>;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="keywordtype">int</span> loc;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  sigma_pole[0] = <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  bsq_pole[0] = <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  gotnormal=0; <span class="comment">// to check if ever was in location where wanted to normalize</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d5b/defs_8general_8h.html#abf002e87ba3ed4d3c9dcc98216e6d9d6">R</a>;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="comment">// LOOP</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#ac8b973bce4dcedb06b10ea23d7fe6d4a">ZLOOP</a> {</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i, j, k, loc, ptrgeom);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    bl_coord_ijk_2(i, j, k, loc, X, V);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    r=V[1];</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    th=V[2];</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    R=r*sin(th);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">if</span>(1){</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      gotnormal=1;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a837cc5e285c9e98d2b74a324352b0117">bsq_calc</a>(<a class="code" href="../../df/d1c/global_8storage_8h.html#a849d8ce0cf4a61f92340425b34ba9538">MAC</a>(prim,i,j,k), ptrgeom, &amp;bsq_ij) &gt;= 1) <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a5febb92786c5f7a1479e7e65f1c23ef3">FAILSTATEMENT</a>(<span class="stringliteral">&quot;init.c:init()&quot;</span>, <span class="stringliteral">&quot;bsq_calc()&quot;</span>, 1);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="comment">// \sigma \sim \mu \sim b^2/(2\rho_0)</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      sigma_ij=bsq_ij/(2.0*fabs(<a class="code" href="../../df/d1c/global_8storage_8h.html#a42b71f60b3fac655a8770411acf0ab62">MACP0A1</a>(prim,i,j,k,RHO))+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;SIGMA: %d %d %d : sigma_ij=%21.15g\n&quot;,i,j,k,sigma_ij);</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="comment">// if multiple positions found, keep getting maximum</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="keywordflow">if</span> (sigma_ij &gt; sigma_pole[0])      sigma_pole[0] = sigma_ij;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="keywordflow">if</span> (bsq_ij &gt; bsq_pole[0])      bsq_pole[0] = bsq_ij;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  }</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  mpiisum(&amp;gotnormal);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordflow">if</span>(gotnormal==0){</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Never found place to normalize field for NS\n&quot;</span>);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>==1 &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>==1){</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#ac8b973bce4dcedb06b10ea23d7fe6d4a">ZLOOP</a> {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        bl_coord_ijk_2(i, j, k, loc, X, V);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        <a class="code" href="../../d9/de9/coord_8c.html#a0672d8c0ee4ff07c7265d0ecbc365cdc" title="normally-used dxdxp[i,j,k] = dV/dX">dxdxprim_ijk</a>(i, j, k, loc, dxdxp);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        r=V[1];</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        th=V[2];</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;i=%d j=%d k=%d V[1]=%21.15g dxdxp[1][1]*dx[1]=%21.15g dx[1]=%21.15g\n&quot;</span>,i,j,k,V[1],dxdxp[1][1]*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[1],dx[1]);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    myexit(111);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  }</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  mpimax(sigma_pole);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  mpimax(bsq_pole);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;}</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">// UUMIN/RHOMIN used for atmosphere</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">// for each WHICHVEL possibility, set atmosphere state for any coordinate system</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">// which=0 : initial condition</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">// which=1 : evolution condition (might also include a specific angular momentum or whatever)</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">// which==1 assumes pr set to something locally reasonable, and we adjust to that slowly</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div>
<div class="line"><a name="l01277"></a><span class="lineno"><a class="code" href="../../df/d15/init_8tools_8c.html#a9a78072c4dfb516eb59753c58b5d1cb8"> 1277</a></span>&#160;<span class="preprocessor">#define TAUADJUSTATM (10.0) // timescale for boundary to adjust to using preset inflow</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="preprocessor"></span><span class="keywordtype">int</span> user1_set_atmosphere(<span class="keywordtype">int</span> atmospheretype, <span class="keywordtype">int</span> whichcond, <span class="keywordtype">int</span> whichvel, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pr)</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;{</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rho,u,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a8aee081296d4586f805fa24a2729c8b9">ur</a>,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a92163508c0b18e75db11592248b16332">uh</a>,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a1df03026db3aa663afda0c9eed67408e">up</a>;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r,th;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#af2af6d8fbe2841b0b5ad76ba4b2e2bae">prlocal</a>[NPR];</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="comment">// Bondi like initial atmosphere</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">//    rho = RHOMIN * 1.E-14;</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="comment">//    u = UUMIN * 1.E-14;</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  bl_coord_ijk_2(ptrgeom-&gt;i, ptrgeom-&gt;j, ptrgeom-&gt;k, ptrgeom-&gt;p, X, V);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  r=V[1];</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  th=V[2];</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">// default</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) prlocal[pl]=pr[pl];</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a71b7c970651a395e2500645e74862abc">DOEVOLVERHO</a>){</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="comment">// Bondi-like atmosphere</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">if</span>(rescaletype==4){</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <span class="keywordflow">if</span>(atmospheretype==1){</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="comment">// couple rescaletype to atmosphere type</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        prlocal[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>] = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a>*pow(r,-2.0);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(atmospheretype==2){</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="comment">// couple rescaletype to atmosphere type</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="keywordflow">if</span>(r&gt;40.0) prlocal[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>] = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a>*pow(r,-2.0);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <span class="keywordflow">else</span> prlocal[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>] = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a>*pow(40.0,-2.0);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      }</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    }</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      prlocal[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>] = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a7ea29d2d3d2dedf13e5530aae75489db">RHOMIN</a>*pow(r,-1.5);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    }</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    prlocal[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>] = 0;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  }</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#abc7fe8413995280e1b65fa54885bf547">DOEVOLVEUU</a>){</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="comment">// Bondi-like atmosphere</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    prlocal[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>]  = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a5f145b29adcf588cf7f2821cb5c9302f">UUMIN</a>*pow(r,-2.5);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    prlocal[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>]  = 0;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  }</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="comment">// bl-normal observer (4-vel components)</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  set_zamo_velocity(whichvel,ptrgeom,prlocal);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="keywordflow">if</span>(whichcond==1){</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">if</span>(100.0*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a56db625f31229c5e8b208ff27d464931">dt</a>&gt;<a class="code" href="../../df/d15/init_8tools_8c.html#a9a78072c4dfb516eb59753c58b5d1cb8">TAUADJUSTATM</a>){</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;dt=%21.15g and TAUADJUSTATM=%21.15g\n&quot;</span>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a56db625f31229c5e8b208ff27d464931">dt</a>,<a class="code" href="../../df/d15/init_8tools_8c.html#a9a78072c4dfb516eb59753c58b5d1cb8">TAUADJUSTATM</a>);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      myexit(1);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    }</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="comment">// TAUADJUSTATM must be &gt;&gt; dt always in order for this to make sense (i.e. critical damping to fixed solution)</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) pr[pl] = pr[pl]+(prlocal[pl]-pr[pl])*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a56db625f31229c5e8b208ff27d464931">dt</a>/<a class="code" href="../../df/d15/init_8tools_8c.html#a9a78072c4dfb516eb59753c58b5d1cb8">TAUADJUSTATM</a>;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(whichcond==0){ </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) pr[pl] = prlocal[pl];</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="comment">// very specific</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="comment">// always outflow field</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="comment">//    pr[B1] = pr[B2] = pr[B3] = 0;</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(whichcond==-1){ </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">// t=0, just sets as &quot;floor&quot;</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) pr[pl] = prlocal[pl];</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>] = pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>] = pr[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>] = 0;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  }</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;}</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:33 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
