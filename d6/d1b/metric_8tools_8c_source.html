<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: metric.tools.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">metric.tools.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d1b/metric_8tools_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;decs.h&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#if(0) // uniformly low values although not always lower than original version</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAXITER 5</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NRANSI</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CON 1.1</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CON2 (CON*CON)</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor"></span><span class="comment">//#define NTAB 130 // number of function evaluations is 2XNTAB</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#define NTAB 30 // number of function evaluations is 2XNTAB</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#define SAFE 2.0</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TRYTOL (trytollocal) // attempted tolerance</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define OKTOL 1e-5 // error must be below this to avoid report</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FAILTOL 1e-1</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span><span class="comment">//#define HSTARTCHANGE 10.0</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#if(1) // original version (gets pretty damn low for many, but not all, derivatives -- some 1E-6 rather than 1E-13)</span></div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">   27</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAXITER 15  //Increased by Sasha up from 5 to avoid non-convergence errors (&gt;1e-5)</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#ac35ec264c922c9b83f2b3d79cb8f5d93">   28</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NRANSI</span></div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8a0d2564a5ab8fa0a8a0581fba5453e2">   29</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CON 1.3</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae93353b15b5afaa5e9dc185271095650">   30</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CON2 (CON*CON)</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">   31</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NTAB 10 // number of function evaluations is 2XNTAB</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a1757a37987cd02d649eda609c531a33c">   33</a></span>&#160;<span class="preprocessor">#define SAFE 2.0</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a294d0d3d7a413d263d8da658b1cc8157">   34</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TRYTOL 1E-10 // attempted tolerance</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a903ce625c8f3afcfbc3d1e217cb3c663">   35</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define OKTOL 1e-5 // error must be below this to avoid report</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#aef40af594ce3e56614c10b2be2ba1f35">   36</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FAILTOL 1e-3</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// whether to turn on extensive recent debugging</span></div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#ac4b05bd975ee0e31321db53c3816100d">   40</a></span>&#160;<span class="preprocessor">#define DEBUGDF 0</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// whether to output matrix of derivative and extrapolations of various orders</span></div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a3f2ebd8796e3ac5d3f7fdafecfa9c5bf">   43</a></span>&#160;<span class="preprocessor">#define DEBUGOUTPUTAMATRIX 0</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// whether to use Jon&#39;s additional starting &quot;h&quot; checks [about 2X-3X more expensive in typical cases]</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a877450e1755fc69cab4205f875c9f657">   46</a></span>&#160;<span class="preprocessor">#define USEJONEXTENSION 1</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// jon&#39;s version of NR&#39;s dfridr modified to accept more general, needed, function</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keywordtype">int</span> dfridr(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*func)(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>*,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>), <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,<span class="keywordtype">int</span> ii, <span class="keywordtype">int</span> jj, <span class="keywordtype">int</span> kk, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *finalanswer)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errt,fac,hh,**<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa73cf2d397cae726436e08d2c891bdb0">a</a>,ans;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dX[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Xh[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Xl[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> h,err;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> firsthstart,hstart;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> newdx,temp;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordtype">int</span> iter;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errlist[<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">MAXITER</a>];</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> hhlist[<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">MAXITER</a>];</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> anslist[<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">MAXITER</a>];</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> minerror,minerrorhstart;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordtype">int</span> miniter;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordtype">int</span> iterdebug;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> minans;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> trytollocal;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordtype">int</span> lasti;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordtype">int</span> Nvec[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">int</span> goodi,goodj;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> goodhh;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> truecon,truecon2;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordtype">int</span> nrlasti,nrgoodi,nrgoodj;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> nrerr,nrans,nrgoodhh;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordtype">int</span> iterfailed;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  trytollocal=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac79d4fd7cdf46f68ef5a749d73a4b286">NUMEPSILONPOW23</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">//  minhlocal=NUMEPSILONPOW23;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// allocate memory</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  a=dmatrix(1,<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">NTAB</a>,1,<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">NTAB</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// starting delta shouldn&#39;t be so large to cross interesting boundaries (like pole or r=0), but should be large enough to allow convergence to answer at smaller intervals.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  Nvec[0]=0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  Nvec[1]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  Nvec[2]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  Nvec[3]=<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordflow">if</span>(kk==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>) hstart=<a class="code" href="../../da/d3e/definit_8h.html#ac8fa6cbeee4579e6535f95866234f8a9">CONNDELTA</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Nvec[kk]==1) hstart=<a class="code" href="../../da/d3e/definit_8h.html#ac8fa6cbeee4579e6535f95866234f8a9">CONNDELTA</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">else</span> hstart=0.5*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[kk];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  firsthstart=hstart;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  miniter=0; <span class="comment">// didn&#39;t find minimum is assumed, which means first is minimum!</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  iter=0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  minerror=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a38eb76aa0a9a1bb1dac30c75be4a05b6">BIG</a>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  minans=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a38eb76aa0a9a1bb1dac30c75be4a05b6">BIG</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  truecon=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8a0d2564a5ab8fa0a8a0581fba5453e2">CON</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  truecon2=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae93353b15b5afaa5e9dc185271095650">CON2</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  goodhh=-1.0; <span class="comment">// -1.0 indicates if ever found goodhh</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// START BIG LOOP over Jon&#39;s iterations</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"></span>  iterfailed=0;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">while</span>(1){</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#if(DEBUGDF)</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;iter=%d\n&quot;</span>,iter);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// Set initial differential size</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    h=hstart;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (h &lt;= 0.0) nrerror(<span class="stringliteral">&quot;h must be positive definite in dfridr.&quot;</span>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    hh=h;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// HARM STUFF</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;k++) dX[k]=0.0; <span class="comment">// other components will remains 0 for this function</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    dX[kk]=hh;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;k++){</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="comment">//      Xl[k]=X[k]-dX[k];</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      temp=X[k]-dX[k];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      newdx=temp-X[k];</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      Xl[k]=X[k]+newdx;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;newdx[k=%d] for low = %21.15g : %21.15g\n&quot;,k,newdx,Xl[k]);</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;k++){</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="comment">//      Xh[k]=X[k]+dX[k];</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      temp=X[k]+dX[k];</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      newdx=temp-X[k];</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      Xh[k]=X[k]+newdx;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;newdx[k=%d] for high = %21.15g : %21.15g\n&quot;,k,newdx,Xh[k]);</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;a[1][1]=%21.15g dX[kk=%d]=%21.15g\n&quot;,a[1][1],kk,dX[kk]);</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">//    for(k=0;k&lt;NDIM;k++) dualfprintf(fail_file,&quot;X[%d]=%21.15g Xh[%d]=%21.15g Xl[%d]=%21.15g dXhl=%21.15g\n&quot;,k,X[k],k,Xh[k],k,Xl[k],Xh[k]-Xl[k]);</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">//    for(k=0;k&lt;NDIM;k++) dualfprintf(fail_file,&quot;funch=%21.15g funcl=%21.15g\n&quot;,k,(*func)(ptrgeom,Xh,ii,jj),k,(*func)(ptrgeom,Xl,ii,jj));</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// end HARM STUFF</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// compute df/dx</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    a[1][1]=((*func)(ptrgeom,Xh,ii,jj)-(*func)(ptrgeom,Xl,ii,jj))/(2.0*hh);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    err=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a38eb76aa0a9a1bb1dac30c75be4a05b6">BIG</a>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">for</span> (i=2;i&lt;=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">NTAB</a>;i++) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      hh /= truecon;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="comment">// HARM STUFF</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      dX[kk]=hh;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;k++) Xl[k]=X[k]-dX[k];</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">for</span>(k=0;k&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;k++) Xh[k]=X[k]+dX[k];</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="comment">//      for(k=0;k&lt;NDIM;k++) dualfprintf(fail_file,&quot;i=%d k=%d %21.15g %21.15g\n&quot;,i,k,X[k],dX[k]);</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">// end HARM STUFF</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="comment">// compute df/dx with dx here as dx*dx in dx size</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      a[1][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=((*func)(ptrgeom,Xh,ii,jj)-(*func)(ptrgeom,Xl,ii,jj))/(2.0*hh);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      fac=truecon2;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="comment">// compute Neville table for each smaller step size</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="comment">// Contains extrapolation to dx-&gt;0 for each possible order of extrapolation</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordflow">for</span> (j=2;j&lt;=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;j++) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">// extrapolate for dx-&gt;0</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        a[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=(a[j-1][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]*fac-a[j-1][i-1])/(fac-1.0);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        fac=truecon2*fac;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="comment">//unnormalized error</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">// errt=MAX(fabs(a[j][i]-a[j-1][i]),fabs(a[j][i]-a[j-1][i-1]));</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">//normalized error</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">// errt=MAX(fabs(a[j][i]-a[j-1][i]),fabs(a[j][i]-a[j-1][i-1]))/((*func)(ptrgeom,X,ii,jj)+SMALL);</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="comment">// normalized error</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        errt=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(a[j][i]-a[j-1][i]),fabs(a[j][i]-a[j-1][i-1]));</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        errt/=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(a[j][i]),fabs(a[j-1][i])),<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(a[j][i]),fabs(a[j-1][i-1]))),<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> (errt &lt;= err) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          err=errt;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          ans=a[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          goodj=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          goodi=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          goodhh=hh;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      }<span class="comment">// end over j derivatives</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="comment">// unnormalize error</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="comment">//      if (fabs((a[i][i]-a[i-1][i-1])) &gt;= SAFE*(err)) break;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="comment">// normalized error</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="comment">//      if (fabs((a[i][i]-a[i-1][i-1])/( (*func)(ptrgeom,X,ii,jj)+SMALL)) &gt;= SAFE*(err)) break;</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="comment">//      if (fabs((a[i][i]-a[i-1][i-1]))/(fabs(ans)+SMALL) &gt;= SAFE*(err)) break;</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="comment">// normalized error</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (fabs((a[i][i]-a[i-1][i-1]))/<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(a[i][i]),fabs(a[i-1][i-1]))) &gt;= <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a1757a37987cd02d649eda609c531a33c">SAFE</a>*(err)){</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        nrlasti=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        nrerr=err;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        nrans=ans;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        nrgoodj=goodj;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        nrgoodi=goodi;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        nrgoodhh=goodhh;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">#if(0) // NR breaks a bit early -- found solution can sometimes be better if wait -- so just do whole NTAB</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor"></span>      }<span class="comment">// end NR early termination check</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      lasti=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }<span class="comment">// end over NTAB entries for i</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="preprocessor">#if(DEBUGOUTPUTAMATRIX) // debug report to see exactly what table contained</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;BEGIN DFRIDR table for i=%d j=%d k=%d :: ii=%d jj=%d kk=%d hstart=%21.15g lasti=%d nrlasti=%d\n&quot;</span>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ii,jj,kk,hstart,lasti,nrlasti);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;   %21s &quot;</span>,<span class="stringliteral">&quot;ORDERS&quot;</span>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;=lasti;i++){</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;%21d&quot;</span>,i);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;=lasti;i++){</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;hh=%21.15g &quot;</span>,hstart/pow(truecon,i-1));</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">for</span>(j=1;j&lt;=lasti;j++){</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">if</span>(j&lt;=i){</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          <span class="keywordflow">if</span>(i==goodi &amp;&amp; j==goodj){</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;*%21.15g*&quot;</span>,a[j][i]);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;          }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(i==nrgoodi &amp;&amp; j==nrgoodj){</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;?%21.15g?&quot;</span>,a[j][i]);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;          }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot; %21.15g &quot;</span>,a[j][i]);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;%21s&quot;</span>,<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">if</span>(j==lasti) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">else</span> dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">if</span>(i==lasti) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;final error=%21.15g goodhh=%21.15g ans=%21.15g\n&quot;</span>,err,goodhh,ans);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;NR error=%21.15g goodhh=%21.15g ans=%21.15g\n&quot;</span>,nrerr,nrgoodhh,nrans);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;END DFRIDR table for i=%d j=%d k=%d ii=%d jj=%d kk=%d\n&quot;</span>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ii,jj,kk);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor">#if(USEJONEXTENSION==0)</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// Entire below section is new JCM additions</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">//   </span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// now check error is not crazy with the starting large h, decrease h if crazy until not crazy and get good error</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    errlist[iter]=err; <span class="comment">// store final error from NR method</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">//    hhlist[iter]=hstart;</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    hhlist[iter]=goodhh; <span class="comment">// current hh to focus around</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    anslist[iter]=ans; <span class="comment">// store result</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span>(err&gt;<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a294d0d3d7a413d263d8da658b1cc8157">TRYTOL</a>){ <span class="comment">// TRYTOL is error we are attempting to reach</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">if</span>(errlist[iter]&lt;minerror){</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">// store min error event</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        minerror=errlist[iter];</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        minerrorhstart=hhlist[iter];</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        miniter=iter;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        minans=ans;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#if(DEBUGDF)</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="preprocessor"></span>        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;minerr=%21.15g minhstart=%21.15g miniter=%d minans=%21.15g\n&quot;</span>,minerror,minerrorhstart,miniter,minans);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="comment">// if did no better through bisecting hhgood, then probably done</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        ans=minans;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">#if(DEBUGDF)</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span>(iter==1) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Done with no better error (iter=%d)\n&quot;</span>,iter);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">else</span> dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Did better on multiple iterations (iter=%d)\n&quot;</span>,iter);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="comment">// if here, then not done yet with bisecting on hh</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="comment">// try h around goodh, but narrow down the factor by which hh changes so don&#39;t skip over better hh than goodhh</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">// NTAB entries, and want to go back to prior hh before goodhh, but need to cross to goodhh/truecon</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="comment">// so change on truecon is fixed to be:</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> htop,hbottom;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      htop=goodhh*truecon;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      hbottom=goodhh/truecon;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      truecon= pow(hbottom,-1.0/<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">NTAB</a>) * pow(htop,1.0/<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">NTAB</a>);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      truecon2=truecon*truecon; <span class="comment">// reset truecon2</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="comment">// now set new hstart:</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      hstart=htop;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="comment">// so start at htop and will exponentially approach hbottom after NTAB entries.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">#if(DEBUGDF)</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor"></span>      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;iter=%d err=%21.15g goodhh=%21.15g lasti=%d truecon=%21.15g htop=%21.15g hbottom=%21.15g\n&quot;</span>,iter,err,goodhh,lasti,truecon,htop,hbottom);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordflow">if</span>(truecon==1.0){</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        ans=minans;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">break</span>; <span class="comment">// can&#39;t do any better</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }<span class="comment">// end if err &gt; TRYTOL</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">break</span>; <span class="comment">// then error&lt;TRYTOL!  GOOD!</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    iter++;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span>(iter&gt;=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">MAXITER</a>){</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">if</span>(err&lt;<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a903ce625c8f3afcfbc3d1e217cb3c663">OKTOL</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">else</span>{ <span class="comment">// then maybe problems</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        ans=minans;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span>((minerror&lt;<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a903ce625c8f3afcfbc3d1e217cb3c663">OKTOL</a> || err&lt;<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a903ce625c8f3afcfbc3d1e217cb3c663">OKTOL</a>)){</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <span class="keywordflow">break</span>;       <span class="comment">// then accept as answer</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          <span class="comment">// then must fail</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;iter=%d&gt;=MAXITER=%d: never found error below %21.15g: err=%21.15g : ii=%d jj=%d kk=%d\n&quot;</span>,iter,<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">MAXITER</a>,<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a903ce625c8f3afcfbc3d1e217cb3c663">OKTOL</a>,err,ii,jj,kk);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;gi=%d gj=%d gk=%d\n&quot;</span>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ti=%d tj=%d tk=%d\n&quot;</span>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[1]+ptrgeom-&gt;i,<a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[2]+ptrgeom-&gt;j,<a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[3]+ptrgeom-&gt;k);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;miniter=%d errlist[miniter]=%21.15g hhlist[miniter]=%21.15g\n&quot;</span>,miniter,errlist[miniter],hhlist[miniter]);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;minerror=%21.15g minans=%21.15g\n&quot;</span>,minerror,minans);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;          <span class="keywordflow">for</span>(iterdebug=0;iterdebug&lt;iter;iterdebug++){</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;h[%d]=%21.15g err[%d]=%21.15g ans[%d]=%21.15g\n&quot;</span>,iterdebug,hhlist[iterdebug],iterdebug,errlist[iterdebug],iterdebug,anslist[iterdebug]);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          iterfailed=1;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        }<span class="comment">//end if not OKTOL</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      }<span class="comment">// end if not OKTOL for only err</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }<span class="comment">// end if iter&gt;=MAXITER</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif // end JCM addition</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }<span class="comment">// end while loop</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">// done</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  free_dmatrix(a,1,<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">NTAB</a>,1,<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0e93cfb2d62849853fd34957ba6e6fdc">NTAB</a>);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">if</span>(err&lt;<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a903ce625c8f3afcfbc3d1e217cb3c663">OKTOL</a>){</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// then good, nothing to report</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Bad NUMREC error at i=%d j=%d k=%d ii=%d jj=%d kk=%d error=%21.15g ans=%21.15g :: iter=%d lasti=%d minerrorhstart=%21.15g firsthstart=%21.15g\n&quot;</span>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ii,jj,kk,err,ans,iter,lasti,minerrorhstart,firsthstart);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">if</span>(err&gt;=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#aef40af594ce3e56614c10b2be2ba1f35">FAILTOL</a>){</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">return</span>(1); <span class="comment">// indicate failure</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  *finalanswer=ans;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">return</span>(0); <span class="comment">// indicate no failure</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;       </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">#undef CON</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef CON2</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef BIG</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef NTAB</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef SAFE</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef NRANSI</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="preprocessor"></span><span class="comment">// (C) Copr. 1986-92 Numerical Recipes Software *1.@Q.. </span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">   FTYPE delta(int i, int j) { if(i == j) return(1.) ; else return(0.) </span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">   ; } */</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">/* Minkowski metric; signature +2 */</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">   FTYPE mink(int i, int j) { if(i == j) { if(i == 0) return(-1.) ;</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">   else return(1.) ; } else return(0.) ; } */</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">// continuous mod function like Mathematica</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordtype">int</span> contmod(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;{</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordtype">int</span> ans;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  ans = x%y;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">if</span>(ans&lt;0) ans+=y;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">return</span>(ans);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">// below 2 mysin/mycos preserve symmetry for arg=-M_PI/2 .. 2M_PI by restricting arg to 0..PI/2</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> mysin(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> th)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordtype">int</span> contmod(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">int</span> nmod4;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ans;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#if(ACCURATESINCOS)</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="preprocessor"></span>  nmod4=contmod((<span class="keywordtype">int</span>)(th/(M_PI*0.5)),4);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">switch</span>(nmod4){</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    ans=sin(th);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    ans=sin(M_PI-th);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    ans=-sin(th-M_PI);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    ans=-sin(2.0*M_PI-th);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such case for mysin with nmod4=%d\n&quot;</span>,nmod4);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    ans=sqrt(-1.0);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    myexit(206983462);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="preprocessor"></span>  ans=sin(th);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">return</span>(ans);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;}</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> mycos(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> th)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;{</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#if(ACCURATESINCOS)</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">return</span>(mysin(th+M_PI*0.5));</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">return</span>(cos(th));</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="preprocessor">#if(SUPERLONGDOUBLE==0)</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor"></span><span class="comment">//#ifdef WIN32</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">// cot = 1/tan = cos/sin</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> cot(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> arg)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;{</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordflow">if</span>(fabs(fmod(arg,M_PI))&lt;1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-14){</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span>(0.0); <span class="comment">// avoid singularity - assume handled elsewhere</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="preprocessor">#if(ACCURATESINCOS)</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span>(mycos(arg)/mysin(arg));</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span>(1.0/tan(arg));</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;}</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">//#endif </span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> csc(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> arg)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;{</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">if</span>(fabs(fmod(arg,M_PI))&lt;1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-14){</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">return</span>(0.0); <span class="comment">// avoid singularity - assume handled elsewhere</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="preprocessor">#if(ACCURATESINCOS)</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span>(1.0/mysin(arg));</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span>(1.0/sin(arg));</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0cadfd81839468f4b4d9bebcecd8ee12">  508</a></span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a0cadfd81839468f4b4d9bebcecd8ee12">sec</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> arg)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;{</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span>(fabs(fmod(arg,0.5*M_PI))&lt;1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-14){</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">return</span>(0.0); <span class="comment">// avoid singularity - assume handled elsewhere</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="preprocessor">#if(ACCURATESINCOS)</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span>(1.0/mycos(arg));</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">return</span>(1.0/cos(arg));</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;}</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">// fromwhere==0 or 1, then assume horizoni on downside of actual location</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">// fromwhere==2, then assume horizoni on upside of actual location</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="keywordtype">int</span> find_horizon(<span class="keywordtype">int</span> fromwhere)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;{</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, ii;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r1, r2;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],<a class="code" href="../../dc/dd2/newcodediff_8txt.html#af84f2c3bf153920b7c8d186132d39bc7">V</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">int</span> gotit;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> horizonvalue;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">// called after grid is setup for all cpus</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="comment">// first compute where horizon is</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">// these 2 below are used prior, but not initialized otherwised on restart</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="comment">// some calculations</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">// these 2 below are also used by find_horizon() below</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>=rhor_calc(0);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a13eb494465126d4aa3e4d7657b9ff6ca">Risco</a>=rmso_calc(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a571d9963a240dbb4dd863b248ee0ff34">PROGRADERISCO</a>);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="comment">// need to find horizon and place horizoni on right-hand-side of location</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">// was testing to make sure if held horizoni fixed that conserved mass if using conservation of baryon number as basis for masses in Mvsr and accretion of energy</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">// GODMARK DEBUG DEBUG DEBUG</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">//  if(fromwhere!=2){</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">//  return(0);</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="comment">// definition of horizoni must be consistent so fluxes are consistent and have conservation</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  fromwhere=2; <span class="comment">// force to be on upside unless Rhor=0, which is caught first</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keywordflow">if</span>(fromwhere==0) trifprintf(<span class="stringliteral">&quot;begin: find_horizon ... &quot;</span>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// find cpu column that brackets the horizon and determine the</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="comment">// i-offset of horizon</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="comment">// notice that only 1 CPU will get horizon since stop process once found</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="comment">// notice that radius(horizoni) is below or equal to actual horizon radius</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  horizonvalue = <a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a> = -100;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a>=-1;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  gotit = 0;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">for</span> (ii = <a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a> - 1; ii &gt;= 0; ii--) { <span class="comment">// should get done by first row</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (ii == myid) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">for</span> (i = <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1; i &gt;= 0; i--) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        j = <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a> / 2;             <span class="comment">// doesn&#39;t matter (spherical polar assumed)</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        k = <a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a> / 2;             <span class="comment">// doesn&#39;t matter (spherical polar assumed)</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, X);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <a class="code" href="../../d9/de9/coord_8c.html#a96290375e27d5d0aa4d843b07e228e14" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; V only">bl_coord_ijk</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, V);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        r1=V[1];</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a27e1e0a92af691ffd03d7e9d0a628392">ip1mac</a>(i), j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, X);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <a class="code" href="../../d9/de9/coord_8c.html#a96290375e27d5d0aa4d843b07e228e14" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; V only">bl_coord_ijk</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a27e1e0a92af691ffd03d7e9d0a628392">ip1mac</a>(i), j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, V);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        r2=V[1];</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">// looking between FACE1&#39;s r value and upper FACE1&#39;s r value, so loop is from i=N1-1..i=0</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">if</span>(ii==myid &amp;&amp; myid==0 &amp;&amp; i==0){</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          <span class="comment">// special check in case horizon inside inner-most radial grid</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          <span class="keywordflow">if</span>(horizonvalue&lt;=r1 || horizonvalue&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>){ <span class="comment">// GODMARK: this means horizon can&#39;t be chosen to &lt;SMALL and mean there is a black hole there</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="comment">// then horizon off grid or right on edge, but still ok</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="comment">// treat as if horizon is off grid if right on edge</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a> = 0;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a>=<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1];</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="comment">//        if (fabs(r1 - horizonvalue) &lt;= (r2 - r1)) {     // find horizon</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">if</span> (fromwhere!=2){</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          <span class="keywordflow">if</span>(horizonvalue &gt;= r1 &amp;&amp; horizonvalue &lt; r2){ <span class="comment">// note that if strictly on r2, then next CPU should pick it up</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a> = <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a> = <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1];</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fromwhere==2){</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          <span class="keywordflow">if</span>(horizonvalue &gt;= r1 &amp;&amp; horizonvalue &lt; r2){</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a> = <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a27e1e0a92af691ffd03d7e9d0a628392">ip1mac</a>(i);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a> = <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1];</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a>&gt;=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>){</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;              <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a>=0;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;              <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a>++;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;              <span class="comment">// then on original CPU</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;              <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a> = <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1];</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <span class="comment">//dualfprintf(fail_file,&quot;horizon: %d %d\n&quot;,horizoni,horizoncpupos1);</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          <span class="comment">//   dualfprintf(fail_file,&quot;horizonnot: %d %d :: %21.15g %21.15g %21.15g\n&quot;,horizoni,horizoncpupos1,r1,Rhor,r2);</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a> &gt; 0) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="preprocessor"></span>      MPI_Bcast(&amp;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a>, 1, MPI_INT, MPIid[ii], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      MPI_Bcast(&amp;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a>, 1, MPI_INT, MPIid[ii], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a> &gt;= 0) gotit = 1;                <span class="comment">// can stop entire process</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// keep horizoni as relative to CPU with horizon so any CPU knows where horizon is</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">//    if (mycpupos[1] != horizoncpupos1) {</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="comment">//  horizoni = -100;</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">//}                           // reset if not right cpu group</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">if</span> (gotit) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordflow">if</span>(gotit==0){</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Never found horizon: fromwhere=%d :: MBH=%21.15g a=%21.15g :: Rhor=%21.15g Risco=%21.15g\n&quot;</span>,fromwhere,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa73cf2d397cae726436e08d2c891bdb0">a</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a13eb494465126d4aa3e4d7657b9ff6ca">Risco</a>);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    myexit(6246);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">// report some information</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordflow">if</span>(fromwhere==0) {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    trifprintf(<span class="stringliteral">&quot;horizoni: %d horizoncpupos1: %d\n&quot;</span>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a>);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">// just a check</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;horizoni: %d mycpupos[1]: %d horizoncpupos1: %d\n&quot;</span>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a3ac70e0bc8f102cca400733fb37c3f54" title="end changes after ...">horizoni</a>, <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1], <a class="code" href="../../d8/d5b/defs_8general_8h.html#a58b9fa3befcf1cde8e143386173d5960">horizoncpupos1</a>);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    trifprintf(<span class="stringliteral">&quot;end: find_horizon\n&quot;</span>);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;}</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0537d7b3c46e899adfe0fa3a0711d0d6">  682</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a0537d7b3c46e899adfe0fa3a0711d0d6">find_RinRout</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *localRin, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *localRout)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;{</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> X[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordtype">int</span> whichcpu;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">// assume outer radius is on outer CPU</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="comment">// only 1 CPU needs to get this</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  whichcpu=<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>-1;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">if</span>(myid==whichcpu){</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>, 0, 0, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, X);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a96290375e27d5d0aa4d843b07e228e14" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; V only">bl_coord_ijk</a>(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>, 0, 0, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, V);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    *localRout=V[1];</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a> &gt; 0) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="preprocessor"></span>    MPI_Bcast(localRout, 1, MPI_FTYPE, MPIid[whichcpu], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="comment">// assume inner radius is on inner CPU</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="comment">// only 1 CPU needs to get this</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  whichcpu=0;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">if</span>(myid==whichcpu){</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(0, 0, 0, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, X);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a96290375e27d5d0aa4d843b07e228e14" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; V only">bl_coord_ijk</a>(0, 0, 0, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, V);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    *localRin=V[1];</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a> &gt; 0) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="preprocessor"></span>    MPI_Bcast(localRin, 1, MPI_FTYPE, MPIid[whichcpu], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;}</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">// get dr(i=0)</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">// assumes black hole is at r=0</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="keywordtype">void</span> set_drsing(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;{</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a9a663b46497bd8f1608c548396d23320">dxdxp</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],X[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dr;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="comment">// assume BH r=0 is at inner radial boundary</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]==0){</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(0,0,0,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>,X);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a96290375e27d5d0aa4d843b07e228e14" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; V only">bl_coord_ijk</a>(0,0,0,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>,V);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a0672d8c0ee4ff07c7265d0ecbc365cdc" title="normally-used dxdxp[i,j,k] = dV/dX">dxdxprim_ijk</a>(0,0,0,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>,dxdxp);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    dr = (dxdxp[1][1]*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[1] + dxdxp[1][2]*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[2])/10.0; <span class="comment">// divide by 10 so doesn&#39;t dominate</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;%21.15g %21.15g %21.15g %21.15g\n&quot;,dxdxp[1][1],dx[1],dxdxp[1][2],dx[2]);</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordflow">else</span> dr=0;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="preprocessor"></span>  MPI_Allreduce(&amp;dr, &amp;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a33389dfee9e6524be223a3a422a5d1da">drsing</a>,1, MPI_FTYPE, MPI_MAX,MPI_COMM_GRMHD);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a33389dfee9e6524be223a3a422a5d1da">drsing</a>=dr;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;}</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">// get 1-D line over all CPUs that has the radius (only applicable if r(x_1) and not r(x_1,x_2)</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="keywordtype">void</span> set_rvsr(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;{</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> X[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordtype">int</span> ii;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> r;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// get radius for this CPU</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">// initialize full rcent for all CPUs, choosing value so that can use MAX over all CPUs and get answer we want</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <a class="code" href="../../d9/d37/global_8loops_8manypoints1d_8h.html#ab0ade3821d77fce9423873b67e8e6a4b">GRAVLOOP</a>(ii) <a class="code" href="../../d8/d5b/defs_8general_8h.html#adb9059dff5930dbf48234512353b9b27">rcent</a>[ii]=-1E30;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  j=0; <span class="comment">// assumes j==0 has same radial dependence as all other j (true if r(x_1))</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  k=0; <span class="comment">// as with j</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <a class="code" href="../../df/da8/global_8comploops_8h.html#a6dff454bec7d57821256d476d129cce7">COMPLOOPFP11</a>{</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, X);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a96290375e27d5d0aa4d843b07e228e14" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; V only">bl_coord_ijk</a>(i, j, k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>, V);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    r=V[1];</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    ii=<a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[1]+<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#adb9059dff5930dbf48234512353b9b27">rcent</a>[ii] = r;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="comment">// send information to myid=0 since only this processor needs rcent</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="preprocessor"></span>  MPI_Reduce(&amp;(<a class="code" href="../../d8/d5b/defs_8general_8h.html#adb9059dff5930dbf48234512353b9b27">rcent</a>[-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#aa00aaa6c09563827fbe601635b149ef8">N1BND</a>]),&amp;(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac13a98dcfba120d979164962aefc1ec7">rcent_tot</a>[-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#aa00aaa6c09563827fbe601635b149ef8">N1BND</a>]),<a class="code" href="../../d9/d37/global_8loops_8manypoints1d_8h.html#a01c3da500a0c545db969d13919a159ac">NUMGRAVPOS</a>,MPI_FTYPE,MPI_MAX,MPIid[0], MPI_COMM_GRMHD);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="comment">//  MPI_Reduce(rcent,rcent_tot,ncpux1*N1,MPI_FTYPE,MPI_MAX,MPIid[0], MPI_COMM_GRMHD);</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d9/d37/global_8loops_8manypoints1d_8h.html#ab0ade3821d77fce9423873b67e8e6a4b">GRAVLOOP</a>(ii) <a class="code" href="../../d8/d5b/defs_8general_8h.html#ac13a98dcfba120d979164962aefc1ec7">rcent_tot</a>[ii]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#adb9059dff5930dbf48234512353b9b27">rcent</a>[ii];</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">// determinant not simply transformed from analytic function -- so no analytic form possible yet</span></div>
<div class="line"><a name="l00801"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#ae5dbb2bc88f07e392d2a9e6b911c5c48">  801</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae5dbb2bc88f07e392d2a9e6b911c5c48">gdet_func_metric</a>(<span class="keywordtype">int</span> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#ab29c7802084b56a574b83eb818d2fdda">whichcoord</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a93300df7bd864b90cc8ed9f3d96515ad">gcov</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a597ef3c829c23db3a2637f8b3aefe240">gdet</a>)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;{</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordtype">int</span> jj,kk;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> generalmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordtype">int</span> toreturn;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">// copy to full 2D space for NR functions</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(jj,kk) generalmatrixlower[jj][kk] = gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(jj,kk)];</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  toreturn=gdet_func_singcheck(whichcoord, V,generalmatrixlower,gdet);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a89318355659561cf170e3b18f44409c5" title="whether to force gdet to be positive everywhere.">FORCEGDETPOSITIVE</a>==1){</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    *gdet=fabs(*gdet);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">return</span>(toreturn);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">// determinant not simply transformed from analytic function -- so no analytic form possible yet</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keywordtype">int</span> gdet_func_singcheck(<span class="keywordtype">int</span> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#ab29c7802084b56a574b83eb818d2fdda">whichcoord</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*generalmatrixlower)[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a597ef3c829c23db3a2637f8b3aefe240">gdet</a>)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;{</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a7eea66c80d4525808a408f782136362c">gdet_func_orig</a>(<span class="keywordtype">int</span> whichcoord,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*generalmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdet);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordtype">int</span> toreturn;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  toreturn=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a7eea66c80d4525808a408f782136362c">gdet_func_orig</a>(whichcoord, generalmatrixlower,gdet);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">#if(FLIPGDETAXIS)</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(whichcoord)){</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">if</span>(V[2]&lt;0.0) *gdet*=-1.0;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">if</span>(V[2]&gt;M_PI) *gdet*=-1.0;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordflow">return</span>(toreturn);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;}</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">// find determinant in general of a metric</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">/* assumes gcov has been set first; returns determinant */</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">// determinant not simply transformed from analytic function -- so no analytic form possible yet</span></div>
<div class="line"><a name="l00849"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a7eea66c80d4525808a408f782136362c">  849</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a7eea66c80d4525808a408f782136362c">gdet_func_orig</a>(<span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*generalmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdet)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;{</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> d;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, indx[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordtype">int</span> singfix;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordtype">int</span> anglesing,centersing,truedim;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> finalvalue;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">int</span> firstc = 1;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordflow">if</span> (firstc) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    firstc = 0;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  singfix=0;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor">#if(1)</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="preprocessor"></span>  <span class="comment">// check for coordinate singularity (using this avoids bad input to ludcmp())</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  metric_sing_check(whichcoord, generalmatrixlower, &amp;anglesing, &amp;centersing, &amp;truedim);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="preprocessor"></span>  truedim=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) tmp[j + 1][k + 1] = generalmatrixlower[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k];</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">if</span>(ludcmp(tmp, truedim, indx - 1, &amp;d)&gt;=1){</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ludcmp failure in gdet_func_orig\n&quot;</span>);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="preprocessor">#if(1)</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(whichcoord)){</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <span class="comment">// super hack</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Assuming on polar axis\n&quot;</span>);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      singfix=1;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ludcmp failure 2: whichcoord=%d\n&quot;</span>,whichcoord);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      myexit(3477);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ludcmp failure: Can&#39;t assume on polar axis for whichcoord=%d\n&quot;</span>,whichcoord);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    myexit(246);</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keywordflow">if</span>(singfix==0 || truedim&lt;NDIM){</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="comment">// below from 1..NDIM due to ludcmp requiring 1..N</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">for</span> (j = 1; j &lt;= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; j++) d *= tmp[j][j];</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span>(d&gt;0.0 &amp;&amp; d&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>){</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      finalvalue=0.0;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(d&gt;0.0){</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Metric has bad signature: d=%21.15g\n&quot;</span>,d);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;generalmatrixlower[%d][%d]=%21.15g\n&quot;</span>,j,k,generalmatrixlower[j][k]); <span class="comment">// generalmatrixlower[][] is 2d array since using NR routines.</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      myexit(3478);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      finalvalue=sqrt(-d);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    finalvalue=0.0;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  free_dmatrix(tmp, 1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  *gdet=finalvalue;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordflow">if</span>(singfix) <span class="keywordflow">return</span>(-1); <span class="comment">// indicates some problem, may want to report a bit</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;}</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">// t-r inverse only (for r=0 coordinate singularity)</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">// NDIM in size, but invert submatrix that&#39;s 2x2 in size</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="keywordtype">void</span> matrix_inverse_2d(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM])</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;{</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordtype">int</span> jj,kk;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(jj,kk) genmatrixupper[jj][kk] = 0.0;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  genmatrixupper[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>] = 1.0/(-genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]*genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]/genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>] + genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  genmatrixupper[TT][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>] = genmatrixupper[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>][TT] = -genmatrixlower[TT][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]/(-genmatrixlower[TT][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]*genmatrixlower[TT][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>] + genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]*genmatrixlower[TT][TT]);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  genmatrixupper[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>] = 1.0/(-genmatrixlower[TT][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]*genmatrixlower[TT][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]/genmatrixlower[TT][TT] + genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;}</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">// t-r-\theta inverse only (for \theta={0,\pi} coordinate singularities)</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">// NDIM in size, but invert submatrix that&#39;s 3x3 in size</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="keywordtype">void</span> matrix_inverse_3d(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM])</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;{</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordtype">int</span> jj,kk;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> genmatrixlowerrhsq,genmatrixlowertrsq,genmatrixlowerthsq;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(jj,kk) genmatrixupper[jj][kk] = 0.0;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  genmatrixlowerrhsq = genmatrixlower[RR][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8ccbf4850176503992b0295081d5f4bc">TH</a>]*genmatrixlower[RR][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8ccbf4850176503992b0295081d5f4bc">TH</a>];</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  genmatrixlowertrsq = genmatrixlower[TT][RR]*genmatrixlower[TT][RR];</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  genmatrixlowerthsq = genmatrixlower[TT][TH]*genmatrixlower[TT][TH];</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  genmatrixupper[TT][TT]=(genmatrixlowerrhsq - genmatrixlower[TH][TH]*genmatrixlower[RR][RR])/(genmatrixlower[RR][RR]*genmatrixlowerthsq - 2.0*genmatrixlower[RR][TH]*genmatrixlower[TT][TH]*genmatrixlower[TT][RR] + genmatrixlower[TH][TH]*genmatrixlowertrsq + genmatrixlowerrhsq*genmatrixlower[TT][TT] - genmatrixlower[TH][TH]*genmatrixlower[RR][RR]*genmatrixlower[TT][TT]);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  genmatrixupper[TT][RR]=genmatrixupper[RR][TT]=(-(genmatrixlower[RR][TH]*genmatrixlower[TT][TH]) + genmatrixlower[TH][TH]*genmatrixlower[TT][RR])/(-2.0*genmatrixlower[RR][TH]*genmatrixlower[TT][TH]*genmatrixlower[TT][RR] + genmatrixlower[TH][TH]*genmatrixlowertrsq + genmatrixlowerrhsq*genmatrixlower[TT][TT] + genmatrixlower[RR][RR]*(genmatrixlowerthsq - genmatrixlower[TH][TH]*genmatrixlower[TT][TT]));</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  genmatrixupper[TT][TH]=genmatrixupper[TH][TT]=(genmatrixlower[RR][RR]*genmatrixlower[TT][TH] - genmatrixlower[RR][TH]*genmatrixlower[TT][RR])/(genmatrixlower[RR][RR]*genmatrixlowerthsq - 2.0*genmatrixlower[RR][TH]*genmatrixlower[TT][TH]*genmatrixlower[TT][RR] + genmatrixlower[TH][TH]*genmatrixlowertrsq + genmatrixlowerrhsq*genmatrixlower[TT][TT] - genmatrixlower[TH][TH]*genmatrixlower[RR][RR]*genmatrixlower[TT][TT]);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  genmatrixupper[RR][RR]=(genmatrixlowerthsq - genmatrixlower[TH][TH]*genmatrixlower[TT][TT])/(genmatrixlower[RR][RR]*genmatrixlowerthsq - 2.0*genmatrixlower[RR][TH]*genmatrixlower[TT][TH]*genmatrixlower[TT][RR] + genmatrixlower[TH][TH]*genmatrixlowertrsq + genmatrixlowerrhsq*genmatrixlower[TT][TT] - genmatrixlower[TH][TH]*genmatrixlower[RR][RR]*genmatrixlower[TT][TT]);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  genmatrixupper[RR][TH]=genmatrixupper[TH][RR]=(-(genmatrixlower[TT][TH]*genmatrixlower[TT][RR]) + genmatrixlower[RR][TH]*genmatrixlower[TT][TT])/(-2.0*genmatrixlower[RR][TH]*genmatrixlower[TT][TH]*genmatrixlower[TT][RR] + genmatrixlower[TH][TH]*genmatrixlowertrsq + genmatrixlowerrhsq*genmatrixlower[TT][TT] + genmatrixlower[RR][RR]*(genmatrixlowerthsq - genmatrixlower[TH][TH]*genmatrixlower[TT][TT]));</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  genmatrixupper[TH][TH]=(genmatrixlowertrsq - genmatrixlower[RR][RR]*genmatrixlower[TT][TT])/(genmatrixlower[RR][RR]*genmatrixlowerthsq - 2.0*genmatrixlower[RR][TH]*genmatrixlower[TT][TH]*genmatrixlower[TT][RR] + genmatrixlower[TH][TH]*genmatrixlowertrsq + genmatrixlowerrhsq*genmatrixlower[TT][TT] - genmatrixlower[TH][TH]*genmatrixlower[RR][RR]*genmatrixlower[TT][TT]);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;}</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">// wrapper for symmetric matrix</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="keywordtype">void</span> matrix_inverse_metric(<span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a93300df7bd864b90cc8ed9f3d96515ad">gcov</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a98399a5a291e3844900ecfbacdcb2da0">gcon</a>)</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;{</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> genmatrixupper[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordtype">int</span> jj,kk;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="comment">// copy both in case both needed for some reason</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(jj,kk) genmatrixlower[jj][kk]=gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(jj,kk)];</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(jj,kk) genmatrixupper[jj][kk]=gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(jj,kk)];</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <a class="code" href="../../d6/d1b/metric_8tools_8c.html#af5438dd54272eb585ff5acb06d7195d4">matrix_inverse</a>(whichcoord, genmatrixlower, genmatrixupper);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="comment">// translate back</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(jj,kk) gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(jj,kk)]=genmatrixupper[jj][kk];</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;}</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">/* invert genmatrixlower to get genmatrixupper */</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">// can be used to invert any 2nd rank tensor (symmetric or not)</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">// actually returns the inverse transpose, so if</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">// genmatrixlower=T^j_k then out pops (iT)^k_j such that T^j_k (iT)^k_l = \delta^j_l</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#af5438dd54272eb585ff5acb06d7195d4"> 1009</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#af5438dd54272eb585ff5acb06d7195d4">matrix_inverse</a>(<span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM])</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;{</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordtype">int</span> anglesing,centersing,truedim;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordtype">void</span> metric_sing_check(<span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <span class="keywordtype">int</span> *anglesing, <span class="keywordtype">int</span>*centersing, <span class="keywordtype">int</span> *truedim);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordtype">void</span> matrix_inverse_2d(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM]);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keywordtype">void</span> matrix_inverse_3d(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM]);  </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">int</span> firstc = 1;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordflow">if</span> (firstc) {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    firstc = 0;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) tmp[j + 1][k + 1] = genmatrixlower[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k];</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="preprocessor">#if(1)</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="preprocessor"></span>  <span class="comment">// check for singularities</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="comment">// only truedim used</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="comment">// allow avoiding of gaussj fail as detection of singularity</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  metric_sing_check(whichcoord, genmatrixlower, &amp;anglesing, &amp;centersing, &amp;truedim);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;anglesing=%d centersing=%d truedim=%d\n&quot;,anglesing,centersing,truedim);</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="preprocessor"></span>  truedim=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">// 0-out all genmatrixupper</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) genmatrixupper[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k]=0.0;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="comment">//  DLOOP(j,k) dualfprintf(fail_file,&quot;tmp[%d][%d]=%21.15g\n&quot;,j+1,k+1,tmp[j+1][k+1]);</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="comment">// GODMARK: Feeding in nan&#39;s results in gaussj segfaulting with erroneous access.  Seems bad behavior!</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordflow">if</span>(gaussj(tmp, truedim, NULL, 0)){</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="comment">// then singular</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="preprocessor">#if(0) // new singularity check before if(gaussj) should work</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(whichcoord)){</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="comment">// super hack</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="comment">//if(centersing)  matrix_inverse_2d(genmatrixlower,genmatrixupper);</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="comment">//      else if(anglesing) matrix_inverse_3d(genmatrixlower,genmatrixupper);</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      matrix_inverse_2d(genmatrixlower,genmatrixupper);</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;whichcoord=%d\n&quot;</span>,whichcoord);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      myexit(6243);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="preprocessor"></span>    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Singularity check didn&#39;t work\n&quot;</span>);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;whichcoord=%d anglesing=%d centersing=%d truedim=%d\n&quot;</span>,whichcoord,anglesing,centersing,truedim);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;inputmatrix[%d][%d]=%21.15g\n&quot;</span>,j,k,genmatrixlower[j][k]);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    myexit(2714);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  }</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">// assign but also transpose (shouldn&#39;t do in general, confusing)</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="comment">//DLOOP(j,k) genmatrixupper[j][k] = tmp[k + 1][j + 1];</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) genmatrixupper[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = tmp[j + 1][k + 1];</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  }</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="preprocessor">#if(1) // check for nan&#39;s</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) <span class="keywordflow">if</span>(!finite(genmatrixupper[j][k])){</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Came out of matrix_inverse with inf/nan for genmatrixupper at j=%d k=%d\n&quot;</span>,j,k);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    myexit(5);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  free_dmatrix(tmp, 1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;}</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">/* invert genmatrixlower to get genmatrixupper */</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">// can be used to invert any 2nd rank tensor (symmetric or not)</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">// actually returns the inverse transpose, so if</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">// genmatrixlower=T^j_k then out pops (iT)^k_j such that T^j_k (iT)^k_l = \delta^j_l</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="keywordtype">void</span> matrix_inverse_gen(<span class="keywordtype">int</span> truedim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM])</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;{</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">int</span> firstc = 1;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="keywordflow">if</span> (firstc) {</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    firstc = 0;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  }</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) tmp[j + 1][k + 1] = genmatrixlower[j][k];</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="comment">// 0-out all genmatrixupper</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) genmatrixupper[j][k]=0.0;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  if(gaussj(tmp, truedim, NULL, 0)){</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="comment">// then singular</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Singularity\n&quot;</span>);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,&quot;inputmatrix[%d][%d]=%21.15g\n&quot;,j,k,genmatrixlower[j][k]);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    myexit(2715);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  else{</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">// assign but also transpose (shouldn&#39;t do in general, confusing)</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="comment">//DLOOP(j,k) genmatrixupper[j][k] = tmp[k + 1][j + 1];</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) genmatrixupper[j][k] = tmp[j + 1][k + 1];</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="preprocessor">#if(1) // check for nan&#39;s</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) if(!finite(genmatrixupper[j][k])){</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Came out of matrix_inverse_gen with inf/nan for genmatrixupper at j=%d k=%d\n&quot;</span>,j,k);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    myexit(5);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  }</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  free_dmatrix(tmp, 1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;}</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">/* invert genmatrixlower to get genmatrixupper */</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">// can be used to invert any 2nd rank tensor (symmetric or not)</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">// actually returns the inverse transpose, so if</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">// genmatrixlower=T^j_k then out pops (iT)^k_j such that T^j_k (iT)^k_l = \delta^j_l</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="keywordtype">void</span> matrix_inverse_4d(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM])</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;{</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="keywordtype">void</span> matrix_inverse_2d(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM]);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="keywordtype">void</span> matrix_inverse_3d(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixupper)[NDIM]);  </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">int</span> firstc = 1;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> **tmp;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="keywordflow">if</span> (firstc) {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    tmp = dmatrix(1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    firstc = 0;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  }</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) tmp[j + 1][k + 1] = genmatrixlower[j][k];</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordtype">int</span> truedim=NDIM;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="comment">// 0-out all genmatrixupper</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) genmatrixupper[j][k]=0.0;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">//  DLOOP(j,k) dualfprintf(fail_file,&quot;tmp[%d][%d]=%21.15g\n&quot;,j+1,k+1,tmp[j+1][k+1]);</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <span class="comment">// GODMARK: Feeding in nan&#39;s results in gaussj segfaulting with erroneous access.  Seems bad behavior!</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  if(gaussj(tmp, truedim, NULL, 0)){</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="comment">// then singular</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Singular\n&quot;</span>);</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) dualfprintf(fail_file,&quot;inputmatrix[%d][%d]=%21.15g\n&quot;,j,k,genmatrixlower[j][k]);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    myexit(2714);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  else{</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">// assign but also transpose (shouldn&#39;t do in general, confusing)</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="comment">//DLOOP(j,k) genmatrixupper[j][k] = tmp[k + 1][j + 1];</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) genmatrixupper[j][k] = tmp[j + 1][k + 1];</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="preprocessor">#if(1) // check for nan&#39;s</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) if(!finite(genmatrixupper[j][k])){</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Came out of matrix_inverse_4d with inf/nan for genmatrixupper at j=%d k=%d\n&quot;</span>,j,k);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    myexit(5);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="preprocessor"></span>  <span class="comment">// maintain thread safety</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  free_dmatrix(tmp, 1, NDIM, 1, NDIM);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;}</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="keywordtype">void</span> metric_sing_check(<span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*genmatrixlower)[NDIM], <span class="keywordtype">int</span> *anglesing, <span class="keywordtype">int</span>*centersing, <span class="keywordtype">int</span> *truedim)</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;{</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">// check for singularity (always removes highest coordinates -- so can use same matrix inverse with lower dimension when on coordinate singularities)</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  *anglesing=0;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  *centersing=0;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(whichcoord)){</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">if</span>(fabs(genmatrixlower[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae0fcc909f5a4166b625a6707cbdfa643">PH</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae0fcc909f5a4166b625a6707cbdfa643">PH</a>])&lt;10.0*<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>){</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      *anglesing=1;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">if</span>(fabs(genmatrixlower[TH][TH])&lt;10.0*<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>){</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      *centersing=1;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordflow">if</span>(*centersing){</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      *truedim=NDIM-2;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(*anglesing){</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      *truedim=NDIM-1;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    }</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordflow">else</span> *truedim=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  }</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">else</span> *truedim=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;}</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">// compute the radius of the inner most stable circular orbit</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rmso_calc(<span class="keywordtype">int</span> which)</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;{</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rmso,Z1,Z2,<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a> ;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  j=<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa73cf2d397cae726436e08d2c891bdb0">a</a>/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>); <span class="comment">// so doesn&#39;t nan for MBH=0 since &quot;a&quot; should be &quot;0&quot; if MBH=0</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordflow">if</span>(which==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a571d9963a240dbb4dd863b248ee0ff34">PROGRADERISCO</a>) sign=1; <span class="keywordflow">else</span> sign=-1;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  Z1 = 1. + pow(1. - j*j,1./3.)*(pow(1. + j,1./3.) +</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                                 pow(1. - j, 1./3.)) ;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  Z2 = sqrt(fabs(3.*j*j + Z1*Z1)) ;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  rmso=3. + Z2-sign*sqrt(fabs(3. - Z1)*fabs(3. + Z1 + 2.*Z2)) ;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">return</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>*rmso) ;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;}</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div>
<div class="line"><a name="l01292"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#a5ac38d54092c8021a39c3136426e402c"> 1292</a></span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#acb54f8ab3c1388bf533e7aecd6509794">uphi_isco_calc</a>(<span class="keywordtype">int</span> which,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rold)</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;{</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> uphi;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Z1,Z2;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,rnew;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  rnew=rold/<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  j=<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa73cf2d397cae726436e08d2c891bdb0">a</a>/<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  <span class="keywordflow">if</span>(which==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a571d9963a240dbb4dd863b248ee0ff34">PROGRADERISCO</a>) sign=1; <span class="keywordflow">else</span> sign=-1;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  Z1=rnew*rnew-sign*2.*j*sqrt(rnew)+j*<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  Z2=rnew*(rnew*rnew-3.*rnew+sign*2.*j*sqrt(rnew));</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  uphi=sign*Z1/sqrt(Z2);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="keywordflow">return</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>*uphi);</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;}</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rhor_calc(<span class="keywordtype">int</span> which)</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;{</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>,rhor;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,jsq,disc;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  j=<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa73cf2d397cae726436e08d2c891bdb0">a</a>/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>); <span class="comment">// so doesn&#39;t nan for MBH=0 since &quot;a&quot; should be &quot;0&quot; if MBH=0</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  jsq=j*<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="keywordflow">if</span>(which==0) sign=1; <span class="keywordflow">else</span> sign=-1;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  disc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(1.0 - jsq,0.0);</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  rhor=1. +sign*sqrt(disc);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="keywordflow">return</span>(rhor*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1fb64169459d57727a61a72b6e01ced5">MBH</a>);</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;}</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">// </span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">// below are independent of user choice of metric/coords/grid</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">// </span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">// presume get_geometry() only necessarily feeds back pointer where geometry is located</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">// still required to have pointer point to physical allocated memory in general</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#a2cae56010745f154527f822d6074c95b"> 1342</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#adba02d76daa0e901bc1b8e31c28421ab">get_and_copy_geometry</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> loc, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;{</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeomorig;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  ptrgeomorig=ptrgeom;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  </div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a3059ed7bfcfb692cbe8014d55fd7c1e4">get_geometry</a>(i,j,k,loc,ptrgeom); <span class="comment">// potentially overwrites ptrgeom</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  </div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">if</span>(ptrgeom!=ptrgeomorig){</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="comment">// direct copy of geometry structure</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    *ptrgeomorig=*ptrgeom;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  </div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;}</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">// set igdet part of geometry since more expensive and not always needed</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="keywordtype">void</span> set_igdet_old(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;{</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="comment">// avoids 0.0 for any sign of ptrgeom-&gt;e[pl]</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="preprocessor">#if(GDETVOLDIFF==0)</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  geom-&gt;igdetnosing = <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(geom-&gt;gdet)/(fabs(geom-&gt;gdet)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="comment">// use PALLLOOP so compiler can optimize</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="preprocessor">#if(WHICHEOM!=WITHGDET)</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) geom-&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a6d808515c6c005e51aeefb326bc04515">IEOMFUNCNOSINGMAC</a>(pl) = sign(geom-&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ab3032b7a358cd8a18da35ab6936a265c">EOMFUNCMAC</a>(pl))/(fabs(geom-&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ab3032b7a358cd8a18da35ab6936a265c">EOMFUNCMAC</a>(pl))+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="preprocessor"></span>  <span class="comment">// required to set to something since in general refer to this</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) geom-&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a6d808515c6c005e51aeefb326bc04515">IEOMFUNCNOSINGMAC</a>(pl)=geom-&gt;igdetnosing;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">// volume regularization (correct to second order) // GODMARK: NOT FOR FINITE VOLUME WENO METHOD</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  igdetnosing = <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(geom-&gt;gdetvol)/(fabs(geom-&gt;gdetvol)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  geom-&gt;igdetnosing = igdetnosing;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="comment">// use PALLLOOP so compiler can optimize</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) geom-&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a6d808515c6c005e51aeefb326bc04515">IEOMFUNCNOSINGMAC</a>(pl) = igdetnosing;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;}</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">// set igdet part of geometry since more expensive and not always needed</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="keywordtype">void</span> set_igdetsimple_old(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom)</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;{</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="preprocessor">#if(WHICHEOM!=WITHGDET)</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="preprocessor"></span>  dualfprintf(fail_file,<span class="stringliteral">&quot;Using set_igdetsimple() but WHICHEOM!=WITHGDET\n&quot;</span>);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  myexit(342968347);</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="comment">// avoids 0.0 for any sign of ptrgeom-&gt;e[pl]</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="preprocessor">#if(GDETVOLDIFF==0)</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="preprocessor"></span>  geom-&gt;igdetnosing = <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(geom-&gt;gdet)/(fabs(geom-&gt;gdet)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="comment">// volume regularization (correct to second order) // GODMARK: NOT FOR FINITE VOLUME WENO METHOD</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  igdetnosing = <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a1e471b644e7fd684cd5dbb144e00ee81">sign</a>(geom-&gt;gdetvol)/(fabs(geom-&gt;gdetvol)+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  geom-&gt;igdetnosing = igdetnosing;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;}</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">// obtain prime or non-prime alphalapse</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#af202c80e27da736cefdcfb32b58f2d50"> 1418</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#af202c80e27da736cefdcfb32b58f2d50">alphalapse_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#aba79df536b86921bebbe2b33fb409b68">getprim</a>, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *alphalapse)</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;{</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="comment">// set alpha -- fabs just for roundoff error</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="comment">// Note ptrgeom only has i,j,k,loc at this point</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  *alphalapse = 1.0/sqrt(fabs(-gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,TT)]));</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;}</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">// obtain \beta^2</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#ae1e83b3070698bfd965333b1de3c316f"> 1428</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae1e83b3070698bfd965333b1de3c316f">betasqoalphasq_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#aba79df536b86921bebbe2b33fb409b68">getprim</a>, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *betasqoalphasq)</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;{</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="comment">// \beta^i \beta_i / \alpha^2 = g^{ti} g_{ti}</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  *betasqoalphasq = 0.0;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aa97638a87093a4efe2bece0de87093cc" title="loop over all Space dimensions; first rank loop">SLOOPA</a>(j) *betasqoalphasq += (gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,j)])*(gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,j)]);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;}</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="comment">// obtain \beta^i</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#a2a46942b789b8a05a90cfc89bf71d678"> 1439</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a2a46942b789b8a05a90cfc89bf71d678">beta_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#aba79df536b86921bebbe2b33fb409b68">getprim</a>, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> alphalapse, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d8/d60/init_8c.html#a355acd73443366a551c12ccc7eab9f52">beta</a>)</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;{</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> alphasq;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  alphasq=alphalapse*alphalapse;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// \beta^\mu = {0,\alpha^2 g^{ti}}</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  beta[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=0.0;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aa97638a87093a4efe2bece0de87093cc" title="loop over all Space dimensions; first rank loop">SLOOPA</a>(j) beta[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] = gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,j)]*alphasq ;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  </div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;}</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment">// find the con/cov forms of the chosen metric</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="keywordtype">void</span> gset(<span class="keywordtype">int</span> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#aba79df536b86921bebbe2b33fb409b68">getprim</a>, <span class="keywordtype">int</span> whichcoord, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom)</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;{</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <span class="comment">// assumes loc=CENT</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordtype">int</span> loc;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  loc=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  gset_genloc(getprim, whichcoord, i, j, k, loc, ptrgeom);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;}</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">// find the con/cov forms of the chosen metric</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment">// fills in information like get_geometry but for arbitrary metric not just PRIMECOORDS</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">// GODMARK: doesn&#39;t yet set igdet&#39;s</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">// NOTE:</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">// This function returns contents of ptrgeom when not necessarily internal coordinate system</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">// So this function should be quite similar to set_grid.c for that part setting ptrgeom contents, but really setting contents rather than looking them up</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="keywordtype">void</span> gset_genloc(<span class="keywordtype">int</span> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#aba79df536b86921bebbe2b33fb409b68">getprim</a>, <span class="keywordtype">int</span> whichcoord, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> loc, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;{</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> X[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">if</span>(whichcoord&gt;=0){</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(i, j, k, loc, X);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(whichcoord==<a class="code" href="../../d2/dbf/metric_8h.html#a401668353c0216165cf6f1c7b2d34e94">PRIMECOORDS</a>){ <span class="comment">// special case</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">// won&#39;t neeed X .  Assumes user never requests PRIMECOORDS unless on grid.  User should call getprim=1 with whichcoord&gt;=0 for normal coordinates in prime coords</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  }</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;gset(): no such whichcoord=%d\n&quot;</span>,whichcoord);</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    myexit(3466);</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  }</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  gset_X(getprim, whichcoord, i, j, k, loc, X, ptrgeom);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;}</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">// find the con/cov forms of the chosen metric</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">// fills in information like get_geometry but for arbitrary metric not just PRIMECOORDS</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">// GODMARK: doesn&#39;t yet set igdet&#39;s</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">// NOTE:</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">// This function returns contents of ptrgeom when not necessarily internal coordinate system</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">// So this function should be quite similar to set_grid.c for that part setting ptrgeom contents, but really setting contents rather than looking them up</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">// i,j,k,loc can be filled or loc=NOWHERE then recomputes bl_coord()</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="keywordtype">void</span> gset_X(<span class="keywordtype">int</span> getprim, <span class="keywordtype">int</span> whichcoord, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> loc, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom)</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;{</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> tempgeom;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">void</span> assign_eomfunc(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a79f1117a7b76f818853fb81739de8095" title="this should be only place eomfunc[] or ieomfuncnosing[] are referred to! special cases: =GLOBALMETMAC...">EOMFUNCNAME</a>);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> getprim, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert);</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d9/d53/metric_8c.html#a9aa4d60510a1e0ce7ccf8c6548533559" title="obtain prim gcon in primcoords of whichcoord type metric/coords">gcon_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> getprim, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcon);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovptr;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gconptr;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpertptr;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  ptrgeom-&gt;i=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  ptrgeom-&gt;j=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  ptrgeom-&gt;k=k;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  ptrgeom-&gt;p=loc;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="preprocessor">#if(GETGEOMUSEPOINTER==0 || NEWMETRICSTORAGE==1)</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="preprocessor"></span>  <span class="comment">// then ptrgeom-&gt;gcov,gcon,gcovpert are real memory spaces</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  gcovptr=ptrgeom-&gt;gcov;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  gconptr=ptrgeom-&gt;gcon;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  gcovpertptr=ptrgeom-&gt;gcovpert;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="preprocessor"></span>  <span class="comment">// then need to use dummy pointer space that has real memory assigned</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  gcovptr=ptrgeom-&gt;gengcov;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  gconptr=ptrgeom-&gt;gengcon;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  gcovpertptr=ptrgeom-&gt;gengcovpert;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  ptrgeom-&gt;gcov=ptrgeom-&gt;gengcov; <span class="comment">// pointer</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  ptrgeom-&gt;gcon=ptrgeom-&gt;gengcon; <span class="comment">// pointer</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  ptrgeom-&gt;gcovpert=ptrgeom-&gt;gengcovpert; <span class="comment">// pointer</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="keywordflow">if</span>(whichcoord&gt;=0){</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordflow">if</span>(X==NULL) <a class="code" href="../../d9/de9/coord_8c.html#a1e1d4fd69f1234cb8751c4ea66297995" title="normally-used bl_coord[i,j,k] {i,j,k} -&gt; X only">coord_ijk</a>(i, j, k, loc, X); <span class="comment">// user passes X if X==NULL</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    bl_coord_ijk_2(i, j, k, loc, X, V);</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(ptrgeom,getprim,whichcoord,X,gcovptr,gcovpertptr);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="comment">// must come after gcov_func() above</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae5dbb2bc88f07e392d2a9e6b911c5c48">gdet_func_metric</a>(whichcoord,V,gcovptr,&amp;(ptrgeom-&gt;gdet))!=0){</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Caught gdet_func_metric() problem in gset_genloc()\n&quot;</span>);</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    }</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <a class="code" href="../../d9/d53/metric_8c.html#a9aa4d60510a1e0ce7ccf8c6548533559" title="obtain prim gcon in primcoords of whichcoord type metric/coords">gcon_func</a>(ptrgeom,getprim,whichcoord,X,gcovptr,gconptr); <span class="comment">// must come after gcov_func() above</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <a class="code" href="../../d6/d1b/metric_8tools_8c.html#af202c80e27da736cefdcfb32b58f2d50">alphalapse_func</a>(ptrgeom,getprim,whichcoord,X,gcovptr,gconptr,&amp;(ptrgeom-&gt;alphalapse));</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae1e83b3070698bfd965333b1de3c316f">betasqoalphasq_func</a>(ptrgeom,getprim,whichcoord,X,gcovptr,gconptr,&amp;(ptrgeom-&gt;betasqoalphasq));</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a2a46942b789b8a05a90cfc89bf71d678">beta_func</a>(ptrgeom,getprim,whichcoord,X,gcovptr,gconptr,ptrgeom-&gt;alphalapse,ptrgeom-&gt;beta);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    eomfunc_func(ptrgeom, getprim, whichcoord,X,&amp;(ptrgeom-&gt;EOMFUNCMAC(0)));</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    assign_eomfunc(ptrgeom,&amp;(ptrgeom-&gt;EOMFUNCMAC(0))); <span class="comment">// must come after assigning ptrgeom-&gt;g above (won&#39;t use eomfuncgen if WHICHEOM==WITHGDET)</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="preprocessor">#if(GDETVOLDIFF)</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="preprocessor"></span>    <span class="comment">// uses X,V (not det) from all locations</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <a class="code" href="../../d9/d53/metric_8c.html#a5abb16fde142db59624fe7c0d165eef5" title="geometry only contains i,j,k,p only for spherical polar coordinates with negligible relativistic effe...">gdetvol_func</a>(ptrgeom,ptrgeom-&gt;gdet,&amp;(ptrgeom-&gt;EOMFUNCMAC(0)),ptrgeom-&gt;gdetvol);</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="preprocessor"></span>    set_igdet_old(ptrgeom); <span class="comment">// full 1/gdet and 1/EOMFUNCMAC(pl)</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(whichcoord==<a class="code" href="../../d2/dbf/metric_8h.html#a401668353c0216165cf6f1c7b2d34e94">PRIMECOORDS</a>){ <span class="comment">// special case</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <a class="code" href="../../d6/d1b/metric_8tools_8c.html#adba02d76daa0e901bc1b8e31c28421ab">get_and_copy_geometry</a>(i,j,k,loc,ptrgeom);</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  }</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;gset(): no such whichcoord=%d\n&quot;</span>,whichcoord);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    myexit(3466);</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;}</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">//void SHOULDNOTREACHHEREEVERBUGYOUHAVE(void)</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">//{</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">//  exit(1);</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div>
<div class="line"><a name="l01577"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a679ef21784b0e4cf643c89d44ee38d9a"> 1577</a></span>&#160;<span class="preprocessor">#define OPTMETRICLOOP 1 // whether to use highly optmized loop (assumes metric is symmetric)</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#af3fe70c70f939fa2091a2772893e5ed7"> 1578</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define COMPUTEPERTURBEDMETRIC 0 // GODMARK: NOT CORRECT RIGHT NOW, so do NOT do it</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01580"></a><span class="lineno"><a class="code" href="../../dc/dd2/newcodediff_8txt.html#ac436ae06ee28eed00b64838c83661111"> 1580</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#aa8128748c3d99802f8c4d3e46eb81ee9">gcov2gcovprim</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovprim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpertprim)</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;{</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, l, m;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dxdxp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ftemp1,ftemp2;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="keywordtype">int</span> q;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <span class="comment">// now take term by term:</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  <span class="comment">// g_{u v} = \vec{e_{\mu}}\cdot\vec{e_{\nu}} </span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="comment">//           * (dx/dx&#39;)_{mu} * (dx/dx&#39;)_{\nu} =</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="comment">//          \vec{e&#39;_{\mu}}\cdot\vec{e&#39;_{\nu}} </span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="comment">// dx/dx&#39; where &#39;=prim coords (i.e. nonuni coords)</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;gcov2gcovprim: i=%d p=%d\n&quot;,ptrgeom-&gt;i,ptrgeom-&gt;p);</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  dxdxprim_ijk_2(ptrgeom,X,V,dxdxp);</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="preprocessor">#if(OPTMETRICLOOP==0)</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k){</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = 0.;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;l++) <span class="keywordflow">for</span>(m=0;m&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;m++){</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <span class="comment">// g_{mup nup} = g_{mu nu} T^mu_mup T^nu_nup</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        <span class="comment">// where T^mu_mup == dx^mu[BL]/dx^mup[KSP uni grid]</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] += <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a9cafebe4358571ae4a05b8af833f17" title="must multiply assignments by the below so don&#39;t duplicate sums">GINDASSIGNFACTOR</a>(j,k)*gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(l,m)] * dxdxp[l][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] * dxdxp[m][k];</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      }</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k){</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    <span class="comment">// also must be outside above DLOOP because tempgcov can be reset to zero if GINDASSIGNFACTOR is zero, and then gcovprim would be zero, but that normally points also to gcov!</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="comment">// use tmpgcov since gcon might be same address as gcovprim</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)];</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  }</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a645377006a6bb3b11a14105e704f3c0d">transgcov</a>(gcov,dxdxp,gcovprim);</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="comment">//  DLOOP(j,k) dualfprintf(fail_file,&quot;prim gcov[%d][%d]=%21.15g\n&quot;,j,k,gcov[GIND(j,k)]);</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  <span class="comment">//  DLOOP(j,k) dualfprintf(fail_file,&quot;prim gcovprim[%d][%d]=%21.15g\n&quot;,j,k,gcovprim[GIND(j,k)]);</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  <span class="comment">//  DLOOP(j,k) dualfprintf(fail_file,&quot;prim dxdxp[%d][%d]=%21.15g\n&quot;,j,k,dxdxp[j][k]);</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae3bffdfbdfdf3391abc1cf67b4d5c9b8">get_gcovpert</a>(gcovprim,gcovpert,gcovpertprim);</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160; </div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;}</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">// get perturbed part of gcov</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#ae3bffdfbdfdf3391abc1cf67b4d5c9b8"> 1631</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae3bffdfbdfdf3391abc1cf67b4d5c9b8">get_gcovpert</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovprim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpertprim)</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;{</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, l, m;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ftemp1,ftemp2;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="keywordtype">int</span> q;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="comment">// perturbed terms</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="preprocessor">#if(COMPUTEPERTURBEDMETRIC)</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="preprocessor"></span>  <span class="comment">// SUPERGODMARK GODMARK: This only works for non-rel gravity if dxdxp is diagonal.  Not sure what to do in general</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(q){</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;gcovpert[%d]=%21.15g\n&quot;,q,gcovpert[q]);</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="comment">// get q-q term</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="comment">// -1 + g_{q&#39;q&#39;} for q!=TT, else  SOMECONSTANT + g_{q&#39;q&#39;} for q=TT</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="comment">// for spatial parts, only care about deviations from constant in getting connection coefficients</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="comment">// avoids catastrophic cancellation (GODMARK)</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">if</span>( (q!=TT)&amp;&amp;(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a07aa730709566649748925d2ae0aae77">defcoord</a>==<a class="code" href="../../d7/d56/coord_8h.html#a47b225226fbd0e3e573ec095071ecc10">UNIFORMCOORDS</a>)) ftemp1=0.0;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="comment">// then unsure how to handle in general, so just leave alone (SUPERGODMARK GODMARK)</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// problem is with machine error in dxdxp leading to apparently large connection coefficients due to that machine error</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// also don&#39;t know ahead of time what constant to choose for prim coordinate quantities</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="comment">// and don&#39;t know how to handle variations in dxdxp, since then no constant to subtract off, but grid accelerations apparently wash out non-rel gravity accelerations?</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="comment">// except for time term, which is solid</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">else</span> ftemp1=(-1.0 + dxdxp[q][q] * dxdxp[q][q]);</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="keywordflow">if</span>(q==TT) ftemp1 *=-1.0;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    gcovpertprim[q]  = (gcovpert[q] * dxdxp[q][q] * dxdxp[q][q]) + ftemp1;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="comment">// now add 15 other terms</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    ftemp2 = 0.;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;l++) <span class="keywordflow">for</span>(m=0;m&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;m++){</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="keywordflow">if</span>((l!=q)&amp;&amp;(m!=q)) ftemp2+= gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(l,m)] * dxdxp[l][q] * dxdxp[m][q];</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="comment">// add other 15 terms to answer for total of 16 terms</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    gcovpertprim[q]+=ftemp2;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    </div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;dxdxp[%d][%d]=%21.15g\n&quot;,q,q,dxdxp[q][q]);</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;ftemp1[%d]=%21.15g ftemp2[%d]=%21.15g gcovpertprim[%d]=%21.15g\n&quot;,q,ftemp1,q,ftemp2,q,gcovpertprim[q]);</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  }</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="preprocessor">#elif(0)</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="preprocessor"></span>  <span class="comment">// override for now</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  gcovpertprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,TT)]-<a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a84090a6666715240b33bc16623f3548a">mink</a>(TT,TT);</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aa97638a87093a4efe2bece0de87093cc" title="loop over all Space dimensions; first rank loop">SLOOPA</a>(q){</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    gcovpertprim[q]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(q,q)]-<a class="code" href="../../d9/d43/global_8variousmacros_8h.html#a84090a6666715240b33bc16623f3548a">mink</a>(q,q);</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  }</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="preprocessor">#elif(1)</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="preprocessor"></span>  <span class="comment">// override for now</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  gcovpertprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,TT)]+1.0;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  gcovpertprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a63979cf6054f403eab1d354e6dcc4ce9">RR</a>]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(RR,RR)]-1.0;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  gcovpertprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8ccbf4850176503992b0295081d5f4bc">TH</a>]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TH,TH)]-1.0;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  gcovpertprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae0fcc909f5a4166b625a6707cbdfa643">PH</a>]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(PH,PH)]-1.0;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;}</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="keywordtype">void</span> transgcov_old(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dxdxp)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovprim)</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;{</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, l, m;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k){ <span class="comment">// OPTMARK: In places where deal with symmetric metric that&#39;s using GIND(), could introduce new DLOOPMET(j,k) that only goes over required elements.  Only works for assignment to LHS, not RHS since need factors of two that arrive naturally in sum on RHS.</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = 0.;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;l++) <span class="keywordflow">for</span>(m=0;m&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;m++){</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="comment">// g_{mup nup} = g_{mu nu} T^mu_mup T^nu_nup</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <span class="comment">// where T^mu_mup == dx^mu[BL]/dx^mup[KSP uni grid]</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] += gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(l,m)] * dxdxp[l][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] * dxdxp[m][k]; <span class="comment">// GINDASSIGNFACTOR(j,k) not needed because tmpgcov not += to itself.  RHS is summed over as if entire metric there, as wanted.</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      }</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  }</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k){</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="comment">// use tmpgcov since gcov might be same address as gcovprim</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = tmpgcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)];</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;}</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">// used to transform gcov and put back into gcov</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#a883b64bd581671c831e2ab2f76a9a4c3"> 1716</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a883b64bd581671c831e2ab2f76a9a4c3">transgcovself</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*trans)[NDIM])</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;{</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a645377006a6bb3b11a14105e704f3c0d">transgcov</a>(gcov,<a class="code" href="../../d4/dd3/bounds_8tools_8c.html#aa1e05558c3c146cdd55721c99ae1f2a5">trans</a>,gcovprim);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)];</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;}</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="comment">// used to transform gcov&amp;gcovprim and put back into gcov&amp;gcovprim</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#aa2133cdebf9e5b32b9b93d58e43170f3"> 1728</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#aa2133cdebf9e5b32b9b93d58e43170f3">transgcovgcovpertself</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*trans)[NDIM])</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;{</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovpertprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a645377006a6bb3b11a14105e704f3c0d">transgcov</a>(gcov,<a class="code" href="../../d4/dd3/bounds_8tools_8c.html#aa1e05558c3c146cdd55721c99ae1f2a5">trans</a>,gcovprim);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)];</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae3bffdfbdfdf3391abc1cf67b4d5c9b8">get_gcovpert</a>(gcovprim, gcovpert, gcovpertprim);</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(j) gcovpert[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] = gcovpertprim[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>];</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;}</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">// gcov might be same memory address as gcovprim, so use tmp</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">// assumes metric is symmetric 2nd rank tensor</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"><a class="code" href="../../d5/df2/metric_8tools_8funcdeclare_8h.html#a645377006a6bb3b11a14105e704f3c0d"> 1748</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a645377006a6bb3b11a14105e704f3c0d">transgcov</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*trans)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovprim)</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;{</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, l, m;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> tmp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="comment">// g_{\alpha \beta} = g_{\mu \nu} \Lambda^\mu_\alpha \Lambda^\nu_\beta</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">  // 4 along diagonal and 6 off-diagonal with 6 other identical values</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">  #define GCOV_DOT_TRANS_DOT_TRANS(a,b)\</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">  gcov[GIND(0,0)] * trans[0][a]* trans[0][b]\</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">  +     gcov[GIND(1,1)] * trans[1][a]* trans[1][b]\</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="comment">  +     gcov[GIND(2,2)] * trans[2][a]* trans[2][b]\</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">  +     gcov[GIND(3,3)] * trans[3][a]* trans[3][b]\</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">  + 2.0*gcov[GIND(0,1)] * trans[0][a]* trans[1][b]\</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">  + 2.0*gcov[GIND(0,2)] * trans[0][a]* trans[2][b]\</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">  + 2.0*gcov[GIND(0,3)] * trans[0][a]* trans[3][b]\</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">  + 2.0*gcov[GIND(1,2)] * trans[1][a]* trans[2][b]\</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment">  + 2.0*gcov[GIND(1,3)] * trans[1][a]* trans[3][b]\</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">  + 2.0*gcov[GIND(2,3)] * trans[2][a]* trans[3][b]</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <span class="comment">// 4 along diagonal and 6 off-diagonal with 6 other identical values</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="preprocessor">#define GCOV_DOT_TRANS_DOT_TRANS(a,b)                                   \</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="preprocessor">  gcov[GIND(0,0)] * trans[0][a]* trans[0][b]                            \</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="preprocessor">    +     gcov[GIND(1,1)] * trans[1][a]* trans[1][b]                    \</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="preprocessor">    +     gcov[GIND(2,2)] * trans[2][a]* trans[2][b]                    \</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="preprocessor">    +     gcov[GIND(3,3)] * trans[3][a]* trans[3][b]                    \</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="preprocessor">    +     gcov[GIND(0,1)] * (trans[0][a]* trans[1][b] + trans[1][a]* trans[0][b]) \</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="preprocessor">    +     gcov[GIND(0,2)] * (trans[0][a]* trans[2][b] + trans[2][a]* trans[0][b]) \</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="preprocessor">    +     gcov[GIND(0,3)] * (trans[0][a]* trans[3][b] + trans[3][a]* trans[0][b]) \</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="preprocessor">    +     gcov[GIND(1,2)] * (trans[1][a]* trans[2][b] + trans[2][a]* trans[1][b]) \</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="preprocessor">    +     gcov[GIND(1,3)] * (trans[1][a]* trans[3][b] + trans[3][a]* trans[1][b]) \</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="preprocessor">    +     gcov[GIND(2,3)] * (trans[2][a]* trans[3][b] + trans[3][a]* trans[2][b])</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <span class="comment">// first do 4 along diagonal</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(j) tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] = <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a84fd2557d5df499f541ce96ac96cd19c">GCOV_DOT_TRANS_DOT_TRANS</a>(j,j);</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="comment">// now do 6 others off-diagonal</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  j=0; k=1; tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a84fd2557d5df499f541ce96ac96cd19c">GCOV_DOT_TRANS_DOT_TRANS</a>(j,k);</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  j=0; k=2; tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a84fd2557d5df499f541ce96ac96cd19c">GCOV_DOT_TRANS_DOT_TRANS</a>(j,k);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;  j=0; k=3; tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a84fd2557d5df499f541ce96ac96cd19c">GCOV_DOT_TRANS_DOT_TRANS</a>(j,k);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  j=1; k=2; tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a84fd2557d5df499f541ce96ac96cd19c">GCOV_DOT_TRANS_DOT_TRANS</a>(j,k);</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;  j=1; k=3; tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a84fd2557d5df499f541ce96ac96cd19c">GCOV_DOT_TRANS_DOT_TRANS</a>(j,k);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  j=2; k=3; tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a84fd2557d5df499f541ce96ac96cd19c">GCOV_DOT_TRANS_DOT_TRANS</a>(j,k);</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    </div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  <span class="comment">// copy over result assuming tmp on upper-diagonal only, but filling gcovprim fully</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  <span class="comment">// 4 along diagonal (00,11,22,33) and 6 off-diagonal (01, 02, 03, 12, 13, 23), 6 more as copies of off-diagonal</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(j) gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,j)] = tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>];</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(0,1)]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(1,0)]=tmp[0][1];</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(0,2)]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(2,0)]=tmp[0][2];</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(0,3)]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(3,0)]=tmp[0][3];</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(1,2)]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(2,1)]=tmp[1][2];</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(1,3)]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(3,1)]=tmp[1][3];</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(2,3)]=gcovprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(3,2)]=tmp[2][3];</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;}</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div>
<div class="line"><a name="l01811"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#ac6cbb75d520b0e66c6b083229a2225ee"> 1811</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ac6cbb75d520b0e66c6b083229a2225ee">gcon2gconprim</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *V, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcon,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gconprim)</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;{</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, l, m;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="comment">//FTYPE dxdxp[NDIM][NDIM],idxdxp[NDIM][NDIM];</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> idxdxp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> tmpgcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="comment">// see transforms.c and mettometp() and see gcov2gcovprim()</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  idxdxprim_ijk_2(ptrgeom, X, V, idxdxp);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;mi in gcon2gconprim\n&quot;);</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="comment">// PRIMECOORDS indicates no special considerations if fails to get inverse</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  <span class="comment">//  matrix_inverse(PRIMECOORDS, dxdxp,idxdxp);</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  </div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) tmpgcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = 0.;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k){</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordflow">for</span>(l=0;l&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;l++){</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      <span class="keywordflow">for</span>(m=0;m&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;m++){</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        tmpgcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] += <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a9cafebe4358571ae4a05b8af833f17" title="must multiply assignments by the below so don&#39;t duplicate sums">GINDASSIGNFACTOR</a>(j,k)*idxdxp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][l] * idxdxp[k][m] * gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(l,m)] ;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      }</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    }</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  }</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="comment">// use tmpgcon since gcon might be same address as gconprim</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(j,k) gconprim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)] = tmpgcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(j,k)];</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;}</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="keywordtype">void</span> setup_delta(<span class="keywordtype">int</span> whichfun,<span class="keywordtype">int</span> whichdifftype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> defaultdelta, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeoml)[NDIM], <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeomh)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *truedelta)</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;{</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <span class="keywordtype">int</span> localwhichdifftype;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  <span class="keywordtype">int</span> N[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  N[0]=2; <span class="comment">// if evolving metric then 2, but doesn&#39;t matter since at CENT always</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  N[1]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  N[2]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  N[3]=<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordflow">if</span>(whichfun==0 || whichfun==1){ <span class="comment">// connection or dxdxp</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keywordflow">if</span>(whichdifftype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0bebb8a47e2a0ea6225daa0a8ea7bf1c">DIFFGAMMIE</a> || whichdifftype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae62e36a8fb8b0fa34b625c8934ce4947">DIFFNUMREC</a>){</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      localwhichdifftype=0; <span class="comment">// infinitesimal</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    }</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(whichdifftype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2dcf2dee869fae170cc049fbc7b719f1">DIFFFINITE</a>){</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      localwhichdifftype=1; <span class="comment">// finite</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    }</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  }</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;no such whichfun=%d for whichdifftype=%d&quot;</span>,whichfun,whichdifftype);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    myexit(915);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  }</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="keywordflow">if</span>(localwhichdifftype==0){ <span class="comment">// infinitesimal</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj){</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="comment">// specify NOWHERE so that won&#39;t use gridded position</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      ((*localptrgeoml)[jj]).<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=((*localptrgeomh)[jj]).<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8bf292e53bd4a7ca0cf7b164daf1997a">NOWHERE</a>;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      </div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      ((*localptrgeoml)[jj]).i=((*localptrgeomh)[jj]).i=(geom-&gt;i);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      ((*localptrgeoml)[jj]).j=((*localptrgeomh)[jj]).j=(geom-&gt;j);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      ((*localptrgeoml)[jj]).k=((*localptrgeomh)[jj]).k=(geom-&gt;k);</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      </div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="comment">// an infinitesimal fraction of total grid difference (so scales with artificial startx and endx)</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      truedelta[jj]=defaultdelta*<a class="code" href="../../d8/d5b/defs_8general_8h.html#a6ac48c1b0aa6fae2692a7179ffbc70e1">Diffx</a>[jj];</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="preprocessor">#if(DOEVOLVEMETRIC)</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="preprocessor"></span>    <span class="comment">// if evolving metric, then use CENT and gcov_func() will use X[0] to choose if present time or not</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="comment">// GODMARK: assume didstoremetricdata==1 is set when presenttime==1 is set so doesn&#39;t reach bl_coord_ijk_2() and do coord(i,j,k...) that would be wrong</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    jj=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    ((*localptrgeoml)[jj]).<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=((*localptrgeomh)[jj]).<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>; <span class="comment">// when taking temporal differences, values are always spatially located at loc=CENT</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  }</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(localwhichdifftype==1){ <span class="comment">// finite</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="comment">// use gridded data</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="comment">// assumes connection at CENT</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="keywordflow">if</span>(geom-&gt;p==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a>){</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj){</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        ((*localptrgeoml)[jj]).<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=((*localptrgeomh)[jj]).<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8936711f57f82d1fc75c21fa2894e1c6">CENT</a> + jj*(N[jj]!=1); <span class="comment">// jj=0 -&gt; CENT , jj=1 -&gt; FACE1 , jj=2 -&gt; FACE2 , jj=3 -&gt; FACE3</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        ((*localptrgeoml)[jj]).i=(geom-&gt;i);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        ((*localptrgeoml)[jj]).j=(geom-&gt;j);</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        ((*localptrgeoml)[jj]).k=(geom-&gt;k);</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160; </div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="comment">// GODMARK: Note that infinitesimal version obtains correct connection even in reduced dimensions, while the finite version just reduces to no connection if reduced dimension (so this assumes something about the position or may not even be right in general)</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        ((*localptrgeomh)[jj]).i=(geom-&gt;i) + (jj==1 ? <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a> : 0);</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        ((*localptrgeomh)[jj]).j=(geom-&gt;j) + (jj==2 ? <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a> : 0);</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        ((*localptrgeomh)[jj]).k=(geom-&gt;k) + (jj==3 ? <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a> : 0);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160; </div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        truedelta[jj]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[jj];</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      }</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    }</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;No localptrgeom defined for p=%d\n&quot;</span>,geom-&gt;p);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      myexit(916);</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    }</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  }</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;No such difftype=%d\n&quot;</span>,localwhichdifftype);</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    myexit(917);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  }</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="preprocessor"></span>  dualfprintf(fail_file,<span class="stringliteral">&quot;whichfun=%d whichdifftype=%d localwhichdifftype=%d\n&quot;</span>,whichfun,whichdifftype,localwhichdifftype);</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) dualfprintf(fail_file,&quot;%d :: truedelta=%21.15g\n&quot;,jj,truedelta[jj]);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) dualfprintf(fail_file,&quot;%d :: low: i=%d j=%d k=%d <a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=%d :: high: i=%d j=%d k=%d <a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>=%d\n&quot;,jj,((*localptrgeoml)[jj]).i,((*localptrgeoml)[jj]).j,((*localptrgeoml)[jj]).k,((*localptrgeoml)[jj]).<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,((*localptrgeomh)[jj]).i,((*localptrgeomh)[jj]).j,((*localptrgeomh)[jj]).k,((*localptrgeomh)[jj]).p);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;}</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment">   this gives the connection coefficient \Gamma^{i}_{j,k} =</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment">   GLOBALMETMACP1A0(conn,..,i,j,k) where i,j,k = {0,1,2,3} corresponds to {t,r,theta,phi} </span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment">  we also compute the 2nd connection:</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">  -d/dj(ln(\detg))</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment">  Based upon EOM:</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment">  (f_{(\nu)} T^t_\nu)_{,t} </span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="comment">  = -(f_{(\nu)}T^j_\nu)_{,j} </span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="comment">  +  f_{(\nu)} [</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">  T^\lambda_\nu[\ln(f_{(\nu)}/\detg)]_{,\lambda} </span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">  + T^\mu_\lambda \Gamma^\lambda_{\mu\nu} </span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">  + \ln(f_{(\nu)})_{,t} T^t_\nu</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment">  ]</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">  More compactly (JCM: 05/07/08):</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">  d_\mu (f T^\mu_\nu) = f[ T^\lambda_\kappa \Gamma^\kappa_{\nu\lambda} - d_\mu ln (\detg/f) T^\mu_\nu]</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">  SUPERGODMARK: for  if(WHICHEOM!=WITHGDET) don&#39;t yet compute correct conn2 I believe</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">  // to avoid body forces in general, must compute (e.g. through correction):</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">  \Gamma^\kappa_{\nu\lambda}[new] = \Gamma^\kappa_{\nu\lambda}[old] - (1/4)[\Gamma^\alpha_{\nu\alpha} - ( (d_\nu f)/f + d_\nu \ln(\detg/f) )]\delta^\kappa_\lambda</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment">  or:</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">  \Gamma^\kappa_{\nu\lambda} += - (1/4)[ \Gamma^\alpha_{\nu\alpha} - ( (d_\nu f)/f - conn2_\nu )]\delta^\kappa_\lambda</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">  For the WHICHEOM!=WITHGDET version, in general this would require a different \Gamma for each EOM.  For simplicity just assume f=\detg and don&#39;t allow this non-body version unless WHICHEOM==WITHGDET, and so then one has:</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">  \Gamma^\kappa_{\nu\lambda} += - (1/4)[ \Gamma^\alpha_{\nu\alpha} - (d_\nu \detg)/\detg ]\delta^\kappa_\lambda</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment">  The above is only true for second order scheme.  For higher order FLUXRECON scheme one has:</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">  \Gamma^\kappa_{\nu\lambda} += - (1/4)[ \Gamma^\alpha_{\nu\alpha} - (d_\nu a2c_\nu \detg)/\detg ]\delta^\kappa_\lambda</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">  $$</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">  Problems:</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">  1) But a2c_\nu would normally be chosen adaptively and so one wouldn&#39;t have good cancellation.</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">  2) Fact that \detg is there means difficult to generally have cancellation otherwise unless use NOGDET</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">  3) NOGDET not yet setup for EVOLVEMETRIC, but otherwise for spherical polar coordinates should just use NOGDET for r and \theta.</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">  4) Alternatively, can perform correction every timestep and use same a2c as used for each flux -- expensive</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment">  Problem is b^2/2 and p will be treated differently for SPLITMAEM unless constant all weights</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">  5) So seems only solution apart from NOGDET is to use constant all weights that is unstable</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">// if evolving in time, then metric changed from Xmetricold[TT] to now (t)</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">// by shifting time in past we tell metric to use old metric</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">// if t==Xmetricold[0], then feeding the below tells gcov to assume standard difference at present time</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a2c3c744c975b7fe9573c0fb98b490647"> 2017</a></span>&#160;<span class="preprocessor">#define DELTAFORTIMEh(DELTA) (Xmetricnew[TT]!=Xmetricold[TT] ? (0.0) : 2.0*DELTA)</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a9da8c2c34625b2d5b58be73922bba326"> 2018</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define DELTAFORTIMEl(DELTA) (Xmetricnew[TT]!=Xmetricold[TT] ? (-(Xmetricnew[TT]-Xmetricold[TT])) : DELTA)</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02020"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#ab6838b9862efdc7aaa6fbdb08d85f68b"> 2020</a></span>&#160;<span class="preprocessor">#define MYDELTAh(DELTA,k) ( k==TT ? DELTAFORTIMEh(DELTA) : +DELTA*0.5 )</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#aa52d83d0263b07871639551c71476553"> 2021</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MYDELTAl(DELTA,k) ( k==TT ? DELTAFORTIMEl(DELTA) : -DELTA*0.5 )</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">/* NOTE: parameter hides global variable */</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">// note that inputted geom is used not only for i,j,k but for actual CENT gcon, etc.</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae69349da832b43c5e199da1b2526b2da"> 2026</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae69349da832b43c5e199da1b2526b2da">conn_func_numerical1</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> DELTA, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom,</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                          <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>)[NDIM][NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *conn2)</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;{</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k, l;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  <span class="keywordtype">int</span> kk,jj;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> conndiag[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],conndiag2[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gdethgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],gdetlgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> lngdethgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],lngdetlgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  <span class="comment">//  FTYPE *gdeth,*gdetl;</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <span class="comment">//  FTYPE *lngdeth,*lngdetl;</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gdetmid;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> tmp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Xhgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Xlgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> signdXgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="comment">//  FTYPE *Xh, *Xl;</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  <span class="comment">//  FTYPE signdX;</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gmid[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ghgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> glgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <span class="comment">//  FTYPE (*gh)[NDIM];</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  <span class="comment">//  FTYPE (*gl)[NDIM];</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovpertmid[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovperthgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],gcovpertlgen[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;  <span class="comment">//  FTYPE *gcovperth,*gcovpertl;</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> getprim, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert);</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="keywordtype">int</span> dfridr(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*func)(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>*,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>), <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X,<span class="keywordtype">int</span> ii, <span class="keywordtype">int</span> jj, <span class="keywordtype">int</span> kk, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *ans);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a16590e2fa012fcb4003a079c3d990854">gcov_func_mcoord</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> lngdet_func_mcoord(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  <span class="comment">// below variables used for setup_delta()</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="comment">// and used for defining whether infinitesimal or finite difference</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> truedelta[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> localgeoml[NDIM];</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> localgeomh[NDIM];</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeoml)[NDIM];</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeomh)[NDIM];</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> localgeom;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="keyword">struct </span><a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *localptrgeom=&amp;localgeom;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  <span class="keywordtype">void</span> setup_delta(<span class="keywordtype">int</span> whichfun,<span class="keywordtype">int</span> whichdifftype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> defaultdelta, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeoml)[NDIM], <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeomh)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *truedelta);</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8f34363ac1d1e0d1100611f9ff540074">gdet_func_mcoord_usegcov</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovmcoord, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="keywordtype">int</span> doingmachinebody;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="keywordtype">int</span> setup_XlXh(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *truedelta, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xlgen)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xhgen)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *signdXgen);</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <span class="keywordtype">int</span> compute_metricquantities_midlh(<span class="keywordtype">int</span> donormal, <span class="keywordtype">int</span> domachinebody</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                                     ,<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gmid, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpertmid,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdetmid,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdetlgen,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdethgen</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;                                     ,<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeoml)[NDIM],<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeomh)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xlgen)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xhgen)[NDIM]</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                                     ,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lngdetlgen, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lngdethgen, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*glgen)[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ghgen)[SYMMATRIXNDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*gcovpertlgen)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*gcovperthgen)[NDIM]</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                                     );</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  <span class="keywordtype">int</span> failreturn;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  <span class="keywordtype">int</span> conndertypelocal;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> value;</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="comment">// setup conditional</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;  doingmachinebody = <a class="code" href="../../da/d3e/definit_8h.html#a7b4991f295ae469b66bb4f129db7564a" title="whether to correct connection so body forces are 0 when p=constant only makes sense for non-higher or...">CONNMACHINEBODY</a> &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#aa394f1d919e05adcf57ae2731c0389e6" title="if WHICHEOM==WITHNOGDET, then below determines which EOMs get what geometric prefactor. Notice (as described in phys.c&#39;s source_conn() ) that geometry issue applies AFTER additions/subtractions of EOMs (as done by REMOVERESTMASSFROMUU).">WHICHEOM</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aea04d064e60276455dd06bbce582cc8c" title="for WHICHEOM">WITHGDET</a>;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  </div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;  localptrgeoml=&amp;localgeoml;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  localptrgeomh=&amp;localgeomh;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="preprocessor">#if(DOEVOLVEMETRIC==1 &amp;&amp; CONNDERTYPE==DIFFNUMREC)</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="preprocessor"></span>  <span class="comment">// no choice in sense that NUMREC is too slow</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  dualfprintf(fail_file,<span class="stringliteral">&quot;Not good idea to use DOEVOLVEMETRIC==1 with CONNDERTYPE==DIFFNUMREC\n&quot;</span>);</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;  myexit(7225);</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="comment">// gabc_{ijk}=dg_{ij}/dx^k</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;  <span class="comment">// gammie derivative (attempt to get analytical value) or finite difference (true finite difference with given cell size)</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0bebb8a47e2a0ea6225daa0a8ea7bf1c">DIFFGAMMIE</a> || <a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2dcf2dee869fae170cc049fbc7b719f1">DIFFFINITE</a>      || <a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae62e36a8fb8b0fa34b625c8934ce4947">DIFFNUMREC</a>){ <span class="comment">// get default value even for DIFFNUMREC</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae62e36a8fb8b0fa34b625c8934ce4947">DIFFNUMREC</a>) conndertypelocal=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0bebb8a47e2a0ea6225daa0a8ea7bf1c">DIFFGAMMIE</a>; <span class="comment">// assume ok to use gammie diff as default</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    <span class="keywordflow">else</span> conndertypelocal=<a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>; <span class="comment">// normal</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    <span class="comment">// Setup delta</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment"></span>    <span class="comment">// 0 indicates connection type</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    setup_delta(0,conndertypelocal,DELTA,geom,localptrgeoml,localptrgeomh,truedelta);</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="comment">// setup Xl and Xh and signdX</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    setup_XlXh(X,truedelta,Xlgen,Xhgen,signdXgen);</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="comment">// get metric quantities</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    compute_metricquantities_midlh(1,doingmachinebody</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                                   ,geom, X, gmid, gcovpertmid,&amp;gdetmid,gdetlgen,gdethgen</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                                   ,localptrgeoml,localptrgeomh,Xlgen,Xhgen</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                                   ,lngdetlgen, lngdethgen, glgen, ghgen, gcovpertlgen, gcovperthgen</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                                   );</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <span class="comment">// resetup Xl and Xh and signdX since above &quot;compute&quot; function will have overwritten X positions for non-existent dimensions</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="comment">// if do this, must set truedelta correctly consistent in setup_delta()</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    setup_XlXh(X,truedelta,Xlgen,Xhgen,signdXgen);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    <span class="comment">// Now compute derivatives</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment"></span>    </div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++) {</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      </div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      </div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <span class="keywordflow">if</span>(WHICHEOM!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aea04d064e60276455dd06bbce582cc8c" title="for WHICHEOM">WITHGDET</a>){</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="comment">//$$</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        <span class="comment">//d_\mu (f T^\mu_\nu) = f[ T^\lambda_\kappa \Gamma^\kappa_{\nu\lambda} - d_\mu ln (\detg/f) T^\mu_\nu]</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        <span class="comment">//$$</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        conn2[k]= signdXgen[k]*(lngdethgen[k] - lngdetlgen[k]) / (Xhgen[k][k] - Xlgen[k][k]);</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      }</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        conn2[k]=0.0; <span class="comment">// no 2nd connection then</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      }</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <span class="comment">// answer is symmetric on i,j since uses g_{ij}, so only do part of work</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++){</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt;=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>; j++){</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;          <span class="comment">// d(1+g_{tt}) -&gt; dg_{tt}, so can use 1+g_{tt} for accurate non-relativistic gravity</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;          <span class="comment">//if(i==j) conn[i][j][k] = (gcovperth[i] - gcovpertl[i]) / (Xh[k] - Xl[k]);</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;          <span class="comment">// else </span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;          <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = signdXgen[k]*(ghgen[k][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)] - glgen[k][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)]) / (Xhgen[k][k] - Xlgen[k][k]);</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;          <span class="comment">//   dualfprintf(fail_file,&quot;ii=%d jj=%d kk=%d :: i=%d j=%d k=%d c=%21.15g gh=%21.15g gl=%21.15g Xh=%21.15g Xl=%21.15g\n&quot;,localptrgeom-&gt;i,localptrgeom-&gt;j,localptrgeom-&gt;k,i,j,k,conn[i][j][k],ghgen[k][GIND(i,j)],glgen[k][GIND(i,j)],Xhgen[k][k],Xlgen[k][k]);</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        }</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      }</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      </div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    }<span class="comment">// end over k</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  }</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  <span class="comment">// DIFFNUMREC version has DIFFGAMMIE as default value</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae62e36a8fb8b0fa34b625c8934ce4947">DIFFNUMREC</a>){</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="comment">// Setup delta</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="comment"></span>    <span class="comment">// 0 indicates connection type</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    setup_delta(0,<a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>,DELTA,geom,localptrgeoml,localptrgeomh,truedelta);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="comment">// use local copy so don&#39;t overwrite original, which could be pointing to global storage</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    localptrgeom-&gt;i=geom-&gt;i;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    localptrgeom-&gt;j=geom-&gt;j;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    localptrgeom-&gt;k=geom-&gt;k;</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    localptrgeom-&gt;p=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8bf292e53bd4a7ca0cf7b164daf1997a">NOWHERE</a>; <span class="comment">// informs rest of calls that X will generally be arbitrary</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;DIFFNUMREC: doing i=%d j=%d\n&quot;,geom-&gt;i,geom-&gt;j);</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++) {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      </div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <span class="keywordflow">if</span>(WHICHEOM!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aea04d064e60276455dd06bbce582cc8c" title="for WHICHEOM">WITHGDET</a>){</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        failreturn = dfridr(lngdet_func_mcoord,localptrgeom,X,0,0,k,&amp;value); <span class="comment">// 0,0 not used</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <span class="keywordflow">if</span>(failreturn==0) conn2[k]=value; <span class="comment">// else leave as default</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      }</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      <span class="keywordflow">else</span> conn2[k]=0.0; <span class="comment">// then no 2nd connection</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="comment">// answer is symmetric on i,j since uses g_{ij}, so only do part of work</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++){</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt;=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>; j++){</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;          failreturn = dfridr(gcov_func_mcoord,localptrgeom,X,i,j,k,&amp;value);</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;          <span class="keywordflow">if</span>(failreturn==0) <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k]=value; <span class="comment">// else leave as default</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        }</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      }</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    }<span class="comment">// end over k</span></div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  }<span class="comment">// end if CONNDERTYPE==DIFFNUMREC</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="comment">//  </span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <span class="comment">// fill in rest of conn[i][j][k] (or enforce symmetry of connection)</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++) {</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++){</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <span class="keywordflow">for</span> (j = i+1; j &lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; j++){</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][k]; </div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  }</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  <span class="comment">// now rearrange to find \Gamma_{ijk}=1/2*(gabc_{jik}+gabc_{kij}-gabc_{kji})</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++)</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; j++)</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++)</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        tmp[i][j][k] =</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;          0.5 * (<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[j][i][k] + <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[k][i][j] - <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[k][j][i]);</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  <span class="comment">// finally, raise first index</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++)</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; j++)</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++) {</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] = 0.;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        <span class="keywordflow">for</span> (l = 0; l &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; l++){</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;          <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k] += geom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,l)] * tmp[l][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][k];</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        }</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="comment">// now correct for accurate body forces</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  <span class="comment">// only makes sense for no a2c on flux right now</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <span class="comment">// Idea is that pressure term in stress-energy tensor does not cancel between flux and source term, leading to lack of cancellation leading to secular errors -- especially near pole where flux must vanish so errors in flux are not removed by flux differencing.</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  <span class="comment">// So by looking at $T^\mu_\nu += p_{\rm tot} \delta^\mu_\nu$ term, one can see how to correct the connection so this pressure term (for constant total pressure) cancels between flux and source</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="comment">// --&gt; $d_t (\detg \delta^t_\nu) = -d_j(\detg \delta^j_\nu) + \detg \delta^k_\lambda \Gamma^\lambda_{\nu\kappa}$</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;  <span class="comment">// assume $d_t(\detg)\sim 0$ and $d_j(ptot)\sim 0$, then:</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="comment">// $0 = -d_\nu(\detg) + \detg \Gamma^\kappa_{\nu\kappa}$</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  <span class="comment">// or:</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;  <span class="comment">// $\Gamma^\kappa_{\nu\kappa} = d_\nu(\detg) / \detg$</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  <span class="comment">// Since source is at center while flux is at faces, we need to subtract off face-related values and add center-related values. The $d_\nu(\detg)$ term is really the only face part related to the flux calculation.  That needs to be removed and then we should add back on the center version</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <span class="comment">// 1) $[each \kappa]\Gamma^\kappa_{\nu\kappa} -= (1/4) (d_\nu(\detg) @ cent / (\detg @ cent)) = [sum over \kappa] (1/4) \Gamma^\kappa_{\nu\kappa}$</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;  <span class="comment">// 2) $[each \kappa]\Gamma^\kappa_{\nu\kappa} += (1/4) (\delta_\nu(\detg)/(\Delta_\nu) / (\detg @ cent))$</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="comment">// No, cannot just completely change each \kappa term like this, since could change dramatically the value...</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  <span class="comment">// Instead, Form Q_\nu = ([wanted version, with sum over \kappa] \Gamma^\kappa_{\nu\kappa}) / ([original, with sum over \kappa] \Gamma^\kappa_{\nu\kappa})</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;  <span class="comment">// Then to get final \Gamma^\kappa_{\nu\kappa}, multiply *each* \kappa term by Q_\nu</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="comment">// Then one has minimal multiplicative factor that multiplies each term so that sum will be desired value</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(doingmachinebody){</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    <span class="comment">// First repeat setup for connection calculation but use DIFFFINITE so that metric quantities are evaluated at FACES rather than CENT</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="comment"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#ac1c413875e4d88f82853bf12d1df2eeb" title="which derivative type to use when computing connection coefficients define CONNDERTYPE DIFFGAMMIE...">CONNDERTYPE</a>!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2dcf2dee869fae170cc049fbc7b719f1">DIFFFINITE</a>){</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      <span class="comment">// Setup finite difference for correction</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <span class="comment">// 0 indicates connection type</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      <span class="comment">// correction always uses DIFFFINITE</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      setup_delta(0,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2dcf2dee869fae170cc049fbc7b719f1">DIFFFINITE</a>,DELTA,geom,localptrgeoml,localptrgeomh,truedelta);</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      <span class="comment">// setup Xl and Xh and signdX</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      setup_XlXh(X,truedelta,Xlgen,Xhgen,signdXgen);</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      <span class="comment">// 0 means not normal calculations      </span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      compute_metricquantities_midlh(0,doingmachinebody</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                                     ,geom, X, gmid, gcovpertmid,&amp;gdetmid,gdetlgen,gdethgen</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                                     ,localptrgeoml,localptrgeomh,Xlgen,Xhgen</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                                     ,lngdetlgen, lngdethgen, glgen, ghgen, gcovpertlgen, gcovperthgen</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                                     );</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;     </div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <span class="comment">// resetup Xl and Xh and signdX since above &quot;compute&quot; function will have overwritten X positions for non-existent dimensions</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;      <span class="comment">// if do this, must set truedelta correctly consistent in setup_delta()</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      setup_XlXh(X,truedelta,Xlgen,Xhgen,signdXgen);</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160; </div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    }</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="comment">// form original contracted connection</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="comment"></span>    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(kk){</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      conndiag[kk]=0.0;</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) conndiag[kk] += <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[jj][kk][jj];</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    }</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    <span class="comment">// form new finite differential \detg divided by centered \detg</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment"></span>    <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++) {</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      conndiag2[k] = signdXgen[k]*(gdethgen[k] - gdetlgen[k]) / (Xhgen[k][k] - Xlgen[k][k]);</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      conndiag2[k] /= gdetmid;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    }</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="comment">// now obtain correction</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="comment">// for Xh-Xl-&gt;0 this vanishes as required</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <span class="comment">// Plugging this new conn into EOM for T^\mu_\nu = p \delta^\mu_\nu gives exactly cancellation between source and flux differencing of pressure</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Note that correction applies to \Gamma^\kappa_{\nu\kappa}, which is a contracted quantity.  So we spread correction across each \kappa=0,1,2,3.  Hence the 0.25</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="comment">// Once later contractions operate and pressure and flux source terms appear, the contracted term involving the pressure will cancel correctly for constant pressure</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="comment"></span>    <span class="comment">//    for (i = 0; i &lt; NDIM; i++) for (j = 0; j &lt; NDIM; j++) for (k = 0; k &lt; NDIM; k++) conn[i][j][k] += -0.25*(conndiag[j] - conndiag2[j])*delta(i,k);</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <span class="comment">// apply delta(i,k) directly by setting i=k</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <span class="comment">//    for (i = 0; i &lt; NDIM; i++) for (j = 0; j &lt; NDIM; j++) conn[i][j][i] += -0.25*(conndiag[j] - conndiag2[j]);</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <span class="comment">//    for (i = 0; i &lt; NDIM; i++) for (j = 0; j &lt; NDIM; j++) conn[i][j][i] *= pow(fabs(conndiag2[j])/(fabs(conndiag[j])+SMALL),0.25);</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ftemp;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++){</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; j++){</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        <span class="keywordflow">if</span>(fabs(conndiag2[j])==0.0) ftemp=1.0;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        <span class="keywordflow">else</span> ftemp=(fabs(conndiag2[j])+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>)/(fabs(conndiag[j])+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>);</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        <span class="comment">// Note, there is difficulty when sum passes through zero.  Won&#39;t matter for pressure term, but each individual term in connection may be far from zero and simply different terms cancel.</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;        <span class="keywordflow">if</span>(fabs(ftemp-1.0)&gt;0.5){</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;WARNING: Large correction for machinebody: i=%d j=%d :: i=%d j=%d ftemp=%21.15g :: %21.15g %21.15g :: %21.15g\n&quot;</span>,geom-&gt;i,geom-&gt;j,i,j,ftemp,conndiag[j],conndiag2[j],gdetmid);</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        }</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;          <span class="comment">// otherwise do correction</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;          <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] *= ftemp;</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;          <span class="comment">//   if(i==0) dualfprintf(fail_file,&quot;machinebody: i=%d j=%d :: j=%d ftemp=%21.15g :: %21.15g %21.15g :: %21.15g\n&quot;,geom-&gt;i,geom-&gt;j,j,ftemp,conndiag[j],conndiag2[j],gdetmid);</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;        }</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      }</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    }</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="preprocessor"></span>    <span class="comment">// Sasha&#39;s weighted method for correction</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> sumabsconn[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(kk){</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      sumabsconn[kk]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>; <span class="comment">// to avoid 0/0 in weight</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(jj) sumabsconn[kk] += fabs(<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[jj][kk][jj]);</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    }</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dS,weight;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++){ <span class="comment">// over traced terms</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; j++){ <span class="comment">// over each j</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        <span class="comment">// correction to sum of trace:</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;        dS=conndiag2[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]-conndiag[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>];</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        <span class="comment">// weight for this connection term</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        weight=fabs(<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[i][j][i])/sumabsconn[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>];</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;        <span class="comment">// weighted correction</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;        <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] += dS*weight;</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      }</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    }</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  } <span class="comment">// end if correcting body forces</span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="preprocessor">#if(0) // DEBUG</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(geom-&gt;i==0 || geom-&gt;i==-1){</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++) <span class="keywordflow">for</span> (l = 0; l &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; l++){</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;i=%d gcon[%d][%d]=%21.15g\n&quot;</span>,geom-&gt;i,i,l,geom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,l)]);</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      }</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;i=%d conn[0][0][0]=%21.15g\n&quot;</span>,geom-&gt;i,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a03bab59595551d88dd24b0f83a7b7517">conn</a>[0][0][0]);</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  }</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <span class="comment">/* done! */</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;}</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="keywordtype">int</span> setup_XlXh(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *truedelta, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xlgen)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xhgen)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *signdXgen)</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;{</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  <span class="keywordtype">int</span> k,l;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  <span class="comment">// first form high and low positions for function locations</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++) {</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="keywordflow">for</span> (l = 0; l &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; l++){</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      Xhgen[k][l] = X[l];</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      Xlgen[k][l] = X[l];</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    }</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="comment">// normal case</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    Xhgen[k][k] += <a class="code" href="../../d6/d1b/metric_8tools_8c.html#ab6838b9862efdc7aaa6fbdb08d85f68b">MYDELTAh</a>(truedelta[k],k);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    Xlgen[k][k] += <a class="code" href="../../d6/d1b/metric_8tools_8c.html#aa52d83d0263b07871639551c71476553">MYDELTAl</a>(truedelta[k],k);</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    signdXgen[k]=1.0;</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="preprocessor">#if(0)// debug</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(k==TT){</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      <span class="keywordflow">if</span>(Xlgen[k][k]&gt;X[k]){</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;Xl in future! Xl=%21.15g Xh=%21.15g\n&quot;</span>,Xlgen[k][k],Xhgen[k][k]);</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      }</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    }</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="preprocessor"></span>    <span class="comment">// not really wanted since want &quot;force&quot; to be in same &quot;radial&quot; direction so sign SHOULD flip</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    <span class="keywordflow">if</span>(k==1 &amp;&amp; <a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>)){</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <span class="comment">// then check if r&lt;0 and invert Xh and Xl if so</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;      <a class="code" href="../../d9/de9/coord_8c.html#a65ad4ca9656d141cc995fd35ed31dc40" title="Returns boyer-lindquist coordinte of point.">bl_coord</a>(X, V);</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <span class="keywordflow">if</span>(V[k]&lt;0.0){</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        signdXgen[k]=-1.0;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;      }</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    }</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="preprocessor"></span>    <span class="comment">//      if(k==TT) dualfprintf(fail_file,&quot;k=%d DELTAl=%21.15g DELTAh=%21.15g : true=%21.15g\n&quot;,k,MYDELTAl(truedelta[k],k),MYDELTAh(truedelta[k],k),truedelta[k]);</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    <span class="comment">// DEBUG</span></div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    <span class="comment">//Xhgen[k][k] += DELTA;</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <span class="comment">//   Xlgen[k][k] -= DELTA;</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  }</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;}</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="comment">// compute low/high metric quantities</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="keywordtype">int</span> compute_metricquantities_midlh(<span class="keywordtype">int</span> donormal, <span class="keywordtype">int</span> domachinebody</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                                   ,<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *geom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gmid, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpertmid,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdetmid,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdetlgen,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gdethgen</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                                   ,<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeoml)[NDIM],<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> (*localptrgeomh)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xlgen)[NDIM],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*Xhgen)[NDIM]</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                                   ,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lngdetlgen, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *lngdethgen, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*glgen)[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*ghgen)[SYMMATRIXNDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*gcovpertlgen)[NDIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*gcovperthgen)[NDIM]</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                                   )</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;{</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;  <span class="keywordtype">int</span> k;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a16590e2fa012fcb4003a079c3d990854">gcov_func_mcoord</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> lngdet_func_mcoord(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8f34363ac1d1e0d1100611f9ff540074">gdet_func_mcoord_usegcov</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovmcoord, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;  <span class="comment">// get gdet in cell center</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="keywordflow">if</span>(domachinebody){</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(geom,1,<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,X, gmid,gcovpertmid);</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    *gdetmid=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8f34363ac1d1e0d1100611f9ff540074">gdet_func_mcoord_usegcov</a>(gmid, geom, X, 0,0);</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  }</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;  <span class="comment">// get k-dependent things</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;  <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; k++) {</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="keywordflow">if</span>(donormal){</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#aa394f1d919e05adcf57ae2731c0389e6" title="if WHICHEOM==WITHNOGDET, then below determines which EOMs get what geometric prefactor. Notice (as described in phys.c&#39;s source_conn() ) that geometry issue applies AFTER additions/subtractions of EOMs (as done by REMOVERESTMASSFROMUU).">WHICHEOM</a>!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aea04d064e60276455dd06bbce582cc8c" title="for WHICHEOM">WITHGDET</a>){</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        lngdethgen[k]=lngdet_func_mcoord(&amp;((*localptrgeomh)[k]),Xhgen[k],0,0); <span class="comment">// doesn&#39;t use 0,0</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        lngdetlgen[k]=lngdet_func_mcoord(&amp;((*localptrgeoml)[k]),Xlgen[k],0,0); <span class="comment">// doesn&#39;t use 0,0</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      }</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    }</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <span class="keywordflow">if</span>(donormal || domachinebody){</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      <span class="comment">// must come before below gdet_func_mcoord_usegcov() call</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;      <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(&amp;((*localptrgeomh)[k]),1,<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,Xhgen[k], ghgen[k],gcovperthgen[k]);</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(&amp;((*localptrgeoml)[k]),1,<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,Xlgen[k], glgen[k],gcovpertlgen[k]);</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    }</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <span class="keywordflow">if</span>(domachinebody){</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;      gdethgen[k]=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8f34363ac1d1e0d1100611f9ff540074">gdet_func_mcoord_usegcov</a>(ghgen[k], &amp;((*localptrgeomh)[k]), Xhgen[k], 0,0);</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      gdetlgen[k]=<a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8f34363ac1d1e0d1100611f9ff540074">gdet_func_mcoord_usegcov</a>(glgen[k], &amp;((*localptrgeoml)[k]), Xlgen[k], 0,0);</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    }</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  }</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;}</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="comment">// returns MCOORD gcov value for i,j element</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="comment">// excessive to compute other elements, but ok for now</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;<span class="comment">// input ptrgeom is only used for i,j,k,loc positions</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a16590e2fa012fcb4003a079c3d990854"> 2517</a></span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a16590e2fa012fcb4003a079c3d990854">gcov_func_mcoord</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j)</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;{</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovmcoord[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovpert[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> getprim, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert);</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(ptrgeom,1,<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,X,gcovmcoord,gcovpert);</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  <span class="comment">//  if(i==j) return(gcovpert[i]); // for accurate non-rel gravity (works since d(1+g_{tt}) = dg_{tt})</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;  <span class="comment">//  else</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  <span class="keywordflow">return</span>(gcovmcoord[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)]);</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;}</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="comment">// returns MCOORD  value for log(f/gdet).  Doesn&#39;t use i,j (these are not grid locations)</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;<span class="comment">// input ptrgeom is only used for i,j,k,loc positions</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> lngdet_func_mcoord(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j)</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;{</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovmcoord[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovpertcoord[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> toreturn;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> eomfunc[NPR]; <span class="comment">// don&#39;t change this as related to WHICHEOM==WITHGDET</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *eomfuncptr=eomfunc; <span class="comment">// don&#39;t change this as related to WHICHEOM==WITHGDET</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> getprim, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert);</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a597ef3c829c23db3a2637f8b3aefe240">gdet</a>;</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(ptrgeom,1,<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,X,gcovmcoord,gcovpertcoord);</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  eomfunc_func(ptrgeom,1,<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,X,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a680cf23ee1aacb23c5c7ef308ebf6f2f">EOMFUNCPTR</a>);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;  bl_coord_ijk_2(ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ptrgeom-&gt;p, X, V);</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  <span class="comment">// GODMARK: assumes all RHO, etc. use same eomfunc if using 2nd connection</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae5dbb2bc88f07e392d2a9e6b911c5c48">gdet_func_metric</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,V,gcovmcoord,&amp;gdet)!=0){</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Caught gdet_func_metric() issue in lngdet_func_mcoord()\n&quot;</span>);</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;  }</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  toreturn=log(fabs(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ab3032b7a358cd8a18da35ab6936a265c">EOMFUNCMAC</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>)/gdet)); <span class="comment">// can&#39;t take log of negative (FLIPGDETAXIS note about how this method wouldn&#39;t work)</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;  <span class="keywordflow">return</span>(toreturn);</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;}</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="comment">// returns MCOORD  value for gdet.  Doesn&#39;t use i,j (these are not grid locations)</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a5fd4211d5f50d31b117733fd23f86330"> 2557</a></span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a5fd4211d5f50d31b117733fd23f86330">gdet_func_mcoord</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j)</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;{</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovmcoord[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>];</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gcovpertcoord[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> toreturn;</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <span class="keywordtype">int</span> getprim, <span class="keywordtype">int</span> whichcoord, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovpert);</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a597ef3c829c23db3a2637f8b3aefe240">gdet</a>;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;  <a class="code" href="../../d9/d53/metric_8c.html#a4aab5a2c66b9a78bbdf4b802602aea1c" title="obtain gcov in primcoords of whichcoord type metric/coords here ptrgeom is only expected to contain i...">gcov_func</a>(ptrgeom,1,<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,X,gcovmcoord,gcovpertcoord);</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;  bl_coord_ijk_2(ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ptrgeom-&gt;p, X, V);</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae5dbb2bc88f07e392d2a9e6b911c5c48">gdet_func_metric</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,V,gcovmcoord,&amp;gdet)!=0){</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Caught gdet_func_metric() issue in gdet_func_mcoord()\n&quot;</span>);</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  }</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="keywordflow">return</span>(gdet);</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;}</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;<span class="comment">// returns MCOORD  value for gdet using gcovmcoord as input to avoid repeated computations of gcovmcoord.  Doesn&#39;t use i,j (these are not grid locations)</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8f34363ac1d1e0d1100611f9ff540074"> 2577</a></span>&#160;<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d6/d1b/metric_8tools_8c.html#a8f34363ac1d1e0d1100611f9ff540074">gdet_func_mcoord_usegcov</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gcovmcoord, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>* X, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j)</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;{</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;  <span class="comment">//  FTYPE gcovmcoord[SYMMATRIXNDIM];</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;  <span class="comment">//  FTYPE gcovpertcoord[NDIM];</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> toreturn;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="comment">//void gcov_func(struct of_geom *ptrgeom, int getprim, int whichcoord, FTYPE *X, FTYPE *gcov, FTYPE *gcovpert);</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a597ef3c829c23db3a2637f8b3aefe240">gdet</a>;</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  <span class="comment">//  gcov_func(ptrgeom,1,MCOORD,X,gcovmcoord,gcovpertcoord);</span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;  bl_coord_ijk_2(ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ptrgeom-&gt;p, X, V);</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d6/d1b/metric_8tools_8c.html#ae5dbb2bc88f07e392d2a9e6b911c5c48">gdet_func_metric</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>,V,gcovmcoord,&amp;gdet)!=0){</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Caught gdet_func_metric() issue in gdet_func_mcoord_usegcov()\n&quot;</span>);</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  }</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  </div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <span class="keywordflow">return</span>(gdet);</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;}</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;</div>
<div class="line"><a name="l02616"></a><span class="lineno"><a class="code" href="../../d6/d1b/metric_8tools_8c.html#a3b36886edac65bf2cec66526e2fa6839"> 2616</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dd/da9/metric_8funcdeclare_8h.html#a3b36886edac65bf2cec66526e2fa6839">metric_checks</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom)</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;{</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d9/d43/global_8variousmacros_8h.html#aa5ebb2763dd5546bc40222826cea731f">delta</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],X[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k,loc;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;  <span class="keywordtype">int</span> jj,kk,pp;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;  i=ptrgeom-&gt;i;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  j=ptrgeom-&gt;j;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  k=ptrgeom-&gt;k;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  loc=ptrgeom-&gt;p;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="comment">// delta^jj_kk = gcov_{kk pp} gcon^{pp jj}</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="comment"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a59b7ef1517ff22fd4dfce4cf6d380c55" title="loop over all Dimensions; second rank loop">DLOOP</a>(jj,kk){</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;    delta[jj][kk]=0.0;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(pp){</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;      delta[jj][kk]+= ptrgeom-&gt;gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(jj,pp)]* ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(pp,kk)];</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    }</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>==0){</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;      <span class="keywordflow">if</span>(fabs(delta[jj][kk]-<a class="code" href="../../d9/d43/global_8variousmacros_8h.html#aa5ebb2763dd5546bc40222826cea731f">delta</a>(jj,kk))&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>*100.0){</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>)==0 || (<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>)==1 &amp;&amp; j!=<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] &amp;&amp; j!=0 &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5b4b42f50fd7667c7d22d8001811bc7e">FACE2</a> &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1068bcf25c9f187a8db0f422e0af64c8">CORN1</a> &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1a05e117efd4dbc39b7c590141004470">CORN3</a> &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aca28d3c01bd5d2739e54d08b3336c54a">CORNT</a>) ){</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;Problem with metric at i=%d j=%d k=%d loc=%d delta[%d][%d]=%21.15g should be %21.15g\n&quot;</span>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ptrgeom-&gt;p,jj,kk,delta[jj][kk],delta(jj,kk));</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        }</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;      }</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    }</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    <span class="keywordflow">if</span>(fabs(delta[jj][kk]-<a class="code" href="../../d9/d43/global_8variousmacros_8h.html#aa5ebb2763dd5546bc40222826cea731f">delta</a>(jj,kk))&gt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>*1000.0){</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>)==0 || (<a class="code" href="../../d2/dbf/metric_8h.html#a720c791e54d46bbf744b0e3ed7050947">ISSPCMCOORD</a>(<a class="code" href="../../da/d3e/definit_8h.html#ab343edb2f60f3de2d654dcf1c58e06a2" title="#else define MAXBND 3 endif">MCOORD</a>)==1 &amp;&amp; j!=<a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] &amp;&amp; j!=0 &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5b4b42f50fd7667c7d22d8001811bc7e">FACE2</a> &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1068bcf25c9f187a8db0f422e0af64c8">CORN1</a> &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1a05e117efd4dbc39b7c590141004470">CORN3</a> &amp;&amp; loc!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aca28d3c01bd5d2739e54d08b3336c54a">CORNT</a>) ){</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;MAJOR Problem with metric at i=%d j=%d k=%d loc=%d delta[%d][%d]=%21.15g should be %21.15g\n&quot;</span>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ptrgeom-&gt;p,jj,kk,delta[jj][kk],delta(jj,kk));</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      }</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    }</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  }</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  </div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  <span class="comment">// check if near static limit since can&#39;t divide by the below in ucon_calc</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;  <span class="comment">// GODMARK</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;  <span class="keywordflow">if</span> (fabs(ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,TT)]) &lt; SMALL) {</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    bl_coord_ijk_2(i,j,k,loc,X,V);</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    dualfprintf(fail_file, <span class="stringliteral">&quot;grid location too near g_{tt}==0: %d %d %d : r=%21.15g th=%21.15g phi=%21.15g : Rin=%21.15g %21.15g\n&quot;</span>, i,j,k,V[1],V[2],V[3],<a class="code" href="../../d8/d5b/defs_8general_8h.html#aede4c57c0916c7d1ba3760915a650067">Rin</a>,ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TT,TT)]);</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;  }</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  <span class="keywordflow">if</span> (0 &amp;&amp; fabs(ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(RR,RR)]) &lt; SMALL) {</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    bl_coord_ijk_2(i,j,k,loc,X,V);</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    dualfprintf(fail_file, <span class="stringliteral">&quot;grid location too near g^{rr}==0:  %d %d %d : r=%21.15g th=%21.15g phi=%21.15g :  Rin=%21.15g %21.15g\n&quot;</span>, i,j,k,V[1],V[2],V[3],<a class="code" href="../../d8/d5b/defs_8general_8h.html#aede4c57c0916c7d1ba3760915a650067">Rin</a>,ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(RR,RR)]);</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;  }</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;  <span class="keywordflow">if</span> (0 &amp;&amp; fabs(ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TH,TH)]) &lt; SMALL) {</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    bl_coord_ijk_2(i,j,k,loc,X,V);</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;grid location too near g^{\\theta\\theta}==0:  %d %d %d : r=%21.15g th=%21.15g phi=%21.15g :  Rin=%21.15g %21.15g\n&quot;</span>, i,j,k,V[1],V[2],V[3],<a class="code" href="../../d8/d5b/defs_8general_8h.html#aede4c57c0916c7d1ba3760915a650067">Rin</a>,ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(TH,TH)]);</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  }</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;  <span class="keywordflow">if</span> (0 &amp;&amp; fabs(ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(PH,PH)]) &lt; SMALL) {</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    bl_coord_ijk_2(i,j,k,loc,X,V);</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;grid location too near g^{\\phi\\phi}==0:  %d %d %d : r=%21.15g th=%21.15g phi=%21.15g :  Rin=%21.15g %21.15g\n&quot;</span>, i,j,k,V[1],V[2],V[3],<a class="code" href="../../d8/d5b/defs_8general_8h.html#aede4c57c0916c7d1ba3760915a650067">Rin</a>,ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(PH,PH)]);</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    myexit(1);</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  }</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  <span class="comment">// what about g_{tt}==0? Do I ever divide by g_{tt}?</span></div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  <span class="comment">// Yes, for ucon[TT] for 4 velocity, which is done if WHICHVEL==VEL4 or init.c</span></div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  <span class="comment">// what about g^{rr}==0? Do I ever divide by g^{rr}?</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <span class="comment">// Doesn&#39;t appear so</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  <span class="comment">// g^{pp} inf taken care of in metric.c by avoiding theta=0,Pi</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;}</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="keywordtype">void</span> check_rmin(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;{</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,k;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> X[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],V[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],r;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;  <span class="comment">// diagnostic</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  <span class="comment">// determine nature of inner radial edge (assumes myid==0 is always there)</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;  <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    i=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a1cf005fa390f99c43c1dc90bb971c426">INFULL1</a>;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    j=k=0;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a041e7b005310415c97d90f4b8521ed1a" title="get X(i,j,k) CENT is default position in degenerate cases">coord</a>(i,j,k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, X);</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    <a class="code" href="../../d9/de9/coord_8c.html#a65ad4ca9656d141cc995fd35ed31dc40" title="Returns boyer-lindquist coordinte of point.">bl_coord</a>(X, V);</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    r=V[1];</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    trifprintf(<span class="stringliteral">&quot;rmin(i=%d,X=%21.15g) = %21.15g\n&quot;</span>, i,X[1],r);</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    trifprintf(<span class="stringliteral">&quot;r=%21.15g Rhor=%21.15g :: rmin/rh: %21.15g\n&quot;</span>,r,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>, r / (fabs(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>)+SMALL) );</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <span class="comment">//    trifprintf(&quot;rmin/rsing: %21.15g\n&quot;, r / (a+SMALL));</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    <span class="keywordflow">if</span>(r/(fabs(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>)+SMALL)&lt;=1.0){</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;      trifprintf(<span class="stringliteral">&quot;inner grid is inside horizon\n&quot;</span>);</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    }</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;      trifprintf(<span class="stringliteral">&quot;inner grid is outside horizon\n&quot;</span>);</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    }</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  }</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  <span class="comment">// show cells that are inside horizon</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>/2 &amp;&amp; <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]==0){</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    j=0;</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    k=0;</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <a class="code" href="../../da/db2/global_8loops_8manypoints_8h.html#a8f7c05b4d7a80108f2b5faa3157f04ec">LOOPF1</a>{</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;      <a class="code" href="../../d9/de9/coord_8c.html#a041e7b005310415c97d90f4b8521ed1a" title="get X(i,j,k) CENT is default position in degenerate cases">coord</a>(i,j,k, <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a1df736ddba855d7b429869f9f09dbd66">FACE1</a>, X);</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;      <a class="code" href="../../d9/de9/coord_8c.html#a65ad4ca9656d141cc995fd35ed31dc40" title="Returns boyer-lindquist coordinte of point.">bl_coord</a>(X, V);</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      r=V[1];</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <span class="keywordflow">if</span>(r&lt;<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>){</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        logfprintf(<span class="stringliteral">&quot;INSIDE Horizon (r=%g): i=%d r=%21.15g\n&quot;</span>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a20e81ef2343c6d8db701c6613cbcd279">Rhor</a>, i, r);</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      }</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      </div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    }</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  }</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:34 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
