<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: docs/pnmhd/8.txt File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">docs/pnmhd/8.txt File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="fragment"><div class="line">More on BCs</div>
<div class="line">Version 1 Created by Jonathan <a class="code" href="../../d9/d53/metric_8c.html#a52037c938e3c1b126c6277da5ca689d0">M</a>. on 30 May 2009.</div>
<div class="line">1) PUREBC:</div>
<div class="line"></div>
<div class="line">PUREBC (as it says in global.h) means all boundaries are the same type, but it still uses some specialized boundary code. If you are using your own boundary code then it shouldn’t matter what PUREBC is as you can check by looking for the few instances of PUREBC in the .h and .c files. BTW, I assume you wrote your own boundary code and then in global.h there’s the code segment:</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if(BOUNDTYPE==1)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define init_bc init_bc_rect1</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#elif((BOUNDTYPE==2)||(BOUNDTYPE==3))</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define init_bc init_bc_gen1</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">that chooses the <span class="keyword">function</span>. You should have chosen (say) BOUNDTYPE==1 above this code segment and then put your function name in there or just make your function name that one and change files to your file.</div>
<div class="line"></div>
<div class="line">PUREBC=0 or 1 just chooses whether to allow definition of the boundaries in terms of on-off switches. However, you shouldn’t be using the bcs/bcv’s.</div>
<div class="line"></div>
<div class="line">So it shouldn’t have mattered if PUREBC is on or off. You should make sure you see why it did.</div>
<div class="line"></div>
<div class="line">2) While there exists some code like that already, as many things in this code it’s quite complicated. The simplest thing to do is create your own function. It’s very easy so don’t worry — you’ll learn fast.</div>
<div class="line"></div>
<div class="line">You want to do something like this:</div>
<div class="line"></div>
<div class="line">a) Write a function that does the local integral on a single CPU (i.e. no references to CPUs at all).</div>
<div class="line"></div>
<div class="line">b) If you are integrating and need the result to file, then just use CPU=0 to write to file and do:</div>
<div class="line"></div>
<div class="line">MPI_Reduce(&amp;value,&amp;value_summed,numberelements,MPI_FTYPE,MPI_SUM,0, MPI_COMM_WORLD);</div>
<div class="line"></div>
<div class="line">If you are integrating and need all CPUs to ALL have the result, then do:</div>
<div class="line"></div>
<div class="line">MPI_Allreduce(&amp;value,&amp;value_summed,numberelements,MPI_FTYPE,MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"></div>
<div class="line">If you are averaging then just also sum-<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a1df03026db3aa663afda0c9eed67408e">up</a> the denominator and then after “reducing” both just divide them.</div>
<div class="line"></div>
<div class="line">Note in this case there is no need to know anything about the CPU layout.</div>
<div class="line"></div>
<div class="line">Also, when making these MPI calls, make sure to make the code so that if <span class="preprocessor">#define USEMPI 0, then the code still compiles and works. This means putting #if(USEMPI) #endif around the MPI calls and then making sure the code STILL works correctly.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">You can see <a class="code" href="../../d3/da1/diag_8c.html#a33d4865bef4d1e548c3d10b3839adf67" title="main diag() call for diagnostics OPENMPNOTE: Assume diag() not called by multiple threads...">diag</a>.c in diag_ener() for this type of thing being done, although again the code is complicated in there. I highly recommend making things as modular as possible — which I did not do.</div>
</div><!-- fragment --> 
<p>Definition in file <a class="el" href="../../d6/dbb/8_8txt_source.html">8.txt</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:36 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
