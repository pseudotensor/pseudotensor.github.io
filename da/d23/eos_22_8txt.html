<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: docs/eos/2.txt File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">docs/eos/2.txt File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="fragment"><div class="line">2) Generating EOS table from EOS Fortran code</div>
<div class="line">Version 1 Created by Jonathan <a class="code" href="../../d9/d53/metric_8c.html#a52037c938e3c1b126c6277da5ca689d0">M</a>. on 03 Jul 2009.</div>
<div class="line"></div>
<div class="line">Overall, <span class="keyword">this</span> document explains how to generate EOS tables that are ultimately used in HARM.</div>
<div class="line"></div>
<div class="line">*Create Shen EOS table that is interpolated onto uniform grid with desired range and resolution*</div>
<div class="line">1) Using relativity <span class="keywordflow">for</span> Matlab because 32-bit and problem with 64-bit when <span class="keyword">using</span> <span class="stringliteral">&quot;mex&quot;</span> <span class="keyword">function</span> calls.  Matlab core <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89abceb1f5e607b7074378156fa8f94b">dumps</a>.</div>
<div class="line">below uses matlabscripts/shen_interp.m that should be copied <span class="keyword">using</span> gethelmmatlabs.sh on the system <span class="keyword">using</span> Matlab so it<span class="stringliteral">&#39;s located in matlab@&lt;machine&gt;:matlab/</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">2) Run Matlab interpolation script:</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">cd helmeoscode</span></div>
<div class="line"><span class="stringliteral">sh sheneosinterp.sh &quot;&quot;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">*Below not required anymore since NaN or Inf&#39;</span>s are taken out in Matlab:*</div>
<div class="line">3) sed <span class="stringliteral">&#39;s/NaN/0.0/g&#39;</span> sheneos.dat &gt; sheneosnonnan.dat ; cp sheneosnonnan.dat sheneos.dat</div>
<div class="line"></div>
<div class="line">*Review Shen EOS table in SM*</div>
<div class="line">1) go to shen_helm_eostable directory</div>
<div class="line">2) rdshentable0</div>
<div class="line">3) plc 0 xalfa</div>
<div class="line">  To see values on contour plot <span class="keywordflow">do</span>: image cursor </div>
<div class="line">  Then click on a point and <span class="keyword">get</span> the reported value</div>
<div class="line">4) Set WHICHLEV and PLANE to see other slices of 3D data </div>
<div class="line"></div>
<div class="line">*And also look at Matlab interpolated/processed Shen Table</div>
<div class="line">1) go to shen_helm_eostable directory</div>
<div class="line">2) rdshenmatlab</div>
<div class="line">3) plc 0 aheav</div>
<div class="line">  To see values on contour plot <span class="keywordflow">do</span>: image cursor</div>
<div class="line">  Then click on a point and <span class="keyword">get</span> the reported value</div>
<div class="line">4) Set WHICHLEV and PLANE to see other slices of 3D data </div>
<div class="line"></div>
<div class="line">*Create full EOS table*</div>
<div class="line">1) Go to helmeoscode directory</div>
<div class="line">2) Can change things in eosparms.f, kazeos.parms.dek and kazeos.loopparms.dek</div>
<div class="line">3) In kazeos.parms.dek:</div>
<div class="line"> <a class="code" href="../../d3/d10/image_8c.html#a1291f416b069313021b519eea62d5bf1">NORMAL</a> FULL Ye,Ynu dependent EOS has:</div>
<div class="line">  parameter (whichrnpmethod = 1)</div>
<div class="line">  parameter (whichynumethod = 1)</div>
<div class="line">  parameter (whichhcmmethod = 0)</div>
<div class="line"> SIMPLE Ynu quasi-thermalization table has [also used for stellar model compilation]</div>
<div class="line">  parameter (whichrnpmethod = 1)</div>
<div class="line">  parameter (whichynumethod = 0)</div>
<div class="line">  parameter (whichhcmmethod = 1)</div>
<div class="line">4) kazeos.loopparms.dek: Sets ranges of table in rho,T,(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a333bf60038d1801707ebf78ebdebdaea">H</a> if whichhcmmethod==1), Y_e, Y_nu space</div>
<div class="line">  For whichynumethod==0, must set ntydynorynu=1 and probably set value range from 1 to 1</div>
<div class="line">5) <a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> ../joneoscode/jonmod/ ; make clean ; make ; <a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> ../../helmeoscode/ ; make clean ; make</div>
<div class="line">6) sh copyjonhelm.sh &lt;<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>&gt;  (e.g. sh copyjonhelm.sh ../fulltabletest1)</div>
<div class="line">7) <a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> &lt;<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>&gt;</div>
<div class="line">8) rm -<a class="code" href="../../d9/d54/other6_8txt.html#a159e0e9e544b9a0c44070100099776de">rf</a> eos.head eosdetails.dat eosother.dat eos.dat eoscoulomb.dat eosazbar.dat</div>
<div class="line">9) nohup ./helmeos.exe  &amp;&gt; output.txt &amp;</div>
<div class="line"></div>
<div class="line">9.5) If want to generate large table that takes a lot of time, can run on multiple CPUs on cluster and just collate files in the end.  For example, to chunk with 200 CPUs, do:</div>
<div class="line"></div>
<div class="line">echo &quot;1 200&quot; &gt; eoschunk.dat</div>
<div class="line">nohup ./helmeos.exe  &amp;&gt; output.txt &amp;</div>
<div class="line"></div>
<div class="line">This will produce chunk <span class="preprocessor">#1 of 200 chunks.  Iterate 1 through 200 for each of the 200 CPUs.  One could script the creation of the eoschunk.dat file.  Ensure to collate in order of the chunk number or have to sort after and that will be slow and require use of bash&#39;s &quot;sort&quot; command.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">9.7) If want to submit a batch job with either many jobs with some number of CPUs per job or as a single job <span class="keyword">using</span> a <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0050aa7bf7fc92a690eec015acb18800">C</a> MPI wrapper, see helmeoscode/scripts/chunkbunch.sh .  For example, following install0.sh on lonestar.tacc.utexas.edu, one does in the data directory:</div>
<div class="line"></div>
<div class="line">sh chunkbunch.sh 5 . 256</div>
<div class="line"></div>
<div class="line">This will generate a bsub job with 256 cores <span class="keyword">using</span> MPI but running a single chunk (out of total 256 chunks) on each core.</div>
<div class="line"></div>
<div class="line">This is the most efficient way.  See scripts.</div>
<div class="line"></div>
<div class="line">*Review FULL EOS table in SM*</div>
<div class="line">1) load SM</div>
<div class="line">2) load macros:</div>
<div class="line">  gogrmhd</div>
<div class="line">  jre kaz.m</div>
<div class="line">  jre grbmodel.m</div>
<div class="line">3) Run macros:</div>
<div class="line">  rdmykazeos eos.dat</div>
<div class="line">  rdmykazeosother eosother.dat</div>
<div class="line">  rdhelmcou eoscoulomb.dat</div>
<div class="line">  rdhelmextra eosazbar.dat</div>
<div class="line">4) Plot few things setup to setup in 3D space from 4D data (e.g.):</div>
<div class="line">  plc 0 (LG(mydptot))</div>
<div class="line">  plc 0 (LG(mydutot))</div>
<div class="line">  plc 0 (LG(mydstot))</div>
<div class="line"></div>
<div class="line">5) Some other things not yet with 4D-&gt;3D copy, but still can view:</div>
<div class="line">  showpressure 1 1</div>
<div class="line">  plcs2helm</div>
<div class="line">  agzplc <span class="stringliteral">&#39;dump&#39;</span> cs2helm</div>
<div class="line">6) Show where nuclear EOS converged:</div>
<div class="line">  pleos2dconv</div>
<div class="line"></div>
<div class="line">*Process EOS with Matlab to produce <span class="stringliteral">&quot;new&quot;</span> table used by HARM*</div>
<div class="line">*Assume have access via ssh; probably have matlab<span class="stringliteral">&#39;s ~/.ssh/authorized_keys with that users public key inside added to the file*</span></div>
<div class="line"><span class="stringliteral">1) *Create eosparms.head*</span></div>
<div class="line"><span class="stringliteral">eosparms.head filled with (e.g.):</span></div>
<div class="line"><span class="stringliteral">1E-8 1E-8 1E-8 1E-8 1E-14 1E-14 1E-14 1E-14</span></div>
<div class="line"><span class="stringliteral">2) *If desired, copy data-directory to another computer (say from ki-rh39 to ki-rh42) before processing on the new computer*</span></div>
<div class="line"><span class="stringliteral">e.g. scp -rp &lt;dir&gt; jon@ki-rh42:&lt;otherdir&gt;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">3) Ensure latest Matlab scripts.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">a) If one believes Matlab scripts may have changed, then do:</span></div>
<div class="line"><span class="stringliteral">  ssh matlab@ki-rh42</span></div>
<div class="line"><span class="stringliteral">  cd matlab</span></div>
<div class="line"><span class="stringliteral">  export HOST=&lt;your host&gt;</span></div>
<div class="line"><span class="stringliteral">  export USER=&lt;your username&gt;</span></div>
<div class="line"><span class="stringliteral">  export REMOTEDIR=&lt;your directory with matlabscripts and helmeoscode directory on your machine&gt;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">  scp $USER@$HOST:&quot;$REMOTEDIR/matlabscripts/eos_extract.m $REMOTEDIR/matlabscripts/monotonize.m $REMOTEDIR/matlabscripts/shen_interp.m&quot; .</span></div>
<div class="line"><span class="stringliteral">  scp $USER@$HOST:&quot;$REMOTEDIR/helmeoscode/enforce_x_consistency.mex.f $REMOTEDIR/helmeoscode/enforce_ye_consistency.mex.f $REMOTEDIR/helmeoscode/compute_nuclear_azbar.mex.f $REMOTEDIR/helmeoscode/general_compute_functions.f $REMOTEDIR/helmeoscode/eosparms.f $REMOTEDIR/helmeoscode/const.dek $REMOTEDIR/helmeoscode/gethelmmatlabs.sh $REMOTEDIR/helmeoscode/sheneosinterprunmatlab.sh&quot; .</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">  exit</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">b) If using own version of Matlab</span></div>
<div class="line"><span class="stringliteral">  Can get matlab scripts if using local Matab:</span></div>
<div class="line"><span class="stringliteral">svn checkout https://harm.unfuddle.com/svn/harm_matlabscripts/ &lt;some directory&gt;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">But note that original source for eos_extract and mex files is actually in joneoscodes/helmeoscode/ and joneoscodes/joneoscode/jonmod/</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">5) *Convert to HARM form*</span></div>
<div class="line"><span class="stringliteral">*sh eosextract???.sh : Choose the version of script to run. Normal is (with mod of DIR=) (takes &lt; 1 hour for 50x50x50x1x1): e.g.:*</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">sh eosextract2c.sh remotedirtest1 test1</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">6) If Matlab script doesn&#39;</span><a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a> run, then ensure matlab server running:</div>
<div class="line">ssh matlab@ki-rh42</div>
<div class="line">/data/opt/matlab/etc/lmstart</div>
<div class="line">exit</div>
<div class="line"></div>
<div class="line">*Check that files exist and make sense: eosmonodegen*.dat , eosnew*.head , eosnew*.dat , eosdegennew*.dat</div>
<div class="line"></div>
<div class="line">7) Link <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a1df03026db3aa663afda0c9eed67408e">up</a> to standard names (e.g.):</div>
<div class="line"></div>
<div class="line">ln -s eosnewtest1.head eosnew.head</div>
<div class="line">ln -s eosnewtest1.dat eosnew.dat</div>
<div class="line">ln -s eosmonodegentest1.dat eosmonodegen.dat</div>
<div class="line">ln -s eosdegennewtest1.dat eosdegennew.dat</div>
<div class="line"></div>
<div class="line">*Review Matlab-generated EOS files in SM:*</div>
<div class="line">1) Be in directory with eosnew* files generated above</div>
<div class="line">2) load sm</div>
<div class="line">3) load macros:</div>
<div class="line"> gogrmhd</div>
<div class="line"> jre kaz.m</div>
<div class="line"> jre kazpostmatlab.m</div>
<div class="line">4) Run macros:</div>
<div class="line">rdjoneos <span class="stringliteral">&#39;test1&#39;</span></div>
<div class="line">rdjondegeneos <span class="stringliteral">&#39;test1&#39;</span></div>
<div class="line"></div>
<div class="line">5) Check some things about EOS:</div>
<div class="line">  jre kaz.m</div>
<div class="line">  jre grbmodel.m</div>
<div class="line">  jre kazpostmatlab.m</div>
<div class="line"></div>
<div class="line">  checkeossimplenew</div>
<div class="line">  plc 0 (LG(rhob))</div>
<div class="line"></div>
<div class="line">6) Check monotonicity of pre-Matlab EOS</div>
<div class="line">  jre kaz.m</div>
<div class="line">  jre grbmodel.m</div>
<div class="line">  jre kazpostmatlab.m</div>
<div class="line"></div>
<div class="line">*Pre-Matlab plot of EOS near degeneracy*</div>
<div class="line">  checkhelmmonoeos 1 0</div>
<div class="line">*Pre-Matlab with degendiff shown: Bad points are red -- not working as desired yet*</div>
<div class="line">  redohelmmono 1 0</div>
<div class="line">*See whether monotonic: Any visible lines are not monotonic somewhere*</div>
<div class="line">  nonmonosequence2</div>
<div class="line"></div>
<div class="line">------------------------------------------------------------------------------------</div>
<div class="line">Example EOS table from HELM and from Matlab script to be used by HARM:</div>
<div class="line"></div>
<div class="line">http:<span class="comment">//www.slac.stanford.edu/~jmckinne/testfulleostable2.zip</span></div>
</div><!-- fragment --> 
<p>Definition in file <a class="el" href="../../da/d23/eos_22_8txt_source.html">2.txt</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:36 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
