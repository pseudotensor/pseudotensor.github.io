<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: global.depmnemonics.rad.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">global.depmnemonics.rad.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../da/d04/global_8depmnemonics_8rad_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#aed3da9b83aacca64b5116ccb625776ba">   15</a></span>&#160;<span class="preprocessor">#define GGG (GGG0/gTILDA) // cgs in cm^3/(kg s^2)</span></div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a5855d340b80e30f773cd3e4ff36e5f7a">   16</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CCCTRUE (CCCTRUE0/cTILDA) // cgs in cm/s</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a877b0121321c7bd7be53b81a6fd26224">   23</a></span>&#160;<span class="preprocessor">#define MSUNCM (GGG*MSUN/(CCCTRUE*CCCTRUE)) // Msun in cm</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#aff6e1b59e82b351a97439955d09d9a3f">   32</a></span>&#160;<span class="preprocessor">#define LBAR (GGG*MPERSUN*MSUN/(CCCTRUE*CCCTRUE)) // cgs in cm</span></div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a9c048becda477dc608373effba1f1fea">   33</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TBAR (LBAR/CCCTRUE) // cgs in s</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#af9125a077287c7502fe99733f95c21f3">   34</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VBAR (LBAR/TBAR) // cgs // HARM requires this be CCCTRUE!</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a2d44e13624149f4e7039e3b5f30b1142">   35</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define RHOBAR (1.0) //cgs so density unit is 1g/cm^3</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a761b896c3b3b682e09ba21bff9dd8946">   36</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MBAR (RHOBAR*LBAR*LBAR*LBAR) // cgs in grams</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a1e5050833ea87ea4c0fb14d2a6b8c5c8">   37</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ENBAR (MBAR*VBAR*VBAR) // cgs energy in ergs</span></div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#aec26079e7f8db2627689ae90c352586f">   38</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define UBAR (RHOBAR*VBAR*VBAR) // cgs energy density in ergs/cm^3</span></div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a5dbb8dcdb46e75d92683851550d17195">   39</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NDENRATEBAR (1.0/(LBAR*LBAR*LBAR*TBAR))</span></div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#aeb0c1662cbe667ff3bb067f49217aa34">   40</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define EDENRATEBAR (ENBAR/(LBAR*LBAR*LBAR*TBAR))</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#ae6e6a0862165b2979cae17c3414501a9">   41</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define BFIELDBAR (VBAR*sqrt(RHOBAR))  // speed ~ b/sqrt(rho)</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a01551aa4ef762e8bc2189d417dd3eafd">   42</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TEMPBAR (M_PROTON*CCCTRUE*CCCTRUE/K_BOLTZ) // cgs unit of temperature in Kelvin (used to make Kelvin dimensionless)</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor"></span><span class="comment">// so for (e.g.) ideal gas, ucode = rhocode * Tcode using u=\rho_0 k_b T / (m_b c^2)  gives both ucode and rhocode in g/cm^3</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// NOTEMARK: If IC has RHO~UU in terms of units, then need to use RHOBAR to make each dimensionless.  Else add explicit CCCTRUE^2 prefactor in IC value of UU (i.e. energy density) before normalizing with UBAR.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// Note: Interaction requires specific mass unit, which determines code value of ARAD, KAPPAs, and how initial conditions (IC) are chosen.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// Code versions of constants required for radiation interaction</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a968f1d911bdedc8c0f7acb9aa8ea7c1e">   60</a></span>&#160;<span class="comment"></span><span class="preprocessor">#define ARAD_CODE_DEF (ARAD*(TEMPBAR*TEMPBAR*TEMPBAR*TEMPBAR)/UBAR)</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">// CRAD = 60 sigma/pi^4/kb^4 and arad=4*sigma -&gt; CRAD = 15 arad/kb^4/pi^4 = 15 aradcode/pi^4</span></div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a0f38d83a4a498cf6f9c2897f3eb6f1e8">   64</a></span>&#160;<span class="preprocessor">#define EBAR0 (2.7011780329190638961) // 2.70118 kb T = Ruu/nradff = average energy per photon</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a8ded610d7fb238e05e68de5e2fff557c">   65</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CRAD0 (15.0/(M_PI*M_PI*M_PI*M_PI)) // 0.15399</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">// Physical choices for plasma composition</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// Sun-like stars: X=0.75, Y=0.23, Z=0.02, so may be applicable to X-ray binaries</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">// Solar: X=0.70 Y=0.28 Z=0.02 by mass, neutral MUMEAN=1.3, ionized MUMEAN=0.62</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a4e1598dceb76667af68809bd4fdc66ae">   76</a></span>&#160;<span class="preprocessor">#define XSOLAR (0.7)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a3664df34f20500563d201ea237cc4cf8">   77</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define YSOLAR (0.28)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#ab34f70d07a92c55e06f69d57bd0a16a2">   78</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ZSOLAR (1.0-(XSOLAR+YSOLAR))</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor"></span><span class="comment">// Big-Bang: X=0.77 Y=0.23 Z=0.00</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">// post-Big-Bang: X=0.6 Y=0.4 Z=0, so applicable to GRBs from Pop3 stars.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a67027a9cddec1bd34d5393428722fade">   82</a></span>&#160;<span class="preprocessor">#define XFACT (0.7) // Hydrogen mass fraction</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a7d78b721fe8ae725d7c275e7c1504963">   83</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define YFACT (0.28) // Helium mass fraction</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a46f1b5ea915629f2da83d890777c4fd7">   84</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define AVG10AJ (1.0/15.5) // for solar composition.  Not used unless MUMEAN is chosen to be for neutrals.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#aa14581529bda7a88f56a1c6a608ed5d1">   87</a></span>&#160;<span class="preprocessor">#define ZFACT (1.0-(XFACT+YFACT)) // Rest.  Called &quot;metals&quot;.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor"></span><span class="comment">// http://www.astro.wisc.edu/~townsend/resource/teaching/astro-310-F08/21-eos.pdf</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#aae999f67099ea091005908ebf24ca608">   89</a></span>&#160;<span class="preprocessor">#define MUELE (2.0/(1.0+XFACT)) //(1.0/(XFACT + 0.5*(YFACT+ZFACT))) // inverse of Ye = electron fraction by baryon mass</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor"></span><span class="comment">// n_e = Y_e n_b</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a31f54c0221b0f7f885da11867cacc540">   91</a></span>&#160;<span class="preprocessor">#define YELE (1.0/MUELE)</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#ac3304fef3d977a82e5372530aa87c548">   92</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MUMEANNEUTRAL (1.0/(XFACT + 0.25*YFACT + AVG1OAJ*ZFACT))</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#ac574a99e80bd46b99916b733583627d5">   93</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MUMEANIONIZED (1.0/(2.0*XFACT + 0.75*YFACT + 0.5*ZFACT))</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor"></span><span class="comment">// n_b = \rho_0/(\mu_{mean} m_a)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a68bdb87839e246044ea60371ad120813">   95</a></span>&#160;<span class="preprocessor">#define MUMEAN (MUMEANIONIZED) // ASSUMPTION: fully ionized // CHOICE</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">//#define TEMPMINKELVIN (1.0E+2) // Kelvin // Problem with consistency in error function and entropy estimate for URAD method.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#acf1be39543af2d68375f7a69b720af77">   99</a></span>&#160;<span class="preprocessor">#define TEMPMINKELVIN (1.0E-10) // Kelvin</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a213757d7585988f6c552da30cc6fcc39">  100</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TEMPMIN (TEMPMINKELVIN/TEMPBAR) // Code units</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">// Opacities in code units</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a0dba3fdf8ccb132be1cf14a5d7c69993">  110</a></span>&#160;<span class="preprocessor">#define OPACITYBAR (LBAR*LBAR/MBAR) // cgs in cm^2/g</span></div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a1d321391aadcedcc6bcd42f75ec206b0">  111</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TEMPELE (MELE*CCCTRUE*CCCTRUE/K_BOLTZ)</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">// choose which type of opacity calculation to use</span></div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a1e35a06d52ec29bfa4696abbbc8954ae">  115</a></span>&#160;<span class="preprocessor">#define ISFITORIG 1</span></div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#ab851132789fe25b5e69211e91e074cc3">  116</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ISFITNEW 1</span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#ab08f290acf86b911101824c0c34b3084">  117</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define WHICHFIT ISFITORIG // choose</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// whether to allow kappa to depend explicitly upon position, which would require getting position and can be expensive.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#ae139e38772f51b3c13bf86ff8abb1c05">  121</a></span>&#160;<span class="preprocessor">#define ALLOWKAPPAEXPLICITPOSDEPENDENCE 0</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">// Notes on differences with Koral setup</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">// 1) Units:</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">// 1a) Koral sets mass scale as M (i.e. black hole mass), where I set it via the density scale of 1g/cm^3</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">// 1b) Koral&#39;s M is mass per unit Msun, just like my MPERSUN, but as 1a, my mass scale is independent of MPERSUN</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">// 1c) RADOUTPUTINZAMO sets output of koral in orthonormal basis in zamo frame.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">// 1d) Koral hard codes MASSCM, which makes it hard to match for similar constants when gTILDA is changed.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">// 2) Algorithmic differences:</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">// 2a) Koral currently uses v=c as the wavespeed limit when including radiation</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">// 2b) Koral (and now koralinsert) updates radiation source term with dUgeom+dUriemann.  Required for high opacity cases (e.g. RADPULSEPLANAR) to avoid diffusion.  See notes elsewhere.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">// 2c) Koral typically uses MINM with theta=1, but uses MP5 when needing more accuracy</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">// 3) Details:</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">// 3a) Koral&#39;s F and U in LAXF have no \detg</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">// 4) Runtime differences:</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">// 4a) Koral is defaulted to use OpenMP , and default is full use of all cores, so any output from parallel loops will be randomly ordered.  remove -fopenmp to get linear debug output.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">// Koral units conversions</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"></span><span class="comment">// Olek keeps changing gTILDA and cTILDA in different code versions, and so actually changing the problems despite PROBLEM files wanted to describe specific problem as in (e.g.) the paper.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a8c229beec8f23da136adcbb0276e4c69">  150</a></span>&#160;<span class="preprocessor">#define MASSCM (GGG*MPERSUN*MSUN/pow(CCCTRUE,2.0))</span></div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="code" href="../../da/d04/global_8depmnemonics_8rad_8h.html#a725050701c5cd10e73287d42caecebd1">  151</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define KORAL2HARMRHO(rho) ((rho/GGG*CCCTRUE*CCCTRUE/MASSCM/MASSCM)/RHOBAR)</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">//At this point actually everything seems to be working very well qualitatively.  Some effort went into adding tests, fixed the boundary conditions, adding all the missing pieces of code (opacity limiter), getting u2p_rad() to be more generally robust via HARM-like fixups (both inside u2p_rad() and using fixup_utoprim()), coding-up tetrad stuff that might be used, getting units to make sense, debugging the opacity and source terms, folding koral into HARM&#39;s general EOS framework, etc.  Check the git log for some other details.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">//Many things left to do:</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">//0) Setup all the rest of the problems.  Now that code actually works (Hurray!) and is no longer incomplete (whew), we can add the other test problems.  We also need to think of MHD test problems for the new paper.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">//1) See KORALTODO or SUPERGODMARK anywhere, and you&#39;ll see an issue.</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">//3) Implicit use of Uptorprimgen() needs to allow only a few steps to be taken -- no point in getting machine accurate U-&gt;p there if taking multiple implicit steps.  But often only take 1-2 implicit steps, so need to be careful.</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">//4) If Utoprimgen fails in implicit, won&#39;t converge, so need a backup method.  Koral backup won&#39;t work for rel flows, so need to sub-cycle with explicit scheme or use a different semi-implicit scheme like one I mentioned from numerical recipes.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">//6) Need to check factors of Pi and 1/4 for B in calc_Gu as well as 4\pi in Gu.  Are those really dimensionless and should be there?</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">//7) I&#39;m unsure about Olek&#39;s velocity limiter for tau&gt;1.  I&#39;m not sure the 4/3 is right.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">//8) Not sure if reversions in u2p_rad() are all agreeable.  Better than prior choices, but e.g. CASE2B is a concern.  It&#39;s what also caused the implicit method to fail when CASE2B is hit.  Need some backup approach for CASE2B situation.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">//9) Iteration and other constants as in global.depmnemonics.rad.h need to be chosen intelligently.  Can&#39;t always just be 1E-6.  For the MHD inversion, machine precision accuracy is always sought.  Maybe required for radiation sometimes.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">//10) #9 is only possible if the equations are written to avoid catastrophic cancellation.  Maybe G and other terms have catastrophic cancellation issues.  E.g., kappaes cancels in Gu for static flow, but maybe other actual serious cancellation issues somewhere.  Yes, catastrophic issue in u2p_rad() for non-rel limit is fixed.  Maybe issue in ultrarel limit!</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">/* Hi guys, */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">/* Regarding M1&#39;s imperfection, there are many studies on using radiative transfer in planetary and stellar atmospheres, and Shane is probably fully aware of the issues.  It&#39;s well known what fundamental things one misses with various approximations.  Even Wikipedia goes through some of those things (http://en.wikipedia.org/wiki/Two-stream_approximation_(radiative_transfer)!  But apart from those papers I mentioned that are astro-centric, there are *many* papers (just google) that go through why the 2-stream approximation is so great and what we would miss. */</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">/* We&#39;d want to get that effective 2-stream approximation per grid cell, and we are *far* from it.  So we&#39;ll miss many basic physics effects.  This includes the ability to treat multiple scatterings when we involve Compton scattering. */</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">/* But forgetting about scattering, I think the main problem is directional independence in the optically thin limit.  Per-grid cell independence for each face would be a basic freedom.  Here&#39;s how the method would work: */</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">/* 1) In each cell, in the averaged energy-weighted radiation rest frame (average of, e.g., R^t_\mu over bins), we split the angles up into bins/bands.  Easiest is 2N to 4N for N-dimensions giving 8N to 16N new variables.  Only increases total number of variables from current 12 to 24 (or 48) -- so factor of only two (or up to four). */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">/* 2) Once the problem has been setup (one now can control (per-cell) multiple radiation directions and energy densities), those are evolved with the flux conservative approach like normal to get the new U.  There&#39;s no interaction between bins at the flux level, but radiation might want to change its bin -- but that&#39;s not done yet (maybe it&#39;s a good idea to rebin here already, but maybe not). */</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">/* 3) The source term is applied.  The cumulative radiation source still applies to the fluid.  Each radiation bin has its own independent source value determination/step as if the other bins don&#39;t exist.  After each internal implicit/explicit source step, the new value of R^t_\mu is compared to the average R^t_\mu and we rebin each bin at each implicit step if the radiation wants to be in a new bin.  This allows for interaction between bins at the source term level (maybe this isn&#39;t required, but it probably is). */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">/* 4) We do the final U-&gt;P and determine if rebinning (e.g. just even due to fluxes) is required by using each bin&#39;s R^t_\mu as compared to the average.  If already rebinnned at #2 and #3, then no rebinning required here except as related to how harm or koral updates variables (i.e. harm and koral don&#39;t update U during implicit and instead keep it as a dU that later gets added). */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">/* This takes the flux step (during which no rebinning yet occurs) and source step (during which rebinning can occur) and doing the inversion (during which rebinning can occur) to get new values for the radiation for each bin.  This allows for direct interaction between beams via the sources during stage 3, or the fluxes evolve the beam to get rebinned during stage 4. */</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">/* Notes: */</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">/* 1) The 4-force and u2p_rad() assume isotropic emission in the radiation frame.  We don&#39;t violate this because each beam bin is consistent with this.  The only &quot;violation&quot; occurs during rebinning, which just merges or splits beams and conserves energy-momentum -- there&#39;s no violation of isotropy per beam when isotropy is assumed. */</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">/* 2) The only non-linearity for R^t_\mu enters in the source step.  But as far as a solution to the equations of motion that determines whether U-&gt;P can be done, by the linearity of the equations, if R^t_\mu is a solution, so is any other sum of other solutions, so we can&#39;t run into the sum being a non-solution (i.e. no primitive).  Even analytically, the source step could have a crazy cooling or heating that ends up giving bad U-&gt;P, but not the advection+geometry part. */</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">/* Let me know what you think -- if there are gaps or errors. */</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:33 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
