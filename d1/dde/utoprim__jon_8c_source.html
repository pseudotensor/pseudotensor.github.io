<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: utoprim_jon.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">utoprim_jon.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d1/dde/utoprim__jon_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/u2p__defs_8h.html" title="U-&gt;P inversion definitions for all utoprim files.">u2p_defs.h</a>&quot;</span> <span class="comment">// only includes #define&#39;s</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d1c/utoprim__jon_8h.html" title="U-&gt;P inversion definitions for utoprim_jon.c.">utoprim_jon.h</a>&quot;</span> <span class="comment">// only includes #define&#39;s</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8b70e89b2aa5f70dc5e3da2fd32b697a">   17</a></span>&#160;<span class="preprocessor">#define DEBUGINDEX 0</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor"></span><span class="comment">// </span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ifileglobal,jfileglobal,kfileglobal,pfileglobal;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> Utoprim_new_body(<span class="keywordtype">int</span> showmessages, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> U[NPR], <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom,  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pressure, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> raise_g(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vcov[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a98399a5a291e3844900ecfbacdcb2da0">gcon</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vcon[]);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> lower_g(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vcon[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a93300df7bd864b90cc8ed9f3d96515ad">gcov</a>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vcov[]);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ncov_calc_fromlapse(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> lapse,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ncov[]) ;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ncov_calc(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a98399a5a291e3844900ecfbacdcb2da0">gcon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>],<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> ncov[]) ;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ecaf51048018ba1c14b2cd7d83e1bd6" title="re-look at this GODMARK Solution to the cold GRHD equation P^2 = ...[Wp]">coldgrhd</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a796ba9b859f5938812742d89b0238806" title="returns v^2&gt;=1 does NOT depend on EOS W^3 (W+2B^2) - S^2 (2W+B^2)  W^2 (P^2-B^4) GODMARK: vsqgtr1 bas...">vsqgtr1</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq_calc(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dvsq_dW(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a62f2a5c601be1d1e2a02a002b6589b5c">Eprime_Wp</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#afe17864b47716e97813efc16988f8184" title="new version without poles returns actually W^2 P^2 Note that this does NOT use Qdotn or Qdotnp (from ...">Psq_Wp</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *resid, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *norm);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#adb5a3bde8a0f684bc7a2c2810b5871ec" title="new version without poles result = d(W^2 P^2)/dWp = Note that this does NOT use Qdotn or Qdotnp (from...">dPsqdWp_Wp</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq_calc(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a01f12f1b393e896ea7f1c5279356efc4" title="returns ^2 Note that this does NOT use Qdotn or Qdotnp (from energy equation) so works for entropy ev...">gammasq_calc_W</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq_calc(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab0bc808b2bebcc0555091f4fb9105772" title="validate solution:">validate_Wp</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpold, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wpnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0" title="retvsq=0 : no problem retvsq=1 : &gt;=1.0 retvsq=2 : &lt; too negative retvsq=3 : &gt;VSQ_TOO_BIG (forced fail...">validate_vsq</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsqold,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *vsqnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a402afc99b00c69ea3dadd658030ae1ad" title="check on v^2&gt;1 failure">check_utsq_fail</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> pressure_W_vsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq) ;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> pressure_Wp_utsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dpdW_calc_vsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dpdWp_calc_utsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dpdvsq_calc2_Wp(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dpdvsq_calc(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dpdWp_calc_utsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a7bf3b2502fc4ec9b001ecc0fa11cb101" title="EOS-related things for entropy evolution.">Ss_W_vsq</a>(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq) ;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ss_Wp_utsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a022a23ecb7e4416db963019561ecc92b">dSsdW_calc_vsq</a>(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dSsdWp_calc_utsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dSsdvsq_calc2_Wp(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a5cf890c02faf04d622022cc7a27307eb">dSsdvsq_calc</a>(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dSsdWp_calc_utsq(<span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa64047229272de421ebf9e37e9c7baf8" title="Find Root wrappers:">find_root_1D_gen</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab6e4060e2c11ad1fd390e15607b849ee">find_root_1D_gen_scn</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a2c3695a6bccd8e5de8daa9c35c442b96">find_root_1D_gen_Eprime</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a996cb5387934511d2ba03bdf04764314">find_root_1D_gen_Psq</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8b05eb520a657db3ad5f03f48a7bbed5" title="below not done yet!">find_root_3D_gen_Palpha</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> find_root_2D_gen(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8fb6d0d8cc633b31a9b2e2e7746df656">find_root_1D_gen_Sc</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> general_newton_raphson(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> do_line_search,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                  <span class="keywordtype">void</span> (*funcd) (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [][<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *, <span class="keywordtype">int</span>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra), </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*res_func) (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra), <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> func_1d_orig(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_sq_1d_orig( <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#af386191840b4ff9a9db36be0eae5b707">func_1d_orig_scn</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#acdb87aa4479559a25be8b8209b2cf64e">res_sq_1d_orig_scn</a>( <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> func_1d_orig(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_sq_1d_orig( <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> func_1d_orig(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_sq_1d_orig( <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [] , <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> func_1d_orig(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_sq_1d_orig( <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [] , <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">static</span>  <span class="keywordtype">void</span> func_vsq(   <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [][NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keyword">static</span>  <span class="keywordtype">void</span> func_vsq2(   <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [][NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keyword">static</span>  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  res_sq_vsq( <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">static</span>  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  res_sq_vsq2( <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [] , <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x1_of_x0(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x1, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> my_lnsrch(<span class="keywordtype">int</span> eomtype, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> xold[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> fold, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> g[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> TOLX, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> stpmax, <span class="keywordtype">int</span> *check, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*func) (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra), <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a21cdce7292266aa5e19d5d07ef0630f4" title="Newton checks:">newt_repeatcheck</a>(<span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_oldest, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_older, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_olderer);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad576bc07725345ce8ec5882e826d76a0" title="see if repeating Newton cycle with no change in errx, so indicates can&#39;t do anything (even damping) t...">newt_cyclecheck</a>(<span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> trueerror, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_oldest, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_older, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_olderer, <span class="keywordtype">int</span> n_iter, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*xlist)[<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dxlist)[<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *errxlist, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *trueerrorlist);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa72eb753868a7845a97e8659d8be76d3" title="see if meet tolerance">newt_errorcheck</a>(<span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> NEWT_TOL_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> NEWT_TOL_ULTRAREL_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> trueerrortotal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ccbeaf1c72b5fbf65661284edfcb6ca">newt_extracheck</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> EXTRA_NEWT_ITER_VAR, <span class="keywordtype">int</span> EXTRA_NEWT_ITER_ULTRAREL_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> bin_newt_data(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> MAX_NEWT_ITER_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <span class="keywordtype">int</span> niters, <span class="keywordtype">int</span> conv_type, <span class="keywordtype">int</span> print_now  ) ;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> validate_x(<span class="keywordtype">void</span> (*ptr_validate_x)(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra),<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> check_on_inversion(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <span class="keywordtype">int</span> retval, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#afedc0aaa31a5b076cc994d01c2fa6798" title="Setup inversion:">compute_setup_quantities</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a00b6371d7c42afef750bef8c14b22258" title="compute Wp from primitives also get normalizations wglobal">compute_Wp</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *W_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wpabs, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *etaabs, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gamma, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gammasq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rho0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *u, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *p, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wmrho0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aadf2276ac5d5109042cc3f32f1904183" title="SETUP ITERATIVE METHODS (good for GRMHD or entropy evolution or cold GRMHD) Doesn&#39;t use Sc since init...">set_guess_Wp</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *W_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab8dacb674017697e77120c8447f17d93" title="Check if solution was found.">check_Wp</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <span class="keywordtype">int</span> retval, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa5106b3c8d771fe94e7722e089fc1bbd">Wp2prim</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pressure, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <span class="keywordtype">int</span> retval, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a67f02f993eb333c075b363919e3346e5" title="Good for GRMHD or entropy GRMHD or cold GRMHD.">verify_Wlast</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> u, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *W_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab09c217f4c21051ead1431d75b3cad51" title="other inversions:">forcefree_inversion</a>(<span class="keywordtype">int</span> cleaned, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gammaret);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d2e/u2p__util_8c.html" title="U-&gt;P inversion functions used by all utoprim files.">u2p_util.c</a>&quot;</span> <span class="comment">// only includes static functions</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/def/utoprim__jon__eos_8c.html" title="EOS stuff for utoprim_jon.c FUNCTIONS ARE GENERAL for ANY EOS input variables may need to be expanded...">utoprim_jon_eos.c</a>&quot;</span> <span class="comment">// only includes static functions</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/******************************************************************</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">   Driver for new prim. var. solver.  The driver just translates</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">   between the two sets of definitions for U and P. </span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">******************************************************************/</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="code" href="../../db/dc8/utoprimgen_8funcdeclare_8h.html#a2c450f7c2c86203afc48f0a40c665d38">  142</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a2c450f7c2c86203afc48f0a40c665d38" title="The ONLY global function:">Utoprim_jon_nonrelcompat_inputnorestmass</a>(<span class="keywordtype">int</span> showmessages, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom,  <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag,  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pressure, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> U_tmp[NPR], U_tmp2[NPR], prim_tmp[NPR];</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, k,ret; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordtype">int</span> pl,pl2;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a93300df7bd864b90cc8ed9f3d96515ad">gcov</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>], <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a98399a5a291e3844900ecfbacdcb2da0">gcon</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae689bafc5544c4d42f9a05a631bccce1">SYMMATRIXNDIM</a>], alpha;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">/* these variables need to be shared between the functions</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">     Utoprim_1D, residual, and utsq */</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordtype">int</span> real_dimen_newton;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">int</span> whicheos;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">int</span> pliter;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">//  showmessages=1; // FORCE</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">//  PLOOP(pliter,pl) dualfprintf(fail_file,&quot;%d %d %d : pl=%d U=%21.15g\n&quot;,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,pl,U[pl]);</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor"></span>  U[0]=      100.03640347219;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  U[1]=-2.21974020354085e-25;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  U[2]=-2.50158167405965e-12;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  U[3]=                    0;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  U[4]=                    0;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  U[5]=                    0;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  U[6]=                    0;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  U[7]=                    0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  prim[0]=     99.8798655540244;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  prim[1]=  9.6414760309742e-26;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  prim[2]=-9.98706197921322e-14;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  prim[3]=                    0;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  prim[4]=                    0;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  prim[5]=                    0;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  prim[6]=                    0;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  prim[7]=                    0;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">// EOS functions used during inversion</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// GODMARK: WHICHEOS could be input instead of using global definition</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment"></span>  pickeos_eomtype(<a class="code" href="../../da/d3e/definit_8h.html#ad7d4ae935d29d9f729e14124b737a430" title="which EOS (EoS) (equation of state) to use">WHICHEOS</a>,eomtype,&amp;whicheos);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor"></span>  <span class="comment">// make sure nan and inf&#39;s are not in initial guess or U</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl){</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a9d578d6f7714cd0ca219fc3be5f34422" title="SUPERLONGDOUBLE declarations.">isfinite</a>(prim[pl])){</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Guess for p is NAN\n&quot;</span>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl2) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;prim[%d]=%21.15g\n&quot;</span>,pl2,prim[pl2]);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8038577145888857d1fbcec2ab5d5d70">UTOPRIMFAILNANGUESS</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      myexit(876);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a9d578d6f7714cd0ca219fc3be5f34422" title="SUPERLONGDOUBLE declarations.">isfinite</a>(U[pl])){</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;Value of U is NAN\n&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl2) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;prim[%d]=%21.15g\n&quot;</span>,pl2,U[pl2]);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8038577145888857d1fbcec2ab5d5d70">UTOPRIMFAILNANGUESS</a>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      myexit(877);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">// initialize iteration counter</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"></span>  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a83280998e47831044a7e35299495a9bb">lntries</a>=0;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">// Setup dimensionality of method for a given eomtype and choice if inverter</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d89f51ab60206791830c886d62bfd0">EOMGRMHD</a>){</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>==1) real_dimen_newton=1;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">else</span>   <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>==2) real_dimen_newton=2;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">else</span>   <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>==3) real_dimen_newton=1;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such hot inverter %d\n&quot;</span>,<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      myexit(89285323);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a757ad8b9c2c7611dad8aab853a87f61b">EOMCOLDGRMHD</a>){</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>==0) real_dimen_newton=1;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>==1) real_dimen_newton=1;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">else</span>   <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>==2) real_dimen_newton=1;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">else</span>   <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>==3) real_dimen_newton=1;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such cold inverter %d\n&quot;</span>,<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      myexit(89285324);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a40b55e98bfcccde1a3f19d983ca7488c">EOMENTROPYGRMHD</a>){</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8931d14b240568f737f654e78bdb90dd" title="0: 1-D method using equation Sc =   Ss = D Ss with Ss specific entropy to find W&#39;">WHICHENTROPYINVERTER</a>==0) real_dimen_newton=1;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such entropy inverter %d\n&quot;</span>,<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8931d14b240568f737f654e78bdb90dd" title="0: 1-D method using equation Sc =   Ss = D Ss with Ss specific entropy to find W&#39;">WHICHENTROPYINVERTER</a>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      myexit(89285325);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">else</span> real_dimen_newton=0; <span class="comment">// not using Newton&#39;s method</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">#if( WHICHVEL != VELREL4 ) </span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor"></span>  stderrfprintf(<span class="stringliteral">&quot;Utoprim_2d() Not implemented for WHICHVEL = %d \n&quot;</span>, <a class="code" href="../../da/d3e/definit_8h.html#a3d14480f30d39eff4e51ae8bc93df56f" title="whether we use ultimately precise inversion or &quot;workable&quot; inversion precision (see utoprim&#39;s for ho...">WHICHVEL</a> );</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">return</span>(1); </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// First update the primitive B-fields</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span>(i = <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2823378b7a32d2e0dbff9b81f1a944a9">BCON1</a>; i &lt;= <a class="code" href="../../d4/da4/u2p__defs_8h.html#af3955441ac2464e7a646dbd2695a3376">BCON3</a>; i++) prim[i] = U[i] ;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// Calculate the transform the CONSERVATIVE variables into the new system</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// Set the geometry variables</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">//  alpha = 1.0/sqrt(-ptrgeom-&gt;gcon[GIND(0,0)]);</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  alpha = ptrgeom-&gt;alphalapse;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">for</span>( i = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>; i &lt;= <a class="code" href="../../d4/da4/u2p__defs_8h.html#af3955441ac2464e7a646dbd2695a3376">BCON3</a>; i++ ) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    U_tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = alpha * U[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] ;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#if(DOENTROPY!=DONOENTROPY)</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor"></span>  i=ENTROPY;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  U_tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = alpha * U[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] ;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG)</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ptrgeom-&gt;i==0 &amp;&amp; ptrgeom-&gt;j==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(k) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;U_tmp[%d]=%21.15g\n&quot;</span>,k,U_tmp[k]);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="comment">// Calculate the transform the PRIMITIVE variables into the new system</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">// default is to treat all quantities as scalars</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">// Note that need PALLLOOP here since while not setting all quantities, may use all quantities</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(i) prim_tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = prim[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// field</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">for</span>( i = <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2823378b7a32d2e0dbff9b81f1a944a9">BCON1</a>; i &lt;= <a class="code" href="../../d4/da4/u2p__defs_8h.html#af3955441ac2464e7a646dbd2695a3376">BCON3</a>; i++ ) prim_tmp[i] = alpha*prim[i];</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// Perform the inversion from U -&gt; P</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"></span>  ret = Utoprim_new_body(showmessages, eomtype, lpflag, whicheos,EOSextra, U_tmp, ptrgeom, prim_tmp,pressure,newtonstats);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">// Check conservative variable transformation</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"></span><span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; i++ ) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>; j++ ) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)] = ptrgeom-&gt;gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)];</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)] = ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)];</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;gcov,gcon %d %d = %21.15g %21.15g \n&quot;</span>, i, j, gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)], gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)]);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;gdet = %21.15g \n&quot;</span>, ptrgeom-&gt;g);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">//    primtoU_g(ptrgeom, prim_tmp, gcov, gcon, U_tmp2 ); </span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">//    PALLLOOP(i){</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">//      dualfprintf(fail_file, &quot;Utoprim_1d(): Utmp1[%d] = %21.15g , Utmp2[%d] = %21.15g , dUtmp[%d] = %21.15g \n&quot;, </span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">//        i, U_tmp[i], i, U_tmp2[i], i, fabs( (U_tmp[i]-U_tmp2[i]) / ( (U_tmp2[i]!=0.) ? U_tmp2[i] : 1. ) )  ); </span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">//    }</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// Transform new primitive variables back</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>( ret == 0 ) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// only changed RHO through U3 (otherwise have to remove alpha from B^i)</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">for</span>( i = 0; i &lt;=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8de9104f1fffa59f057b214d74c5cfea">U3</a>; i++ ) prim[i] = prim_tmp[i];</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">#if(DOENTROPY!=DONOENTROPY)</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor"></span>    <span class="comment">// if entropy is also copy entropy primitive that is internal energy density</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    i=ENTROPY;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    prim[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = prim_tmp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// ensure failure reported if ret!=0</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afaacb1c256e44ec7be2adaac65713f2b">IFUTOPRIMNOFAILORFIXED</a>(*lpflag)){</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;Internal ret=%d failure\n&quot;,ret);</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      *lpflag= ret+<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e8b2b95acecbfffd1cd90d36c295f9b">UTOPRIMFAILCONVRET</a>+1;<span class="comment">// related to UTOPRIMFAILCONVRET</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">//  PLOOP(pliter,pl) dualfprintf(fail_file,&quot;internal pl=%d prim=%g\n&quot;,pl,prim[pl]);</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// revert EOS for WHICHEOS,EOMTYPE</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">// not really  necessary unless whicheos used after the below call</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"></span>  pickeos_eomtype(<a class="code" href="../../da/d3e/definit_8h.html#ad7d4ae935d29d9f729e14124b737a430" title="which EOS (EoS) (equation of state) to use">WHICHEOS</a>,<a class="code" href="../../da/d3e/definit_8h.html#a87e5572748e4cc27373e50bd78e6f2e8">EOMTYPE</a>,&amp;whicheos); <span class="comment">// see comments in eos.c for pickeos_eomtype_old()</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">return</span>( 0 ) ;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">/**********************************************************************************</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">attempt an inversion from U to prim using the initial guess</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">prim.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">  -- assumes that </span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">             /  rho gamma        \</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">         U = |  alpha T^t_\mu  |</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">             \  alpha B^i        /</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">              \     ...        /</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">              \  specific entropy /</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">             /    rho        \</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">  P = |    uu         |</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">             | \tilde{u}^i   |</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">             \  alpha B^i   /</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">              \     ...        /</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">              \   uu from entropy (copied to uu) /</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">              *lpflag:  (i*100 + j)  where </span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">         i = 0 -&gt;  Newton-Raphson solver either was not called (yet or not used) or returned successfully;</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">             1 -&gt;  Newton-Raphson solver did not converge to a solution with the given tolerances;</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">             2 -&gt;  Newton-Raphson procedure encountered a numerical divergence (occurrence of &quot;nan&quot; or &quot;+/-inf&quot; ;</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">      </span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">         j = 0 -&gt; success </span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">             1 -&gt; failure: some sort of failure in Newton-Raphson; </span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">             2 -&gt; failure: utsq&lt;0 w/ initial p[] guess;</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">      3 -&gt; failure: W&lt;0 or W&gt;W_TOO_BIG</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">             4 -&gt; failure: utsq&lt;0 or utsq &gt; UTSQ_TOO_BIG   with new  W;</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">             5 -&gt; failure: rho,uu &lt;= 0 ;</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">**********************************************************************************/</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> Utoprim_new_body(<span class="keywordtype">int</span> showmessages, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> U[NPR], <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom,  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pressure, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;{</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qconp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Qcovp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtcon[4],Bcon[4],Bcov[4];</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> primother[NPR];</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W_last,W,Wp_last,Wp0,Wp,Wp1,Wp2,Wp3,Wpother;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, retval0, retval, retval1,retval2, retval3 ;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordtype">int</span> retvalother,retvalother2;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// below used to be static global in this file</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc ;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> wglobal[3]; <span class="comment">// [0] is normalization for Wp and [1] is normalization for Wtest, and [2] is for rho0gammasqresidabs term</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordtype">int</span> Wdependentsolution;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="preprocessor">#if(0) // old globals used for debugging -- can&#39;t be used during OpenMP computations</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="preprocessor"></span>  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qcovorig[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Qconorig[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Qdotnorig,Qsqorig,Qtsqorig;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsqnew;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="preprocessor"></span>  <span class="comment">// initialize debug indices</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  ifileglobal=ptrgeom-&gt;i;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  jfileglobal=ptrgeom-&gt;j;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  kfileglobal=ptrgeom-&gt;k;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  pfileglobal=ptrgeom-&gt;p;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace2 = 0;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;NPR;i++) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;%d %21.15g %21.15g\n&quot;</span>,i,prim[i],U[i]) ;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="comment">// Assume no inversion failure initially</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"></span>  *lpflag= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#abdf9e55b7b15ec0bcd386055f1787f47">UTOPRIMNOFAIL</a>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  retval=0;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">// compute quantities necessary for inversion in a certain frame</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"></span>  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#afedc0aaa31a5b076cc994d01c2fa6798" title="Setup inversion:">compute_setup_quantities</a>(prim, U, ptrgeom, Qtcon, Bcon, Bcov, &amp;Bsq,&amp;QdotB,&amp;QdotBsq,&amp;Qtsq,&amp;Qdotn,&amp;Qdotnp,&amp;D,&amp;Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor"></span>  <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="comment">//  if(ptrgeom-&gt;i==1 &amp;&amp; ptrgeom-&gt;j==18){</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(i) dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,&quot;Qtcon[%d]=%21.15g Bcon[%d]=%21.15g Bcov[%d]=%21.15g\n&quot;,i,Qtcon[i],i,Bcon[i],i,Bcov[i]);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  dualfprintf(fail_file,&quot;Bsq=%21.15g QdotB=%21.15g QdotBsq=%21.15g Qtsq=%21.15g Qdotn=%21.15g Qdotnp=%21.15g D=%21.15g Sc=%21.15g\n&quot;,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="comment">// CHECK WHICH EOM TYPE and proceed accordingly</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6f6094bc467dc61f9490ad7e1de63580">EOMFFDE</a> || eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a30a753538ac3bf4801ac123a37dfcc57">EOMFFDE2</a>){</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    Wdependentsolution=0;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6f6094bc467dc61f9490ad7e1de63580">EOMFFDE</a>){</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammaret0;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      W_last=0.0;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordtype">int</span> cleaned=1;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab09c217f4c21051ead1431d75b3cad51" title="other inversions:">forcefree_inversion</a>(cleaned, ptrgeom, W_last, Qtcon, Bsq, Bcon, Bcov, Qtsq, U, prim, &amp;gammaret0)) retval++;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a30a753538ac3bf4801ac123a37dfcc57">EOMFFDE2</a>){ <span class="comment">// does not so good.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordtype">int</span> cleaned=0;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammaret0;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="comment">// get Wp, wglobal, etaabs, gamma, gammaabs</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammasq,gamma,rho0,u,<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,wmrho0;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpabs, etaabs;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a00b6371d7c42afef750bef8c14b22258" title="compute Wp from primitives also get normalizations wglobal">compute_Wp</a>(showmessages, lpflag, eomtype, prim, ptrgeom, &amp;W_last, &amp;Wp_last, &amp;Wpabs, &amp;etaabs, &amp;gamma, &amp;gammasq, &amp;rho0, &amp;u, &amp;p, &amp;wmrho0, wglobal, Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab09c217f4c21051ead1431d75b3cad51" title="other inversions:">forcefree_inversion</a>(cleaned, ptrgeom, W_last, Qtcon, Bsq, Bcon, Bcov, Qtsq, U, prim, &amp;gammaret0)) retval++;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">else</span>{ <span class="comment">// doesn&#39;t do as well as EOMFFDE, so smallest instant value of gamma not only important thing, since eventually leads to larger gamma.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">// get Wp, wglobal, etaabs, gamma, gammaabs</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammasq,gamma,rho0,u,<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,wmrho0;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpabs, etaabs;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a00b6371d7c42afef750bef8c14b22258" title="compute Wp from primitives also get normalizations wglobal">compute_Wp</a>(showmessages, lpflag, eomtype, prim, ptrgeom, &amp;W_last, &amp;Wp_last, &amp;Wpabs, &amp;etaabs, &amp;gamma, &amp;gammasq, &amp;rho0, &amp;u, &amp;p, &amp;wmrho0, wglobal, Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">// then perform the analytic inversion with Lorentz factor limit</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammaret1;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> prim1[NPR];</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordtype">int</span> pliter,pl;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) prim1[pl] = prim[pl];</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordtype">int</span> ret1=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab09c217f4c21051ead1431d75b3cad51" title="other inversions:">forcefree_inversion</a>(0, ptrgeom, W_last, Qtcon, Bsq, Bcon, Bcov, Qtsq, U, prim1, &amp;gammaret1);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammaret2;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> prim2[NPR];</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) prim2[pl] = prim[pl];</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="keywordtype">int</span> ret2=forcefree_inversion(1, ptrgeom, W_last, Qtcon, Bsq, Bcon, Bcov, Qtsq, U, prim2, &amp;gammaret2);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      if(gammaret1&gt;gammaret2){</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) prim[pl] = prim2[pl];</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        if(ret2) retval++;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      else{</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af1c67086436007e897bccc458390886f" title="PLOOP controls looping over conserved or primitive -type quantities except during interpolation or ot...">PLOOP</a>(pliter,pl) prim[pl] = prim1[pl];</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        if(ret1) retval++;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  else{</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    Wdependentsolution=1;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">// SETUP ITERATIVE METHODS (good for GRMHD or entropy GRMHD or cold GRMHD)</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"></span>    retval+=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#aadf2276ac5d5109042cc3f32f1904183" title="SETUP ITERATIVE METHODS (good for GRMHD or entropy evolution or cold GRMHD) Doesn&#39;t use Sc since init...">set_guess_Wp</a>(showmessages, lpflag, eomtype, prim, ptrgeom, &amp;W_last, &amp;Wp_last,wglobal, Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">// HOT GRMHD INVERTERS (obtain Wp)</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment"></span>    <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d89f51ab60206791830c886d62bfd0">EOMGRMHD</a>){</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="comment">// METHOD specific:</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="preprocessor">#if(WHICHHOTINVERTER==3)</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="preprocessor"></span>      retval+= <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a2c3695a6bccd8e5de8daa9c35c442b96">find_root_1D_gen_Eprime</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor">#elif(WHICHHOTINVERTER==2)</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="preprocessor"></span>      retval+= find_root_2D_gen(showmessages, lpflag, eomtype, Wp_last, &amp;Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor">#elif(WHICHHOTINVERTER==1)</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="preprocessor"></span>      retval+= <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa64047229272de421ebf9e37e9c7baf8" title="Find Root wrappers:">find_root_1D_gen</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="preprocessor"></span>      dualfprintf(fail_file,<span class="stringliteral">&quot;No such WHICHHOTINVERTER=%d\n&quot;</span>,<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      myexit(89285221);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="preprocessor"></span>      retval = find_root_2D_gen(showmessages, lpflag, eomtype, Wp_last, &amp;Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      retvalother = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa64047229272de421ebf9e37e9c7baf8" title="Find Root wrappers:">find_root_1D_gen</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wpother, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      retvalother2=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab6e4060e2c11ad1fd390e15607b849ee">find_root_1D_gen_scn</a>(showmessages, lpflag, eomtype, W_last, &amp;W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">//  Wp=Wpother;</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">if</span>(retval!=retvalother || (fabs(Wp-Wpother)/(Wp+Wpother)&gt;1<a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>-13)){</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;2D/1D: i=%d j=%d :: %d %d %d :: Wp_last=%21.15g  Wp=%21.15g Wpother=%21.15g\n&quot;</span>,ptrgeom-&gt;i,ptrgeom-&gt;j,retval,retvalother,retvalother2,Wp_last,Wp,Wpother);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;scn W_last=%g W=%g D=%g  Wp_last=%g Wp=%g\n&quot;</span>,W_last,W,D,W_last-D,W-D);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;rho0=%g u=%g p=%g gamma=%g gammasq=%g w=%g utsq=%g\n&quot;</span>,rho0,u,p,gamma,gammasq,w,utsq);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="preprocessor">#endif // end comparing SCN and Jon method</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    } <span class="comment">// end if hot GRMHD</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="comment">// COLD GRMHD INVERTERS (obtain Wp)</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a757ad8b9c2c7611dad8aab853a87f61b">EOMCOLDGRMHD</a>){</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="preprocessor">#if(WHICHCOLDINVERTER==0)</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="preprocessor"></span>      retval0 = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa64047229272de421ebf9e37e9c7baf8" title="Find Root wrappers:">find_root_1D_gen</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wp0, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">//  if(IFUTOPRIMFAIL(*lpflag)){</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;E&#39;[W,v^2] equation gave bad answer: Wp=%21.15g Qdotnp=%21.15g Qdotn=%21.15g D=%21.15g\n&quot;,Wp0,Qdotnp,Qdotn,D);</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="comment">//    *lpflag=0; // let E&#39; try again</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="comment">//  else{</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;E&#39;[W&#39;,v^2] equation gave good answer: Wp=%21.15g  Qdotnp=%21.15g\n&quot;,Wp0,Qdotnp);</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      retval+=retval0;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      Wp=Wp0;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="preprocessor">#elif(WHICHCOLDINVERTER==1)</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">// Do inversion using E&#39;[W&#39;] equation</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      retval1 = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a2c3695a6bccd8e5de8daa9c35c442b96">find_root_1D_gen_Eprime</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wp1, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="comment">//  if(IFUTOPRIMFAIL(*lpflag)){</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;E&#39;[W&#39;] equation gave bad answer: Wp=%21.15g  Bsq=%21.15g Qdotnp=%21.15g Qdotn=%21.15g D=%21.15g\n&quot;,Wp,Bsq,Qdotnp,Qdotn,D);</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="comment">//    for(i=0;i&lt;4;i++) Qcovp[i] = U[QCOV0+i] ;</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="comment">//    raise_g(Qcovp,ptrgeom-&gt;gcon,Qconp) ;  </span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="comment">//    for(i=0;i&lt;4;i++) dualfprintf(fail_file,&quot;%d Qcovp=%21.15g Qconp=%21.15g\n&quot;,i,Qcovp[i],Qconp[i]);</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="comment">//    *lpflag=0; // let momentum try again</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="comment">//  else{</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;Wp=%21.15g Bsq=%21.15g QdotB=%21.15g QdotBsq=%21.15g Qtsq=%21.15g Qdotnp=%21.15g D=%21.15g\n&quot;,Wp,Bsq,QdotB,QdotBsq,Qtsq,Qdotnp,D,Sc);</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;E&#39;[W&#39;] equation gave good answer: Wp=%21.15g Qdotnp=%21.15g\n&quot;,Wp,Qdotnp);</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      retval+=retval1;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      Wp=Wp1;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="preprocessor">#elif(WHICHCOLDINVERTER==2)</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="preprocessor"></span>      <span class="comment">// Do inversion using P^2[W&#39;] equation</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;Wp_last=%21.15g\n&quot;</span>,Wp_last);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      retval2 = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a996cb5387934511d2ba03bdf04764314">find_root_1D_gen_Psq</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wp2, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">//  if(IFUTOPRIMFAIL(*lpflag)){</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;P^2[W&#39;] equation gave bad answer: Wp=%21.15g Qdotnp=%21.15g Qdotn=%21.15g\n&quot;,Wp2,Qdotnp,Qdotn);</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="comment">//    myexit(0);</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="comment">//  else{</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;P^2[W&#39;] equation gave good answer: Wp=%21.15g Qdotnp=%21.15g\n&quot;,Wp2,Qdotnp);</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">//  Wp = (Wp&gt;Wp2) ? Wp2 : Wp;</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      retval+=retval2;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      Wp=Wp2;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="preprocessor">#elif(WHICHCOLDINVERTER==3)</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="preprocessor"></span>      <span class="comment">// Do inversion using P^\alpha[W&#39;] equation</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      retval3 = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8b05eb520a657db3ad5f03f48a7bbed5" title="below not done yet!">find_root_3D_gen_Palpha</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wp3, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="comment">//  if(IFUTOPRIMFAIL(*lpflag)){</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;P^2[W&#39;] equation gave bad answer: Wp=%21.15g Qdotnp=%21.15g Qdotn=%21.15g\n&quot;,Wp2,Qdotnp,Qdotn);</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="comment">//    myexit(0);</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="comment">//  else{</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;P^2[W&#39;] equation gave good answer: Wp=%21.15g Qdotnp=%21.15g\n&quot;,Wp2,Qdotnp);</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="comment">//  }</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="comment">//  Wp = (Wp&gt;Wp3) ? Wp3 : Wp;</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      retval+=retval3;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      Wp=Wp3;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="preprocessor"></span>      dualfprintf(fail_file,<span class="stringliteral">&quot;No such WHICHCOLDINVERTER=%d\n&quot;</span>,<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      myexit(89285224);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    } <span class="comment">// end if eomtype==EOMCOLDGRMHD</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// ENTROPY GRMHD INVERTERS (obtain Wp)</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a40b55e98bfcccde1a3f19d983ca7488c">EOMENTROPYGRMHD</a>){</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="comment">// METHOD specific:</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="preprocessor">#if(WHICHENTROPYINVERTER==0)</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor"></span>      retval+= <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8fb6d0d8cc633b31a9b2e2e7746df656">find_root_1D_gen_Sc</a>(showmessages, lpflag, eomtype, Wp_last, &amp;Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="preprocessor"></span>      dualfprintf(fail_file,<span class="stringliteral">&quot;No such WHICHENTROPYINVERTER=%d\n&quot;</span>,<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8931d14b240568f737f654e78bdb90dd" title="0: 1-D method using equation Sc =   Ss = D Ss with Ss specific entropy to find W&#39;">WHICHENTROPYINVERTER</a>);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      myexit(89285225);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    } <span class="comment">// end if-else structure over eomtype</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  }<span class="comment">// end if doing non-analytic methods</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="comment">// Use root if no failure in finding root</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="comment">// check on result of inversion even if failure (i.e. even if retval&gt;0)</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="comment">// Can be done for Wdependentsolution==0, but ignore Wp</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  check_on_inversion(showmessages, prim, U, ptrgeom, Wp, Qtcon, Bcon, Bcov,retval, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordflow">if</span>(retval==0 &amp;&amp; Wdependentsolution==1){</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">//  Check if solution was found</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    retval+=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab8dacb674017697e77120c8447f17d93" title="Check if solution was found.">check_Wp</a>(lpflag, eomtype, prim, U, ptrgeom, Wp_last, Wp, retval, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// should add in case retval!=0 before this call</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">if</span>(retval) <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">// find solution</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    retval+=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa5106b3c8d771fe94e7722e089fc1bbd">Wp2prim</a>(showmessages, lpflag, eomtype,prim, pressure, U, ptrgeom, Wp, Qtcon, Bcon, Bcov, retval, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">if</span>(retval) <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">/* done! */</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordflow">return</span>(retval) ;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;}</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#afedc0aaa31a5b076cc994d01c2fa6798">  789</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#afedc0aaa31a5b076cc994d01c2fa6798" title="Setup inversion:">compute_setup_quantities</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;{</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qcov[4],Qcon[4],Qcovp[4],Qconp[4],ncov[4],ncon[4],Qsq,Qtcov[4];</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> alpha,alphasq,Dfactor;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="comment">//  for(i=0;i&lt;NPR;i++) dualfprintf(fail_file,&quot;U[%d]=%g\n&quot;,i,U[i]);</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">//  exit(0);</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  *D = U[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>] ;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="preprocessor">#if(DOENTROPY!=DONOENTROPY)</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="preprocessor"></span>  *Sc = U[ENTROPY];</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="comment">// get B^i</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordflow">for</span>(i = <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2823378b7a32d2e0dbff9b81f1a944a9">BCON1</a>; i &lt;= <a class="code" href="../../d4/da4/u2p__defs_8h.html#af3955441ac2464e7a646dbd2695a3376">BCON3</a>; i++) prim[i] = U[i] ;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  Bcon[0] = 0. ;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) Bcon[i] = U[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2823378b7a32d2e0dbff9b81f1a944a9">BCON1</a>+i-1] ;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="comment">// get B_\mu</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  lower_vec(Bcon,ptrgeom,Bcov) ;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="comment">// get B^2</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  *Bsq = 0. ;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) *Bsq += Bcon[i]*Bcov[i] ;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="comment">// get \eta^\mu and \eta_\mu</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  ncov_calc_fromlapse(ptrgeom-&gt;alphalapse,ncov) ;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  raise_vec(ncov,ptrgeom,ncon);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="comment">// -P_\alpha (P_t has D term inside it)</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="comment">// Q_\nu = \alpha \{T^t_\nu\}  = -T.\eta</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="comment">// Q&#39;_\nu = Q_\nu + \delta^t_\nu D</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;4;i++) Qcovp[i] = U[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a427ad5cc8476ced9f52e98ddcbe99f19">QCOV0</a>+i] ;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  raise_vec(Qcovp,ptrgeom,Qconp) ;  </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="comment">// P^2, which can be written without use of T^t_t</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="comment">//  Qsq = 0. ;</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="comment">//for(i=0;i&lt;4;i++) Qsq += Qcovp[i]*Qconp[i] ;</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="comment">// P^2 = Qtilde^2 can be written without T^t_t</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="comment">// Notice U !=Qcon, but only a problem for time term that is not used</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="comment">// T^t_t not really needed (cancels in the end)</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="comment">//  DLOOP(j) Qtcov[j]=0.0;</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="comment">//  DSLOOP(j,i) Qtcov[j] = U[QCOV0+i]*(delta(i,j)+ncon[i]*ncov[j]) ;</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="comment">//  raise_vec(Qtcov,ptrgeom,Qtcon) ;</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// P^\alpha = Qtcon^\alpha</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(j) Qtcon[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=0.0;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a02501ae891f0d0f9e67e35142be1693e" title="space-space">SSLOOP</a>(j,i) Qtcon[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] += U[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a427ad5cc8476ced9f52e98ddcbe99f19">QCOV0</a>+<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]*(ptrgeom-&gt;gcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)] + ncon[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]*ncon[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]) ;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="comment">//  for(i=0;i&lt;4;i++){</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">//    for(j=1;j&lt;4;j++){</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">//      Qtcon[i] = U[QCOV0+j]*(ptrgeom-&gt;gcon[GIND(j,i)]+ncon[j]*ncon[i]);</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="comment">//    }</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  lower_vec(Qtcon,ptrgeom,Qtcov);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  *Qtsq = 0. ;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;4;i++) *Qtsq += Qtcov[i]*Qtcon[i] ;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(j) dualfprintf(fail_file,<span class="stringliteral">&quot;Qtcon[%d]=%21.15g Qtcov[%d]=%21.15g\n&quot;</span>,j,Qtcon[j],j,Qtcov[j]);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="comment">// Qcon/Qcov  = -\eta.T = \alpha T^t_\nu :: where T^t_t *includes* rest-mass</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">// avoid using this Q if possible to avoid large errors when v or u is small</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="comment">// put back in the D</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;4;i++){</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">if</span>(i==0) Qcov[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=Qcovp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] - (*D);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">else</span> Qcov[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=Qcovp[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  raise_vec(Qcov,ptrgeom,Qcon) ;  </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;D=%g\n&quot;,D);</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="comment">//  for(i=0;i&lt;4;i++) dualfprintf(fail_file,&quot;Qcon[%d]=%g Qcov[%d]=%g\n&quot;,i,Qcon[i],i,Qcov[i]);</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="comment">//  exit(0);</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// P.B (P_t not used because B^t=0, so ok to use Qcov)</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  *QdotB = 0. ;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) *QdotB += Qcov[i]*Bcon[i] ;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  *QdotBsq = (*QdotB)*(*QdotB) ;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="comment">// Energy</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// Qdotnp=-E&#39;=-E+D automatically</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="preprocessor"></span>  <span class="comment">// This does not resolve metric term to have gravity taken into account in non-rel limit</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// Note that gravity will be de-resolved once $r\sim 10^{14}M$</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  *Qdotnp = Qconp[0]*ncov[0] + (*D)*(1.0-1.0/fabs(ncov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>])) ; <span class="comment">// -Qdotn-W = -Qdotnp-Wp</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">// Get 1-1/|\eta_t| in way that avoids catastrophic cancellation in non-rel gravity limit</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment"></span>  <span class="comment">// 1-1/|\eta_t| = 1-1/\alpha = (\alpha-1)/\alpha = (\alpha^2-1)/(\alpha(\alpha+1)) = (-gcovpert[TT] + \alpha^2 g_{ti} g^{ti})/(\alpha(\alpha+1))</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="comment">// \beta^i \beta_i / \alpha^2 = g^{ti} g_{ti}</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="comment">//  betasqoalphasq = 0.0;</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">//  SLOOPA(j) betasqoalphasq += (ptrgeom-&gt;gcov[GIND(TT,j)])*(ptrgeom-&gt;gcon[GIND(TT,j)]);</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  alpha = ptrgeom-&gt;alphalapse;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  alphasq = alpha*alpha;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  Dfactor = (-ptrgeom-&gt;gcovpert[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>] + alphasq*(ptrgeom-&gt;betasqoalphasq))/(alphasq+alpha);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="comment">// now Compute Qdotnp</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  *Qdotnp = Qconp[0]*ncov[0] + (*D)*(Dfactor) ; <span class="comment">// -Qdotn-W = -Qdotnp-Wp</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  *Qdotn  =  Qcon[0]*ncov[0] ;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor"></span>  <span class="comment">// deprecated DEBUG:</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">// used to check on old vs. new method</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  *Qtsqnew=*Qtsq;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;1: Qtsq=%21.15g\n&quot;,Qtsq);</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;4;i++) Qcovorig[i] = U[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a427ad5cc8476ced9f52e98ddcbe99f19">QCOV0</a>+i] ;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  Qcovorig[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>] -=D;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  raise_vec(Qcovorig,ptrgeom,Qconorig) ;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  Qdotnorig = Qconorig[0]*ncov[0] ;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  *Qsqorig = 0. ;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;4;i++) *Qsqorig += Qcovorig[i]*Qconorig[i] ;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  *Qtsqorig = *Qsqorig + Qdotnorig*Qdotnorig ;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;2: Qtsq=%21.15g\n&quot;,*Qtsq);</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  *Qtsq=*Qtsqorig;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="comment">// P^2 (since D already removed from E, then cancelling terms are small)</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// so no problem with catastrophic cancellation since involves energy term</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="comment">//  *Qtsq = *Qsq + (*Qdotnp)*(*Qdotnp) ; // P^2 in eta frame</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Qdotn=%g Qtsq=%g\n&quot;,*Qdotn,*Qtsq);</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="comment">//exit(0);</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG)</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="preprocessor"></span>  <span class="comment">// debug Qsq</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="comment">// deprecated DEBUG:</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordflow">if</span>(ptrgeom-&gt;i==0 &amp;&amp; ptrgeom-&gt;j==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    Qsq = 0. ;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;4;i++) *Qsq += Qcov[i]*Qcon[i] ;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;4;i++) dualfprintf(fail_file,<span class="stringliteral">&quot;Qcon[%d]=%21.15g Qcov[%d]=%21.15g Qsq=%21.15g Qtsq=%21.15g\n&quot;</span>,i,Qcon[i],i,Qcov[i],Qsq,Qtsq);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;}</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a00b6371d7c42afef750bef8c14b22258">  958</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a00b6371d7c42afef750bef8c14b22258" title="compute Wp from primitives also get normalizations wglobal">compute_Wp</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *W_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wpabs, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *etaabs, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gamma, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gammasq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rho0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *u, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *p, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wmrho0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;{</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ss;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> w;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Bcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],bsq;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> nuabs;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">/* calculate W from last timestep and use </span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">     for guess */</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  utsq = 0. ;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++)</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">for</span>(j=1;j&lt;4;j++) utsq += ptrgeom-&gt;gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)]*prim[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2412189362f02ef289478d68d5181c9c">UTCON1</a>+i-1]*prim[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2412189362f02ef289478d68d5181c9c">UTCON1</a>+j-1] ;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">if</span>( (utsq &lt; 0.) &amp;&amp; (fabs(utsq) &lt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#af56179417bd9f912b7d78572759ca24d" title="positive value of max negative utsq">MAXNEGUTSQ</a>) ) { </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;utsq was %21.15g now 0.0 @ i=%d j=%d k=%d\n&quot;</span>,utsq,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    utsq = 0.0;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keywordflow">if</span>(utsq &gt;= 0. &amp;&amp; utsq &lt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#abc5e280197630b4438990a2ebe395bbd">UTSQ_TOO_BIG</a>) {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">// then good, if nan then fails with next else</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  }</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">if</span>( debugfail&gt;=2 ){</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;Utoprim_new(): utsq &lt; 0 or utsq&gt;UTSQ_TOO_BIG in utoprim_jon attempt.  Resetting to utsq=0.0 from utsq = %21.15g @ i=%d j=%d k=%d\n&quot;</span>, utsq,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k) ;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="keywordflow">for</span>(i=1;i&lt;4;i++)</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">for</span>(j=1;j&lt;4;j++) dualfprintf(fail_file,<span class="stringliteral">&quot;i=%d j=%d :: gcov=%21.15g primi=%21.15g primj=%21.15g\n&quot;</span>,i,j,ptrgeom-&gt;gcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a28b8da8b36c3a7b2f04da8809cd50b34">GIND</a>(i,j)],prim[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2412189362f02ef289478d68d5181c9c">UTCON1</a>+i-1],prim[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2412189362f02ef289478d68d5181c9c">UTCON1</a>+j-1]) ;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">// then set some kind of guess since guess may just be bad and may still be able to find a solution</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    utsq = 0.0;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">//    *lpflag= UTOPRIMFAILCONVGUESSUTSQ; // guess failure actually</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="comment">// check on v^2&gt;1 failure</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="comment">//check_utsq_fail(-1E30, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="comment">//return(1) ;</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  *gammasq = 1. + utsq ;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  *gamma  = sqrt(*gammasq);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="comment">// Always calculate rho from D and gamma so that using D in EOS remains consistent</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="comment">//   i.e. you don&#39;t get positive values for dP/d(vsq) . </span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  *rho0 = (D) / (*gamma) ;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  *u = prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>] ;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keywordflow">if</span>(whicheos==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ac8c53bdabe3bb26474339d60e0e7b644">KAZFULL</a>){</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    *u = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.0,*u); <span class="comment">// near degeneracy, allow somewhat &quot;hot&quot; solution so guess doesn&#39;t give immediately bad Wp and utsq(Wp)</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  *p = <a class="code" href="../../d8/d67/eos_8c.html#a62fa304d208e1263d8d681524057a723" title="p(rho0, u) (needed to get initial guess for W)">pressure_rho0_u</a>(whicheos,EOSextra,*rho0,*u) ; <span class="comment">// p(rho0,u) just used for guess, while p(rho0,\chi) used to get solution since assume don&#39;t know \chi yet.  Even if had initial \chi, wouldn&#39;t be final \chi anyways.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  *wmrho0=(*u)+(*p);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  w = (*rho0) + (*wmrho0) ;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="comment">// W&#39;=W-D (D removed from W)</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  *Wp_last = (D)*utsq/(1.0+(*gamma)) + ((*u) + (*p))*(*gammasq);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  *W_last = *Wp_last + (D);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="comment">// need b^2 to normalize W since error in W limited by b^2</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="comment">// GODMARK: Computing b^2 this way is too expensive, just use B^2 since just used to make an error estimate</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="comment">// Misses u.B term</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">//  bsq_calc(prim, ptrgeom, &amp;bsq);</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  Bcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=0.0; <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aa97638a87093a4efe2bece0de87093cc" title="loop over all Space dimensions; first rank loop">SLOOPA</a>(jj) Bcon[jj]=prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>-1+jj];</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  lower_vec(Bcon,ptrgeom,Bcov);</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  bsq = 0.0; <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#aa97638a87093a4efe2bece0de87093cc" title="loop over all Space dimensions; first rank loop">SLOOPA</a>(jj) bsq += Bcon[jj]*Bcov[jj];</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  bsq *= ((ptrgeom-&gt;alphalapse * ptrgeom-&gt;alphalapse))/(*gammasq);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="comment">// Get normalizations</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  *Wpabs = fabs((D)*utsq)/(1.0+fabs(*gamma)) + (fabs(*u)+fabs(*p))*fabs(*gammasq) + <a class="code" href="../../d8/d5b/defs_8general_8h.html#ad51c3292d4a1fe55dad50b5c58b6b2a9">SQRTMINNUMREPRESENT</a>;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  nuabs = fabs(*u) + fabs(*p) + fabs(bsq);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  *etaabs = fabs(*rho0) + nuabs; </div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  wglobal[2]=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a0f7efde8a70b4ecec512f1eb1e92ecee" title="at what ^2 does the inversion change character to become very accurate?">GAMMASQCHECKRESID</a> * fabs(*rho0);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;}</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01046"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#aadf2276ac5d5109042cc3f32f1904183"> 1046</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aadf2276ac5d5109042cc3f32f1904183" title="SETUP ITERATIVE METHODS (good for GRMHD or entropy evolution or cold GRMHD) Doesn&#39;t use Sc since init...">set_guess_Wp</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *W_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;{</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ss;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammasq,gamma,rho0,u,<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,wmrho0;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpabs, etaabs;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpcoldhd;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keywordtype">int</span> numattemptstofixguess;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="comment">// get Wp, wglobal, etaabs, gamma, gammaabs</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a00b6371d7c42afef750bef8c14b22258" title="compute Wp from primitives also get normalizations wglobal">compute_Wp</a>(showmessages, lpflag, eomtype, prim, ptrgeom, W_last, Wp_last, &amp;Wpabs, &amp;etaabs, &amp;gamma, &amp;gammasq, &amp;rho0, &amp;u, &amp;p, &amp;wmrho0, wglobal, Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Wlast=%g Wplast=%g\n&quot;,*W_last,*Wp_last);</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">//  *wglobal=w+bsq; // used to validate normalized version of W</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  </div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="comment">//SUPERGODMARK: what if in nonrel case rho0 is identically zero? looks like rel. case but it&#39;s not (need rhorel for non-rel case)</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordflow">if</span>( <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a70115af9c8ff785379c8c0e53ae7ca56" title="whether to turn on jon&#39;s modificatoins to Scott&#39;s general Newton&#39;s method">JONGENNEWTSTUFF</a> &amp;&amp;   gammasq * etaabs &gt;= (wglobal[2])  ){</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// RIGHT</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">//  if( JONGENNEWTSTUFF &amp;&amp; (w+bsq)*gammasq &gt;= GAMMASQCHECKRESID ) { // WRONG</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordtype">int</span> gotcold=0;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ecaf51048018ba1c14b2cd7d83e1bd6" title="re-look at this GODMARK Solution to the cold GRHD equation P^2 = ...[Wp]">coldgrhd</a>(lpflag, Qtsq, D, &amp;Wpcoldhd)){</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      Wpcoldhd=*Wp_last; <span class="comment">// if failed to get coldGRHD Wp, then just use Wp_last</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      gotcold=1;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    }</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">//  *wglobal=MAX(MAX(Wpcoldhd,*Wp_last),Wpabs); // used to validate normalized version of W -- accurate for cold GRHD</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    *wglobal= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(Wpcoldhd,*Wp_last),Wpabs); <span class="comment">// used to validate normalized version of W -- accurate for cold GRHD</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="comment">//*wglobal=Wpabs;</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    </div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordflow">if</span>(gotcold) *Wp_last=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(2.0*Wpcoldhd,*Wp_last); <span class="comment">// use cold HD to upgrade Wp if needed.  Don&#39;t upgrade from cold if just set to Wp_last from guess.</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// fudge</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="comment">//    *Wp_last = *W_last;</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  }</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    *wglobal=Wpabs; <span class="comment">// non-relativistically correct</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  }</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="comment">// include Wp-like term with rest-mass so becomes W-like term</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  wglobal[1]=fabs(rho0)+wglobal[0]+<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad51c3292d4a1fe55dad50b5c58b6b2a9">SQRTMINNUMREPRESENT</a>;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="comment">//  if((nstep==4)&amp;&amp;(ptrgeom-&gt;i==0)&amp;&amp;(ptrgeom-&gt;j==47)){</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;utsq=%g p=%g w=%g W_last=%g Wp_last=%g\n&quot;,utsq,p,w,*W_last,*Wp_last);</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="comment">//    exit(0);</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;pre verify\n&quot;</span>);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;rho0=%21.15g u=%21.15g p=%21.15g\n&quot;</span>,rho0,u,p);</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;W_last=%21.15g Wp_last=%21.15g gammasq=%21.15g w=%21.15g\n&quot;</span>,*W_last,*Wp_last,gammasq,w);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  }</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a67f02f993eb333c075b363919e3346e5" title="Good for GRMHD or entropy GRMHD or cold GRMHD.">verify_Wlast</a>(u, p, ptrgeom, W_last, Wp_last, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// W_last and Wp_last and rest of variables are already pointers</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;post verify\n&quot;</span>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;W_last=%21.15g Wp_last=%21.15g gammasq=%21.15g w=%21.15g\n&quot;</span>,*W_last,*Wp_last,gammasq,w);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;     </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;MID: Wlast=%g Wplast=%g\n&quot;,*W_last,*Wp_last);</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="preprocessor">#define MAXNUMGUESSCHANGES (1000)</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="comment">// sometimes above gives invalid guess (Wp=0 or utsq&lt;0) so fix</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  numattemptstofixguess=0;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq,Ss0;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="keywordflow">while</span>(1){</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">// under all eomtype&#39;s, ensure utsq reasonable for guess so Newton&#39;s method starts at reasonable value around which to work from</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">// check  utsq from this guess for W</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    utsq=utsq_calc(*W_last, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a40b55e98bfcccde1a3f19d983ca7488c">EOMENTROPYGRMHD</a>){</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="comment">// for Entropy method, must also ensure Ss is reasonable</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      Ss=Ss_Wp_utsq(whicheos,EOSextra,*Wp_last,D,utsq);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="comment">// see what initial entropy is.  Even if Ss is not a nan or inf, can be so small that Newton stepping will be wrong, so keep increasing Wp until actually hotter than older entropy.  This ensures start hotter than required and not bumping-up against limit of method.</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="comment">// Noticed that entropy inversion will think it succeeds (low errx and dx) but it really fails very catastrophically! (conserved quantities don&#39;t match) for this reason.  Typically would give very low internal energy result, when should have been much higher.  Doesn&#39;t do that anymore.</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="comment">// But, once that very low entropy occurs, then noticed a secondary bad effect.  The updated conserved quantity would then be VERY large, leading to a VERY large entropy and huge internal energy.  While this is avoided with no internal energy drop-outs, still a concern that very low entropy regions can cause problematic fluxes and give high entropy.  Probably need larger floor on entropy than SMALL in EOS.</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      Ss0=<a class="code" href="../../d8/d67/eos_8c.html#aef4f2a239ab2ba6c9471a5e9b45f55dd" title="specific entropy as function of rho0 and internal energy (wmrho0) specificS(rho0,wmrho0)">compute_specificentropy_wmrho0</a>(whicheos,EOSextra,rho0,wmrho0);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    }</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="comment">// just some dummy value so passes below conditional without affect</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      Ss=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      Ss0=0.0;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="preprocessor">#define FRACSs0 (0.5) // want to have initial entropy not too far below previous entropy value</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(utsq&gt;=0.0 &amp;&amp; utsq==utsq &amp;&amp; <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a9d578d6f7714cd0ca219fc3be5f34422" title="SUPERLONGDOUBLE declarations.">isfinite</a>(utsq) &amp;&amp; (Ss==Ss &amp;&amp; <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a9d578d6f7714cd0ca219fc3be5f34422" title="SUPERLONGDOUBLE declarations.">isfinite</a>(Ss) &amp;&amp; Ss&gt;=Ss0-<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a5d210f4f0b247ef3ca5cce8670c34582">FRACSs0</a>*fabs(Ss0))){</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="comment">// if utsq=nan or inf, will fail to reach here</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="comment">// if Ss=nan or inf, will fail to reach here</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordflow">if</span>(numattemptstofixguess&gt;0) <span class="keywordflow">if</span>(showmessages &amp;&amp; debugfail&gt;=3) dualfprintf(fail_file,<span class="stringliteral">&quot;GOOD Initial guess #%d/%d [i=%d j=%d k=%d] for W=%21.15g Wp=%21.15g Wp/D=%21.15g gives bad utsq=%21.15g Ss=%21.15g D=%21.15g u=%21.15g p=%21.15g gamma=%21.15g Ss0=%21.15g\n&quot;</span>,numattemptstofixguess,<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a311ac6fd3d74b1d2a9a0b76e3a88ef58">MAXNUMGUESSCHANGES</a>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,*W_last,*Wp_last,*Wp_last/D,utsq,Ss,D,u,p,gamma,Ss0);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="preprocessor">#if(PRODUCTION==0)</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>(showmessages &amp;&amp; debugfail&gt;=3) dualfprintf(fail_file,<span class="stringliteral">&quot;Initial guess #%d/%d [i=%d j=%d k=%d] for W=%21.15g Wp=%21.15g Wp/D=%21.15g gives bad utsq=%21.15g Ss=%21.15g D=%21.15g u=%21.15g p=%21.15g gamma=%21.15g Ss0=%21.15g\n&quot;</span>,numattemptstofixguess,<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a311ac6fd3d74b1d2a9a0b76e3a88ef58">MAXNUMGUESSCHANGES</a>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,*W_last,*Wp_last,*Wp_last/D,utsq,Ss,D,u,p,gamma,Ss0);</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> coldpflag;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> coldWp;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ecaf51048018ba1c14b2cd7d83e1bd6" title="re-look at this GODMARK Solution to the cold GRHD equation P^2 = ...[Wp]">coldgrhd</a>(&amp;coldpflag, Qtsq, D, &amp;coldWp);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="keywordflow">if</span>(*Wp_last&lt;coldWp) *Wp_last=coldWp;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <span class="keywordflow">if</span>(numattemptstofixguess&gt;0){</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="comment">// then cold fix was not enough:</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <span class="comment">//#define FACTORSHIFT (10.0) // bit much</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="preprocessor">#define FACTORSHIFT (2.0)</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="preprocessor"></span>        *Wp_last = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(*Wp_last)*<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab5a703f8d34265e6115843e88edf8701">FACTORSHIFT</a>,<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>*100.0*fabs(D)),<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a917a138c5ec21bd07266281fde043723">KINDASMALL</a>);</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="comment">// set new W</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      *W_last = *Wp_last + (D);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    }</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span>(numattemptstofixguess&gt;<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a311ac6fd3d74b1d2a9a0b76e3a88ef58">MAXNUMGUESSCHANGES</a>){</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      *lpflag= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae592fb13c08de6ebcb503295f27d7f25">UTOPRIMFAILCONVGUESSUTSQ</a>; <span class="comment">// guess failure actually</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="comment">// check on v^2&gt;1 failure</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="keywordflow">return</span>(1) ;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    numattemptstofixguess++;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  }</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;NEW: Wlast=%g Wplast=%g\n&quot;,*W_last,*Wp_last);</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;DEBUG: %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g\n&quot;,utsq,rho0,u,p,bsq,*Wp_last,wglobal[2]);</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="comment">//int pl; PALLLOOP(pl) dualfprintf(fail_file,&quot;DEBUG2: prim[%d]=%21.15g\n&quot;,pl,prim[pl]);</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="comment">//  int jjm,kkm; DLOOP(jjm,kkm) dualfprintf(fail_file,&quot;DEBUG3: gcov=%21.15g gcon=%21.15g\n&quot;,ptrgeom-&gt;gcov[GIND(jjm,kkm)],ptrgeom-&gt;gcon[GIND(jjm,kkm)]);</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="comment">//for(pl=FIRSTEOSGLOBAL;pl&lt;=LASTEOSGLOBAL;pl++) dualfprintf(fail_file,&quot;DEBUG3: EOSextra[%d]=%21.15g\n&quot;,pl,EOSextra[pl]);</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;}</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a67f02f993eb333c075b363919e3346e5"> 1229</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a67f02f993eb333c075b363919e3346e5" title="Good for GRMHD or entropy GRMHD or cold GRMHD.">verify_Wlast</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> u, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *W_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;{</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="keywordtype">int</span> i_increase;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="comment">//  FTYPE Wpnewsmall=-3.0*MAX(MAX(MAX(MAX(MAX(fabs(D),fabs(Qdotn)),fabs(Bsq)),fabs(Qdotnp)),fabs(wglobal[0])),fabs(wglobal[1]));</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="comment">// allow this constraint on W_last and Wp_last so starts hotter than could be.</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keywordflow">if</span>(*W_last&lt;-(D) || *Wp_last&lt;0){</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    *W_last = -(D);</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    *Wp_last = 0;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;W_last=%21.15g Wp_last=%21.15g\n&quot;</span>,*W_last,*Wp_last);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    }</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordflow">if</span>(1){</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    i_increase = 0;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">while</span>( <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a796ba9b859f5938812742d89b0238806" title="returns v^2&gt;=1 does NOT depend on EOS W^3 (W+2B^2) - S^2 (2W+B^2)  W^2 (P^2-B^4) GODMARK: vsqgtr1 bas...">vsqgtr1</a>(*W_last,Bsq,QdotBsq,Qtsq) &amp;&amp; (i_increase &lt; 10) ) {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;bumped up %d %d %g %g\n&quot;,ptrgeom-&gt;i,ptrgeom-&gt;j,*W_last,*Wp_last);</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      *Wp_last*= 10.;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      *W_last = *Wp_last+(D);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <span class="comment">//    dualfprintf(fail_file,&quot;bumped up %d %d\n&quot;,ptrgeom-&gt;i,ptrgeom-&gt;j);</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      i_increase++;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="preprocessor"></span>      dualfprintf(fail_file,<span class="stringliteral">&quot;badval :  W = %21.15g, i_increase = %d \n&quot;</span>, *W_last, i_increase); </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( i_increase &gt;= 10 ) { </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;i_increase is too large, i_increase = %d , W = %21.15g \n&quot;</span>, i_increase, *W_last);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    }</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="preprocessor"></span>   </div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;u = %21.15g,  p = %21.15g,  Bsq = %21.15g, Qtsq = %21.15g \n&quot;</span>,u,p,Bsq,Qtsq);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;Bcon[0-3] = %21.15g   %21.15g   %21.15g   %21.15g   \n&quot;</span>, Bcon[0],Bcon[1],Bcon[2],Bcon[3]);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;Bcov[0-3] = %21.15g   %21.15g   %21.15g   %21.15g   \n&quot;</span>, Bcov[0],Bcov[1],Bcov[2],Bcov[3]);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;Qcon[0-3] = %21.15g   %21.15g   %21.15g   %21.15g   \n&quot;</span>, Qcon[0],Qcon[1],Qcon[2],Qcon[3]);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;Qcov[0-3] = %21.15g   %21.15g   %21.15g   %21.15g   \n&quot;</span>, Qcov[0],Qcov[1],Qcov[2],Qcov[3]);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;call find_root\n&quot;</span>) ;  </div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    }</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;}</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div>
<div class="line"><a name="l01299"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab8dacb674017697e77120c8447f17d93"> 1299</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab8dacb674017697e77120c8447f17d93" title="Check if solution was found.">check_Wp</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp_last, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <span class="keywordtype">int</span> retval, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;{</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wtest;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;   </div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="comment">/* Problem with solver, so return denoting error before doing anything further */</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keywordflow">if</span>( (retval != 0) || (Wp == <a class="code" href="../../d4/da4/u2p__defs_8h.html#a8428e835ad71ada26385fea0895bf4be">FAIL_VAL</a>) ) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">if</span>( debugfail&gt;=2 ) {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;Failed to find a prim. var. solution!! Wp_last=%21.15g Bsq=%21.15g QdotBsq=%21.15g Qdotn=%21.15g D=%21.15g Qtsq=%21.15g \n&quot;</span>,Wp_last,Bsq,QdotBsq,Qdotn,D,Qtsq);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;Utoprim_new_body(): bad newt failure, nstep,steppart :: t,i,j,k, p[0-%d], U[0-%d] = %ld %d :: %21.15g %d %d %d &quot;</span>, NPR, NPR, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>, ptrgeom-&gt;i, ptrgeom-&gt;j,ptrgeom-&gt;k );  </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordtype">int</span> pliter,pl;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ab00b96e57dba47aaf3739e9acaa6cb09" title="loop over all inversion Primitive variables – only over 5 quantities (not field)">PINVERTLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        dualfprintf(fail_file, <span class="stringliteral">&quot;%21.15g &quot;</span>, prim[pl]);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      }</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ab00b96e57dba47aaf3739e9acaa6cb09" title="loop over all inversion Primitive variables – only over 5 quantities (not field)">PINVERTLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        dualfprintf(fail_file, <span class="stringliteral">&quot;%21.15g &quot;</span>, U[pl]);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      }</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    }      </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    *lpflag= retval+<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e8b2b95acecbfffd1cd90d36c295f9b">UTOPRIMFAILCONVRET</a>+1;<span class="comment">// related to UTOPRIMFAILCONVRET</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=1) dualfprintf(fail_file,<span class="stringliteral">&quot;Got here Wp_last=%21.15g Wp=%21.15g retval=%d\n&quot;</span>,Wp_last,Wp,retval);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  }</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="comment">// Note: Wp comparable to D in scale/dimension</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">// Note: Wp/wglobal[1] comparable to \gamma^2</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    Wtest=Wp; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="comment">// GODMARK</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="comment">//      if(Wtest&lt;=0. &amp;&amp; fabs(Wtest)&gt;1E-4){</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="comment">// Complex result if W+D&lt;0 or Wp-D+D&lt;0 or Wp&lt;0</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpnewsmall=-3.0*<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(D),fabs(Qdotn)),fabs(Bsq)),fabs(Qdotnp)),fabs(wglobal[0])),fabs(wglobal[1]));</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">//    if(Wtest&lt;=-(D)){</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">if</span>(Wtest&lt;Wpnewsmall){</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="keywordflow">if</span>(debugfail&gt;=1){</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;Wtest1 failed :: Wp=%21.15g D=%21.15g wglobal=%21.15g\n&quot;</span>,Wp,(D),wglobal[1]);</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;nstep=%ld steppart=%d :: t=%21.15g :: i=%d j=%d k=%d p=%d\n&quot;</span>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ptrgeom-&gt;p);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      }</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      *lpflag= retval+<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e8b2b95acecbfffd1cd90d36c295f9b">UTOPRIMFAILCONVRET</a>+1;<span class="comment">// related to UTOPRIMFAILCONVRET</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      <span class="comment">// reset Wp</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="comment">//      Wp = -(D)+fabs((D))*0.01;</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      Wp = Wpnewsmall;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      <span class="keywordflow">return</span>(retval) ;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    }</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Wtest &lt; Wpnewsmall || Wtest/wglobal[1] &gt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#a86d8c2b9765d50cfa0b9db9187ad6cb0">GAMMASQ_TOO_BIG</a>) {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;Wtest2 failed Wp=%21.15g\n&quot;,Wp);</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      <span class="comment">//if(Wtest &lt;= 0.) {</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      <span class="keywordflow">if</span>( debugfail&gt;=2 ) {</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;Wtest2 failure %21.15g %21.15g %21.15g %21.15g\n&quot;</span>,Wtest,D,wglobal[1],<a class="code" href="../../d4/da4/u2p__defs_8h.html#a86d8c2b9765d50cfa0b9db9187ad6cb0">GAMMASQ_TOO_BIG</a>) ;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        dualfprintf(fail_file, <span class="stringliteral">&quot;Utoprim_new_body(): Wtest&lt;Wpnewsmall or Wtest=toobig failure, t,i,j,k, p[0-7], U[0-7] = %21.15g %d %d %d &quot;</span>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>, ptrgeom-&gt;i, ptrgeom-&gt;j,ptrgeom-&gt;k );  </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordtype">int</span> pliter,pl;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ab00b96e57dba47aaf3739e9acaa6cb09" title="loop over all inversion Primitive variables – only over 5 quantities (not field)">PINVERTLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;          dualfprintf(fail_file, <span class="stringliteral">&quot;%21.15g &quot;</span>, prim[pl]);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ab00b96e57dba47aaf3739e9acaa6cb09" title="loop over all inversion Primitive variables – only over 5 quantities (not field)">PINVERTLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a9d578d6f7714cd0ca219fc3be5f34422" title="SUPERLONGDOUBLE declarations.">isfinite</a>(U[pl])) dualfprintf(fail_file, <span class="stringliteral">&quot;%21.15g &quot;</span>, U[pl]);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;          <span class="keywordflow">else</span> dualfprintf(fail_file, <span class="stringliteral">&quot;nan &quot;</span>);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        }</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        dualfprintf(fail_file, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      }      </div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aee238136c1e827204c5b589fd49483d8">UTOPRIMFAILCONVW</a>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      <span class="keywordflow">return</span>(retval) ;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  }</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;(Wp,Wp_last,Bsq,Qtsq,QdotB,gammasq,Qdotn) %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g\n&quot;</span>,</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                Wp,Wp_last,</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                Bsq,Qtsq,QdotB,gammasq,Qdotn) ;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;done find_root\n&quot;</span>) ; </div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  }</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="keywordflow">if</span>( ltrace2 ) {</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    dualfprintf(fail_file, <span class="stringliteral">&quot;\n &lt;--------- %21.15g %21.15g %21.15g %21.15g %21.15g  \n&quot;</span>, Bsq,QdotBsq,Qdotn,D,Qtsq);</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  }</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">    if( nstep == 3 ) { </span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">    if( ((ptrgeom-&gt;i==89) &amp;&amp; (ptrgeom-&gt;j==88||ptrgeom-&gt;j==111)) || (ptrgeom-&gt;i==92&amp;&amp;(ptrgeom-&gt;j==86||ptrgeom-&gt;j==113)) </span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">    || (ptrgeom-&gt;i==92&amp;&amp;(ptrgeom-&gt;j==86||ptrgeom-&gt;j==113) ) || (ptrgeom-&gt;i==94&amp;&amp;(ptrgeom-&gt;j==84||ptrgeom-&gt;j==115) ) </span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">    || (ptrgeom-&gt;i==105&amp;&amp;(ptrgeom-&gt;j==84||ptrgeom-&gt;j==115) ) || (ptrgeom-&gt;i==107&amp;&amp;(ptrgeom-&gt;j==86||ptrgeom-&gt;j==113) ) </span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">    || (ptrgeom-&gt;i==110&amp;&amp;(ptrgeom-&gt;j==88||ptrgeom-&gt;j==111) ) ) {</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">    dualfprintf(fail_file, &quot;\n &lt;--------- %21.15g %21.15g %21.15g %21.15g %21.15g  \n&quot;, Bsq,QdotBsq,Qdotn,D,Qtsq);</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;}</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div>
<div class="line"><a name="l01404"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a402afc99b00c69ea3dadd658030ae1ad"> 1404</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a402afc99b00c69ea3dadd658030ae1ad" title="check on v^2&gt;1 failure">check_utsq_fail</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;{</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==1 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==32 &amp;&amp; ifileglobal==0 &amp;&amp;  jfileglobal==19){</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Qtsq=%21.15g Bsq=%21.15g D=%21.15g QdotB=%21.15g Wp=%21.15g\n&quot;</span>,Qtsq,Bsq,D,QdotB,Wp);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    myexit(12245);</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  }</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;}</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> check_on_inversion(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <span class="keywordtype">int</span> retval, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;{</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="keywordtype">int</span> checki;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="preprocessor">#if(CHECKONINVERSION)</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="preprocessor"></span>  checki=0;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Qdotnp&quot;</span>);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Qtsq&quot;</span>);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="comment">//  strcpy(newtonstats-&gt;invpropertytext[checki++],&quot;Qtsqorig&quot;);</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Bsq&quot;</span>);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;DD&quot;</span>);</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Sc&quot;</span>);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;QdotB&quot;</span>);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;WWp&quot;</span>);</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Qtcon1&quot;</span>);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Qtcon2&quot;</span>);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Qtcon3&quot;</span>);</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Bcon1&quot;</span>);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Bcon2&quot;</span>);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  strcpy(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#aad08f5f3c0485a3742327d18f6e7f0b3">invpropertytext</a>[checki++],<span class="stringliteral">&quot;Bcon3&quot;</span>);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="comment">// then store quantities required to check up on inversion in mathematica</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  checki=0;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Qdotnp;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Qtsq;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="comment">//  newtonstats-&gt;invproperty[checki++]=Qtsqorig;</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="comment">//  newtonstats-&gt;invproperty[checki++]=Qtsqnew;</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Bsq;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=D;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Sc;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=QdotB;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Wp;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Qtcon[1];</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Qtcon[2];</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Qtcon[3];</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Bcon[1];</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Bcon[2];</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a60c48b8dd68a7e66ff5a570434717dc2">invproperty</a>[checki++]=Bcon[3];</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="keywordflow">if</span>(checki&gt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa974989f8b570e3eedaef4e80b61900a" title="number of inversion quantities to report when inversion fails if CHECKONINVERSION = 1 See utoprim_jon...">NUMINVPROPERTY</a>){</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Not enough memory for invproperty: checki=%d NUMINVPROPERTY=%d\n&quot;</span>,checki,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa974989f8b570e3eedaef4e80b61900a" title="number of inversion quantities to report when inversion fails if CHECKONINVERSION = 1 See utoprim_jon...">NUMINVPROPERTY</a>);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  }</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div>
<div class="line"><a name="l01462"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa5106b3c8d771fe94e7722e089fc1bbd"> 1462</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa5106b3c8d771fe94e7722e089fc1bbd">Wp2prim</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *pressure, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <span class="keywordtype">int</span> retval, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;{</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W,vsq;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rho0;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gtmp,gamma,gammasq,w,wmrho0,<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>,u,tmpdiff;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> wmrho0_compute_vsq(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gamma,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammasq);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> wmrho0_compute_utsq(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gamma,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammasq);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordtype">int</span> retvsq;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> pr0[NPR];</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keywordtype">int</span> pl,pl2;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="keywordtype">int</span> foundnan;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="preprocessor"></span>  <span class="comment">//  if(ifileglobal==1 &amp;&amp; jfileglobal==10 &amp;&amp; nstep==137 &amp;&amp; steppart==3){</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="comment">//Wp = -0.513243850397847;</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="comment">//    Wp = -0.4043038500443759;</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="comment">//Wp = -0.0010560020881852734;</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="comment">//Wp =  0.001055708263718976;</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="comment">//dualfprintf(fail_file,&quot;Testing\n&quot;);</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="comment">//}</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(!<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a9d578d6f7714cd0ca219fc3be5f34422" title="SUPERLONGDOUBLE declarations.">isfinite</a>(Wp)){</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl) prim[pl]=pr0[pl]; <span class="comment">// since might contaminate solution</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aee238136c1e827204c5b589fd49483d8">UTOPRIMFAILCONVW</a>;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  }</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="comment">// Invert (trivially) field components</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span>(i = <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2823378b7a32d2e0dbff9b81f1a944a9">BCON1</a>; i &lt;= <a class="code" href="../../d4/da4/u2p__defs_8h.html#af3955441ac2464e7a646dbd2695a3376">BCON3</a>; i++) prim[i] = U[i] ;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="comment">// set backup of primitive</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment"></span>  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl) pr0[pl]=prim[pl];</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="comment">// Set dependent quantity W[W&#39;]</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment"></span>  W=Wp+D;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="comment">// Compute:</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <span class="comment">// 1) Either v^2 or \tilde{u}^2</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="comment">// 2) \gamma</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="comment">// 3) \chi = u+p</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="comment">// 4) \rho_0</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="comment">// 5) u</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="preprocessor">#if(PRIMFROMVSQ==1)</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="preprocessor"></span>  <span class="comment">// Calculate vsq</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  vsq = vsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  retvsq=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0" title="retvsq=0 : no problem retvsq=1 : &gt;=1.0 retvsq=2 : &lt; too negative retvsq=3 : &gt;VSQ_TOO_BIG (forced fail...">validate_vsq</a>(vsq,&amp;vsq, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keywordflow">if</span>( retvsq==1 || retvsq==2) {</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="comment">//(vsq &gt;= 1.0) || (vsq&lt;0.0) ) {</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keywordflow">if</span>( debugfail&gt;=2 ) { </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;vsq failure:  vsq = %21.15g , W = %21.15g \n&quot;</span>,vsq, W) ;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;Utoprim_new_body(): utsq==bad failure, t,i,j,k, p[0-7], U[0-7] = %21.15g %d %d %d &quot;</span>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>, ptrgeom-&gt;i, ptrgeom-&gt;j,ptrgeom-&gt;k );  </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ab00b96e57dba47aaf3739e9acaa6cb09" title="loop over all inversion Primitive variables – only over 5 quantities (not field)">PINVERTLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        dualfprintf(fail_file, <span class="stringliteral">&quot;%21.15g &quot;</span>, prim[pl]);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      }</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ab00b96e57dba47aaf3739e9acaa6cb09" title="loop over all inversion Primitive variables – only over 5 quantities (not field)">PINVERTLOOP</a>(pliter,pl){</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        dualfprintf(fail_file, <span class="stringliteral">&quot;%21.15g &quot;</span>, U[pl]);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      }</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    }      </div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="comment">// check on v^2&gt;1 failure</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a402afc99b00c69ea3dadd658030ae1ad" title="check on v^2&gt;1 failure">check_utsq_fail</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ab947eb88dee7f7a97006ffb0c5e76cb6">UTOPRIMFAILCONVUTSQVERYBAD</a>;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keywordflow">return</span>(retval) ;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(retvsq==3){</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="comment">// if( vsq &gt; VSQ_TOO_BIG ) {</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    </div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="comment">// check on v^2&gt;VSQ_TOO_BIG failure (not really a failure of convergence, but of confidence in the solution)</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a402afc99b00c69ea3dadd658030ae1ad" title="check on v^2&gt;1 failure">check_utsq_fail</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    </div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#af5aa8bcea9cce083c4b132a466974ad6">UTOPRIMFAILCONVUTSQ</a>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">return</span>(retval) ;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  }</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  gtmp = sqrt(1. - vsq);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  gamma = 1./gtmp ;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  gammasq=gamma*gamma;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="comment">// can compute utsq or gamma from Wp alone instead of using vsq</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  utsq = gammasq*vsq;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="comment">// GODMARK: can compute u+p directly from utsq, Wp, and D.</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  wmrho0=wmrho0_compute_vsq(Wp,D,vsq,gamma,gammasq);</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="preprocessor">#elif(PRIMFROMVSQ==0)</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  gammasq=1.0+utsq;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  gamma=sqrt(gammasq);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  wmrho0=wmrho0_compute_utsq(Wp,D,utsq,gamma,gammasq);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  rho0 = D / gamma;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="comment">//  w = W * (1. - vsq) ;</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="comment">// not used, but compute correctly anyways</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="comment">// w = \rho_0 + u + p</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  w = rho0+wmrho0;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  p = <a class="code" href="../../d8/d67/eos_8c.html#af3b2e227f4a5742b6880f6358a8c3668" title="p(rho0, w-rho0 = u+p)">pressure_wmrho0</a>(whicheos,EOSextra,rho0, wmrho0) ;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="comment">//  u = w - (rho0 + p) ;</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  u = wmrho0-<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  *pressure=<a class="code" href="../../d9/d54/other6_8txt.html#a4c46d2d3bb1db943c0dce6af1c779ff5">p</a>; <span class="comment">// return pressure since may be non-trivial to obtain from p(rho0,u) or inconsistent with p(rho0,\chi) if computed otherwise</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="comment">//  if((nstep==4)&amp;&amp;(ptrgeom-&gt;i==0)&amp;&amp;(ptrgeom-&gt;j==47)){</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Wp=%g W=%g D=%g vsq=%g gamma=%g wmrho0=%g p=%g u=%g\n&quot;,Wp,W,D,vsq,gamma,wmrho0,p,u);</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="comment">//    exit(0);</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Wp=%g W=%g D=%g vsq=%g gamma=%g wmrho0=%g p=%g u=%g\n&quot;,Wp,W,D,vsq,gamma,wmrho0,p,u);</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Wp=%g W=%g D=%g utsq=%g gamma=%g wmrho0=%g p=%g u=%g\n&quot;,Wp,W,D,utsq,gamma,wmrho0,p,u);</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="comment">// GODMARK</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <span class="comment">// fix checks for cold case</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordflow">if</span>( (rho0 &lt;= 0.) </div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      || ((p &lt; 0.)&amp;&amp;(eomtype!=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a757ad8b9c2c7611dad8aab853a87f61b">EOMCOLDGRMHD</a>))</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      ) { </div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <span class="keywordflow">if</span>(showmessages &amp;&amp; debugfail&gt;=2 ) {</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      tmpdiff = w - rho0;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      dualfprintf(fail_file,</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                  <span class="stringliteral">&quot;rho or uu &lt; 0 failure: rho,w,(w-rho),p,u  = %21.15g %21.15g %21.15g %21.15g %21.15g gamma,utsq = %21.15g %21.15g : nstep=%ld steppart=%d :: t=%21.15g :: i=%d j=%d k=%d p=%d\n&quot;</span>,rho0,w,tmpdiff,p,u,gamma, utsq,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,ptrgeom-&gt;i,ptrgeom-&gt;j,ptrgeom-&gt;k,ptrgeom-&gt;p);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="comment">// Below changed to pressure since internal energy can be negative due to arbitrary energy per baryon offset</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <span class="keywordflow">if</span>((rho0&lt;=0.)&amp;&amp;(p&gt;=0.)) *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ad5bd994b947d2a46102582b38e4b1529">UTOPRIMFAILRHONEG</a>;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <span class="keywordflow">if</span>((rho0&gt;0.)&amp;&amp;(p&lt;0.)) *lpflag= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a17c167aa50c0750a25baba351db69740">UTOPRIMFAILUNEG</a>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <span class="keywordflow">if</span>((rho0&lt;=0.)&amp;&amp;(p&lt;0.)) *lpflag= <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a24290f84c3e2b725f7cbbdff81da4760">UTOPRIMFAILRHOUNEG</a>;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#af7f8bb0dd82ef282496bd6d11f919be1" title="0: return non-updated quantities 1: if u&lt;0 or rho&lt;0, then return updated quantities, else return non-updated quantities">UTOPRIMFAILRETURNTYPE</a>==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aea90ac50eee8804320464f11d171d171" title="for UTOPRIMFAILRETURNTYPE – controls the behaviour of inversion: does allow the return of solutions w...">UTOPRIMRETURNNOTADJUSTED</a>) <span class="keywordflow">return</span>(retval) ; <span class="comment">// else let assign -- used to check how bad failure is.</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  }</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <span class="comment">// If didn&#39;t exit so far, then assume valid inversion and so assign primitives (i.e. prim[])</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="comment">// Assign:</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="comment">// 1) rho_0</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="comment">// 2) u (either from energy or entropy evolution)</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  <span class="comment">// 3) \tilde{u}^i[W&#39;]</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="comment">// 4) [Already inverted field]</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>] = rho0 ;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a757ad8b9c2c7611dad8aab853a87f61b">EOMCOLDGRMHD</a>){</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>] = 0;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  }</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>] = u ;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  }</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="preprocessor">#if(DOENTROPY!=DONOENTROPY)</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="preprocessor"></span>  <span class="comment">// put result in both UU and ENTROPY for primitive</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  prim[ENTROPY]=prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>];</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="comment">//  for(i=1;i&lt;4;i++)  Qtcon[i] = Qcon[i] + ncon[i] * Qdotn; // Qtcon already defined in good way</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="comment">// GODMARK: gamma should be computed from W and conserved quantities directly as \gamma[W] (see notes)</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) prim[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2412189362f02ef289478d68d5181c9c">UTCON1</a>+i-1] = gamma/(W+Bsq) * ( Qtcon[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] + QdotB*Bcon[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]/W ) ;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;%d %d : %g %g %g\n&quot;,ptrgeom-&gt;i,ptrgeom-&gt;j,vsq,W,Wp);</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  <span class="comment">//if(fabs(prim[U1])&gt;1E-30)</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="comment">//  for(i=1;i&lt;4;i++) dualfprintf(fail_file,&quot;u[%d]= %g %g\n&quot;,i,Qtcon[i],prim[UTCON1+i-1]);</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;retval=%d\n&quot;,retval);</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="comment">// make sure nan and inf&#39;s don&#39;t pass through</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment"></span>  foundnan=0;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl){</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a9d578d6f7714cd0ca219fc3be5f34422" title="SUPERLONGDOUBLE declarations.">isfinite</a>(prim[pl])){</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      foundnan=1;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    }</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  }</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <span class="keywordflow">if</span>(foundnan){</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    *lpflag=  <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a60b4996e25f5f432174dfaaf02872642">UTOPRIMFAILNANRESULT</a>;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    </div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keywordflow">if</span>(debugfail&gt;=2)  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl2) dualfprintf(fail_file,<span class="stringliteral">&quot;prim is nan: prim[%d]=%21.15g -&gt; pr0[%d]=%21.15g\n&quot;</span>,pl2,prim[pl2],pl2,pr0[pl2]);</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="comment">// remove nan since might contaminate solution or cause super-slowdown</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a9925a64985c8320ff6b912e6ebbfe763" title="always goes over all standard invertable quantities for inversion to operate normally">PLOOPALLINVERT</a>(pl) prim[pl]=pr0[pl];</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  }</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot; rho final = %21.15g ,  u final = %21.15g \n&quot;</span>, rho0, u);</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  }</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;}</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab09c217f4c21051ead1431d75b3cad51"> 1721</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab09c217f4c21051ead1431d75b3cad51" title="other inversions:">forcefree_inversion</a>(<span class="keywordtype">int</span> cleaned, <span class="keyword">struct</span> <a class="code" href="../../d6/d39/global_8structs_8h.html#aa7fe064ca3d2eb92f00456cd7c186eae" title="typedef struct of_geom struct of_compgeom; force to be the same">of_geom</a> *ptrgeom, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Qtcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcon, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Bcov, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *U, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *prim, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gammaret)</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;{</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  <span class="comment">// force-free variables</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtconclean[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Qtcovclean[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],Qtsqclean;</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> alphasq,gammamax,vcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],vcov[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],QtdotB,vconff[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],vcovff[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq,gamma;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> realBsq;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <span class="comment">// note that doing this means B.B!=Bsq</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  Bsq+=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>; <span class="comment">// in case Bsq=0 identically</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  alphasq=<a class="code" href="../../d8/d5b/defs_8general_8h.html#accef7ff74daca804b9a5a3ad7d3db882">GAMMAMAX</a>*<a class="code" href="../../d8/d5b/defs_8general_8h.html#accef7ff74daca804b9a5a3ad7d3db882">GAMMAMAX</a>/(<a class="code" href="../../d8/d5b/defs_8general_8h.html#accef7ff74daca804b9a5a3ad7d3db882">GAMMAMAX</a>*<a class="code" href="../../d8/d5b/defs_8general_8h.html#accef7ff74daca804b9a5a3ad7d3db882">GAMMAMAX</a>-1.0);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3bf4402b9e2ae88e4462c3689f5d22b8">RHO</a>]=prim[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a94db1ec6a412a83becda73ca2a5db0bf">UU</a>]=0.0;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="comment">// first 3-velocity</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  vcon[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=0.0; <span class="comment">// Qtcon[TT]=0</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) vcon[i] = Qtcon[i]/Bsq ;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="comment">// first project out parallel velocity from Qtcon</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <span class="comment">// note that \tilde{Q}.B = Q.B</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  QtdotB=0.0;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) QtdotB += Qtcon[i]*Bcov[i];</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  Qtconclean[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=0.0;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordflow">if</span>(cleaned==1){</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;4;i++) Qtconclean[i] = Qtcon[i] - QtdotB*Bcon[i]/Bsq;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="comment">// define new cleaned 3-velocity</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    vconff[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=0.0;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;4;i++) vconff[i] = Qtconclean[i]/Bsq;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  }</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;4;i++) Qtconclean[i] = Qtcon[i];</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="comment">// define new non-cleaned 3-velocity</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    vconff[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=0.0;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;4;i++) vconff[i] = (Qtconclean[i] + 0.0*QtdotB*Bcon[i]/fabs(W) )/(fabs(W) + fabs(Bsq));</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    </div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  }</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  <span class="comment">// v_\alpha cleaned</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  lower_vec(vconff,ptrgeom,vcovff) ;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  <span class="comment">// v^2 cleaned</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  vsq=0.0;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) vsq+=vconff[i]*vcovff[i]; <span class="comment">// vcon[TT]=0</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;vsq=%21.15g Bsq=%21.15g alphasq=%21.15g Qtsq=%21.15g\n&quot;,vsq,Bsq,alphasq,Qtsq);</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="comment">// now limit the 3-velocity to be physical (no change in direction, so QtdotB=0 will be preserved)</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="keywordflow">if</span>( (vsq&lt;0.0) || (vsq&gt;1.0/alphasq) ){</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="comment">// then need to limit Lorentz factor</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="comment">// dissipation is expected to occur without affecting force-free equations</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="comment">// define cleaned Qtsq</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    lower_vec(Qtconclean,ptrgeom,Qtcovclean) ;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    Qtsqclean=0.0;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;4;i++) Qtsqclean+=Qtconclean[i]*Qtcovclean[i];</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160; </div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="comment">// define new vconff (overwrites above) that is cleaned AND has dissipation</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="comment">// v^\alpha = P^\alpha/(B^2+\sqrt{\alpha^2 P^2})</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    vconff[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08ca909b46b12e894320afaabce3056e" title="time period between dumps for various types of dumps NO, use &quot;DUMPTYPE&quot; names now">TT</a>]=0.0;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="comment">//    for(i=1;i&lt;4;i++) vconff[i] = Qtconclean[i]/(Bsq+sqrt(alphasq*Qtsqclean)) ;</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="comment">//realBsq=sqrt(Bsq+sqrt(alphasq*Qtsqclean));</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="comment">// Note that E^2 = P^2/B^2, and then use same limiting procedure as in phys.ffde.c</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    realBsq=sqrt(Qtsqclean*alphasq);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">if</span>(cleaned==1){</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <span class="keywordflow">for</span>(i=1;i&lt;4;i++) vconff[i] = Qtconclean[i]/realBsq ;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    }</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <span class="keywordflow">for</span>(i=1;i&lt;4;i++) vconff[i] = (Qtconclean[i] + 0.0*QtdotB*Bcon[i]/fabs(W) )/(fabs(W) + fabs(realBsq));</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    }</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="comment">// v_\alpha cleaned and w/ dissipation</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    lower_vec(vconff,ptrgeom,vcovff) ;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="comment">// v^2 cleaned and w/ dissipation</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    vsq=0.0;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="keywordflow">for</span>(i=1;i&lt;4;i++) vsq+=vconff[i]*vcovff[i]; <span class="comment">// vcon[TT]=0</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  }</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160; </div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  <span class="comment">// notice that vsq&lt;1 enforced now, so should be ok</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="keywordflow">if</span>( (vsq&lt;-<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>) || (vsq&gt;1.0/alphasq + 100.0*<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>) ){</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Failed to limit vcon\n&quot;</span>);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="keywordflow">if</span>(vsq&lt;-<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>) vsq=-<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e8b2b95acecbfffd1cd90d36c295f9b">UTOPRIMFAILCONVRET</a>+1);</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  }</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="comment">// gamma cleaned and w/ dissipation if necessary</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="comment">// clearly limits accuracy of gamma -- unavoidable when using B^\alpha instead of b^\alpha as fundamental variable</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  gamma=1.0/sqrt(1.0-vsq);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="comment">// set relative 4-velocity</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="keywordflow">for</span>(i=1;i&lt;4;i++) prim[<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2412189362f02ef289478d68d5181c9c">UTCON1</a>+i-1] = gamma*vconff[i];</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  </div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="comment">// set field (not really used)</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keywordflow">for</span>(i = <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2823378b7a32d2e0dbff9b81f1a944a9">BCON1</a>; i &lt;= <a class="code" href="../../d4/da4/u2p__defs_8h.html#af3955441ac2464e7a646dbd2695a3376">BCON3</a>; i++) prim[i] = U[i] ;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="comment">//  PLOOPALLINVERT(i) dualfprintf(fail_file,&quot;vsq=%21.15g prim[%d]=%21.15g\n&quot;,vsq,i,prim[i]);</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  *gammaret=gamma;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;}</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div>
<div class="line"><a name="l01842"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a796ba9b859f5938812742d89b0238806"> 1842</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a796ba9b859f5938812742d89b0238806" title="returns v^2&gt;=1 does NOT depend on EOS W^3 (W+2B^2) - S^2 (2W+B^2)  W^2 (P^2-B^4) GODMARK: vsqgtr1 bas...">vsqgtr1</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq)</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;{</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="keywordflow">return</span>(W*W*W * ( W + 2.*Bsq ) - QdotBsq*(2.*W + Bsq)  &lt;= W*W*(Qtsq-Bsq*Bsq) );</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;}</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment">// GENERAL FUNCTIONS USED BY INVERSION</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq_calc(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;{</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsqtop,utsqbottom,utsq;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> S,SoW;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  S = QdotB;</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  SoW = S/W;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  utsqtop = Qtsq + (Bsq+2.0*W)*SoW*SoW;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  utsqbottom = (Bsq*Bsq-Qtsq) + 2.0*Bsq*W + W*W - SoW*SoW*(Bsq+2.0*W);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  utsq = utsqtop/utsqbottom;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="preprocessor"></span>  <span class="comment">//  if(ifileglobal&gt;90 &amp;&amp; CRAZYNEWCHECK){</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="comment">//  if(CRAZYNEWCHECK&amp;&amp;0){</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="comment">//    dualfprintf(fail_file,&quot;utsqtop=%21.15g utsqbottom=%21.15g Qtsq=%21.15g\n&quot;,utsqtop,utsqbottom,Qtsq);</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="keywordflow">return</span>(utsq);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;}</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01890"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a01f12f1b393e896ea7f1c5279356efc4"> 1890</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a01f12f1b393e896ea7f1c5279356efc4" title="returns ^2 Note that this does NOT use Qdotn or Qdotnp (from energy equation) so works for entropy ev...">gammasq_calc_W</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;{</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammatop,gammabottom,gammasq;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> S,SoW;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  S = QdotB;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  SoW = S/W;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;  gammatop = Bsq+W;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  gammabottom = W*W+2.0*Bsq*W + (Bsq*Bsq-Qtsq)-2.0*SoW*SoW*W - Bsq*SoW*SoW;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  gammasq = gammatop*gammatop/gammabottom;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  <span class="keywordflow">return</span>(gammasq);</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;}</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div>
<div class="line"><a name="l01911"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a383397c8a53f1ca4dcd71ba0395fb4cd"> 1911</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a383397c8a53f1ca4dcd71ba0395fb4cd" title="returns  Note that this does NOT use Qdotn or Qdotnp (from energy equation) so works for entropy evol...">gamma_calc_W</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;{</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammasq,gamma;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  gammasq = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a01f12f1b393e896ea7f1c5279356efc4" title="returns ^2 Note that this does NOT use Qdotn or Qdotnp (from energy equation) so works for entropy ev...">gammasq_calc_W</a>(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="comment">// should I check sign of gammasq?  GODMARK</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  gamma=sqrt(gammasq);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  <span class="keywordflow">return</span>(gamma);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;}</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq_calc(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;{</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wsq,Xsq,Ssq;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> SoW;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160; </div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  Wsq = W*W ;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  Xsq = (Bsq + W) * (Bsq + W);</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  <span class="comment">// Ssq = QdotBsq / Bsq;</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  SoW = QdotB/W;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160; </div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  <span class="comment">//return(  Ssq * ( 1./Wsq - 1./Xsq )  +  Qtsq / Xsq  ); </span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="comment">// return(  ( Wsq * Qtsq  + QdotBsq * (Bsq + 2.*W)) / (Wsq*Xsq) );</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="keywordflow">return</span>(  (SoW*SoW*(2.0*W+Bsq)  +  Qtsq)/Xsq );</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;}</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dvsq_dW(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;{</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W3,X3,Ssq,Wsq,<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160; </div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  X = Bsq + W;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  W3 = Wsq*W ;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  X3 = X*X*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="comment">// if(fabs(Bsq)==0.0) Ssq=0.0;</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <span class="comment">// else Ssq = QdotBsq / Bsq;</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  <span class="comment">//return( -2.*( Ssq * ( 1./W3 - 1./X3 )  +  Qtsq / X3 ) ); </span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  <span class="comment">// return( -2.*( W3*Qtsq + QdotBsq * ( 3*W*X + Bsq*Bsq ) ) / ( W3 * X3 )   );</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  <span class="keywordflow">return</span>( -2.0/X3 * ( Qtsq  +  QdotBsq * (3.0*W*X + Bsq*Bsq)/W3  )  ); <span class="comment">// RIGHT (avoids catastrophic cancellation with W^3 term in numerator)</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  <span class="comment">// return( -2.*( Qtsq/X3  +  QdotBsq/Bsq * (1.0/W3 - 1.0/X3)  )  ); // RIGHT (said was WRONG!)</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;}</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div>
<div class="line"><a name="l01977"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ecaf51048018ba1c14b2cd7d83e1bd6"> 1977</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ecaf51048018ba1c14b2cd7d83e1bd6" title="re-look at this GODMARK Solution to the cold GRHD equation P^2 = ...[Wp]">coldgrhd</a>(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wp)</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;{</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> det;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  det = D*D+Qtsq;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="keywordflow">if</span>(det&lt;0.0){</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;coldgrhd: no solution: det=%21.15g\n&quot;,det);</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    *lpflag=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#af5aa8bcea9cce083c4b132a466974ad6">UTOPRIMFAILCONVUTSQ</a>;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="keywordflow">if</span>(D&gt;0.0){</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;      *Wp = Qtsq/(D+sqrt(det));</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    }</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      *Wp = Qtsq/(D-sqrt(det));</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    }</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  }</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="keywordflow">return</span>(0); <span class="comment">// shouldn&#39;t get here -- only used if coldgrhd() used</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;}</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Psq_Wp_old(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;{</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> S,W,W2,DoW,SoW;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Y;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  Y = Bsq+2.0*W;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  W2 = W*W;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  S = QdotB;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  DoW = D/W;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  SoW = S/W;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160; </div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Qtsq=%21.15g Bsq=%21.15g D=%21.15g S=%21.15g\n&quot;</span>,Qtsq,Bsq,D,S);</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  }</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  <span class="comment">//  result = -Qtsq + (Bsq+2.0*D)*Bsq + 2.0*(Bsq+D)*Wp + Wp*Wp - (Bsq*DoW*DoW + SoW*SoW)*(Bsq+2.0*W);</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  result = -Qtsq + Wp*(D+W)*(1.0 + Bsq*Y/W2) - Y*SoW*SoW;</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;}</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dPsqdWp_Wp_old(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;{</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> S,W,DoW,SoW;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  S = QdotB;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  DoW = D/W;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  SoW = S/W;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  result = 2.0*(Bsq+W)*(Bsq/W*DoW*DoW + SoW*SoW/W + 1.0);</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;}</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div>
<div class="line"><a name="l02055"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#afe17864b47716e97813efc16988f8184"> 2055</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#afe17864b47716e97813efc16988f8184" title="new version without poles returns actually W^2 P^2 Note that this does NOT use Qdotn or Qdotnp (from ...">Psq_Wp</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *resid, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *norm)</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;{</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> S,W,W2,DoW,SoW;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Y;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  Y = Bsq+2.0*W;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  W2 = W*W;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  S = QdotB;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  *resid = -Qtsq*W2 + Wp*(D+W)*(W2 + Bsq*Y) - Y*S*S;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  *norm = fabs(Qtsq*W2) + fabs(Wp*(D+W)*(W2)) + fabs(Wp*(D+W)*(Bsq*Y)) + fabs(Y*S*S);</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;}</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div>
<div class="line"><a name="l02076"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#adb5a3bde8a0f684bc7a2c2810b5871ec"> 2076</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#adb5a3bde8a0f684bc7a2c2810b5871ec" title="new version without poles result = d(W^2 P^2)/dWp = Note that this does NOT use Qdotn or Qdotnp (from...">dPsqdWp_Wp</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;{</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> S,W,DoW,SoW;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  S = QdotB;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  result = 2.0*(D*( (Bsq+D)*(Bsq+D) - Qtsq) - (S*S) + ((Bsq + D)*(Bsq + 5.0*D) - Qtsq)*Wp + 3.0*(Bsq + 2.0*D)*(Wp*Wp) + 2.0*(Wp*Wp*Wp));</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;}</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div>
<div class="line"><a name="l02099"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ae7b1f4865b2a4f8be3661db75061b344"> 2099</a></span>&#160;<span class="preprocessor">#define MINRESIDEPRIME(Wp) ( Bsq*0.5+Qdotnp+3.0/5.0*Wp+(Bsq*Qtsq-QdotBsq)/(2.0*(Bsq+D+Wp)*(Bsq+D+Wp)) )</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02103"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a5e5fa8022da930edc7ec6c2a7760ac3f"> 2103</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a5e5fa8022da930edc7ec6c2a7760ac3f" title="0 = -E&#39; + E&#39;[Wp] for hot GRMHD (can be used for cold GRMHD too) while this has poles near bad roots...">Eprime_Wp_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *resid, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *norm)</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;{</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X2,W;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p_tmp;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  X = Bsq + W + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  X2 = X*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;  <span class="comment">// PERFORMANCEMARK: Tested code with and without these type of if/else (all of them in utoprim_jon.c) and all rest used by func_Eprime_unopt() and found only changed performance from 7% of CPU to 6.90% CPU.  Not interesting change</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <span class="keywordflow">if</span>(utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){ <span class="comment">// also checks if nan</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    *resid=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// force residual to be large and negative so indicates a problem</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    *norm=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  }</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    p_tmp=pressure_Wp_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    </div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="comment">// Note that -E&#39;=Qdotnp</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    *resid = Qdotnp + Wp - p_tmp + 0.5*Bsq + 0.5*(Bsq*Qtsq-QdotBsq)/X2;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    *norm = fabs(Qdotnp) + fabs(Wp) + fabs(p_tmp) + fabs(0.5*Bsq) + fabs(0.5*(Bsq*Qtsq)/X2) + fabs(0.5*(QdotBsq)/X2);</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <span class="keywordflow">if</span>(p_tmp!=p_tmp || *resid!=*resid) *resid=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;  }</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;}</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;</div>
<div class="line"><a name="l02145"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a521ffc23d619471f17b09af68d997c87"> 2145</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a521ffc23d619471f17b09af68d997c87" title="dE&#39;/dWp [ Wp ] It is ok that there exists a term (1-dpdW) since even with ideal gas EOS in non-rel li...">dEprimedWp_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;{</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X3,W;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dvsq,dp1,dp2,dpdWp;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  X = Bsq + W + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  X3 = X*X*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="keywordflow">if</span>(utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){ <span class="comment">// also checks for nan</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    result=0.0; <span class="comment">// indicates a problem</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  }</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    dvsq = dvsq_dW(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// no precision problem</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    dp1 = dpdWp_calc_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    dp2 = dpdvsq_calc2_Wp(whicheos,EOSextra, Wp, D, utsq );</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    dpdWp = dp1  + dp2*dvsq; <span class="comment">// dp/dW = dp/dWp</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    </div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    result = (1.0 - dpdWp) - (Bsq*Qtsq - QdotBsq)/X3;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="comment">// check for nan (but not inf)</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="keywordflow">if</span>(dvsq!=dvsq || dp1!=dp1 || dp2!=dp2 || dpdWp!=dpdWp || result!=result) result=0.0; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;  }</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;}</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div>
<div class="line"><a name="l02182"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3aff300c2c78a06215004ed4b3d8edfe"> 2182</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3aff300c2c78a06215004ed4b3d8edfe" title="this version has no poles assumes X2!=0, in which case previous old version gives inf anyways 0 = (B^...">Eprime_Wp_new1</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;{</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X2,W;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p_tmp;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  X = Bsq + W + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  X2 = X*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160; </div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="keywordflow">if</span>(utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    result=0.0; <span class="comment">// indicates problem</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  }</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    p_tmp=pressure_Wp_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    result = X2*(Qdotnp + Wp - p_tmp + 0.5*Bsq) + 0.5*(Bsq*Qtsq-QdotBsq);</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="keywordflow">if</span>(p_tmp!=p_tmp || result!=result) result=0.0; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;  }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="preprocessor"></span>  <span class="comment">//  if(ifileglobal&gt;90 &amp;&amp; CRAZYNEWCHECK){</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="comment">//  if(CRAZYNEWCHECK&amp;&amp;0){</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  <span class="comment">//    dualfprintf(fail_file,&quot;Eprime: Wp=%21.15g W=%21.15g X2=%21.15g p_tmp=%21.15g utsq=%21.15g D=%21.15g result=%21.15g\n&quot;,Wp,W,X2,p_tmp,utsq,D,result);</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;}</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;</div>
<div class="line"><a name="l02221"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfb218ad5f3117abc47f95d9e0b15e5"> 2221</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfb218ad5f3117abc47f95d9e0b15e5" title="this version has no poles d((B^2+W)^2 E&#39;)/dWp [ Wp ] It is ok that there exists a term (1-dpdW) since...">dEprimedWp_new1</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;{</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X3,W;</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dvsq,dp1,dp2,dpdWp;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p_tmp;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  X = Bsq + W + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  X3 = X*X*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  <span class="keywordflow">if</span>(utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    result=0.0; <span class="comment">// indicates problem</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;  }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    dvsq = dvsq_dW(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// no precision problem</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    dp1 = dpdWp_calc_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    dp2 = dpdvsq_calc2_Wp(whicheos,EOSextra, Wp, D, utsq );</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    dpdWp = dp1  + dp2*dvsq; <span class="comment">// dp/dW = dp/dWp</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    </div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <span class="comment">// just copied from Eprime_Wp() to avoid recomputing utsq_calc()</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    p_tmp=pressure_Wp_utsq(whicheos,EOSextra,Wp,D,utsq); </div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    </div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    result = X*(2.0*(Qdotnp + Wp - p_tmp + 0.5*Bsq) + (1.0 - dpdWp)*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a> );</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keywordflow">if</span>(dvsq!=dvsq || dp1!=dp1 || dp2!=dp2 || dpdWp!=dpdWp || p_tmp!=p_tmp || result!=result) result=0.0; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  }</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="preprocessor">#if(DEBUGINDEX)</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="preprocessor"></span>  <span class="comment">//  if(ifileglobal&gt;90 &amp;&amp; CRAZYNEWCHECK){</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="comment">//  if(CRAZYNEWCHECK&amp;&amp;0){</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  <span class="comment">//    dualfprintf(fail_file,&quot;dEprime: Wp=%21.15g W=%21.15g X3=%21.15g p_tmp=%21.15g utsq=%21.15g dp1=%21.15g dp2=%21.15g dpdWp=%21.15g result=%21.15g\n&quot;,Wp,W,X3,p_tmp,utsq,dp1,dp2,dpdWp,result);</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <span class="comment">//  }</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;}</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc_Wp_old(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;{</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ss_tmp;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  <span class="keywordflow">if</span>(utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){ <span class="comment">// also checks if nan</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    result=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// force residual to be large and negative so indicates a problem</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    Ss_tmp=Ss_Wp_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    </div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    result = -Sc + D*Ss_tmp;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="keywordflow">if</span>(Ss_tmp!=Ss_tmp || result!=result) result=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  }</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Sc_Wp_old: Wp=%21.15g W=%21.15g D=%21.15g utsq=%21.15g :: Ss_tmp=%21.15g result=%21.15g Sc=%21.15g\n&quot;,Wp,W,D,utsq,Ss_tmp,result,Sc);</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;}</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div>
<div class="line"><a name="l02307"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a9ab30fbd31679018adef3710300826c3"> 2307</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a9ab30fbd31679018adef3710300826c3" title="0 = Wp(-Sc + Sc[Wp]) for entropy GRMHD Noticed that original residual behaves like log(Wp) near the r...">Sc_Wp_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *resid, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *norm)</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;{</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ss_tmp;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;  <span class="keywordflow">if</span>(utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){ <span class="comment">// also checks if nan</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    *resid=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// force residual to be large and negative so indicates a problem</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    *norm=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// force residual to be large and negative so indicates a problem</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;  }</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    Ss_tmp=Ss_Wp_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    </div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    *resid = Wp*(-Sc + D*Ss_tmp);</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    *norm = fabs(Wp)*fabs(Sc) + fabs(Wp)*fabs(D*Ss_tmp);</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <span class="keywordflow">if</span>(Ss_tmp!=Ss_tmp || *resid!=*resid) *resid=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;  }</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;  <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Sc_Wp_unopt: Wp=%21.15g W=%21.15g D=%21.15g utsq=%21.15g :: Ss_tmp=%21.15g *resid=%21.15g Sc=%21.15g\n&quot;,Wp,W,D,utsq,Ss_tmp,*resid,Sc);</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;}</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div>
<div class="line"><a name="l02342"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a4733edf9231a97e1ff06e0901257fbec"> 2342</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a4733edf9231a97e1ff06e0901257fbec" title="dSc/dWp [ Wp ] for entropy GRMHD">dScdWp_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;{</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> result;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W;</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dvsq,dSs1,dSs2,dSsdWp;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ss;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  utsq=utsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keywordflow">if</span>(utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){ <span class="comment">// also checks for nan</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    result=0.0; <span class="comment">// indicates a problem</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  }</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    dvsq = dvsq_dW(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// no precision problem</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    dSs1 = dSsdWp_calc_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    dSs2 = dSsdvsq_calc2_Wp(whicheos,EOSextra, Wp, D, utsq );</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    dSsdWp = dSs1  + dSs2*dvsq; <span class="comment">// dSs/dW = dSs/dWp</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;    Ss=Ss_Wp_utsq(whicheos,EOSextra,Wp,D,utsq);</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    </div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    <span class="comment">// old result for old residual</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <span class="comment">//   result = D*dSsdWp;</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    </div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    <span class="comment">// new result for new residual</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    result = -Sc + D*(dSsdWp*Wp + Ss);</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="comment">// check for nan (but not inf)</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="keywordflow">if</span>(dvsq!=dvsq || dSs1!=dSs1 || dSs2!=dSs2 || dSsdWp!=dSsdWp || result!=result) result=0.0; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;  }</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;dScdWp:  Wp=%21.15g W=%21.15g D=%21.15g utsq=%21.15g :: dvsq=%21.15g dSs1=%21.15g dSs2=%21.15g dSsdWp=%21.15g result=%21.15g\n&quot;,Wp,W,D,utsq,dvsq,dSs1,dSs2,dSsdWp,result);</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  <span class="keywordflow">return</span>(result);</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;}</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">/********************************************************************</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">  x1_of_x0(): Only Used For 2D Inversion</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="comment">           </span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="comment">    -- calculates x1 from x0 depending on value of vartype;</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="comment">                          x0   x1</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;<span class="comment">             vartype = 2 : Wp, gamma</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="comment">             vartype = 3 : Wp, vsq</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="comment">             vartype = 4 : Wp, utsq</span></div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="comment">    -- asumes x0 is already physical</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="comment">*********************************************************************/</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x1_of_x0(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x1, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra) </div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;{</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq;</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <span class="comment">//  FTYPE dv = 1.e-15;</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  W = x0+D;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  </div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="preprocessor">#if(CHANGEDTOOLDER)</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="preprocessor"></span>  vsq = fabs(vsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra)) ; <span class="comment">// guaranteed to be positive (&gt;=0)</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="preprocessor"></span>  vsq = vsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ; <span class="comment">// ok if not positive</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  retval=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0" title="retvsq=0 : no problem retvsq=1 : &gt;=1.0 retvsq=2 : &lt; too negative retvsq=3 : &gt;VSQ_TOO_BIG (forced fail...">validate_vsq</a>(vsq,&amp;vsq, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;  <span class="comment">//  return( ( vsq &gt; 1. ) ? VSQ_TOO_BIG : vsq   ); </span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;  *x1=vsq;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  <span class="keywordflow">return</span>(retval); <span class="comment">// indicates failure of v^2 or not</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;}</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="comment">/********************************************************************</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="comment">  validate_x(): </span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;<span class="comment">           </span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="comment">    -- makes sure that x[0,1] have physical values, based upon their definitions:</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="comment">    // added wglobal to properly normalize -- global variable set before find_root_2d()</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="comment">    // avoided truncating bottom value of x[0] and x[1] since then can&#39;t converge properly to slightly unphysical values or temporarily reach out into unphysical space and come back in.</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="comment">    // avoid truncating x[1] for v^2&lt;0 since all equations are ok for v^2&lt;0 and can help convergence to nearly physical or even physical solutions</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="comment">    // must avoid x[0] too large and v^2&gt;1, however, since that produces nan&#39;s.</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="comment">    *********************************************************************/</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div>
<div class="line"><a name="l02453"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab0bc808b2bebcc0555091f4fb9105772"> 2453</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab0bc808b2bebcc0555091f4fb9105772" title="validate solution:">validate_Wp</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpold, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *Wpnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;{</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dv = <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> vlpflag;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="comment">/* Always take the absolute value of Wpnew[0] and check to see if it&#39;s too big:  */</span> </div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="comment">//  Wpnew[0] = fabs(Wpold);</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;  <span class="comment">// below allows cases when can be negative internal energy density.  Primarily allowed by wglobal[0].</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpnewsmall=-3.0*<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(D),fabs(Qdotn)),fabs(Bsq)),fabs(Qdotnp)),fabs(wglobal[0])),fabs(wglobal[1]));</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Wpnewsmall=%Lg : %Lg %Lg %Lg %Lg %Lg %Lg\n&quot;,Wpnewsmall,D,Qtsq,Qdotn,*wglobal,Bsq,Qdotnp);</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="keywordflow">if</span>(Wpnew[0]&lt;Wpnewsmall){</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="comment">//  if(Wpnew[0]&lt;-D &amp;&amp; D&gt;0.0){</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <span class="comment">//    Wpnew[0] = 10.0*Qtsq/(2.0*D+Wp0);</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <span class="comment">//    Wpnew[0]=10.0*D+dv;</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="comment">// reset above HD solution</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ecaf51048018ba1c14b2cd7d83e1bd6" title="re-look at this GODMARK Solution to the cold GRHD equation P^2 = ...[Wp]">coldgrhd</a>(&amp;vlpflag, Qtsq, D, &amp;Wp); <span class="comment">// ignore vlpflag result</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    Wpnew[0] = Wp*10.0;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG)</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="preprocessor"></span>    dualfprintf(fail_file,<span class="stringliteral">&quot;Wpnew[0] changed from %21.15g to %21.15g (D=%21.15g Qtsq=%21.15g)\n&quot;</span>,Wpold,Wpnew[0],D,Qtsq);</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;<span class="preprocessor">#endif    </span></div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;  }</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="comment">// revert to previous Wp if &quot;new&quot; Wp very bad</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;  <span class="comment">// can&#39;t go back to previous Wp otherwise won&#39;t go anywhere</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <span class="comment">// Wpnew[0]/global = gamma^2</span></div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  Wpnew[0] = (fabs(Wpnew[0]/wglobal[1]) &gt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#a86d8c2b9765d50cfa0b9db9187ad6cb0">GAMMASQ_TOO_BIG</a>) ?  0.5*(Wpold+Wpnew[0]) : Wpnew[0];</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;}</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;</div>
<div class="line"><a name="l02492"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0"> 2492</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0" title="retvsq=0 : no problem retvsq=1 : &gt;=1.0 retvsq=2 : &lt; too negative retvsq=3 : &gt;VSQ_TOO_BIG (forced fail...">validate_vsq</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsqold,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *vsqnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;{</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  retval=0; <span class="comment">// assume no problem</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;  <span class="keywordflow">if</span>(vsqnew[0]&gt;1.0){</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    retval=1;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    vsqnew[0]=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  }</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <span class="keywordflow">if</span>(vsqnew[0]&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>){</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    retval=3;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    vsqnew[0]=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  }</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="preprocessor">#if(VSQNEGCHECK==1)</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="preprocessor"></span>  <span class="comment">// unnecessary limitation on Newton&#39;s method</span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <span class="keywordflow">if</span>( (vsqnew[0] &lt; 0.) &amp;&amp; (fabs(vsqnew[0]) &lt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#acce84377439ef44cbdd933a44b36b2fd">MAXNEGVSQ</a>) ) { </div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    vsqnew[0] = 0.0;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    retval=2;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;  }</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<span class="preprocessor">#elif(VSQNEGCHECK==2)</span></div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="preprocessor"></span>  <span class="comment">// best can do, but need to indicate that did it since Newton&#39;s method will fail to compute residual and derivative correctly</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;  <span class="keywordflow">if</span>(vsqnew[0] &lt;=-<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>) { </div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    vsqnew[0] = -<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    retval=2;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;  }</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="preprocessor">#elif(VSQNEGCHECK==3)</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(vsqnew[0]&lt;0.0) {</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    vsqnew[0]=0.0;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    retval=2;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;  }</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;}</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div>
<div class="line"><a name="l02541"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a0442f8e961abb0552e7254e87f5a2cbb"> 2541</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a0442f8e961abb0552e7254e87f5a2cbb" title="validate functions here change where Newton is, so ok to change arbitrarily since next Newton step wi...">validate_x_2d</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;{</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab0bc808b2bebcc0555091f4fb9105772" title="validate solution:">validate_Wp</a>(x0[0], &amp;x[0], wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0" title="retvsq=0 : no problem retvsq=1 : &gt;=1.0 retvsq=2 : &lt; too negative retvsq=3 : &gt;VSQ_TOO_BIG (forced fail...">validate_vsq</a>(x0[1], &amp;x[1], wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;}</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> validate_x_1d_old(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[1], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[1], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;{</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dv = <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>;</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;  <span class="comment">/* Always take the absolute value of x[0] and check to see if it&#39;s too big:  */</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;  <span class="comment">//  x[0] = fabs(x[0]);</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wpnewsmall=-3.0*<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(D),fabs(Qdotn)),fabs(Bsq)),fabs(Qdotnp)),fabs(wglobal[0])),fabs(wglobal[1]));</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;Wpnewsmall=%Lg : %Lg %Lg %Lg %Lg %Lg %Lg\n&quot;,Wpnewsmall,D,Qtsq,Qdotn,*wglobal,Bsq,Qdotnp);</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  <span class="keywordflow">if</span>(x[0]&lt;Wpnewsmall) x[0]=D+dv;</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  <span class="comment">// x[0]/global = gamma^2</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;  x[0] = (x[0]/wglobal[1] &gt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#a86d8c2b9765d50cfa0b9db9187ad6cb0">GAMMASQ_TOO_BIG</a>) ?  x0[0] : x[0];</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;}</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div>
<div class="line"><a name="l02569"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ae776e6e31381814b4dd1aafd336bb69d"> 2569</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ae776e6e31381814b4dd1aafd336bb69d" title="1D methods using W&#39;">validate_x_1d</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[1], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[1], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;{</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab0bc808b2bebcc0555091f4fb9105772" title="validate solution:">validate_Wp</a>(x0[0], &amp;x[0], wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;}</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div>
<div class="line"><a name="l02578"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ac5113207ae627a2049037851190aecfd"> 2578</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ac5113207ae627a2049037851190aecfd" title="set pointer to the correct validate_x function">pick_validate_x</a>(<span class="keywordtype">int</span> eomtype,<span class="keywordtype">void</span> (**ptr_validate_x)(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra))</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;{</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;     (<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>==1 &amp;&amp; (eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d89f51ab60206791830c886d62bfd0">EOMGRMHD</a>)  ) ||</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;     (<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>==3 &amp;&amp; (eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d89f51ab60206791830c886d62bfd0">EOMGRMHD</a>) ) ||</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;     ( (<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>==0 || <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>==1) &amp;&amp; eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a757ad8b9c2c7611dad8aab853a87f61b">EOMCOLDGRMHD</a>) ||</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;     (<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#ac8af83d0a144f357cdbf1666d3dbf79d" title="0: original 1-D but with E&#39; (W and v^2, but can give nan&#39;s when Wp&lt;0 slightly – maybe fixed with new n...">WHICHCOLDINVERTER</a>==2 &amp;&amp; eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a757ad8b9c2c7611dad8aab853a87f61b">EOMCOLDGRMHD</a>)</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;     || (eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a40b55e98bfcccde1a3f19d983ca7488c">EOMENTROPYGRMHD</a>)</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;     ){</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    *ptr_validate_x = &amp;<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ae776e6e31381814b4dd1aafd336bb69d" title="1D methods using W&#39;">validate_x_1d</a>;</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  }</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a1a8b022bda62ebcefb911b330e85e8e7" title="1: 1-D E&#39;(W&#39;) (really has 3 roots, but seemingly always positive-most root found AND correct root) 2:...">WHICHHOTINVERTER</a>==2 &amp;&amp; (eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d89f51ab60206791830c886d62bfd0">EOMGRMHD</a>)){</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    *ptr_validate_x = &amp;<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a0442f8e961abb0552e7254e87f5a2cbb" title="validate functions here change where Newton is, so ok to change arbitrarily since next Newton step wi...">validate_x_2d</a>;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  }</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;pick_validate_x: Shouldn&#39;t reach here\n&quot;</span>);</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    myexit(999);</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  }</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;}</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> validate_x(<span class="keywordtype">void</span> (*ptr_validate_x)(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra),<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra) </div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;{</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  (*ptr_validate_x)(x,x0,wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;}</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="comment">/**************************************************** </span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="comment">*****************************************************/</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> func_1d_orig(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;{</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq,vsqfake,gamma,gamma_sq,rho0,w,W,Wp,drdW,dpdW,Wsq,p_tmp, dvsq,dp1,dp2,a_term,ap_term ;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X2,X3;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keywordtype">int</span> retvalvalidatevsq;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  X = Bsq+W;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  X2 = X*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  X3 = X2*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <span class="comment">//dualfprintf(fail_file,&quot;call utsq in residual\n&quot;) ;</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  vsq = vsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;  <span class="comment">//dualfprintf(fail_file,&quot;done w/ utsq in residual\n&quot;) ;</span></div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <span class="comment">// GODMARK DANGEROUS </span></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;  <span class="comment">//  vsqfake = ( vsq &lt; -1.e-10 ) ?  dv : fabs(vsq) ;</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <span class="comment">//  vsqfake = ( vsq &gt; 1. ) ?  (1.-dv) : vsq ;</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160; </div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  retvalvalidatevsq=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0" title="retvsq=0 : no problem retvsq=1 : &gt;=1.0 retvsq=2 : &lt; too negative retvsq=3 : &gt;VSQ_TOO_BIG (forced fail...">validate_vsq</a>(vsq,&amp;vsqfake, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="preprocessor"></span>  <span class="comment">// no longer use below methods </span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="preprocessor">#if(OPTIMIZED)</span></div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="preprocessor"></span>  vsqfake = ( vsq &lt; -<a class="code" href="../../d4/da4/u2p__defs_8h.html#acce84377439ef44cbdd933a44b36b2fd">MAXNEGVSQ</a> ) ?  0.0 : fabs(vsq) ;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;  vsqfake = ( vsq &gt; 1. ) ?  <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a> : vsq ;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="preprocessor">#elif(0)</span></div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(vsq&lt;0.0){</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    <span class="keywordflow">if</span>(vsq&gt;-<a class="code" href="../../d4/da4/u2p__defs_8h.html#acce84377439ef44cbdd933a44b36b2fd">MAXNEGVSQ</a>) vsqfake=0.0;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;      myexit(1);</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    }</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;  }</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  <span class="keywordflow">if</span>(vsq&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>){</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    <span class="keywordflow">if</span>(vsq&lt;=1.0) vsqfake=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      myexit(1);</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    }</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;  }</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  <span class="keywordflow">if</span>(retvalvalidatevsq==0){</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <span class="comment">//rho0 = D * sqrt(1. - vsq) ;</span></div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    <span class="comment">//dualfprintf(fail_file,&quot;rho0,D,gamma: %21.15g %21.15g %21.15g\n&quot;,rho0,D,gamma) ;</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    <span class="comment">//  w = W * (1. - vsq);</span></div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    </div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    p_tmp = pressure_Wp_vsq(whicheos,EOSextra,Wp,D,vsqfake); <span class="comment">// needs to be correct</span></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;    </div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    </div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;    </div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="comment">// Same as previous residual, however, jacobian is calculated using full differentiation w.r.t. W  </span></div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    <span class="comment">// dp/dW&#39; = dp/dW + dP/dv^2 dv^2/dW</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    </div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    </div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    dvsq = dvsq_dW(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// no precision problem</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    dp1 = dpdWp_calc_vsq(whicheos,EOSextra, Wp, D, vsq ); <span class="comment">// vsq can be unphysical</span></div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;    dp2 = dpdvsq_calc_Wp(whicheos,EOSextra, Wp, D, vsq ); <span class="comment">// vsq must be physical</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    dpdW = dp1  + dp2*dvsq; <span class="comment">// dp/dW = dp/dWp</span></div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    </div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    </div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="preprocessor">#if(0) // Scott</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="preprocessor"></span>    </div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    resid[0] = </div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      + Wp </div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      + 0.5 * Bsq * ( 1. + vsq ) <span class="comment">// any vsq</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;      - 0.5*QdotBsq/Wsq</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;      + Qdotnp</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;      - p_tmp;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    norm[0] = </div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;      + fabs(Wp)</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;      + fabs(0.5 * Bsq * ( 1. + vsq ))</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;      + fabs(0.5*QdotBsq/Wsq)</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;      + fabs(Qdotnp)</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;      + fabs(p_tmp);</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    </div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    jac[0][0] = drdW = 1. - dpdW + QdotBsq/(Wsq*W) + 0.5*Bsq*dvsq;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    </div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="preprocessor">#elif(0)</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;<span class="preprocessor"></span>    <span class="comment">//  resid[0] = </span></div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    <span class="comment">//    + W*Wsq</span></div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="comment">//    + 0.5 * Wsq * Bsq * ( 1. + vsq )</span></div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    <span class="comment">//    - 0.5*QdotBsq</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    <span class="comment">//    - Qdotn*Wsq</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <span class="comment">//    - p_tmp*Wsq;</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <span class="comment">//  jac[0][0] = drdW = W * ( 3.*W  +  Bsq * (1. + vsq + 0.5*W*dvsq)  - 2.*Qdotn - 2.*p_tmp - W*dpdW );</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    </div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="preprocessor">#elif(1)  // JON:</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;<span class="preprocessor"></span>    </div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    resid[0] = Qdotnp + Wp - p_tmp + 0.5*Bsq + (Bsq*Qtsq - QdotBsq)/X2;</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    norm[0] = fabs(Qdotnp) + fabs(Wp) + fabs(p_tmp) + fabs(0.5*Bsq) + fabs((Bsq*Qtsq)/X2) + fabs((QdotBsq)/X2);</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    </div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    jac[0][0] = drdW = 1. - dpdW + (Bsq*Qtsq - QdotBsq)/X3*(-2.0);</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;    </div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="preprocessor"></span>    </div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    </div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    dx[0] = -resid[0]/drdW;</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    </div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    *f = 0.5*resid[0]*resid[0];</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    *df = -2. * (*f);</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    </div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;      a_term = 0.5*Bsq*(1.+vsq) + Qdotnp - p_tmp;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;      ap_term = dvsq * ( 0.5*Bsq - dp2 ) - dp1;</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;      </div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig(): x = %21.15g, dx = %21.15g, resid = %21.15g, drdW = %21.15g \n&quot;</span>, x[0], dx[0], resid[0], drdW);</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig(): dvsq = %21.15g,  dp = %21.15g , dp1 = %21.15g , dp2 = %21.15g \n&quot;</span>, dvsq, dpdW,dp1,dp2);</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig(): W = %21.15g , vsq = %21.15g , a = %21.15g,  a_prime = %21.15g  \n&quot;</span>, x[0], vsq, a_term, ap_term);</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;      </div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    }</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;  <span class="keywordflow">else</span>{ <span class="comment">// indicate failure for this 1-D method since depends on v^2 or \tilde{u}^2 to be well-defined as a function of W&#39;</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    resid[0]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    norm[0]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    jac[0][0]=0.0;</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    dx[0]=0.0;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    *f=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    *df=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;  }</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;}</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;<span class="comment">/**************************************************** </span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="comment">  Routine for line searching for the 1D method . </span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="comment">*****************************************************/</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_sq_1d_orig(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;{</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq,W,Wp,Wsq,p_tmp,resid[1],norm[1];</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsqfake;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X2;</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  <span class="keywordtype">int</span> retvalvalidatevsq;</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  </div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  X = Bsq+W;</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  X2 = X*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;  vsq = vsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  retvalvalidatevsq=<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a25cafb40786423e350c5948fb681dce0" title="retvsq=0 : no problem retvsq=1 : &gt;=1.0 retvsq=2 : &lt; too negative retvsq=3 : &gt;VSQ_TOO_BIG (forced fail...">validate_vsq</a>(vsq,&amp;vsqfake, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  <span class="keywordflow">if</span>(retvalvalidatevsq==0){</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="preprocessor"></span>    <span class="comment">// GODMARK DANGEROUS </span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="preprocessor">#if(OPTIMIZED)</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;<span class="preprocessor"></span>    <span class="comment">// scn&#39;s version</span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <span class="comment">//  vsqfake = ( vsq &lt; -dv ) ?  dv : fabs(vsq) ;</span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="comment">//vsqfake = ( vsq &gt; 1. ) ?  (1.-dv) : vsq ;</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="comment">// jon&#39;s version</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    vsqfake = ( vsq &lt; 0.0 ) ?  0.0 : vsq ;</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    vsqfake = ( vsq &gt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a> ) ? <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>  : vsq ; <span class="comment">// GODMARK: must let iterate if vsq&gt;1.  Can&#39;t just force vsq or else Newton&#39;s method won&#39;t work.</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(vsq&lt;0.0){</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;      <span class="keywordflow">if</span>(vsq&gt;-<a class="code" href="../../d4/da4/u2p__defs_8h.html#acce84377439ef44cbdd933a44b36b2fd">MAXNEGVSQ</a>) vsqfake=0.0;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;        myexit(1);</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;      }</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    }</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keywordflow">if</span>(vsq&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>){</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;      <span class="keywordflow">if</span>(vsq&lt;=1.0) vsqfake=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        myexit(1);</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      }</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;    }</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    p_tmp = pressure_Wp_vsq(whicheos,EOSextra,Wp,D,vsqfake); <span class="comment">// vsq&lt;=1 for pressure</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="preprocessor">#if(0) // Scott</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="preprocessor"></span>    resid[0] = </div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      + Wp </div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;      + 0.5 * Bsq * ( 1. + vsq ) <span class="comment">// residual must use unphysical vsq</span></div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      - 0.5*QdotBsq/Wsq</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;      + Qdotnp</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;      - p_tmp;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    norm[0] = </div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;      + fabs(Wp)</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      + fabs(0.5 * Bsq * ( 1. + vsq ))</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      + fabs(0.5*QdotBsq/Wsq)</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;      + fabs(Qdotnp)</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      + fabs(p_tmp);</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="preprocessor">#elif(1)  // JON:</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    resid[0] = Qdotnp + Wp - p_tmp + 0.5*Bsq + (Bsq*Qtsq - QdotBsq)/X2;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    norm[0] = fabs(Qdotnp) + fabs(Wp) + fabs(p_tmp) + fabs(0.5*Bsq) + fabs((Bsq*Qtsq)/X2) + fabs((QdotBsq)/X2);</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    resid[0]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    norm[0]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  }</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;  <span class="keywordflow">return</span>(  0.5*resid[0]*resid[0] );</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;}</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;<span class="comment">// SCN versions of 1D method</span></div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02864"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#af386191840b4ff9a9db36be0eae5b707"> 2864</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#af386191840b4ff9a9db36be0eae5b707">func_1d_orig_scn</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;{</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq,vsqfake,gamma,gamma_sq,rho0,w,W,drdW,dpdW,Wsq,p_tmp, dvsq,dp1,dp2,a_term,ap_term ;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  W = x[0];</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;  <span class="comment">//dualfprintf(fail_file,&quot;call utsq in residual\n&quot;) ;</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;  vsq = vsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  <span class="comment">//dualfprintf(fail_file,&quot;done w/ utsq in residual\n&quot;) ;</span></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;  <span class="comment">// GODMARK DANGEROUS </span></div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;  <span class="comment">//  vsq = ( vsq &lt; -1.e-10 ) ?  dv : fabs(vsq) ;</span></div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;  <span class="comment">//  vsq = ( vsq &gt; 1. ) ?  (1.-dv) : vsq ;</span></div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;  </div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="preprocessor">#if(OPTIMIZED)</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="preprocessor"></span>  vsqfake = ( vsq &lt; -<a class="code" href="../../d4/da4/u2p__defs_8h.html#acce84377439ef44cbdd933a44b36b2fd">MAXNEGVSQ</a> ) ?  0.0 : fabs(vsq) ;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  vsqfake = ( vsq &gt; 1. ) ?  <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a> : vsq ;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(vsq&lt;0.0){</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    <span class="keywordflow">if</span>(vsq&gt;-<a class="code" href="../../d4/da4/u2p__defs_8h.html#acce84377439ef44cbdd933a44b36b2fd">MAXNEGVSQ</a>) vsqfake=0.0;</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      myexit(1);</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    }</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  }</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  <span class="keywordflow">if</span>(vsq&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>){</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keywordflow">if</span>(vsq&lt;=1.0) vsqfake=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      myexit(1);</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    }</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;  }</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;  <span class="comment">//rho0 = D * sqrt(1. - vsq) ;</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;  <span class="comment">//dualfprintf(fail_file,&quot;rho0,D,gamma: %21.15g %21.15g %21.15g\n&quot;,rho0,D,gamma) ;</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;  <span class="comment">//  w = W * (1. - vsq);</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;  p_tmp = pressure_W_vsq_scn(whicheos,EOSextra, W,D,vsqfake);</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;  <span class="comment">// Same as previous residual, however, jacobian is calculated using full differentiation w.r.t. W  </span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;  dvsq = dvsq_dW(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  dp1 = dpdW_calc_vsq_scn(whicheos,EOSextra, W, D, vsq ); <span class="comment">// use real vsq</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;  dp2 = dpdvsq_calc_scn(whicheos,EOSextra, W, D, vsqfake );</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;  dpdW = dp1  + dp2*dvsq;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;  resid[0] = </div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    + W </div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    + 0.5 * Bsq * ( 1. + vsq ) <span class="comment">// use real vsq</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    - 0.5*QdotBsq/Wsq</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    + Qdotn</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    - p_tmp;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  norm[0] = </div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    + fabs(W )</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    + fabs(0.5 * Bsq * ( 1. + vsq ))</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    + fabs(0.5*QdotBsq/Wsq)</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    + fabs(Qdotn)</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    + fabs(p_tmp);</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  jac[0][0] = drdW = 1. - dpdW + QdotBsq/(Wsq*W) + 0.5*Bsq*dvsq;</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;  <span class="comment">//  resid[0] = </span></div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;  <span class="comment">//    + W*Wsq</span></div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;  <span class="comment">//    + 0.5 * Wsq * Bsq * ( 1. + vsq )</span></div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;  <span class="comment">//    - 0.5*QdotBsq</span></div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;  <span class="comment">//    - Qdotn*Wsq</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;  <span class="comment">//    - p_tmp*Wsq;</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;  <span class="comment">//  jac[0][0] = drdW = W * ( 3.*W  +  Bsq * (1. + vsq + 0.5*W*dvsq)  - 2.*Qdotn - 2.*p_tmp - W*dpdW );</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;  dx[0] = -resid[0]/drdW;</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;  *f = 0.5*resid[0]*resid[0];</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;  *df = -2. * (*f);</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    a_term = 0.5*Bsq*(1.+vsq) + Qdotn - p_tmp;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    ap_term = dvsq * ( 0.5*Bsq - dp2 ) - dp1;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig(): x = %21.15g, dx = %21.15g, resid = %21.15g, drdW = %21.15g \n&quot;</span>, x[0], dx[0], resid[0], drdW);</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig(): dvsq = %21.15g,  dp = %21.15g , dp1 = %21.15g , dp2 = %21.15g \n&quot;</span>, dvsq, dpdW,dp1,dp2);</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig(): W = %21.15g , vsq = %21.15g , a = %21.15g,  a_prime = %21.15g  \n&quot;</span>, x[0], vsq, a_term, ap_term);</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    </div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  }</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;}</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="comment">/**************************************************** </span></div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;<span class="comment">  Routine for line searching for the 1D method . </span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;<span class="comment">*****************************************************/</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;</div>
<div class="line"><a name="l02965"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#acdb87aa4479559a25be8b8209b2cf64e"> 2965</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#acdb87aa4479559a25be8b8209b2cf64e">res_sq_1d_orig_scn</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;{</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> vsq,vsqfake,W,Wsq,p_tmp,resid[1],norm[1];</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;  W = x[0];</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  vsq = vsq_calc(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  </div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;  <span class="comment">// GODMARK DANGEROUS </span></div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;<span class="preprocessor">#if(OPTIMIZED)</span></div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;<span class="preprocessor"></span>  <span class="comment">// scn&#39;s version</span></div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;  <span class="comment">//  vsq = ( vsq &lt; -dv ) ?  dv : fabs(vsq) ;</span></div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;  <span class="comment">//vsq = ( vsq &gt; 1. ) ?  (1.-dv) : vsq ;</span></div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;  <span class="comment">// jon&#39;s version</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;  vsqfake = ( vsq &lt; 0.0 ) ?  0.0 : vsq ;</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  vsqfake = ( vsq &gt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a> ) ? <a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>  : vsq ;</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(vsq&lt;0.0){</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="keywordflow">if</span>(vsq&gt;-<a class="code" href="../../d4/da4/u2p__defs_8h.html#acce84377439ef44cbdd933a44b36b2fd">MAXNEGVSQ</a>) vsqfake=0.0;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      myexit(1);</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    }</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  }</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;  <span class="keywordflow">if</span>(vsq&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>){</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <span class="keywordflow">if</span>(vsq&lt;=1.0) vsqfake=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2ed49849267c8ccf21fee5e841832422">VSQ_TOO_BIG</a>;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;func_1d_orig: vsq=%21.15g\n&quot;</span>,vsq);</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      myexit(1);</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    }</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;  }</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;  p_tmp = pressure_W_vsq_scn(whicheos,EOSextra,W,D,vsqfake);</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;  resid[0] = </div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    + W </div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    + 0.5 * Bsq * ( 1. + vsq )</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    - 0.5*QdotBsq/Wsq</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;    + Qdotn</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    - p_tmp;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;  norm[0] = </div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    + fabs(W)</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    + fabs(0.5 * Bsq * ( 1. + vsq ))</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;    + fabs(0.5*QdotBsq/Wsq)</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    + fabs(Qdotn)</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    + fabs(p_tmp);</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;  <span class="keywordflow">return</span>(  0.5*resid[0]*resid[0] );</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;}</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;</div>
<div class="line"><a name="l03031"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a6e08a0798ec2a46291f694eb8afb62ea"> 3031</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a6e08a0798ec2a46291f694eb8afb62ea" title="unoptimized vresion of func_Eprime">func_Eprime_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;{</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> drdW;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;  </div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a5e5fa8022da930edc7ec6c2a7760ac3f" title="0 = -E&#39; + E&#39;[Wp] for hot GRMHD (can be used for cold GRMHD too) while this has poles near bad roots...">Eprime_Wp_unopt</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra, &amp;resid[0], &amp;norm[0]);</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;  jac[0][0] = drdW = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a521ffc23d619471f17b09af68d997c87" title="dE&#39;/dWp [ Wp ] It is ok that there exists a term (1-dpdW) since even with ideal gas EOS in non-rel li...">dEprimedWp_unopt</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;  dx[0] = -resid[0]/drdW;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;  <span class="comment">//  if((fabs(dx[0])/(Wp+D)&gt;0.1){ // don&#39;t trust such a big jump</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;  <span class="comment">// dx[0] = sign(dx[0])*0.1;</span></div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  *f = 0.5*resid[0]*resid[0];</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  *df = -2. * (*f);</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;}</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;</div>
<div class="line"><a name="l03057"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ae45a10654916147c0bd6eb16ebd4cdf0"> 3057</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ae45a10654916147c0bd6eb16ebd4cdf0" title="res_sq_Eprime() (or any pure residual function) is only called by line searching method">res_sq_Eprime_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;{</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid,norm;</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a5e5fa8022da930edc7ec6c2a7760ac3f" title="0 = -E&#39; + E&#39;[Wp] for hot GRMHD (can be used for cold GRMHD too) while this has poles near bad roots...">Eprime_Wp_unopt</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra, &amp;resid, &amp;norm);</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;  <span class="keywordflow">return</span>(  0.5*resid*resid );</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;}</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div>
<div class="line"><a name="l03075"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a7aa8084194414e0db6af909356a94f74"> 3075</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a7aa8084194414e0db6af909356a94f74" title="get first part of kinetic stuff for func() or resid_sq() for optimized version of func()...">get_kinetics_part1</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra,  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X2, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *X3, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *utsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gamma, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *gammasq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *rho0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wmrho0)</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;{</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;  <span class="comment">// compute common quantities</span></div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;  *W = Wp+D;</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;  *X = Bsq + *W + <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>;</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;  *X2 = (*X)  *(*X);</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  *X3 = (*X2) *(*X);</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;  *utsq=utsq_calc(*W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// check for precision problems</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;  <span class="comment">// get \gamma^2, \gamma, \chi, and \rho_0 (no EOS used):</span></div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;  *gammasq=1.0+ (*utsq);</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;  *gamma=sqrt(*gammasq);</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  *wmrho0=wmrho0_compute_utsq(Wp, D, *utsq, *gamma, *gammasq);</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;  *rho0=D/(*gamma);</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;}</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div>
<div class="line"><a name="l03104"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#adc1ab10f4ac3ae07f8f8b8e4b00f3858"> 3104</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#adc1ab10f4ac3ae07f8f8b8e4b00f3858" title="get kinetic stuff for func() or resid_sq() for optimized version of func()">get_kinetics_part2</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra,  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> W, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> X, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> X2, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> X3, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gamma, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gammasq, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rho0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> wmrho0,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dvsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dwmrho0dW,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *drho0dW,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dwmrho0dvsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *drho0dvsq)</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;{</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;  <span class="comment">// total derivative dv^2/dW&#39;</span></div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;  *dvsq = dvsq_dW(W, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra); <span class="comment">// no precision problem -- and no EOS calls inside -- purely kinetic</span></div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;  *dwmrho0dW = 1.0/gammasq; <span class="comment">// holding utsq fixed</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  *drho0dW = 0.0; <span class="comment">// because \rho=D/\gamma and holding utsq fixed</span></div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;  *dwmrho0dvsq = (D*(gamma*0.5-1.0) - Wp); <span class="comment">// holding Wp fixed</span></div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;  *drho0dvsq = -D*gamma*0.5; <span class="comment">// because \rho=D/\gamma and holding Wp fixed</span></div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;}</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;</div>
<div class="line"><a name="l03125"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8dc5a20ee912aa167614e979cfc4d5b6"> 3125</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8dc5a20ee912aa167614e979cfc4d5b6" title="optimized version of func_Eprime() optimized in sense that minimizes extra kinetic calculations AND E...">func_Eprime_opt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;{</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;  <span class="comment">// Get some kinetic quantities</span></div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="comment"></span>  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X2,X3,W;</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gamma,gammasq;</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rho0,wmrho0;</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a7aa8084194414e0db6af909356a94f74" title="get first part of kinetic stuff for func() or resid_sq() for optimized version of func()...">get_kinetics_part1</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc, whicheos, EOSextra,  &amp;W, &amp;X, &amp;X2, &amp;X3, &amp;utsq, &amp;gamma, &amp;gammasq, &amp;rho0, &amp;wmrho0);</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;  <span class="comment">// Now can get thermodynamical quantities and results from them</span></div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;<span class="comment"></span>  <span class="comment">// PERFORMANCEMARK: Tested code with and without these type of if/else (all of them in utoprim_jon.c) and all rest used by func_Eprime() and found only changed performance from 7% of CPU to 6.90% CPU.  Not interesting change</span></div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Eprime,dEprimedWp;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  <span class="keywordflow">if</span>(gammasq&lt;0.0 || utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){ <span class="comment">// also checks if nan</span></div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    Eprime=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// force residual to be large and negative so indicates a problem</span></div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    dEprimedWp=0.0; <span class="comment">// indicates a problem</span></div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    resid[0]=Eprime;</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    norm[0]=Eprime;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    jac[0][0]=dEprimedWp;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    dx[0] = <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    *f = 0.5*(Eprime*Eprime);</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    *df = -2. * (*f);</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;  }</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <span class="comment">// Now can get pressure and other thermodynamical quantities</span></div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    <span class="comment">// Optimize for any EOS table lookup by computing P(\rho_0,\chi), dP/d\rho_0 and dP/d\chi now.</span></div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <span class="comment">// Otherwise, Eprime_Wp() and dEprimeWp() (as previously coded) repeated these calls and made calls for each EOS term while now can make a pipelined call and obtain all 3 EOS values at once.</span></div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="comment"></span>    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> pofchi,dpdrho,dpdchi;</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    getall_forinversion(whicheos,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a03d89f51ab60206791830c886d62bfd0">EOMGRMHD</a>,CHIDIFF,EOSextra,rho0,wmrho0,&amp;pofchi,&amp;dpdrho,&amp;dpdchi);</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <span class="comment">// get Eprime</span></div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <span class="comment">// Note that -E&#39;=Qdotnp</span></div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;<span class="comment"></span>    Eprime = Qdotnp + Wp - pofchi + 0.5*Bsq + 0.5*(Bsq*Qtsq-QdotBsq)/X2;</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> normEprime = fabs(Qdotnp) + fabs(Wp) + fabs(pofchi) + fabs(0.5*Bsq) + fabs(0.5*(Bsq*Qtsq)/X2) + fabs(0.5*(QdotBsq)/X2);</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="keywordflow">if</span>(pofchi!=pofchi || Eprime!=Eprime) Eprime=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;    <span class="comment">// Get derivative-related kinetics</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;<span class="comment"></span>    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dvsq,dwmrho0dW,drho0dW;</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dwmrho0dvsq,drho0dvsq;</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    <a class="code" href="../../d1/dde/utoprim__jon_8c.html#adc1ab10f4ac3ae07f8f8b8e4b00f3858" title="get kinetic stuff for func() or resid_sq() for optimized version of func()">get_kinetics_part2</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc, whicheos, EOSextra,  W, X, X2, X3, utsq, gamma, gammasq, rho0, wmrho0, &amp;dvsq,&amp;dwmrho0dW,&amp;drho0dW,&amp;dwmrho0dvsq,&amp;drho0dvsq);</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;    <span class="comment">// get mixed kinetic-thermal derivatives</span></div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="comment"></span>    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dpdW,dpdvsq,dpdWp;</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    <span class="comment">// dvsq = dv^2/dW&#39; total derivative</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    dpdW   = drho0dW   *dpdrho  +     dwmrho0dW *dpdchi; <span class="comment">// dP/dW&#39; holding utsq fixed</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    dpdvsq = drho0dvsq *dpdrho  +   dwmrho0dvsq *dpdchi; <span class="comment">// dP/dvsq holding W&#39; fixed where utsq and vsq are same fixed quantity</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    dpdWp = dpdW  + dpdvsq*dvsq; <span class="comment">// dp/dW = dp/dWp [total derivative]</span></div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="comment">// get dEprimedWp</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;<span class="comment"></span>    dEprimedWp = (1.0 - dpdWp) - (Bsq*Qtsq - QdotBsq)/X3;</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    <span class="comment">// check for nan (but not inf)</span></div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    <span class="keywordflow">if</span>(dvsq!=dvsq || dpdW!=dpdW || dpdvsq!=dpdvsq || dpdWp!=dpdWp || dEprimedWp!=dEprimedWp) dEprimedWp=0.0; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    <span class="comment">// residual, jacobian, and step</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;<span class="comment"></span>    resid[0]=Eprime;</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;    norm[0]=normEprime;</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;    jac[0][0]=dEprimedWp;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    dx[0] = -Eprime/dEprimedWp;</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    *f = 0.5*(Eprime*Eprime);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    *df = -2. * (*f);</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="comment">//    if(x[0]+dx[0]&lt;SMALL){</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    <span class="comment">//      dualfprintf(fail_file,&quot;EPRIMEPROBLEM: %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g %21.15g :: %21.15g %21.15g %21.15g :: %21.15g %21.15g %21.15g %21.15g %21.15g :: %21.15g %21.15g %21.15g %21.15g %21.15g :: %21.15g %21.15g\n&quot;</span></div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    <span class="comment">//    ,Wp, Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc, W, X, X2, X3, utsq, gamma, gammasq, rho0, wmrho0</span></div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    <span class="comment">//    ,pofchi,dpdrho,dpdchi</span></div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="comment">//    ,dvsq,dwmrho0dW,drho0dW,dwmrho0dvsq,drho0dvsq</span></div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="comment">//    ,dpdW,dpdvsq,dpdWp,Eprime,dEprimedWp</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    <span class="comment">//            ,x[0],dx[0]);</span></div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;    <span class="comment">//      int extraloop;</span></div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    <span class="comment">//      for(extraloop=FIRSTEOSGLOBAL;extraloop&lt;=LASTEOSGLOBAL;extraloop++) dualfprintf(fail_file,&quot;EPRIMEPROBELMEXTRA: %21.15g\n&quot;,EOSextra[extraloop]);</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="comment">//    }</span></div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;  }</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;}</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;</div>
<div class="line"><a name="l03259"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab641905badd72443028936b1047fcf94"> 3259</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab641905badd72443028936b1047fcf94" title="res_sq_Eprime() (or any pure residual function) is only called by line searching method">res_sq_Eprime_opt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;{</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> jac[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>][<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>]; <span class="comment">// dummy variable, return value not used</span></div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> f,df; <span class="comment">// dummy, return value not used</span></div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;  <span class="keywordtype">int</span> n=1; <span class="comment">// true for this residual</span></div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;  <span class="comment">// just call func_Eprime_opt() since more optimized than before -- could optimize further but don&#39;t often or at all use this function</span></div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8dc5a20ee912aa167614e979cfc4d5b6" title="optimized version of func_Eprime() optimized in sense that minimizes extra kinetic calculations AND E...">func_Eprime_opt</a>(x, dx, resid, norm, jac, &amp;f, &amp;df, n, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc, whicheos, EOSextra);</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;  <span class="keywordflow">return</span>(  0.5*resid[0]*resid[0] );</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;}</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;</div>
<div class="line"><a name="l03279"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab5dd7587116d2d7073062c2d17f5d17a"> 3279</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab5dd7587116d2d7073062c2d17f5d17a" title="not that this is well-optimized. Psq_Wp() and dPsqdWp_Wp() don&#39;t use subfunctions like &quot;_unopt&quot; versi...">func_Psq</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;{</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> drdW,Wp;</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#afe17864b47716e97813efc16988f8184" title="new version without poles returns actually W^2 P^2 Note that this does NOT use Qdotn or Qdotnp (from ...">Psq_Wp</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra, &amp;resid[0], &amp;norm[0]);</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;  jac[0][0] = drdW = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#adb5a3bde8a0f684bc7a2c2810b5871ec" title="new version without poles result = d(W^2 P^2)/dWp = Note that this does NOT use Qdotn or Qdotnp (from...">dPsqdWp_Wp</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;  dx[0] = -resid[0]/drdW;</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;  *f = 0.5*resid[0]*resid[0];</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;  *df = -2. * (*f);</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;}</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;</div>
<div class="line"><a name="l03301"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a1780c31c73839c379dcd3b6e514ad57b"> 3301</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a1780c31c73839c379dcd3b6e514ad57b">res_sq_Psq</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;{</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid,norm;</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#afe17864b47716e97813efc16988f8184" title="new version without poles returns actually W^2 P^2 Note that this does NOT use Qdotn or Qdotnp (from ...">Psq_Wp</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra, &amp;resid, &amp;norm);</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;  <span class="keywordflow">return</span>(  0.5*resid*resid );</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;}</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;</div>
<div class="line"><a name="l03316"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8b2e2da2d6f2aece34544eb68713394b"> 3316</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8b2e2da2d6f2aece34544eb68713394b">func_Sc_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;{</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> drdW;</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;  <span class="comment">//  FTYPE dv = 1.0e-10;</span></div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a9ab30fbd31679018adef3710300826c3" title="0 = Wp(-Sc + Sc[Wp]) for entropy GRMHD Noticed that original residual behaves like log(Wp) near the r...">Sc_Wp_unopt</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra, &amp;resid[0], &amp;norm[0]);</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;  jac[0][0] = drdW = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a4733edf9231a97e1ff06e0901257fbec" title="dSc/dWp [ Wp ] for entropy GRMHD">dScdWp_unopt</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;  dx[0] = -resid[0]/drdW;</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;  <span class="comment">//  if((fabs(dx[0])/(Wp+D)&gt;0.1){ // don&#39;t trust such a big jump</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;  <span class="comment">// dx[0] = sign(dx[0])*0.1;</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;  *f = 0.5*resid[0]*resid[0];</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;  *df = -2. * (*f);</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;}</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;</div>
<div class="line"><a name="l03341"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#adbaf5c40586f6e85803ade2f3a6bed1a"> 3341</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#adbaf5c40586f6e85803ade2f3a6bed1a">res_sq_Sc_unopt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;{</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid,norm;</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a9ab30fbd31679018adef3710300826c3" title="0 = Wp(-Sc + Sc[Wp]) for entropy GRMHD Noticed that original residual behaves like log(Wp) near the r...">Sc_Wp_unopt</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra, &amp;resid, &amp;norm);</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;  <span class="keywordflow">return</span>(  0.5*resid*resid );</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;}</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;</div>
<div class="line"><a name="l03357"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad797f172e3b3b7f0fb03c7076cd404eb"> 3357</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad797f172e3b3b7f0fb03c7076cd404eb" title="optimized version of func_Sc() very similar to optimized version of func_Eprime() but different &quot;geta...">func_Sc_opt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;{</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;  <span class="comment">// Get some kinetic quantities</span></div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment"></span>  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Wp;</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a933233ff9879962bcc2ff987c6920f90">X</a>,X2,X3,W;</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> utsq;</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> gamma,gammasq;</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> rho0,wmrho0;</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a7aa8084194414e0db6af909356a94f74" title="get first part of kinetic stuff for func() or resid_sq() for optimized version of func()...">get_kinetics_part1</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc, whicheos, EOSextra,  &amp;W, &amp;X, &amp;X2, &amp;X3, &amp;utsq, &amp;gamma, &amp;gammasq, &amp;rho0, &amp;wmrho0);</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;  <span class="comment">// Now can get thermodynamical quantities and results from them</span></div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;<span class="comment"></span>  <span class="comment">// PERFORMANCEMARK: Tested code with and without these type of if/else (all of them in utoprim_jon.c) and all rest used by func_Eprime() and found only changed performance from 7% of CPU to 6.90% CPU.  Not interesting change</span></div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Scprime,dScprimedWp;</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;  <span class="keywordflow">if</span>(gammasq&lt;0.0 || utsq&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#af0d629b39ce816aeba59dec34ae99193" title="For &lt;=-1 the equations become complex.">UTSQNEGLIMIT</a> || utsq!=utsq){ <span class="comment">// also checks if nan</span></div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;    Scprime=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// force residual to be large and negative so indicates a problem</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;    dScprimedWp=0.0; <span class="comment">// indicates a problem</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;    resid[0]=Scprime;</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    norm[0]=Scprime;</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    jac[0][0]=dScprimedWp;</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    dx[0] = -Scprime/dScprimedWp;</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    *f = 0.5*(Scprime*Scprime);</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    *df = -2. * (*f);</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;  }</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;    <span class="comment">// Now can get pressure and other thermodynamical quantities</span></div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    <span class="comment">// Optimize for any EOS table lookup by computing P(\rho_0,\chi), dP/d\rho_0 and dP/d\chi now.</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;    <span class="comment">// Otherwise, Eprime_Wp() and dEprimeWp() (as previously coded) repeated these calls and made calls for each EOS term while now can make a pipelined call and obtain all 3 EOS values at once.</span></div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="comment"></span>    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Ssofchi,dSsdrho,dSsdchi;</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    getall_forinversion(whicheos,<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a40b55e98bfcccde1a3f19d983ca7488c">EOMENTROPYGRMHD</a>,CHIDIFF,EOSextra,rho0,wmrho0,&amp;Ssofchi,&amp;dSsdrho,&amp;dSsdchi);</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    <span class="comment">// get Scprime</span></div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="comment"></span>    <span class="comment">// old residual</span></div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    Scprime = -Sc + D*Ssofchi;</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Scprimenorm = fabs(Sc) + fabs(D*Ssofchi);</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    <span class="comment">// new residual (problem near Wp=0 of course that could diverge to Wp=0 and be wrong solution. Was using this &quot;new&quot; residual to help reach solution faster, but in general doesn&#39;t help so much and hurts since sometimes with tabulated EOS reaches Wp=0 and results in bad inversion.)</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    <span class="comment">// Also, for tabulated EOS, new residual more complicated and error doesn&#39;t drop.  Even though old residual has many iterations like new residual, at least old residual has very small error.  This is probably because derivative is not exactly consistent with function in the tabulated EOS yet both are used in the derivative expression.</span></div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;    <span class="keywordflow">if</span>(Ssofchi!=Ssofchi || Scprime!=Scprime) Scprime=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;    <span class="comment">// Get derivative-related kinetics</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;<span class="comment"></span>    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dvsq,dwmrho0dW,drho0dW;</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dwmrho0dvsq,drho0dvsq;</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    <a class="code" href="../../d1/dde/utoprim__jon_8c.html#adc1ab10f4ac3ae07f8f8b8e4b00f3858" title="get kinetic stuff for func() or resid_sq() for optimized version of func()">get_kinetics_part2</a>(Wp, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc, whicheos, EOSextra,  W, X, X2, X3, utsq, gamma, gammasq, rho0, wmrho0, &amp;dvsq,&amp;dwmrho0dW,&amp;drho0dW,&amp;dwmrho0dvsq,&amp;drho0dvsq);</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;    <span class="comment">// get mixed kinetic-thermal derivatives</span></div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;<span class="comment"></span>    <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dSsdW,dSsdvsq,dSsdWp;</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;    dSsdW =   drho0dW   *dSsdrho +   dwmrho0dW   *dSsdchi; <span class="comment">// dSs/dW&#39; holding utsq fixed</span></div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;    dSsdvsq = drho0dvsq *dSsdrho +   dwmrho0dvsq *dSsdchi;</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    dSsdWp = dSsdW  + dSsdvsq*dvsq; <span class="comment">// dSs/dW = dSs/dWp [total derivative]</span></div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;    <span class="comment">// get dScprimeWp</span></div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="comment"></span>    <span class="comment">// old result for old residual</span></div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;    dScprimedWp = D*dSsdWp;</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;    </div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    <span class="comment">// new result for new residual</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    <span class="comment">// check for nan (but not inf)</span></div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;    <span class="keywordflow">if</span>(dvsq!=dvsq || dSsdW!=dSsdW || dSsdvsq!=dSsdvsq || dSsdWp!=dSsdWp || dScprimedWp!=dScprimedWp) dScprimedWp=0.0; <span class="comment">// indicates still problem</span></div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    <span class="comment">// residual, jacobian, and step</span></div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;<span class="comment"></span>    resid[0]=Scprime;</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    norm[0]=Scprimenorm;</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    jac[0][0]=dScprimedWp;</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    dx[0] = -Scprime/dScprimedWp;</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    *f = 0.5*(Scprime*Scprime);</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;    *df = -2. * (*f);</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;  }</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;}</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;</div>
<div class="line"><a name="l03476"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#acba495fe9b21b19b393a2e532c4880dc"> 3476</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#acba495fe9b21b19b393a2e532c4880dc" title="optimized version of res_sq_Sc() just calls func_Sc_opt() for now since more optimized than original ...">res_sq_Sc_opt</a>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;{</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> jac[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>][<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>]; <span class="comment">// dummy variable, return value not used</span></div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> f,df; <span class="comment">// dummy, return value not used</span></div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;  <span class="keywordtype">int</span> n=1; <span class="comment">// true for this residual</span></div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;  <span class="comment">// just call func_Eprime_opt() since more optimized than before -- could optimize further but don&#39;t often or at all use this function</span></div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad797f172e3b3b7f0fb03c7076cd404eb" title="optimized version of func_Sc() very similar to optimized version of func_Eprime() but different &quot;geta...">func_Sc_opt</a>(x, dx, resid, norm, jac, &amp;f, &amp;df, n, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc, whicheos, EOSextra);</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;  <span class="keywordflow">return</span>(  0.5*resid[0]*resid[0] );</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;}</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;<span class="comment">/*********************************************************</span></div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;<span class="comment">returns residual  of vsq-1</span></div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="comment">**********************************************************/</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> func_vsq(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;{</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;  </div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  Wp,W, vsq, Wsq, p_tmp, dPdvsq, dPdW, temp, detJ,tmp2,tmp3;</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;  vsq = x[1];</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;  </div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;  p_tmp  = pressure_Wp_vsq(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;  dPdW   = dpdWp_calc_vsq(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;  dPdvsq = dpdvsq_calc_Wp(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;p_tmp=%21.15g dPdW=%21.15g dPdvsq=%21.15g\n&quot;</span>,p_tmp,dPdW,dPdvsq);</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;  }</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;  <span class="comment">/* These expressions were calculated using Mathematica */</span></div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;  <span class="comment">/* Since we know the analytic form of the equations, we can explicitly</span></div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;<span class="comment">     calculate the Newton-Raphson step:                  */</span></div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;  dx[0] = (-Bsq/2. + dPdvsq)*(Qtsq - vsq*((Bsq+W)*(Bsq+W)) + </div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;                              (QdotBsq*(Bsq + 2*W))/Wsq) + </div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    ((Bsq+W)*(Bsq+W))*(-Qdotnp - (Bsq*(1 + vsq))/2. + QdotBsq/(2.*Wsq) -Wp + p_tmp);</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;  dx[1] = -((-1 + dPdW - QdotBsq/(Wsq*W))*</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;            (Qtsq - vsq*((Bsq+W)*(Bsq+W)) + (QdotBsq*(Bsq + 2*W))/Wsq)) - </div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;    2*(vsq + QdotBsq/(Wsq*W))*(Bsq + W)*</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    (-Qdotnp - (Bsq*(1 + vsq))/2. + QdotBsq/(2.*Wsq) - Wp + p_tmp);</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;  detJ = (Bsq + W)*((-1 + dPdW - QdotBsq/(Wsq*W))*(Bsq + W) + </div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;                    ((Bsq - 2*dPdvsq)*(QdotBsq + vsq*(Wsq*W)))/(Wsq*W));</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;  </div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;  dx[0] /= -(detJ) ;</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;  dx[1] /= -(detJ) ;</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;  jac[0][0] = -2*(vsq + QdotBsq/(Wsq*W))*(Bsq + W);</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;  jac[0][1] = -(Bsq + W)*(Bsq + W);</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;  jac[1][0] = -1 - QdotBsq/(Wsq*W) + dPdW;</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;  jac[1][1] = -Bsq/2. + dPdvsq;</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;  resid[0]  = Qtsq - vsq*(Bsq + W)*(Bsq + W) + (QdotBsq*(Bsq + 2*W))/Wsq;</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;  resid[1]  = -Qdotnp - (Bsq*(1 + vsq))/2. + QdotBsq/(2.*Wsq) - Wp + p_tmp;</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;  norm[0]  = fabs(Qtsq) + fabs(vsq*(Bsq + W)*(Bsq + W)) + fabs((QdotBsq*(Bsq + 2*W))/Wsq);</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;  norm[1]  = fabs(Qdotnp) + fabs((Bsq*(1 + vsq))/2.) + fabs(QdotBsq/(2.*Wsq)) + fabs(Wp) + fabs(p_tmp);</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;  *df = -resid[0]*resid[0] - resid[1]*resid[1];</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;  *f = -0.5 * ( *df );</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;func_vsq(): x[0] = %21.15g , x[1] = %21.15g , dx[0] = %21.15g , dx[1] = %21.15g , f = %21.15g \n&quot;</span>, </div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;                x[0], x[1],dx[0], dx[1], *f);</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    </div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;  }</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;}</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;<span class="comment">/**********************************************************/</span></div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> func_vsq2(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> norm[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*jac)[NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *df, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;{</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;  </div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  W, Wp,vsq, Wsq, p_tmp, dPdvsq, dPdW, temp, detJ,tmp2,tmp3;</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t11;</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t16;</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t18;</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t2;</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t21;</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t23;</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t24;</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t25;</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t3;</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t35;</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t36;</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t4;</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t40;</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t9;</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;  vsq = x[1];</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;  </div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;  </div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;  p_tmp  = pressure_Wp_vsq(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;  dPdW   = dpdWp_calc_vsq(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;  dPdvsq = dpdvsq_calc_Wp(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;W=%21.15g D=%21.15g vsq=%21.15g\n&quot;</span>,W,D,vsq);</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;p_tmp=%21.15g dPdW=%21.15g dPdvsq=%21.15g\n&quot;</span>,p_tmp,dPdW,dPdvsq);</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;  }</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="preprocessor"></span>  dualfprintf(fail_file,<span class="stringliteral">&quot;p_tmp=%21.15g dPdW=%21.15g dPdvsq=%21.15g\n&quot;</span>,p_tmp,dPdW,dPdvsq);</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;  <span class="comment">/* These expressions were calculated using Mathematica, but made into efficient code using Maple */</span></div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;  <span class="comment">/* Since we know the analytic form of the equations, we can explicitly</span></div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="comment">     calculate the Newton-Raphson step:                  */</span></div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;  t2 = -0.5*Bsq+dPdvsq;</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;  t3 = Bsq+W;</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;  t4 = t3*t3;</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;  t9 = 1/Wsq;</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;  t11 = Qtsq-vsq*t4+QdotBsq*(Bsq+2.0*W)*t9;</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t11norm = fabs(Qtsq)+fabs(vsq*t4)+fabs(QdotBsq*(Bsq+2.0*W)*t9);</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;  t16 = QdotBsq*t9;</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;  t18 = -Qdotnp-0.5*Bsq*(1.0+vsq)+0.5*t16-Wp+p_tmp;</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t18norm = fabs(Qdotnp)+fabs(0.5*Bsq*(1.0+vsq))+fabs(0.5*t16)+fabs(Wp)+fabs(p_tmp);</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;  <span class="comment">//t18 = -Qdotn-0.5*Bsq*(1.0+vsq)+0.5*t16-W+p_tmp;</span></div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;  t21 = 1/t3;</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;  t23 = 1/W;</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;  t24 = t16*t23;</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;  t25 = -1.0+dPdW-t24;</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;  t35 = t25*t3+(Bsq-2.0*dPdvsq)*(QdotBsq+vsq*Wsq*W)*t9*t23;</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;  t36 = 1/t35;</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;  dx[0] = -(t2*t11+t4*t18)*t21*t36;</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;<span class="preprocessor"></span>  dualfprintf(fail_file,<span class="stringliteral">&quot;Qdotn=%21.15g Qdotnp=%21.15g Wp=%21.15g p_tmp=%21.15g\n&quot;</span>,Qdotn,Qdotnp,Wp,p_tmp);</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;  dualfprintf(fail_file,<span class="stringliteral">&quot;t2=%21.15g t3=%21.15g t4=%21.15g t9=%21.15g t11=%21.15g t16=%21.15g t18=%21.15g t21=%21.15g t23=%21.15g t24=%21.15g t25=%21.15g t35=%21.15g t36=%21.15g dx[0]=%21.15g\n&quot;</span>,t2,t3,t4,t9,t11,t16,t18,t21,t23,t24,t25,t35,t36,dx[0]);</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;  t40 = (vsq+t24)*t3;</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;  dx[1] = -(-t25*t11-2.0*t40*t18)*t21*t36;</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;  detJ = t3*t35;</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;  jac[0][0] = -2.0*t40;</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;  jac[0][1] = -t4;</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;  jac[1][0] = t25;</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;  jac[1][1] = t2;</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;  resid[0] = t11;</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;  resid[1] = t18;</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;  norm[0] = t11norm;</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;  norm[1] = t18norm;</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;  *df = -resid[0]*resid[0] - resid[1]*resid[1];</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;  *f = -0.5 * ( *df );</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;Qdotn=%21.15g QdotBsq=%21.15g Qtsq=%21.15g Bsq=%21.15g vsq=%21.15g W=%21.15g p_tmp=%21.15g -Qdotnp-Wp=%21.15g\n&quot;</span>,Qdotn,QdotBsq,Qtsq,Bsq,vsq,W,p_tmp,-Qdotnp-Wp);</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;    </div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;t2=%21.15g\nt3=%21.15g\nt4=%21.15g\nt9=%21.15g\nt11=%21.15g\nt16=%21.15g\nt18=%21.15g\nt21=%21.15g\nt23=%21.15g\nt24=%21.15g\nt25=%21.15g\nt35=%21.15g\nt36=%21.15g\ndx[0]=%21.15g\nt40=%21.15g\ndx[1]=%21.15g\ndetJ=%21.15g\njac[0][0]=%21.15g\njac[0][1]=%21.15g\njac[1][0]=%21.15g\njac[1][1]=%21.15g\nresid[0]=%21.15g\nresid[1]=%21.15g\n&quot;</span>,t2,t3,t4,t9,t11,t16,t18,t21,t23,t24,t25,t35,t36,dx[0],t40,dx[1],detJ,jac[0][0],jac[0][1],jac[1][0],jac[1][1],resid[0],resid[1]);</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;    </div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;*df=%21.15g *f=%21.15g Wp=%21.15g W=%21.15g\n&quot;</span>,*df,*f,Wp,W);</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;  }</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;func_vsq2(): x[0] = %21.15g , x[1] = %21.15g , dx[0] = %21.15g , dx[1] = %21.15g , f = %21.15g \n&quot;</span>, </div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;                x[0], x[1],dx[0], dx[1], *f);</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;    </div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;  }</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;}</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;<span class="comment">/*********************************************************</span></div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="comment">**********************************************************/</span></div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_sq_vsq(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;{</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;  </div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  W, Wp, vsq, Wsq, p_tmp, dPdvsq, dPdW, temp, detJ,tmp2,tmp3;</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  resid[2],norm[2];</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;  vsq = x[1];</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;  </div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;  </div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;  p_tmp  = pressure_Wp_vsq(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;  <span class="comment">//  dPdW   = dpdW_calc_vsq(whicheos,EOSextra, Wp, D, vsq );</span></div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;  <span class="comment">//  dPdvsq = dpdvsq_calc_Wp(whicheos,EOSextra, Wp, D, vsq );</span></div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;  <span class="comment">/* These expressions were calculated using Mathematica */</span></div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;  <span class="comment">/* Since we know the analytic form of the equations, we can explicitly</span></div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;<span class="comment">     calculate the Newton-Raphson step:                  */</span></div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;  resid[0]  = Qtsq - vsq*(Bsq + W)*(Bsq + W) + (QdotBsq*(Bsq + 2*W))/Wsq;</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;  resid[1]  = -Qdotnp - (Bsq*(1 + vsq))/2. + QdotBsq/(2.*Wsq) - Wp + p_tmp;</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;  norm[0]  = fabs(Qtsq) + fabs(vsq*(Bsq + W)*(Bsq + W)) + fabs((QdotBsq*(Bsq + 2*W))/Wsq);</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;  norm[1]  = fabs(Qdotnp) + fabs((Bsq*(1 + vsq))/2.) + fabs(QdotBsq/(2.*Wsq)) + fabs(Wp) + fabs(p_tmp);</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;  tmp3 = 0.5 * ( resid[0]*resid[0] + resid[1]*resid[1] ) ;</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;  </div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace  ) {</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;res_sq_vsq(): W,vsq,resid0,resid1,f =   %21.15g  %21.15g  %21.15g  %21.15g  %21.15g  \n&quot;</span>,</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;                W,vsq,resid[0],resid[1],tmp3);</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;res_sq_vsq(): Qtsq, Bsq, QdotBsq, Qdotn =   %21.15g  %21.15g  %21.15g  %21.15g  \n&quot;</span>,</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;                Qtsq, Bsq, QdotBsq, Qdotn);</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;  }</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;<span class="preprocessor"></span>    </div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;  <span class="keywordflow">return</span>( tmp3 );</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;}</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;<span class="comment">/*********************************************************</span></div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;<span class="comment">**********************************************************/</span></div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_sq_vsq2(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;{</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  W, Wp, vsq, Wsq, p_tmp, dPdvsq, dPdW, temp, detJ,tmp2,tmp3;</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>  resid[2],norm[2];</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t3, t4 ;</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t9 ;</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t11;</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t16;</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t18;</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;  Wp = x[0];</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;  W = Wp+D;</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;  vsq = x[1];</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;  </div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;  Wsq = W*W;</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;  </div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;  p_tmp  = pressure_Wp_vsq(whicheos,EOSextra, Wp, D, vsq );</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;  <span class="comment">/* These expressions were calculated using Mathematica and made into efficient code using Maple*/</span></div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;  <span class="comment">/* Since we know the analytic form of the equations, we can explicitly</span></div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;<span class="comment">     calculate the Newton-Raphson step:                  */</span></div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;  t3 = Bsq+W;</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;  t4 = t3*t3;<span class="comment">//</span></div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;  t9 = 1/Wsq;  <span class="comment">//</span></div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;  t11 = Qtsq-vsq*t4+QdotBsq*(Bsq+2.0*W)*t9; <span class="comment">//</span></div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t11norm = fabs(Qtsq)+fabs(vsq*t4)+fabs(QdotBsq*(Bsq+2.0*W)*t9); <span class="comment">//</span></div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;  t16 = QdotBsq*t9;<span class="comment">//</span></div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  t18 = -Qdotnp-0.5*Bsq*(1.0+vsq)+0.5*t16-Wp+p_tmp;<span class="comment">//</span></div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> t18norm = fabs(Qdotnp)+fabs(0.5*Bsq*(1.0+vsq))+fabs(0.5*t16)+fabs(Wp)+fabs(p_tmp);<span class="comment">//</span></div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;  resid[0] = t11;</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;  resid[1] = t18;</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;  norm[0] = t11norm;</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;  norm[1] = t18norm;</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;  tmp3 = 0.5 * ( resid[0]*resid[0] + resid[1]*resid[1] ) ;</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  </div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace  ) {</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;res_sq_vsq(): W,vsq,resid0,resid1,f =   %21.15g  %21.15g  %21.15g  %21.15g  %21.15g  \n&quot;</span>,</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;                W,vsq,resid[0],resid[1],tmp3);</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;res_sq_vsq(): Qtsq, Bsq, QdotBsq, Qdotn =   %21.15g  %21.15g  %21.15g  %21.15g  \n&quot;</span>,</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;                Qtsq, Bsq, QdotBsq, Qdotn);</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;  }</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;res: W=%21.15g Wsq=%21.15g p_tmp=%21.15g t3=%21.15g t4=%21.15g t9=%21.15g t11=%21.15g t16=%21.15g t18=%21.15g resid[0]=%21.15g resid[1]=%21.15g tmp3=%21.15g\n&quot;</span>,W,Wsq,p_tmp,t3,t4,t9,t11,t16,t18,resid[0],resid[1],tmp3);</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;  }</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;    </div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;  <span class="keywordflow">return</span>( tmp3 );</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;}</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;<span class="comment">/**************************************************** </span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;<span class="comment">GENERAL PROCEDURES BELOW (except validate_x() and must choose function and residual)</span></div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;<span class="comment">*****************************************************/</span></div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;</div>
<div class="line"><a name="l03817"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa64047229272de421ebf9e37e9c7baf8"> 3817</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa64047229272de421ebf9e37e9c7baf8" title="Find Root wrappers:">find_root_1D_gen</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;{</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x_1d[1];</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;  x_1d[0] = x0;</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;  <span class="keywordflow">if</span>( (retval=general_newton_raphson(showmessages, lpflag, eomtype, x_1d, 1, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>, func_1d_orig, res_sq_1d_orig, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ) ) {</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( debugfail&gt;=2 ) dualfprintf(fail_file, <span class="stringliteral">&quot;GNR failed, x_1d[0] = %21.15g \n&quot;</span>, x_1d[0] );  </div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;  *xnew = x_1d[0];</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;}</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;</div>
<div class="line"><a name="l03838"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab6e4060e2c11ad1fd390e15607b849ee"> 3838</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab6e4060e2c11ad1fd390e15607b849ee">find_root_1D_gen_scn</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;{</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x_1d[1];</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;  x_1d[0] = x0;</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;  <span class="keywordflow">if</span>( (retval=general_newton_raphson(showmessages, lpflag, eomtype, x_1d, 1, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#af386191840b4ff9a9db36be0eae5b707">func_1d_orig_scn</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#acdb87aa4479559a25be8b8209b2cf64e">res_sq_1d_orig_scn</a>, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ) ) {</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( debugfail&gt;=2 ) dualfprintf(fail_file, <span class="stringliteral">&quot;GNR failed, x_1d[0] = %21.15g \n&quot;</span>, x_1d[0] );  </div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;  *xnew = x_1d[0];</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;}</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;</div>
<div class="line"><a name="l03859"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a2c3695a6bccd8e5de8daa9c35c442b96"> 3859</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a2c3695a6bccd8e5de8daa9c35c442b96">find_root_1D_gen_Eprime</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;{</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x_1d[1];</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;  x_1d[0] = x0;</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;  <span class="comment">// Note u sing func_Eprime_opt() and res_sq_Eprime_opt() : optimized versions.</span></div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;  <span class="keywordflow">if</span>( (retval=general_newton_raphson(showmessages, lpflag, eomtype, x_1d, 1, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8dc5a20ee912aa167614e979cfc4d5b6" title="optimized version of func_Eprime() optimized in sense that minimizes extra kinetic calculations AND E...">func_Eprime_opt</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab641905badd72443028936b1047fcf94" title="res_sq_Eprime() (or any pure residual function) is only called by line searching method">res_sq_Eprime_opt</a>, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ) ) {</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( debugfail&gt;=2 ) dualfprintf(fail_file, <span class="stringliteral">&quot;GNR failed, x_1d[0] = %21.15g \n&quot;</span>, x_1d[0] );  </div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;  *xnew = x_1d[0];</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;}</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;</div>
<div class="line"><a name="l03880"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a996cb5387934511d2ba03bdf04764314"> 3880</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a996cb5387934511d2ba03bdf04764314">find_root_1D_gen_Psq</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;{</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x_1d[1];</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;  x_1d[0] = x0;</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;  <span class="keywordflow">if</span>( (retval=general_newton_raphson(showmessages, lpflag, eomtype, x_1d, 1, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab5dd7587116d2d7073062c2d17f5d17a" title="not that this is well-optimized. Psq_Wp() and dPsqdWp_Wp() don&#39;t use subfunctions like &quot;_unopt&quot; versi...">func_Psq</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a1780c31c73839c379dcd3b6e514ad57b">res_sq_Psq</a>, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ) ) {</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( debugfail&gt;=2 ) dualfprintf(fail_file, <span class="stringliteral">&quot;GNR failed, x_1d[0] = %21.15g \n&quot;</span>, x_1d[0] );  </div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;  *xnew = x_1d[0];</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;}</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;</div>
<div class="line"><a name="l03903"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8b05eb520a657db3ad5f03f48a7bbed5"> 3903</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8b05eb520a657db3ad5f03f48a7bbed5" title="below not done yet!">find_root_3D_gen_Palpha</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;{</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x_3d[3];</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;  x_3d[0] = x0;</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;  x_3d[1] = x0;</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;  x_3d[2] = x0;</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;  <span class="keywordflow">if</span>( (retval=general_newton_raphson(showmessages, lpflag, eomtype, x_3d, 3, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ab5dd7587116d2d7073062c2d17f5d17a" title="not that this is well-optimized. Psq_Wp() and dPsqdWp_Wp() don&#39;t use subfunctions like &quot;_unopt&quot; versi...">func_Psq</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a1780c31c73839c379dcd3b6e514ad57b">res_sq_Psq</a>, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ) ) {</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( debugfail&gt;=2 ) dualfprintf(fail_file, <span class="stringliteral">&quot;GNR failed, x_3d[0] = %21.15g x_3d[1] = %21.15g x_3d[2] = %21.15g \n&quot;</span>, x_3d[0], x_3d[1], x_3d[2] );  </div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;  *xnew = x_3d[0];</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;  *xnew = x_3d[1];</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;  *xnew = x_3d[2];</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;}</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;</div>
<div class="line"><a name="l03926"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8fb6d0d8cc633b31a9b2e2e7746df656"> 3926</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a8fb6d0d8cc633b31a9b2e2e7746df656">find_root_1D_gen_Sc</a>(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;{</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x_1d[1];</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;  <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;  x_1d[0] = x0;</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;  <span class="comment">// Note, using optimized versions of func_Sc() and res_sq_Sc()</span></div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;  <span class="keywordflow">if</span>( (retval=general_newton_raphson(showmessages, lpflag, eomtype, x_1d, 1, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad797f172e3b3b7f0fb03c7076cd404eb" title="optimized version of func_Sc() very similar to optimized version of func_Eprime() but different &quot;geta...">func_Sc_opt</a>, <a class="code" href="../../d1/dde/utoprim__jon_8c.html#acba495fe9b21b19b393a2e532c4880dc" title="optimized version of res_sq_Sc() just calls func_Sc_opt() for now since more optimized than original ...">res_sq_Sc_opt</a>, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ) ) {</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( debugfail&gt;=2 ) dualfprintf(fail_file, <span class="stringliteral">&quot;GNR failed, x_1d[0] = %21.15g \n&quot;</span>, x_1d[0] );  </div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;  *xnew = x_1d[0];</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;}</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;<span class="comment">/********************************************************************</span></div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;<span class="comment">   find_root_2D_gen(): </span></div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;<span class="comment">         -- performs a 2D Newton-Raphson method for solving the \tilde{Q}^2</span></div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;<span class="comment">             and Q.n equations for two variables in general;</span></div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;<span class="comment">              (usually W and something else like utsq, vsq, or gamma)</span></div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;<span class="comment">         residual vector       = { Qtsq eq. , Q.n eq. }</span></div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;<span class="comment">         indep. var. vector, x = { W, vsq/utsq/gamma/? }</span></div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;<span class="comment">       vartype = 2 : W, gamma</span></div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;<span class="comment">       vartype = 3 : W, vsq</span></div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;<span class="comment">       vartype = 4 : W, utsq</span></div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;<span class="comment">     -- Uses  general_newton_raphson();</span></div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;<span class="comment">*********************************************************************/</span></div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> find_root_2D_gen(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *xnew, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;{</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;  </div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[2], x_orig[2];</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;  <span class="keywordtype">int</span> ntries = 0;</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;  <span class="keywordtype">int</span> retval, n = 2;</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;  <span class="keywordtype">int</span> it;</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;  <span class="comment">/* Set presets: */</span></div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;  x_orig[0] = x[0] = fabs(x0) ;</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;  x1_of_x0( x0, &amp;x[1], wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;  x_orig[1] = x[1];</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;x[0]=%21.15g W=%21.15g x[1]=%21.15g\n&quot;</span>,x[0],x[0]+D,x[1]);</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;  }</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    dualfprintf(fail_file, <span class="stringliteral">&quot;find_root_2D_gen():  x[0] = %21.15g , x[1] = %21.15g \n&quot;</span>, x[0], x[1]);</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;    </div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;  }</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span>(it=0;it&lt;n;it++) dualfprintf(fail_file,<span class="stringliteral">&quot;x[%d]=%21.15g xnew[%d]=%21.15g\n&quot;</span>,it,x[it],it,xnew[it]);</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;  retval = general_newton_raphson(showmessages, lpflag, eomtype, x, n, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>,  func_vsq2, res_sq_vsq2, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ;</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;  ntries++;</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;  <span class="keywordflow">while</span>( (retval==1) &amp;&amp; (ntries &lt;= <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a3e282d07542aa7872417e0ed73c083f6">MAX_NEWT_RETRIES</a> ) ) {</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;    <span class="comment">//       x[0] = x_orig[0] * (1. + ( (1.*rand())/(1.*RAND_MAX) - 0.5 ) );  </span></div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    x[0] = x_orig[0];</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="keywordflow">for</span>( it=0; it&lt;ntries; it++)  x[0] *= 10.0;</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;    x1_of_x0( x[0],&amp;x[1], wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;    <span class="comment">//       retval = general_newton_raphson(showmessages, lpflag, eomtype, x, n, USE_LINE_SEARCH,  func_vsq, res_sq_vsq, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ;</span></div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;    retval = general_newton_raphson(showmessages, lpflag, eomtype, x, n, <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>,  func_vsq2, res_sq_vsq2, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats) ;</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;find_root_2D_gen():  ntries, x[0,1] = %4i  %21.15g   %21.15g  \n&quot;</span>, ntries, x[0], x[1]);</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;      </div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    }</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="preprocessor"></span>    ntries++;</div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;  }</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;<span class="preprocessor">#if( MAX_NEWT_RETRIES &gt; 0 )</span></div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( (ntries &gt; <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a3e282d07542aa7872417e0ed73c083f6">MAX_NEWT_RETRIES</a>) &amp;&amp;  (retval==1)  ) {</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;    <span class="keywordflow">if</span>( debugfail &gt;= 2 ) { </div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;find_root_2D_gen():  Bad exit value from general_newton_raphson() !! \n&quot;</span>);</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;      dualfprintf(fail_file, <span class="stringliteral">&quot;find_root_2D_gen():  ntries = %d , x[0] = %21.15g , x[1] = %21.15g  \n&quot;</span>, ntries, x[0], x[1]); </div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;    }</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;  }</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;  *xnew = x[0];</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;  <span class="keywordflow">return</span>(retval);</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;}</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;<span class="comment">/************************************************************</span></div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;<span class="comment">  general_newton_raphson(): </span></div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;<span class="comment">    -- performs Newton-Rapshon method on an arbitrary system.</span></div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;<span class="comment">    -- inspired in part by Num. Rec.&#39;s routine newt();</span></div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="comment">*****************************************************************/</span></div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> general_newton_raphson(<span class="keywordtype">int</span> showmessages, <a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9377001671b5ece8bb2a2cf636de4b8a">PFTYPE</a> *lpflag, <span class="keywordtype">int</span> eomtype, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> do_line_search,</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;                                  <span class="keywordtype">void</span> (*funcd) (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [][NEWT_DIM], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *, <span class="keywordtype">int</span>, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra), </div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;                                  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*res_func) (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra), <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra, <span class="keyword">struct</span> <a class="code" href="../../db/d3a/structof__newtonstats.html">of_newtonstats</a> *newtonstats)</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;{</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> f, f_old, df, df_old, dx[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], dx_old[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], x_old[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], x_older[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], x_olderer[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], resid[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], norm[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], jac[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>][<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, errx_old, errx_oldest, x_orig[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;  <span class="keywordtype">int</span>    n_iter, id, jd, i_extra, doing_extra;</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> randtmp, tmp;</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dW,dvsq,vsq_old,vsq,W,W_old;</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> resid_norm, resid_check, grad_check;</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> res_func_val, res_func_old, res_func_new;</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dn[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], del_f[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;  </div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> trueerror[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>],trueerrortotal;</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;  <span class="comment">// Jon&#39;s modification</span></div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> DAMPFACTOR[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>];</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;  <span class="keywordtype">int</span>   keep_iterating, i_increase, retval2,retval = 0;</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace  = 0;</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace2 = 1;</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;  <span class="keywordtype">int</span> it;</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;  <span class="keywordtype">int</span> foundnan;</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;  <span class="keywordtype">int</span> diddamp=0;</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;  <span class="keywordtype">int</span> didcycle=0;</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;  void (*ptr_validate_x)(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;  <span class="keywordtype">int</span> newtoniter;</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;</div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;  <span class="comment">// use inputs from newtonstats that sets up iterations</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;  <span class="comment">// see global.structs.h: of_newtonstats{}</span></div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;<span class="comment"></span>  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> NEWT_TOL_VAR;</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;  <span class="keywordflow">if</span>(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#abaf99ec9e8c395755285cd9a44858314">tryconv</a>&gt;0.0 &amp;&amp; newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#abaf99ec9e8c395755285cd9a44858314">tryconv</a>&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#abf6ee8463e89259d039a8db9f83596c9">NEWT_TOL</a>) NEWT_TOL_VAR=newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#abaf99ec9e8c395755285cd9a44858314">tryconv</a>;</div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;  <span class="keywordflow">else</span> NEWT_TOL_VAR=<a class="code" href="../../d4/da4/u2p__defs_8h.html#abf6ee8463e89259d039a8db9f83596c9">NEWT_TOL</a>;</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;</div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> NEWT_TOL_ULTRAREL_VAR;</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;  <span class="keywordflow">if</span>(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a00940ef45bf3eb6e72c49ea66dd7c8b2">tryconvultrarel</a>&gt;0.0 &amp;&amp; newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a00940ef45bf3eb6e72c49ea66dd7c8b2">tryconvultrarel</a>&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a01074576f46333f9f26da340f374babd">NEWT_TOL_ULTRAREL</a>) NEWT_TOL_ULTRAREL_VAR=newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a00940ef45bf3eb6e72c49ea66dd7c8b2">tryconvultrarel</a>;</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;  <span class="keywordflow">else</span> NEWT_TOL_ULTRAREL_VAR=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a01074576f46333f9f26da340f374babd">NEWT_TOL_ULTRAREL</a>;</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> MIN_NEWT_TOL_VAR;</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;  <span class="keywordflow">if</span>(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a98ac5de850a4bd5b495a8c9e1975499b">mintryconv</a>&gt;0.0 &amp;&amp; newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a98ac5de850a4bd5b495a8c9e1975499b">mintryconv</a>&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a640c2be0ee830329483db0f67613b130">MIN_NEWT_TOL</a>) MIN_NEWT_TOL_VAR=newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a98ac5de850a4bd5b495a8c9e1975499b">mintryconv</a>;</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;  <span class="keywordflow">else</span> MIN_NEWT_TOL_VAR=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a640c2be0ee830329483db0f67613b130">MIN_NEWT_TOL</a>;</div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> MAX_NEWT_ITER_VAR;</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;  <span class="keywordflow">if</span>(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a767c6b7671c51ec6db1a3d7199775588">maxiter</a>&gt;=0 &amp;&amp; newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a767c6b7671c51ec6db1a3d7199775588">maxiter</a>&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>) MAX_NEWT_ITER_VAR=newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a767c6b7671c51ec6db1a3d7199775588">maxiter</a>;</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  <span class="keywordflow">else</span> MAX_NEWT_ITER_VAR=<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>;</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;  <span class="keywordtype">int</span> EXTRA_NEWT_ITER_VAR;</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  <span class="keywordflow">if</span>(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a28c2335afb8757d40128392034402c17">extra_newt_iter</a>&gt;=0 &amp;&amp; newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a28c2335afb8757d40128392034402c17">extra_newt_iter</a>&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>) EXTRA_NEWT_ITER_VAR=newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a28c2335afb8757d40128392034402c17">extra_newt_iter</a>;</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;  <span class="keywordflow">else</span> EXTRA_NEWT_ITER_VAR=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>;</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;  <span class="keywordtype">int</span> EXTRA_NEWT_ITER_ULTRAREL_VAR;</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;  <span class="keywordflow">if</span>(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a08186e529162af19adc29e62eaaf31d9">extra_newt_iter_ultrarel</a>&gt;=0 &amp;&amp; newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a08186e529162af19adc29e62eaaf31d9">extra_newt_iter_ultrarel</a>&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>) EXTRA_NEWT_ITER_ULTRAREL_VAR=newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a08186e529162af19adc29e62eaaf31d9">extra_newt_iter_ultrarel</a>;</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;  <span class="keywordflow">else</span> EXTRA_NEWT_ITER_ULTRAREL_VAR=<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>;</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;  <span class="comment">// setup error list</span></div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> xlist[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>][<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>],errxlist[<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>];</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dxlist[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>][<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>],trueerrorlist[<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>];</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  <span class="keywordtype">int</span> listi;</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;  <span class="keywordflow">for</span>(it=0;it&lt;n;it++){</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;    <span class="keywordflow">for</span>(listi=0;listi&lt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>;listi++){</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;      xlist[it][listi]=errxlist[listi]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a38eb76aa0a9a1bb1dac30c75be4a05b6">BIG</a>;</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;      dxlist[it][listi]=trueerrorlist[listi]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a38eb76aa0a9a1bb1dac30c75be4a05b6">BIG</a>;</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;    }</div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  }</div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;</div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;</div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;  <span class="comment">// pick version of validate_x depending upon scheme</span></div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ac5113207ae627a2049037851190aecfd" title="set pointer to the correct validate_x function">pick_validate_x</a>(eomtype, &amp;ptr_validate_x);</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  retval = 0;</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;  errx = 1. ; </div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;  errx_old = 2.;</div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;  df = df_old = f = f_old = 1.;</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;  i_extra = doing_extra = 0;</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;  <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++)  x_olderer[<span class="keywordtype">id</span>]=x_older[<span class="keywordtype">id</span>]=x_old[<span class="keywordtype">id</span>] = x_orig[<span class="keywordtype">id</span>] = x[<span class="keywordtype">id</span>] ; <span class="comment">// save initial guess as orig and old</span></div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;  vsq_old = vsq = W = W_old = 0.;</div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) DAMPFACTOR[<span class="keywordtype">id</span>]=1.0; <span class="comment">// Jon&#39;s mod: start out fast</span></div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;  <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) dx_old[<span class="keywordtype">id</span>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a>;<span class="comment">// Assume bad error at first (notice not normalized to x[id] since x[id] might be 0</span></div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;  <span class="comment">/* Start the Newton-Raphson iterations : */</span></div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;<span class="comment"></span>  n_iter = 0;</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;  keep_iterating = 1;</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;  newtoniter=0;</div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;  <span class="keywordflow">while</span>( keep_iterating ) { </div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    (newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a073783ba864c07681c8999a67162202b">nstroke</a>)++;</div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;    (newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a83280998e47831044a7e35299495a9bb">lntries</a>)++;</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;    <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a83280998e47831044a7e35299495a9bb">lntries</a>) &gt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#a8cdb30d4a201e1bbad624ec022edf3b8" title="Note that if using -pc64 -mp that error in inversion seems to be limited for doubles to 1E-11 instead...">ITERDAMPSTART</a> &amp;&amp; diddamp==0 &amp;&amp; didcycle==0){</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) DAMPFACTOR[<span class="keywordtype">id</span>]=0.5; <span class="comment">// Jon&#39;s mod: try to catch bad closed loop cycles that can occur, e.g., when cubic type behavior</span></div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;    }</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="preprocessor"></span>    <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;    <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;      <span class="keywordflow">for</span>(it=0;it&lt;n;it++) dualfprintf(fail_file,<span class="stringliteral">&quot;before funcd: x[%d]=%21.15g dx[%d]=%2.15g\n&quot;</span>,it,x[it],it,dx[it]);</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;    }</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;<span class="preprocessor">#endif      </span></div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;    <span class="comment">/* returns with new dx, f, df */</span></div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;    (*funcd) (x, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>, resid, norm, jac, &amp;f, &amp;df, n, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;    <span class="comment">// get true error</span></div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;    <span class="keywordflow">for</span>(it=0;it&lt;n;it++) trueerror[it]=fabs(resid[it]/(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>+fabs(norm[it])));</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;    trueerrortotal=0.0;</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    <span class="keywordflow">for</span>(it=0;it&lt;n;it++) trueerrortotal = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(trueerrortotal,(1.0/(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a>)(n))*(fabs(resid[it])/(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a09c78d2f8feb311dd9fc969a0bf84979">SMALL</a>+fabs(norm[it]))));</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;    <span class="comment">// store in list</span></div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;    errxlist[n_iter] = errx;</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;    trueerrorlist[n_iter] = trueerrortotal;</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;    <span class="keywordflow">for</span>(it=0;it&lt;n;it++){</div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;      dxlist[it][n_iter] = fabs(dx[it]);</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;      xlist[it][n_iter] = x[it];</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;    }</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;    </div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;    <span class="comment">// below now used currently</span></div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;    <span class="keywordtype">id</span>=0; <span class="keywordflow">if</span>(resid[<span class="keywordtype">id</span>] &lt;=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a> || jac[0][<span class="keywordtype">id</span>]==0.0){</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;      <span class="comment">// get error and dx</span></div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;      newtoniter++;</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;    }</div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;<span class="preprocessor"></span>    <span class="comment">//    if(nstep&gt;=26070){</span></div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;    <span class="comment">//      if(1||myid==5 &amp;&amp; nstep==1 &amp;&amp; steppart==0 &amp;&amp; ifileglobal==19 &amp;&amp; jfileglobal==15){</span></div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;    <span class="keywordflow">for</span>(it=0;it&lt;n;it++) dualfprintf(fail_file,<span class="stringliteral">&quot;lntries=%d after funcd: x[%d]=%26.20g dx[%d]=%26.20g f=%26.20g df=%26.20g errx=%26.20g trueerror=%26.20g (%26.20g %26.20g) diddamp=%d dampfactor=%26.20g didcycle=%d : %g %g %g %g %g %g %g %g %g\n&quot;</span>,(<span class="keywordtype">int</span>)(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a83280998e47831044a7e35299495a9bb">lntries</a>),it,x[it],it,dx[it],f,df,errx,resid[it]/norm[it],NEWT_TOL_VAR,NEWT_TOL_ULTRAREL_VAR,diddamp,DAMPFACTOR[it],didcycle,wglobal[2],Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc);</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;    <span class="comment">//      }</span></div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;    <span class="comment">//    }</span></div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;<span class="preprocessor"></span>    <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;    <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;      <span class="keywordflow">for</span>(it=0;it&lt;n;it++) dualfprintf(fail_file,<span class="stringliteral">&quot;after funcd: x[%d]=%21.15g dx[%d]=%2.15g\n&quot;</span>,it,x[it],it,dx[it]);</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;    }</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;<span class="preprocessor">#endif      </span></div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*  Check for bad untrapped divergences : */</span></div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;    <span class="keywordflow">if</span>( (finite(f)==0) ||  (finite(df)==0) ) {</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;      <span class="keywordflow">if</span>( debugfail &gt;= 2 ) { </div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson(): nan encountered in f or df!! \n&quot;</span>);</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;gnr nan(): f, df, x0, dx0 =  %21.15g  %21.15g  %21.15g  %21.15g  \n&quot;</span>, f,df,x[0],dx[0]);</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      }</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;      <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;    }</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;<span class="preprocessor"></span>    <span class="comment">/* Randomly rescale Newton step to break out of iteration cycles: */</span></div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;    <span class="keywordflow">if</span>( ((n_iter+1) % <a class="code" href="../../d4/da4/u2p__defs_8h.html#a59d796d38151a2eb5ef25706123864d4">CYCLE_BREAK_PERIOD</a>) == 0 ) {</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;      randtmp = ( (1.*rand())/(1.*RAND_MAX) );</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) dx[<span class="keywordtype">id</span>] *= randtmp;</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;      <span class="comment">// for( id = 0; id &lt; n ; id++) dx[id] *= ( (1.*rand())/(1.*RAND_MAX) );</span></div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;    }</div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;    <span class="comment">/* Save old values before calculating the new: */</span></div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;    errx_oldest = errx_old;</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;    errx_old = errx;</div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;    errx = 0.;</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    f_old = f;</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      x_olderer[id]=x_older[id];  <span class="comment">//x_olderer contains 2 steps ago</span></div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      x_older[id]=x_old[id];  <span class="comment">//x_older contains last step&#39;s W used by above funcd() to get resid and dx</span></div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;      x_old[id] = x[id] ; <span class="comment">// x_old contains just used W that was used to compute funcd() to get present resid and dx</span></div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;    }</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;</div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;    <span class="comment">/* Make the newton step: */</span></div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;    <span class="keywordflow">if</span>( do_line_search == 1 ) { </div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;</div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;      <span class="comment">/* Compare the residual to its initial value */</span> </div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;      <span class="keywordflow">if</span>( n_iter == 0 ) { </div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;        resid_norm = 0.0e0;</div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;          resid_norm += fabs(resid[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;        }</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;        resid_norm /= 1.0*n ;</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;        <span class="keywordflow">if</span>( resid_norm == 0.0 ) resid_norm = 1.0;</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;      }</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;        tmp = 0.;</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        <span class="keywordflow">for</span>( jd = 0; jd &lt; n ; jd++) {</div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;          tmp += jac[jd][id] * resid[jd];</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;        }</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;        del_f[id] = tmp;</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;      }</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;        dn[id] = dx[id];</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;      }</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      my_lnsrch(eomtype, n, x_old-1, f_old, del_f-1, dn-1, x-1, &amp;f, <a class="code" href="../../d4/da4/u2p__defs_8h.html#aa25dce0846dbd1d8d7d2ebde588c7a50">TOL_LINE_STEP</a>, <a class="code" href="../../d4/da4/u2p__defs_8h.html#abbbf6c394883fa9e5f58e1e773953c6f">SCALEMAX</a>, &amp;retval, res_func, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;      <span class="comment">/* dx is needed for errx calculation below: */</span></div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;        dx[id] = x[id] - x_old[id];</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;      }</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>( ltrace ) { </div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;        res_func_val = res_func(x, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc );</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;        res_func_old = res_func(x_old, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc );</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): f_old, f, res_func_old, res_func_val = %21.15g  %21.15g  %21.15g  %21.15g  \n&quot;</span>,</div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;                    f_old, f, res_func_old, res_func_val );</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): x_old = &quot;</span>);</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g &quot;</span>,x_old[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;        }</div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;\n &quot;</span>);</div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): x     = &quot;</span>);</div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g &quot;</span>,x[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        }</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;\n &quot;</span>);</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): dn    = &quot;</span>);</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g &quot;</span>,dn[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;        }</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;\n &quot;</span>);</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): del_f = &quot;</span>);</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g &quot;</span>,del_f[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;        }</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;\n &quot;</span>);</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;      }</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;      <span class="comment">/* Check to see if line search problem is because the residual vector is already small enough */</span></div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;      <span class="keywordflow">if</span>( retval == 1 ) {</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;        resid_check = 0.0e0;</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;          resid_check += fabs(resid[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;        }</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;        resid_check /= 1.0*n;</div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160; </div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;        <span class="keywordflow">if</span>( resid_check &lt;= resid_norm * <a class="code" href="../../d4/da4/u2p__defs_8h.html#ac319c46c1b4d84c1ec442a17719b93ff">NEWT_FUNC_TOL</a> ) {</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;          retval = 0;</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        }</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;        <span class="keywordflow">if</span>( ltrace &amp;&amp; retval ) { </div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson():  retval, resid_check = %4i  %21.15g \n&quot;</span>,retval, resid_check);</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;        }   </div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;      }</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;      <span class="comment">/* If initial Newton step is bad, then try again without line searching: */</span></div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;      <span class="keywordflow">if</span>( (retval == 2) &amp;&amp; (<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a> == do_line_search) ) { </div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;        <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;bad first step\n&quot;</span>);</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)   </span></div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span>( ltrace ) { </div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): bad first step: retval, f_old, f  = %4i  %21.15g  %21.15g  \n&quot;</span>,retval,f_old,f);</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;gnr: doing recursive call, retval, errx = %4i  %21.15g \n&quot;</span>, retval, errx );</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;        }</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;<span class="preprocessor"></span>        retval = general_newton_raphson(showmessages, lpflag, eomtype, x_orig, n, ((do_line_search+1)%2), funcd, res_func, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++)  x[<span class="keywordtype">id</span>] = x_orig[<span class="keywordtype">id</span>] ;</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        <span class="keywordflow">return</span>( retval );</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;      }</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;      <span class="comment">/* Check to see if it is trapped in a local minimum, i.e. gradient is too small */</span> </div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;      <span class="keywordflow">if</span>( retval == 1 ) { </div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;        grad_check = 0.0e0;</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;          resid_check = (x[id] == 0.) ? 1.0 : fabs(x[<span class="keywordtype">id</span>]) ;</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;          grad_check  +=  del_f[id] * resid_check ;</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;        }</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;        resid_check = (f == 0.) ? 1.0 : fabs(f) ;</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        grad_check /= resid_check;</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160; </div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;        <span class="comment">/* Then we&#39;ve most likely found a solution: */</span></div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;        <span class="keywordflow">if</span>( grad_check &gt; <a class="code" href="../../d4/da4/u2p__defs_8h.html#a478253a2e0de1871154c8025fce81020">GRADMIN</a> ) { </div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;          retval = -1;</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;        }</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ltrace ) { </div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson():  retval, grad_check = %4i  %21.15g \n&quot;</span>,retval, grad_check);</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        }</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;      }</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;    }</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;      <span class="comment">/* don&#39;t use line search : */</span></div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;      diddamp=0;</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;<span class="preprocessor">#if(JONGENNEWTSTUFF)</span></div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>(n_iter==0){</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;          <span class="comment">// start history</span></div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;          x_olderer[id]=x[id];</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;          x_older[id]=x[id];</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;          x_old[id]=x[id];</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;          dx_old[id]=dx[id];</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;          <span class="comment">//   xold[id]=x[id]; // original W</span></div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;          <span class="comment">//   dxold[id]=dx[id]; // original dW</span></div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;          <span class="comment">//   residold[id]=resid[id]; // original residual</span></div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;        }</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;      }</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;      <span class="keywordflow">else</span>{ <span class="comment">// only meaningful to consider goodness of W if compute residual from present W, not previous W.</span></div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++){</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;          <span class="comment">//  if(sign(residold[id])!=sign(resid[id])){ //  then passed over root -- bad in very relativistic case</span></div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;          <span class="keywordflow">if</span>(resid[<span class="keywordtype">id</span>] &lt;=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a> || jac[0][<span class="keywordtype">id</span>]==0.0 ){ <span class="comment">// then went too far such that v^2&lt;0 or \tilde{u}^2&lt;0 or Ss=NaN</span></div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;            <span class="comment">//   if(1 || fabs(xold[0])&gt;wglobal[2] || fabs(x_old[0])&gt;wglobal[2]){ // always do now under more careful choice of when returns bad residual indicating problem</span></div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;            <span class="keywordflow">if</span>(1 || fabs(x_old[0])&gt;wglobal[2]){ <span class="comment">// always do now under more careful choice of when returns bad residual indicating problem</span></div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;              <span class="comment">// then ultrarelativistic and need to be more careful</span></div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;              DAMPFACTOR[id]=0.5*DAMPFACTOR[id];</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;              x[id]=x_older[id]; <span class="comment">// since current W is what gave bad residual and already saved it into x_old[0]</span></div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;              dx[id]=dx_old[id]; <span class="comment">// new dx is probably messed up (didn&#39;t yet save dx[0], so use dx_old[0]</span></div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;<span class="preprocessor">#if(PRODUCTION==0)</span></div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;<span class="preprocessor"></span>              <span class="keywordflow">if</span>(showmessages&amp;&amp;debugfail&gt;=3) dualfprintf(fail_file,<span class="stringliteral">&quot;resetW: nstep=%ld steppart=%d :: lntries=%d :: id=%d :: x=%21.15g dx=%21.15g : x/D=%21.15g DAMPFACTOR=%21.15g errx=%21.15g eomtype=%d\n&quot;</span>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>,(<span class="keywordtype">int</span>)(newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a83280998e47831044a7e35299495a9bb">lntries</a>),<span class="keywordtype">id</span>,x[<span class="keywordtype">id</span>],dx[<span class="keywordtype">id</span>],x[<span class="keywordtype">id</span>]/D,DAMPFACTOR[<span class="keywordtype">id</span>],newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a02529bef0a69373dc4e7e9e7a672d1db">lerrx</a>,eomtype);</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;<span class="preprocessor"></span>              <span class="comment">// SUPERGODMARK: Noticed that if Mathematica solution can be found but gives utsq&lt;0 then this damping leads to nearly circular loop till max iterations.</span></div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;              diddamp=1;</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;            }</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;          }</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;        } <span class="comment">// end loop over id&#39;s</span></div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;        <span class="keywordflow">if</span>(diddamp){</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;          <span class="comment">// Ensure this newly chosen &quot;old&quot; value gives reasonable result</span></div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;          (*funcd) (x, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a99b91d8e229e5df70958f2aed7fd15bf">dx</a>, resid, norm, jac, &amp;f, &amp;df, n, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);  <span class="comment">/* returns with new dx, f, df */</span></div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++){</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;            <span class="keywordflow">if</span>(resid[<span class="keywordtype">id</span>] &lt;=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a492fbe489a78316b029c696db35a5ec5">VERYBIG</a> || jac[0][<span class="keywordtype">id</span>]==0.0 ){ <span class="comment">// then went too far such that v^2&lt;0 or \tilde{u}^2&lt;0 or Ss=nan or inf</span></div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;<span class="preprocessor">#if(PRODUCTION==0)</span></div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;<span class="preprocessor"></span>              <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Old value failed too: resid[%d]=%26.20g jac[0][%d]=%26.20g\n&quot;</span>,<span class="keywordtype">id</span>,resid[<span class="keywordtype">id</span>],<span class="keywordtype">id</span>,jac[0][<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;<span class="preprocessor"></span>              <span class="keywordflow">return</span>(1); <span class="comment">// then old fails to work too</span></div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;            }</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;            <span class="comment">// reset old values so will use this good value if immediately hit bad solution</span></div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;            <span class="comment">// This restarts history</span></div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;            x_olderer[id]=x[id];</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;            x_older[id]=x[id];</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;            x_old[id]=x[id];</div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;            dx_old[id]=dx[id];</div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;          }</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;        }</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;<span class="preprocessor">#if(1)</span></div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;          <span class="comment">// can only use x_olderer if 3 steps, but add 1 extra.</span></div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;          <span class="comment">// Only do if not just doing extra steps after already error is low (so avoid errx=0 case where will cycle).</span></div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;          <span class="keywordflow">if</span>(n_iter&gt;4 &amp;&amp; doing_extra==0){</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;            <span class="comment">// see if cycling Newton steps with no change in errx</span></div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;<span class="preprocessor"></span>            <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==19 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==1){<span class="comment">// &amp;&amp; i==0 &amp;&amp; j==0 &amp;&amp; k==26){</span></div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;              dualfprintf(fail_file,<span class="stringliteral">&quot;errx=%26.20g errx_old=%26.20g errx_oldest=%26.20g dx=%26.20g dx_old=%26.20g x=%26.20g x_old=%26.20g x_older=%26.20g  x_olderer=%26.20g\n&quot;</span>,errx,errx_old,errx_oldest,dx[0],dx_old[0],x[0],x_old[0],x_older[0],x_olderer[0]);</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;              dualfprintf(fail_file,<span class="stringliteral">&quot;differrx=%26.20g is=%d diffx=%26.20g is=%d\n&quot;</span>,errx_old-errx_oldest,errx_old==errx_oldest,x[0]-x_olderer[0],x[0]==x_olderer[0]);</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;            }</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad576bc07725345ce8ec5882e826d76a0" title="see if repeating Newton cycle with no change in errx, so indicates can&#39;t do anything (even damping) t...">newt_cyclecheck</a>(n, trueerrortotal, errx, errx_old, errx_oldest, dx, dx_old, x, x_old, x_older, x_olderer, n_iter, xlist,dxlist, errxlist, trueerrorlist)){</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;              <span class="comment">//            if( newt_cyclecheck(n,errx,errx_old,errx_oldest,dx,dx_old,x,x_old,x_older,x_olderer) ){</span></div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;              <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Caught in cycle, trying to damp: n_iter=%d.\n&quot;</span>,n_iter);</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;              <span class="comment">// if hits another cycle, damp more</span></div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++) DAMPFACTOR[<span class="keywordtype">id</span>]=0.1*DAMPFACTOR[<span class="keywordtype">id</span>]; <span class="comment">// severe damp to try to get good step.</span></div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;              diddamp=1; <span class="comment">// tells start of loop to not reset DAMPFACTOR</span></div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;              didcycle++; <span class="comment">// tells not to reset damp because having trouble and should stay damped</span></div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;            }</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;          }<span class="comment">// end if avoiding cycle</span></div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;        }</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;<span class="preprocessor"></span>      }<span class="comment">// end else if not first step</span></div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;<span class="preprocessor"></span>      </div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;      <span class="comment">// Step forward with x+dx</span></div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;<span class="comment"></span>      <span class="keywordflow">if</span>(eomtype==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a40b55e98bfcccde1a3f19d983ca7488c">EOMENTROPYGRMHD</a>){</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;        <span class="comment">// Function to find root of is like log(Wp) , so near root, Newton can jump to negative Wp.  But for entropy method, this cannot be allowed without using very small DAMPFACTOR.  So instead, somewhat bracket the root between original Wp and 0.0</span></div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;          x[id] = <a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>((x[<span class="keywordtype">id</span>]+DAMPFACTOR[<span class="keywordtype">id</span>]*dx[<span class="keywordtype">id</span>]),(x[<span class="keywordtype">id</span>]-0.0)/100.0);</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;          <span class="comment">// DEBUG:</span></div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;          <span class="comment">//   dualfprintf(fail_file,&quot;id=%d newx=%21.15g using dx=%21.15g\n&quot;,id,x[id],dx[id]);</span></div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;        }</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;      }</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;          x[id] +=DAMPFACTOR[id]*dx[id]  ;</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        }</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      }</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;      <span class="comment">// undo damping if no longer damping</span></div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;      <span class="comment">// Otherwise too slow eventually, and otherwise error based upon dx thinks error is much smaller than really is.</span></div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;<span class="comment"></span>      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;        <span class="keywordflow">if</span>(diddamp==0) DAMPFACTOR[id]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(1.0,2.0*DAMPFACTOR[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;      }</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;no line search: x[0]=%21.15g dx[0]=%21.15g\n&quot;</span>,x[0],dx[0]);</div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;      }</div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;    } <span class="comment">/* End of &quot;to do line search or not to do line search...&quot; */</span></div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;</div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;      <span class="comment">//  Calculate the convergence criterion */</span></div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;      <span class="comment">/* For the new criterion, always look at error in &quot;W&quot; : */</span></div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;      <span class="comment">// METHOD specific: </span></div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;<span class="preprocessor">#if( NEWCONVERGE == 1 )</span></div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;<span class="preprocessor">#if(JONGENNEWTSTUFF==0)</span></div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;<span class="preprocessor"></span>    <span class="comment">// SUPERGODMARK: is wglobal always the right normalization for the error?</span></div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;    <span class="comment">//    errx  = (x[0]==0.) ?  fabs(dx[0]) : fabs(dx[0]/x[0]);</span></div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;    <span class="comment">//    errx  = (x[0]==0.) ?  fabs(dx[0]) : fabs(dx[0]/wglobal[0]);</span></div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;    </div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;    errx  = (wglobal[0]==0.) ?  fabs(dx[0]) : fabs(dx[0]/<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(wglobal[0]),fabs(x[0])));</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;<span class="preprocessor">#elif(JONGENNEWTSTUFF==1)</span></div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;<span class="preprocessor"></span>    <span class="comment">// makes no sense to compute error from present dx for present x.  The error in x[0] is unknown.  errx here will be error in xold</span></div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;    <span class="comment">// actually error of previous x[0]</span></div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;    <span class="comment">// in this way, final funcd() call is actually an error check only, not an update to x[0]!  So final solution returned should be x_old</span></div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;    errx  = (wglobal[0]==0.) ?  fabs(dx_old[0]) : fabs(dx_old[0]/<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(fabs(wglobal[0]),fabs(x[0])));</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;    <span class="comment">//    errx  = (wglobal[0]==0.) ?  fabs(dx_old[0]) : fabs(dx_old[0]/fabs(wglobal[0]));</span></div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(ifileglobal==0 &amp;&amp; jfileglobal==31 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>==9 &amp;&amp; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>==2){</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;x[0]=%21.15g dx[0]=%21.15g\n&quot;</span>,x[0],dx[0]);</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;    }</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;    <span class="comment">/* For the old criterion, look at errors in each indep. variable(s) (except for 5D) : */</span></div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;      errx  += (x[id]==0.) ?  fabs(dx[<span class="keywordtype">id</span>]) : fabs(dx[id]/x[id]);</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;    }</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;    errx /= 1.*n;</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;    <span class="comment">//dualfprintf(fail_file,&quot;x[0]=%21.15g dx[0]=%21.15g df/f=%21.15g errx=%21.15g out of %21.15g or %21.15g\n&quot;,x[0],dx[0],df/f,errx,NEWT_TOL_VAR,newtonstats-&gt;tryconv);</span></div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;    <span class="comment">// save errx for information/debug purposes</span></div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;    newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a02529bef0a69373dc4e7e9e7a672d1db">lerrx</a>=errx;</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;    <span class="comment">/* Make sure that the new x[] is physical : */</span></div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;    <span class="comment">// METHOD specific:</span></div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;    </div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;    validate_x(ptr_validate_x, x, x_old, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra) ;</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;    <span class="comment">/* Check to see if we&#39;re in a infinite loop with error function: */</span></div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;<span class="preprocessor">#if( CHECK_FOR_STALL )</span></div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( ( (errx_old == errx) || (errx_oldest == errx) ) &amp;&amp; (errx &lt;= MIN_NEWT_TOL_VAR) )  errx = -errx;</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;<span class="preprocessor">#endif </span></div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;    <span class="comment">/* If there&#39;s a problem with line search, then stop iterating: */</span></div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    <span class="keywordflow">if</span>( (retval == 1) || (retval == -1) ) errx = -errx;</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot; general_newton_raphson(): niter,f_old,f,errx_old,errx = %4i  %21.15g  %21.15g  %21.15g  %21.15g\n&quot;</span>,  </div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;                  n_iter,f_old,f,errx_old,errx );</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): x_old = &quot;</span>);</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g &quot;</span>,x_old[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;      }</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;\n &quot;</span>);</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): x     = &quot;</span>);</div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g &quot;</span>,x[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;      }</div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;\n &quot;</span>);</div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;gnr(): dx     = &quot;</span>);</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g &quot;</span>,dx[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;      }</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;\n &quot;</span>);</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;      </div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;    }</div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;    <span class="comment">/* Prepare for the next iteration, set the &quot;old&quot; variables: */</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++)  dx_old[<span class="keywordtype">id</span>] = dx[<span class="keywordtype">id</span>] ;</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;    f_old  = f;</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;    df_old = df;</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;    <span class="comment">/* If we&#39;ve reached the tolerance level, then just do a few extra iterations before stopping */</span></div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;    <span class="comment">/****************************************/</span></div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;   </div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;    </div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;    <span class="comment">// see if reached tolerance</span></div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa72eb753868a7845a97e8659d8be76d3" title="see if meet tolerance">newt_errorcheck</a>(n, NEWT_TOL_VAR, NEWT_TOL_ULTRAREL_VAR, errx, trueerrortotal, x[0],  dx[0], x, dx, wglobal) &amp;&amp; (doing_extra == 0) &amp;&amp; (<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ccbeaf1c72b5fbf65661284edfcb6ca">newt_extracheck</a>(n, EXTRA_NEWT_ITER_VAR, EXTRA_NEWT_ITER_ULTRAREL_VAR, errx,x[0],dx[0],x, dx, wglobal) &gt; 0) ) {</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;      doing_extra = 1;</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;    }</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    <span class="comment">// see if repeating Newton steps with no change in errx</span></div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;    <span class="keywordflow">if</span>(doing_extra==0 &amp;&amp; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a21cdce7292266aa5e19d5d07ef0630f4" title="Newton checks:">newt_repeatcheck</a>(n,errx,errx_old,errx_oldest,dx,dx_old,x,x_old,x_older,x_olderer) ){</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;      <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Repeat found\n&quot;</span>);</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;      doing_extra = 1;</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;    }</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    <span class="keywordflow">if</span>( doing_extra == 1 ) i_extra++ ;</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <span class="keywordflow">if</span>( (<a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa72eb753868a7845a97e8659d8be76d3" title="see if meet tolerance">newt_errorcheck</a>(n, NEWT_TOL_VAR, NEWT_TOL_ULTRAREL_VAR, errx, trueerrortotal, x[0],  dx[0],x,dx, wglobal)&amp;&amp;(doing_extra == 0)) || (i_extra &gt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ccbeaf1c72b5fbf65661284edfcb6ca">newt_extracheck</a>(n, EXTRA_NEWT_ITER_VAR, EXTRA_NEWT_ITER_ULTRAREL_VAR, errx,x[0],dx[0],x,dx,wglobal)) || (n_iter &gt;= (MAX_NEWT_ITER_VAR-1)) ) {</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;      keep_iterating = 0;</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    }</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    <span class="comment">// if cycling twice, then jump out and assume repeating cycle with no hope of improvement.  Do so after CYCLESTOP steps</span></div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="keywordflow">if</span>(n_iter&gt;<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2c235567d455c15a7ef6e325c62fd3e4">CYCLESTOP</a> &amp;&amp; didcycle&gt;1){</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;      keep_iterating = 0;</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    }</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;<span class="preprocessor"></span>    <span class="comment">// check if error is not dropping sufficiently</span></div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;<span class="preprocessor">#define CHECKDECREASE0 5</span></div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CHECKDECREASEAVGNUM 3 // should be less than CHECKDECREASE0</span></div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CHECKDECFACTOR (0.5) // i.e. should drop by this factor compared to older average</span></div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(0&amp;&amp;newtoniter&gt;CHECKDECREASE0){ <span class="comment">// too aggressive, causes no solutions more often when could have gotten solution</span></div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;      <span class="keywordtype">int</span> ci;</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> avgerror;</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;      avgerror=0.0;</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;      <span class="keywordflow">for</span>(ci=0;ci&lt;<a class="code" href="../../d2/d72/phys_8tools_8rad_8c.html#a44c64c3ad77999ceaaf6c1156fb2c1bd">CHECKDECREASEAVGNUM</a>;ci++) <span class="keywordflow">if</span>(errorlist[newtoniter-CHECKDECREASE0+ci]!=1.0) avgerror += errorlist[newtoniter-<a class="code" href="../../d2/d72/phys_8tools_8rad_8c.html#ab875a9257a90523e50d86f22faf1173d">CHECKDECREASE0</a>+ci]; <span class="comment">// GODMARK: uses debug info</span></div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;      avgerror/=(CHECKDECREASEAVGNUM);</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> currenterror;</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;      currenterror=errorlist[newtoniter];</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;      <span class="comment">// check both errors to ensure they are decreasing</span></div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;      <span class="keywordtype">int</span> cond=(currenterror&gt;<a class="code" href="../../d2/d72/phys_8tools_8rad_8c.html#abee5b17ad07d8944ce6f8d94a74e8716">CHECKDECFACTOR</a>*avgerror);</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;      <span class="keywordflow">if</span>(cond){</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;        keep_iterating=0;</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;        <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;Error not decreasing properly: currenterror=%g avgerror=%g\n&quot;</span>,currenterror,avgerror);</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;      }<span class="comment">// end if current error too large compared to older average error</span></div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    }<span class="comment">// end if large enough iterations so can check how error is trending, to avoid many iterations when error is not dropping enough to matter.</span></div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;    n_iter++;</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;<span class="preprocessor">#if(CRAZYDEBUG&amp;&amp;DEBUGINDEX)</span></div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;<span class="preprocessor"></span>    <span class="comment">//i=0 j=63 part=2 step=9 :: n_iter=6</span></div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;    <span class="comment">//  if(ifileglobal==0 &amp;&amp; jfileglobal==31 &amp;&amp; nstep==9 &amp;&amp; steppart==2){</span></div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;    <span class="comment">//    if(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; nstep==9 &amp;&amp; steppart==2){</span></div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    <span class="comment">//    if(n_iter&gt;20){</span></div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;    <span class="comment">//if(ifileglobal&gt;90 &amp;&amp; CRAZYNEWCHECK){</span></div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a62a06e4649959d888f5e20cbd216472d">CRAZYNEWCHECK</a>){</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;      <span class="comment">//    if(ifileglobal==0 &amp;&amp; jfileglobal==63 &amp;&amp; nstep==12 &amp;&amp; steppart==0){</span></div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;      <span class="comment">//    if(ifileglobal==0 &amp;&amp; jfileglobal==0 &amp;&amp; nstep==0 &amp;&amp; steppart==0){</span></div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;i=%d j=%d part=%d step=%ld :: n_iter=%d :: errx=%21.15g minerr=%21.15g :: x[0]=%21.15g dx[0]=%21.15g wglobal0=%21.15g\n&quot;</span>,ifileglobal,jfileglobal,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>,n_iter,errx,MIN_NEWT_TOL_VAR,x[0],dx[0],wglobal[0]);</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;    }</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;    <span class="comment">//  }</span></div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;  }   <span class="comment">// END of while(keep_iterating)</span></div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;  <span class="comment">//  dualfprintf(fail_file,&quot;n_iter=%d\n&quot;,n_iter);</span></div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;  <span class="comment">//  Check for bad untrapped divergences</span></div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;  foundnan=0; <span class="comment">// assume no nan&#39;s</span></div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++){</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;    <span class="keywordflow">if</span>(finite(x[<span class="keywordtype">id</span>])==0)      foundnan=1;</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;  }</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;  <span class="keywordflow">if</span>( (finite(f)==0) ||  (finite(df)==0) ){  <span class="comment">// deprecated: || (real_dimen_newton&gt;=1)&amp;&amp;(finite(x[0])==0) || (real_dimen_newton&gt;=2)&amp;&amp;(finite(x[1])==0)) {</span></div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;    foundnan=1;</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;  }</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;  <span class="keywordflow">if</span>(foundnan){</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;<span class="preprocessor">#if(!OPTIMIZED || PRODUCTION==0)</span></div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(debugfail&gt;=1){</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;naninf: f=%21.15g df=%21.15g\n&quot;</span>,f,df);</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++){</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;naninf: x[%d]=%21.15g\n&quot;</span>,<span class="keywordtype">id</span>,x[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;      }</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;    }</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;    <span class="keywordflow">if</span>( debugfail &gt;= 2 ) { </div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson(): nan encountered in f or df!! \n&quot;</span>);</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;gnr nan(): f, df, x0, dx0 =  %21.15g  %21.15g  %21.15g  %21.15g  \n&quot;</span>, f,df,x[0],dx[0]);</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;    }</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;<span class="preprocessor"></span>    *lpflag=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a60b4996e25f5f432174dfaaf02872642">UTOPRIMFAILNANRESULT</a>;</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;  }</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;</div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;  <span class="comment">//  Check error</span></div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;  <span class="comment">// assign final result</span></div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;<span class="preprocessor">#if(JONGENNEWTSTUFF==1)</span></div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;    x[id]=x_old[id]; <span class="comment">// actually evaluated x</span></div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;  }</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa72eb753868a7845a97e8659d8be76d3" title="see if meet tolerance">newt_errorcheck</a>(n, NEWT_TOL_VAR, NEWT_TOL_ULTRAREL_VAR, errx, trueerrortotal, x[0],  dx[0], x,dx,wglobal) ){</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;<span class="preprocessor">#if(DOHISTOGRAM)</span></div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;<span class="preprocessor"></span>    bin_newt_data(MAX_NEWT_ITER_VAR, errx, n_iter, 2, 0 );</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(ltrace2) {</div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot; totalcount = %d   2   %d  %d  %d  %21.15g \n&quot;</span>,n_iter,retval,do_line_search,i_extra, errx); </div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;      </div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;    }</div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;gnr retval5 = %4i \n&quot;, 0); </span></div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;</div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;    <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;  }</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;  <span class="keywordflow">if</span>( (fabs(errx) &lt;= MIN_NEWT_TOL_VAR) &amp;&amp; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa72eb753868a7845a97e8659d8be76d3" title="see if meet tolerance">newt_errorcheck</a>(n, NEWT_TOL_VAR, NEWT_TOL_ULTRAREL_VAR, errx, trueerrortotal, x[0],  dx[0], x,dx,wglobal) ){</div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;<span class="preprocessor">#if(DOHISTOGRAM)</span></div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;<span class="preprocessor"></span>    bin_newt_data(MAX_NEWT_ITER_VAR, errx, n_iter, 1, 0 );</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(ltrace2) {</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot; totalcount = %d   1   %d  %d  %d  %21.15g \n&quot;</span>,n_iter,retval,do_line_search,i_extra,errx); </div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;      </div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;    }</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;    <span class="keywordflow">if</span>(ltrace) {</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson(): found minimal solution \n&quot;</span>);</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;      </div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;    }</div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;gnr retval4 = %4i \n&quot;, 0); </span></div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;</div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;<span class="preprocessor">#if(JONGENNEWTSTUFF==1)</span></div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=0;<span class="keywordtype">id</span>&lt;n;<span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;      x[id]=x_old[id]; <span class="comment">// actually evaluated x</span></div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;    }</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;    <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;  }</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;</div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;  <span class="keywordflow">if</span>( fabs(errx) &gt; MIN_NEWT_TOL_VAR){</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;    <span class="keywordflow">if</span>( (do_line_search != <a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a>) || (<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a4ecb52853a5a7a52d60d1662732b26d8">USE_LINE_SEARCH</a> &lt; 0) ) { </div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;<span class="preprocessor">#if(DOHISTOGRAM)</span></div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;<span class="preprocessor"></span>      bin_newt_data(MAX_NEWT_ITER_VAR, errx, n_iter, 0, 0 );</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;      <span class="keywordflow">if</span>(debugfail&gt;=2){</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;fabs(errx)=%21.15g &gt; MIN_NEWT_TOL_VAR=%21.15g n=%d n_iter=%d lntries=%d eomtype=%d\n&quot;</span>,fabs(errx),MIN_NEWT_TOL_VAR,n,n_iter,newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a83280998e47831044a7e35299495a9bb">lntries</a>,eomtype);</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;        <span class="comment">//        if(DEBUGINDEX) dualfprintf(fail_file,&quot;i=%d j=%d part=%d step=%ld :: n_iter=%d :: errx=%21.15g minerr=%21.15g :: x[0]=%21.15g dx[0]=%21.15g wglobal0=%21.15g\n&quot;,ifileglobal,jfileglobal,steppart,nstep,n_iter,errx,MIN_NEWT_TOL_VAR,x[0],dx[0],wglobal[0]);</span></div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;      }</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;      <span class="keywordflow">if</span>(ltrace2) {</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot; totalcount = %d   0   %d  %d  %d  %21.15g \n&quot;</span>,n_iter,retval,do_line_search,i_extra,errx); </div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;      }</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;      <span class="keywordflow">if</span>(ltrace) {</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson():  did not find solution \n&quot;</span>);</div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;        <span class="keywordflow">if</span>( retval == -1 ) {</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson(): lnsrch converged: x = &quot;</span>);</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;          <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++)  dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g  &quot;</span>,x[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;general_newton_raphson(): lnsrch converged: x_old = &quot;</span>);</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;          <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++)  dualfprintf(fail_file,<span class="stringliteral">&quot; %21.15g  &quot;</span>,x_old[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;        }</div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160; </div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;      }</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;gnr retval2 = %4i \n&quot;, 1); </span></div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;<span class="preprocessor"></span>      *lpflag=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e8b2b95acecbfffd1cd90d36c295f9b">UTOPRIMFAILCONVRET</a>+4;</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;      <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    } </div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;      <span class="comment">/* If bad return and we tried line searching, try it without before giving up: */</span></div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;gnr: doing recursive call, do_line_search, retval, errx = %4i  %4i  %21.15g \n&quot;, do_line_search, retval, errx );</span></div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;      <span class="comment">//      </span></div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;      retval2 = general_newton_raphson(showmessages, lpflag, eomtype, x_orig, n, ((do_line_search+1)%2), funcd, res_func, wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra,newtonstats);</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; n ; <span class="keywordtype">id</span>++)  x[<span class="keywordtype">id</span>] = x_orig[<span class="keywordtype">id</span>] ;</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;      <span class="comment">//      dualfprintf(fail_file,&quot;gnr retval3 = %4i \n&quot;, retval2); </span></div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;      <span class="keywordflow">if</span>(debugfail&gt;=2) dualfprintf(fail_file,<span class="stringliteral">&quot;fabs(errx) &gt; MIN_NEWT_TOL_VAR: n_iter=%d lntries=%d\n&quot;</span>,n_iter,newtonstats-&gt;<a class="code" href="../../db/d3a/structof__newtonstats.html#a83280998e47831044a7e35299495a9bb">lntries</a>);</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;      <span class="keywordflow">return</span>( retval2 );</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    }</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;  }</div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;<span class="preprocessor"></span>  dualfprintf(fail_file,<span class="stringliteral">&quot;gnr retval6 = %4i \n&quot;</span>, 0);</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;}</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;</div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;</div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;</div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;</div>
<div class="line"><a name="l04863"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa72eb753868a7845a97e8659d8be76d3"> 4863</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#aa72eb753868a7845a97e8659d8be76d3" title="see if meet tolerance">newt_errorcheck</a>(<span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> NEWT_TOL_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> NEWT_TOL_ULTRAREL_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> trueerrortotal, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal)</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;{</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;  <span class="keywordtype">int</span> ultrarel=0;</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;  ultrarel=( (fabs(wglobal[1])&gt;wglobal[2]) || (fabs(x0)&gt;wglobal[2]) );</div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;</div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;  <span class="comment">// see if dx&#39;s are too small to matter, despite condition on errx.</span></div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;  <span class="keywordtype">int</span> dxsmallcount=0;</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;  <span class="keywordtype">int</span> iter;</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;  <span class="keywordflow">for</span>(iter=0;iter&lt;n;iter++) dxsmallcount += (fabs(dx[iter])&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>*x[iter]);</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;  <span class="keywordflow">if</span>(!ultrarel){</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;    <span class="keywordflow">return</span>(fabs(errx) &lt;= NEWT_TOL_VAR || fabs(trueerrortotal) &lt;= NEWT_TOL_VAR || dxsmallcount==n);</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;  }</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;    <span class="keywordflow">return</span>(fabs(errx) &lt;= NEWT_TOL_ULTRAREL_VAR || fabs(trueerrortotal) &lt;= NEWT_TOL_ULTRAREL_VAR || dxsmallcount==n);</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;  }</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;}</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;</div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;</div>
<div class="line"><a name="l04886"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a21cdce7292266aa5e19d5d07ef0630f4"> 4886</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a21cdce7292266aa5e19d5d07ef0630f4" title="Newton checks:">newt_repeatcheck</a>(<span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_oldest, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_older, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_olderer)</div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;{</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;  <span class="keywordtype">int</span> repeat;</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;  repeat=0;</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;n;i++){</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;  </div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;    <span class="keywordflow">if</span>( (x[i]==x_olderer[i] &amp;&amp; fabs(dx[i])==fabs(dx_old[i])) &amp;&amp; (errx_oldest==errx_old) ){</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;      repeat++;</div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;    }</div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;  }</div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;  <span class="keywordflow">if</span>(repeat==n) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;}</div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;<span class="comment">//  FTYPE xlist[NEWT_DIM][MAX_NEWT_ITER+EXTRA_NEWT_ITER_ULTRAREL+EXTRA_NEWT_ITER],errxlist[MAX_NEWT_ITER+EXTRA_NEWT_ITER_ULTRAREL+EXTRA_NEWT_ITER];</span></div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;<span class="comment">//  FTYPE dxlist[NEWT_DIM][MAX_NEWT_ITER+EXTRA_NEWT_ITER_ULTRAREL+EXTRA_NEWT_ITER],trueerrorlist[MAX_NEWT_ITER+EXTRA_NEWT_ITER_ULTRAREL+EXTRA_NEWT_ITER];</span></div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;</div>
<div class="line"><a name="l04910"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad576bc07725345ce8ec5882e826d76a0"> 4910</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ad576bc07725345ce8ec5882e826d76a0" title="see if repeating Newton cycle with no change in errx, so indicates can&#39;t do anything (even damping) t...">newt_cyclecheck</a>(<span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> trueerror, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx_oldest, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_old, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_older, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x_olderer, <span class="keywordtype">int</span> n_iter, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*xlist)[<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*dxlist)[<a class="code" href="../../d4/da4/u2p__defs_8h.html#aaf4d47cc0d062074a46ccf0b603fb6c9">MAX_NEWT_ITER</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#ad1899970fa5506ccf6802535b7c62192">EXTRA_NEWT_ITER_ULTRAREL</a>+<a class="code" href="../../d4/da4/u2p__defs_8h.html#a45400dfae1e944c02609e8649cf65f70" title="always do 1 extra to avoid error estimate issues as above">EXTRA_NEWT_ITER</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *errxlist, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *trueerrorlist)</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;{</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;</div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;  <span class="keywordtype">int</span> cycle=0;</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;n;i++){</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;  </div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;    <span class="comment">//    dualfprintf(fail_file,&quot;%d %d %g %g %g %g\n&quot;,x[i]==x_olderer[i],errx_oldest==errx_old,x[i],x_olderer[i],errx_oldest,errx_old);</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;    <span class="keywordflow">if</span>( (x[i]==x_olderer[i]) &amp;&amp; (errx_oldest==errx_old &amp;&amp; errx_old!=0.0) ){</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;      cycle++;</div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;    }</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;  }</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;</div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;  <span class="keywordtype">int</span> cycle2=0;</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;  <span class="keywordtype">int</span> ii;</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;  <span class="keywordflow">for</span>(ii=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a2c235567d455c15a7ef6e325c62fd3e4">CYCLESTOP</a>;ii&lt;n_iter;ii++){</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;    <span class="keywordflow">if</span>(errx_old!=0.0 &amp;&amp; errx_old==errxlist[ii]) cycle2++;</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;    <span class="keywordflow">if</span>(trueerror!=0.0 &amp;&amp; trueerror==trueerrorlist[ii]) cycle2++;</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;n;i++){</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;      <span class="keywordflow">if</span>(x[i]==xlist[i][ii]) cycle2++;</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;    }</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;  }</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;  <span class="keywordflow">if</span>(cycle&gt;=n || cycle2&gt;=<a class="code" href="../../d4/da4/u2p__defs_8h.html#a43821a4fe8f5f001e7b13c20e089617c">NUMCYCLES</a>*n) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;}</div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;<span class="comment">// see if done with extra iterations</span></div>
<div class="line"><a name="l04944"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ccbeaf1c72b5fbf65661284edfcb6ca"> 4944</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a3ccbeaf1c72b5fbf65661284edfcb6ca">newt_extracheck</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> EXTRA_NEWT_ITER_VAR, <span class="keywordtype">int</span> EXTRA_NEWT_ITER_ULTRAREL_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> dx0, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *x, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *dx, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal)</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;{</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;  <span class="keywordtype">int</span> ultrarel=0;</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;  ultrarel=( (fabs(wglobal[1])&gt;wglobal[2]) || (fabs(x0)&gt;wglobal[2]) );</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;</div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;  <span class="comment">// see if dx&#39;s are too small to matter, despite condition on errx.</span></div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;  <span class="keywordtype">int</span> dxsmallcount=0;</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;  <span class="keywordtype">int</span> iter;</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;  <span class="keywordflow">for</span>(iter=0;iter&lt;n;iter++) dxsmallcount += (fabs(dx[iter])&lt;<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a8913cb5d64cfec23ae1a3052930ec468">NUMEPSILON</a>*x[iter]);</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;  <span class="keywordflow">if</span>(dxsmallcount) <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;    <span class="keywordflow">if</span>(!ultrarel){</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;      <span class="keywordflow">return</span>(EXTRA_NEWT_ITER_VAR);</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;    }</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;      <span class="keywordflow">return</span>(EXTRA_NEWT_ITER_ULTRAREL_VAR);</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;    }</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;  }</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;}</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;</div>
<div class="line"><a name="l04968"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a95342614aba74196773caa006c4dbe1f"> 4968</a></span>&#160;<span class="preprocessor">#define ALF 1.0e-4</span></div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> my_lnsrch(<span class="keywordtype">int</span> eomtype, <span class="keywordtype">int</span> n, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> xold[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> fold, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> g[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> p[], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[], </div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;                      <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *f, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> TOLX, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> stpmax, <span class="keywordtype">int</span> *check, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> (*func) (<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> [], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra), <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra)</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;{</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>;</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> <a class="code" href="../../d8/d5b/defs_8general_8h.html#aa73cf2d397cae726436e08d2c891bdb0">a</a>,alam,alam2,alamin,b,disc,f2,fold2,rhs1,rhs2,slope,sum,temp,test,tmplam;</div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;  <span class="keywordtype">int</span> icount=0;</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;  <span class="keywordtype">int</span> bad_step;</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> bad_step_factor = 2.0;</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ltrace = 0;</div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;  void (*ptr_validate_x)(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> x0[<a class="code" href="../../d0/d1c/utoprim__jon_8h.html#a8c9cd0730b6c72d2d6d4f6b751ce3692">NEWT_DIM</a>], <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *wglobal,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Bsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotB,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> QdotBsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qtsq,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotn,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Qdotnp,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> D,<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> Sc, <span class="keywordtype">int</span> whicheos, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> *EOSextra);</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;</div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;  <span class="comment">// pick version of validate_x depending upon scheme</span></div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;  <a class="code" href="../../d1/dde/utoprim__jon_8c.html#ac5113207ae627a2049037851190aecfd" title="set pointer to the correct validate_x function">pick_validate_x</a>(eomtype, &amp;ptr_validate_x);</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160; </div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;  </div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;  *check=0;</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;  <span class="keywordflow">for</span> (sum=0.0,i=1;i&lt;=n;i++) sum += p[i]*p[i];</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;  sum=sqrt(sum);</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;  <span class="keywordflow">if</span> (sum &gt; stpmax)</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;    <span class="keywordflow">for</span> (i=1;i&lt;=n;i++) p[i] *= stpmax/sum;</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;  <span class="keywordflow">for</span> (slope=0.0,i=1;i&lt;=n;i++)</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;    slope += g[i]*p[i];</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;  test=0.0;</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;  <span class="keywordflow">for</span> (i=1;i&lt;=n;i++) {</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;    <span class="comment">//    temp=fabs(p[i])/max(fabs(xold[i]),1.0);</span></div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;    temp= (xold[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] == 0.) ? fabs(p[i]) :  fabs(p[i]/xold[i]);</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;    <span class="keywordflow">if</span> (temp &gt; test) test=temp;</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;  }</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;  alamin=TOLX/test;</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): sum, slope, test, alamin =   %21.15g  %21.15g  %21.15g  %21.15g \n&quot;</span>,sum,slope,test,alamin); </div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;  }</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;  alam=1.0;</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;    <span class="keywordflow">for</span> (i=1;i&lt;=n;i++) x[i]=xold[i]+alam*p[i];</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;    <span class="comment">// METHOD specific:</span></div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;    validate_x(ptr_validate_x, (x+1), (xold+1), wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;    *f=(*func)(x+1,wglobal,Bsq,QdotB,QdotBsq,Qtsq,Qdotn,Qdotnp,D,Sc,whicheos,EOSextra);</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;      </div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;    bad_step = 0;</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;    <span class="keywordflow">if</span>( finite(*f)==0 ) { </div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;      bad_step = 1;</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;    }</div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;</div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;    <span class="comment">//      if( bad_step ) alam /= bad_step_factor;</span></div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;    <span class="comment">//      if (alam &lt; alamin) bad_step = 0;</span></div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;    <span class="keywordflow">if</span>( bad_step ) { </div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;      *check = 2;</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;<span class="preprocessor"></span>      dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): bad_step = 1,  f = %21.15g , alam = %21.15g \n&quot;</span>, *f, alam); </div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;      <span class="keywordflow">for</span>( i = 1; i &lt;= n; i++ ) { </div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): (xold[%d], x[%d], p[%d]) = %21.15g , %21.15g , %21.15g \n&quot;</span>, i,i,i, xold[i],x[i],p[i]);</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      }</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;    }</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;      </div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;    <span class="keywordflow">if</span> (alam &lt; alamin) {</div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;      <span class="keywordflow">for</span> (i=1;i&lt;=n;i++) x[i]=xold[i];</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;      *check=1;</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>( ltrace ) { </div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): alam &lt; alamin: alam, alamin = %21.15g  %21.15g \n&quot;</span>, alam,alamin); </div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;      }</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;    } </div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*f &lt;= fold+<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a95342614aba74196773caa006c4dbe1f">ALF</a>*alam*slope) {</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span>( ltrace ) { </div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;        dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): good exit:  alam, alamin, f, fold = %21.15g  %21.15g %21.15g  %21.15g \n&quot;</span>, alam,alamin, *f, fold); </div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;      }</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;    }</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;      <span class="keywordflow">if</span> (alam == 1.0) {</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;        tmplam = -slope/(2.0*(*f-fold-slope));</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): setting tmplam!!    tmplam, alam =  %21.15g  %21.15g !!\n&quot;</span>, tmplam, alam); </div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;        }</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;        rhs1 = *f-fold-alam*slope;</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;        rhs2=f2-fold2-alam2*slope;</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;        a=(rhs1/(alam*alam)-rhs2/(alam2*alam2))/(alam-alam2);</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;        b=(-alam2*rhs1/(alam*alam)+alam*rhs2/(alam2*alam2))/(alam-alam2);</div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;        <span class="keywordflow">if</span> (a == 0.0) tmplam = -slope/(2.0*b);</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;          disc=b*b-3.0*a*slope;</div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;          <span class="keywordflow">if</span> (disc&lt;0.0) {</div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">if</span>( disc &lt; -1.e-10 ) {</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;              <span class="keywordflow">if</span>( ltrace ) dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): Big Roundoff problem:  disc = %21.15g \n&quot;</span>, disc);</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;            }</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;<span class="preprocessor">#endif       </span></div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;<span class="preprocessor"></span>            disc = 0.;</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;          }</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;          <span class="keywordflow">else</span> tmplam=(-b+sqrt(disc))/(3.0*a);</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;        }</div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;        <span class="keywordflow">if</span> (tmplam&gt;0.5*alam)</div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;          tmplam=0.5*alam;</div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;          dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): rhs1, rhs2, a, b, tmplam, alam =  %21.15g  %21.15g  %21.15g  %21.15g  %21.15g  %21.15g !!\n&quot;</span>,</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;                      rhs1, rhs2, a, b, tmplam, alam );</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;        }</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;    }</div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;    alam2=alam;</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;    f2 = *f;</div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;    fold2=fold;</div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;    alam=<a class="code" href="../../dc/dc2/f2c_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(tmplam,0.1*alam);</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;<span class="preprocessor">#if(!OPTIMIZED)</span></div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>( ltrace ) {</div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;my_lnsrch(): icount, alam, alam2, tmplam  =   %4i  %21.15g  %21.15g  %21.15g \n&quot;</span>,</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;                  icount, alam, alam2, tmplam);</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;    }</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;<span class="preprocessor">#endif    </span></div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;<span class="preprocessor"></span>    icount++;</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;  }</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;}</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;<span class="preprocessor">#undef ALF</span></div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;</div>
<div class="line"><a name="l05110"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49"> 5110</a></span>&#160;<span class="preprocessor">#define N_CONV_TYPES 3</span></div>
<div class="line"><a name="l05111"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#a404854986ee1512385e04038784a1e96"> 5111</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define N_NITER_BINS (MAX_NEWT_ITER + 3) // want to use MAX_NEWT_ITER_VAR, but not fixed, so constrain to be less.</span></div>
<div class="line"><a name="l05112"></a><span class="lineno"><a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512"> 5112</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NBINS 200</span></div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;<span class="comment">/**************************************************** </span></div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;<span class="comment">  Used to gather statistics for the Newton solver during a disk run:</span></div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;<span class="comment">  -- bins are inclusive on their minimum bounds, and exlusive on their max.</span></div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;<span class="comment">      lerrx_[min,max] = the min./max. bounds of the errx historgram</span></div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;<span class="comment">      d_errx          = errx histogram bin width</span></div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;<span class="comment">      n_beyond_range  = number of solutions with errx max. beyond range speciified by lerrx_[min,max]</span></div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;<span class="comment">      n_conv_types    = number of types of ways newton procedure can exit;</span></div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;<span class="comment">      print_now       = 1 if you want to just print the histograms without counting a solution;</span></div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;<span class="comment">*****************************************************/</span></div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;<span class="comment">// OPENMPMARK: Not thread safe due to use of static variables, but not used except for debugging</span></div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> bin_newt_data(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> MAX_NEWT_ITER_VAR, <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> errx, <span class="keywordtype">int</span> niters, <span class="keywordtype">int</span> conv_type, <span class="keywordtype">int</span> print_now  ) {</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;</div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;  </div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;  <span class="comment">/* General variables */</span></div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> first_call   = 1;</div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_bin_calls  = 0L;</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;  <span class="keyword">const</span>  <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_output_freq = 128*128*100;</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;  <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> localerrx;</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;  <span class="comment">/* Variables for the errx histogram */</span> </div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> localerrx_min = -23.;</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> localerrx_max =   4.;</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> d_errx;</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_errx[<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49">N_CONV_TYPES</a>][<a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512">NBINS</a>];</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d6/df4/global_8realdef_8h.html#a4b869b0ea0650e99dff987e742327ce0" title="need not change below datatype stuff">FTYPE</a> xbin[<a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512">NBINS</a>];</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_beyond_range = 0L;   <span class="comment">/* Number of points that lie out of the bounds of our errx histogram */</span></div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;  <span class="keywordtype">int</span> ibin;</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;  <span class="comment">/* Variables for the histogram of the number of newton iterations : */</span></div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_niters[<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49">N_CONV_TYPES</a>][<a class="code" href="../../d1/dde/utoprim__jon_8c.html#a404854986ee1512385e04038784a1e96">N_NITER_BINS</a>];</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;  </div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(omp_in_parallel()){</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    dualfprintf(fail_file,<span class="stringliteral">&quot;bin_newt_data() called in parallel region\n&quot;</span>);</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;    myexit(93586346);</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;  }</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;  <span class="comment">/* Clear arrays, set constants : */</span></div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;  <span class="keywordflow">if</span>( first_call ) {</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;    d_errx    = ((localerrx_max - localerrx_min)/(1.*<a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512">NBINS</a>));</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;    </div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;    <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49">N_CONV_TYPES</a>; i++ ) { </div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;      <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512">NBINS</a>; j++ ) { </div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;        n_errx[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] = 0;</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;      }</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;      <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a404854986ee1512385e04038784a1e96">N_NITER_BINS</a>; j++ ) { </div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;        n_niters[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] = 0;</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;      }</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;    }</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;    <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512">NBINS</a>; j++ ) { </div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;      xbin[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>] = localerrx_min + (1.*j + 0.5)*d_errx;</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;    }</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;      </div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;    first_call = 0;</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;  }</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;  <span class="keywordflow">if</span>( print_now != 1 ) {</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;    <span class="comment">/* Check validity of arguments : */</span></div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    errx = fabs(errx) ;</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;    localerrx = log10(errx + 1.0e-2*pow(10.,localerrx_min));</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;    <span class="keywordflow">if</span>( (niters &lt; 0) || (niters &gt;= <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a404854986ee1512385e04038784a1e96">N_NITER_BINS</a>) ) {</div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;      dualfprintf(fail_file,<span class="stringliteral">&quot;bin_newt_data(): bad value for niters = %d \n&quot;</span>, niters );</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;      fflush(stdout);</div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;    }</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;    </div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;    <span class="comment">/* Determine ibin */</span></div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;    <span class="keywordflow">if</span>( localerrx &lt; localerrx_min ) {</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;      ibin = 0;</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;      n_beyond_range++ ;</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;    }</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( localerrx &gt;= localerrx_max ) {</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;      ibin = <a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512">NBINS</a> - 1;</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;      n_beyond_range++ ;</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;    }</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;      ibin = (int) ( ( localerrx - localerrx_min ) / d_errx );</div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;    }</div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;    </div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;    <span class="comment">/* Tally this solution  */</span></div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;    n_errx[ conv_type][ibin]++;</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;    n_niters[conv_type][niters]++;</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;  }</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;  <span class="comment">/* Print out the histograms periodically or when asked to : */</span></div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;  <span class="keywordflow">if</span>( print_now  ||  ( (n_bin_calls % n_output_freq) == 0 ) ) {</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;t = %21.15g ,  n_beyond_range = %ld , n_bin_calls = %ld \n&quot;</span>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>, n_beyond_range, n_bin_calls);</div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;    <span class="comment">/* ERRX */</span></div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--\n&quot;</span>);</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;                         x&quot;</span>);</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;    <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49">N_CONV_TYPES</a>; j++ ) { </div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;            N%d&quot;</span>,j);</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;    }</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;    </div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;    <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#abbfe09e0d318a872da390860404cd512">NBINS</a>; i++ ) { </div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;%21.15g &quot;</span>,xbin[i]);</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;      <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49">N_CONV_TYPES</a>; j++ ) { </div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;%13ld &quot;</span>, n_errx[j][i]);</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;      }</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;    }    </div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--ERRX-HISTOGRAM--\n&quot;</span>);</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;    <span class="comment">/* NITER */</span></div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;</div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--\n&quot;</span>);</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;        niter&quot;</span>);</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;    <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49">N_CONV_TYPES</a>; j++ ) { </div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;            N%d&quot;</span>,j);</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    }</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;    </div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;    <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a404854986ee1512385e04038784a1e96">N_NITER_BINS</a>; i++ ) { </div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;%13d &quot;</span>, i);</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;      <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="../../d1/dde/utoprim__jon_8c.html#a39e1e100df5fa85d2e29ba26ea37ee49">N_CONV_TYPES</a>; j++ ) { </div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;        dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;%13ld &quot;</span>, n_niters[j][i]);</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;      }</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;    }    </div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>,<span class="stringliteral">&quot;NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--NITER-HISTOGRAM--\n&quot;</span>);</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;  }</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;    </div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    </div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;  <span class="keywordflow">if</span>( print_now != 1 )  n_bin_calls++;</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;}</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160; </div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160; </div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;<span class="preprocessor">#undef N_CONV_TYPES </span></div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef N_NITER_BINS </span></div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef NBINS </span></div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;<span class="preprocessor">#undef CRAZYDEBUG</span></div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;<span class="preprocessor"></span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:35 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
