<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: docs/general_plotting_guide.txt File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">docs/general_plotting_guide.txt File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="fragment"><div class="line">There are a couple plotting tools that go beyond vis5d+<span class="stringliteral">&#39;s capability</span></div>
<div class="line"><span class="stringliteral">to deal with more publishable plots.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">===============================================================</span></div>
<div class="line"><span class="stringliteral">HARM data:</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">1) In general, in the harm git, see docs/tousedata.txt for the format</span></div>
<div class="line"><span class="stringliteral">for fieldline, gdump, and maybe dump files. All the plotting begins</span></div>
<div class="line"><span class="stringliteral">starting with using that data, so it&#39;</span>s good to know what one is</div>
<div class="line">starting with!</div>
<div class="line"></div>
<div class="line">2) Don<span class="stringliteral">&#39;t forget about http://globusonline.org/ for handling copying of</span></div>
<div class="line"><span class="stringliteral">data to/from various computers.  Don&#39;</span><a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a> use scp or bbcp or any other</div>
<div class="line">method.  Any other method is highly unreliable and slow.</div>
<div class="line"></div>
<div class="line">Most of XSEDE has <span class="keyword">this</span> setup, and virtually any computer you have access</div>
<div class="line">to can have a globusconnect going (even with out you logged in by <span class="keyword">using</span></div>
<div class="line"><span class="stringliteral">&quot;nohup&quot;</span>).</div>
<div class="line"></div>
<div class="line">3) One can <span class="keywordflow">do</span> most analysis/plotting on supercomputers, although <span class="keywordflow">for</span></div>
<div class="line">just learning one can use a local computer.</div>
<div class="line"></div>
<div class="line">===============================================================</div>
<div class="line">SuperMongo (SM):</div>
<div class="line"></div>
<div class="line">SM is good for basic 2D plots with ability to quickly appear high</div>
<div class="line">quality with latex (math) mode for axes labels, titles, etc.</div>
<div class="line"></div>
<div class="line">1) It requires text dump and gdump files.  So one either needs to use</div>
<div class="line"><span class="stringliteral">&quot;bin2txt&quot;</span> to convert the binary to text, or one needs to ensure the</div>
<div class="line">files are written as text during the simulation (not good for</div>
<div class="line">supercomputers).  To do this, one sets in your</div>
<div class="line"><a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#ac4110398e386c9888d9565630357dbbe" title="General-Primary init() routine Uses globals inside init() because sets memory and sets physics...">init</a>.c:<a class="code" href="../../d8/d60/init_8c.html#a2ce999ac8e87da3eb35ffc736f33515a">prepre_init_specific_init</a>():</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d8/d5b/defs_8general_8h.html#a04767aafce2d594a681b4d39134050c8">binaryoutput</a>=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>;</div>
<div class="line"></div>
<div class="line">And also <span class="keywordflow">do</span>: SET <a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a125da10d4f20cf53facb2a408fdc3f52">USEROMIO</a> to 0 or 1 in mympi.definit.h (needs to be 0</div>
<div class="line"><span class="keywordflow">for</span> <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2927c7a2f9bac08381bfb2e1a543e1e8">TEXTOUTPUT</a>)</div>
<div class="line"></div>
<div class="line">2) SM Project and Repo (SVN based):</div>
<div class="line"></div>
<div class="line">https:<span class="comment">//harm.unfuddle.com/svn/harm_harmsmmacros/</span></div>
<div class="line"></div>
<div class="line">QuickStartGuide(updated):</div>
<div class="line">https:<span class="comment">//harm.unfuddle.com/a#/projects/2/notebooks/3/pages/6/latest</span></div>
<div class="line"></div>
<div class="line">Use guide:</div>
<div class="line">https:<span class="comment">//harm.unfuddle.com/a#/projects/1/notebooks/1/pages/45/latest</span></div>
<div class="line"></div>
<div class="line">3) One should use <span class="stringliteral">&quot;jrdp3duentropy&quot;</span> to read-in the latest dump files</div>
<div class="line">(one must have text dump files) and <span class="stringliteral">&quot;grid3d&quot;</span> to read in the gdump file</div>
<div class="line">(again text only).</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>.g., </div>
<div class="line"></div>
<div class="line">A) install as per guide</div>
<div class="line">B) <a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> to the <span class="stringliteral">&quot;run&quot;</span> directory (<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>.e. not <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89abceb1f5e607b7074378156fa8f94b">dumps</a> or images directory)</div>
<div class="line"><a class="code" href="../../d8/d5b/defs_8general_8h.html#a0050aa7bf7fc92a690eec015acb18800">C</a>) run as per guide: jsm</div>
<div class="line">D) gogrmhd</div>
<div class="line"><a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>) jrdpcf3duentropy dump0000</div>
<div class="line">F) plc 0 lrho # This will plot the log of density</div>
<div class="line"><a class="code" href="../../d8/d5b/defs_8general_8h.html#a1b697356441aab8d55c753517a360792">G</a>) help jrdp3duentropy # to see what this macro/script does and what</div>
<div class="line">else you can plot.  See all the other macros in ~/sm/ that you</div>
<div class="line">installed during the quick start guide.</div>
<div class="line"><a class="code" href="../../d8/d5b/defs_8general_8h.html#a333bf60038d1801707ebf78ebdebdaea">H</a>) pl 0 r lrho # 1D plot of all data for radius vs. log(rho0)</div>
<div class="line"></div>
<div class="line">===============================================================</div>
<div class="line">Python Scripting:</div>
<div class="line"></div>
<div class="line">1) Using SM is easy for simple high quality 2D plots, but not as robust</div>
<div class="line">or general as python.</div>
<div class="line"></div>
<div class="line">Python will read-in the binary or binary fieldline file and gdump file</div>
<div class="line">but it<span class="stringliteral">&#39;s not as easy to make a quick high-quality 2D BW plot.  But for</span></div>
<div class="line"><span class="stringliteral">color of &gt;1D (and often &gt;2D) or more complicated analysis using</span></div>
<div class="line"><span class="stringliteral">various packages, python is best.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">2) Repo (git based) is part of the HARM project on unfuddle:</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">git@harm.unfuddle.com:harm/pythontools.git</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">Switch to branch &quot;jon&quot; and don&#39;</span><a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a> use <span class="stringliteral">&quot;master&quot;</span>:  git checkout jon</div>
<div class="line"></div>
<div class="line">It should tell you that it<span class="stringliteral">&#39;s tracking remote branch from origin.  If</span></div>
<div class="line"><span class="stringliteral">not, something&#39;</span>s wrong.</div>
<div class="line"></div>
<div class="line">3) After getting the repo and the directory called <span class="stringliteral">&quot;pythontools&quot;</span> (say</div>
<div class="line">downloaded into your home directory), *move* (do not link, so that</div>
<div class="line">scripts below behave normally) to your home directory as:</div>
<div class="line"></div>
<div class="line">mv ~/pythontools ~/py/</div>
<div class="line"></div>
<div class="line">4a) Make sure you have installed python2.7 (not 2.6 or 3.0 or any</div>
<div class="line">other).  Install all the related packages like matplotlib, numpy,</div>
<div class="line">scipy.  Also best to install ipython.  For some help on that, see</div>
<div class="line">~/py/docs/pythonfullinstall.sh .  However, this is for installing on</div>
<div class="line">any arbitrary system, not ubuntu.  Try using the package manager and</div>
<div class="line">install all those items mentioned in that install script, and only if</div>
<div class="line">one has problems should one install python directly.  This means</div>
<div class="line">looking for ubuntu packages: python, python2.7-setuptools,</div>
<div class="line">python-dateutil, yasm, ipython, python-nose, python2.7-scipy,</div>
<div class="line">python2.7-numpy, python-matplotlib, python-matplotlib-data, dvipng</div>
<div class="line"></div>
<div class="line">Maybe also install medibuntu: http:<span class="comment">//www.medibuntu.org/repository.php</span></div>
<div class="line"></div>
<div class="line">Some things may already be installed (e.g.): python --version # should</div>
<div class="line">be 2.7.x</div>
<div class="line"></div>
<div class="line">4b) Ensure PYTHONPATH is set.  Put in your .bashrc the following:</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a4ebf7765a6bde079a76719b89d3033b6" title="add in source terms to equations of motion ui and dUriemann in UEVOLVE form assume q(pr) so consisten...">source</a> ~/.bashrc.jon</div>
<div class="line">#<a class="code" href="../../d3/ddc/phys_8funcdeclare_8h.html#a4ebf7765a6bde079a76719b89d3033b6" title="add in source terms to equations of motion ui and dUriemann in UEVOLVE form assume q(pr) so consisten...">source</a> /opt/intel/bin/compilervars.sh intel64</div>
<div class="line">export PYTHONPATH=$HOME/py/:$PYTHONPATH</div>
<div class="line">export LESS=<span class="stringliteral">&quot;-R&quot;</span></div>
<div class="line">export EDITOR=emacs</div>
<div class="line">alias ipython=<span class="stringliteral">&#39;ipython --pylab --colors=LightBG&#39;</span></div>
<div class="line">#export PYTHONPATH=$HOME/lib/python/:$HOME/py/:$PYTHONPATH</div>
<div class="line">PATH=/home/$USER/mpich-install/bin:$PATH ; export PATH</div>
<div class="line">export HOSTNAME</div>
<div class="line"><span class="keywordflow">if</span> [ -z $LD_LIBRARY_PATH  ]; then</div>
<div class="line">LD_LIBRARY_PATH=/home/$USER/lib/</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">LD_LIBRARY_PATH=/home/$USER/lib:${LD_LIBRARY_PATH}</div>
<div class="line">fi</div>
<div class="line"><span class="preprocessor">#for user libs</span></div>
<div class="line"><span class="preprocessor"></span>export LD_LIBRARY_PATH</div>
<div class="line"></div>
<div class="line">5) The primary script <span class="keywordflow">for</span> HARM analysis is: ~/py/mread/__init__.py .</div>
<div class="line">There are lots of bash script wrappers <span class="keywordflow">for</span> python stuff in</div>
<div class="line">~/py/scripts/ .</div>
<div class="line"></div>
<div class="line">The __init__.py file is a monster master file used <span class="keywordflow">for</span> the tons of</div>
<div class="line">calculations in the MCAF paper.</div>
<div class="line"></div>
<div class="line">Along with those bash scripts (the *links* to make a single place of</div>
<div class="line">links <span class="keywordflow">for</span> the multiple supercomputer runs, makemovie.sh and</div>
<div class="line">makemallovie.sh <span class="keywordflow">for</span> doing batch jobs of analysis over all files <span class="keywordflow">for</span></div>
<div class="line">each supercomputer run, etc.), <span class="keyword">this</span> is how one can <span class="keywordflow">do</span> large-scale</div>
<div class="line">analysis on supercomputers.  Indeed, those scripts show exactly</div>
<div class="line">how that __init__.py file is really used under many cases.</div>
<div class="line">I mostly tuned __init__.py to be command-line driven.  It doesn<span class="stringliteral">&#39;t</span></div>
<div class="line"><span class="stringliteral">focus on popping-up pictures.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">Note that this __init__.py is quite advanced.  It deals with many</span></div>
<div class="line"><span class="stringliteral">issues related to what computer one is one, issues with various</span></div>
<div class="line"><span class="stringliteral">computers, etc.  But, python is fairly modular (although many global</span></div>
<div class="line"><span class="stringliteral">variables have been used), so it&#39;</span>s not too hard to ignore the advanced</div>
<div class="line">bits and add your own analysis calls or use existing analysis.</div>
<div class="line"></div>
<div class="line">6) You should learn python or get a book.  I used a lot of google</div>
<div class="line">searching after starting with someone else&#39;s template file.</div>
<div class="line">Alot of results will come <a class="code" href="../../dc/dd2/newcodediff_8txt.html#a1df03026db3aa663afda0c9eed67408e">up</a> as from stackoverflow.org answers (very good stuff)</div>
<div class="line">or direct websites about python (e.g. http:<span class="comment">//docs.python.org/2.7/</span></div>
<div class="line">or http:<span class="comment">//matplotlib.org/ or http://www.scipy.org/</span></div>
<div class="line"></div>
<div class="line">Basically, python is a scripting language, meaning the <a class="code" href="../../d9/d54/other6_8txt.html#ad3c086d13a326385668d92acdb4625a6">user</a> doesn&#39;<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a></div>
<div class="line">have to compile the code.  One just runs something like:</div>
<div class="line"></div>
<div class="line">python &lt;scriptname&gt;</div>
<div class="line"></div>
<div class="line">Python scripts are run sequentially as the file appears.  Many times</div>
<div class="line">all that&#39;s in the script are functions and no commands,</div>
<div class="line">but at least sometimes commands appear like &quot;import &lt;package&gt;&quot; at the top</div>
<div class="line">so that when one runs the script packages one needs are already loaded</div>
<div class="line">before running any functions.</div>
<div class="line"></div>
<div class="line">Python scripts have a &quot;def <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function that primarily calls init(), diag(), and step_ch_full() in loop.">main</a>()&quot; type function that is the only</div>
<div class="line">function ran when running a script.  Many times, however, this doesn&#39;<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a></div>
<div class="line">do anything itself unless one passes it arguments.  That&#39;s how this</div>
<div class="line">__init__.py script is setup.</div>
<div class="line"></div>
<div class="line">7) Here&#39;s an example use of python with my script, using it to compute various</div>
<div class="line">stages of the calculation used for the MCAF paper.  This is based upon how</div>
<div class="line">the script makeallmovie.sh uses makemovie.sh.</div>
<div class="line"></div>
<div class="line">preA1)  Ensure right files exist in run/<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89abceb1f5e607b7074378156fa8f94b">dumps</a> and run/</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># if created dump0000 and gdump but not .bin versions, convert them is best:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># e.g., for 128x64 simulation, do (do head -1 on original files and see last number as being numcolumns to use below after the &quot;d&quot;):</span></div>
<div class="line"><span class="preprocessor"></span>bin2txt 2 1 0 -1 2 128 64 1 1 dump0000 dump0000.bin d 81</div>
<div class="line">bin2txt 2 1 0 -1 2 128 64 1 1 gdump gdump.bin d 126</div>
<div class="line"></div>
<div class="line">NOTE: If you tried compiling bin2txt in other instructions, but it wouldn<span class="stringliteral">&#39;t work, you can try editing bin2txt.c and setting HDF and V5D to 0 at the top #define&#39;</span>s.  Then edit makefile and search <span class="keywordflow">for</span> v5d and comment out hdf and v5d stuff by putting a # in front of that stuff, like: #-lmfhdf -ldf -ljpeg -lz -lv5dbin2txt  .  Then <span class="keywordflow">do</span>: make superclean ; make prepbin2txt ; make bin2txt ; cp bin2txt ~/bin  .  Then ensure gdump is converted to gdump.bin as above command <span class="keywordflow">for</span> bin2txt does.</div>
<div class="line"></div>
<div class="line">preA2) Add your run name (e.g. <span class="stringliteral">&quot;run&quot;</span> below, where <span class="stringliteral">&quot;run&quot;</span> could be any modelname like <span class="stringliteral">&quot;thickdisk7&quot;</span> and other things.) to ~/py/mread/__init__.py as another modelname entry in <span class="keywordflow">case</span> defaults aren<span class="stringliteral">&#39;t good enough (e.g. for defaultfti and defaultftf that need to at least cover the range where any data exists, else avg merge will fail as NOTUSING will be applied to all files.)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">A) Run the default torus problem or your problem with harm, so now you</span></div>
<div class="line"><span class="stringliteral">have a &quot;run&quot; directory with &quot;dumps&quot; and &quot;images&quot; directories.  Enter</span></div>
<div class="line"><span class="stringliteral">the &quot;run&quot; directory, whatever it&#39;</span>s called.  I<span class="stringliteral">&#39;ll assume harm master</span></div>
<div class="line"><span class="stringliteral">has been downloaded to ~/harmgit/ and the python stuff has been linked</span></div>
<div class="line"><span class="stringliteral">to ~/py/</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">cd run/</span></div>
<div class="line"><span class="stringliteral">cd ../  #really? Yes!</span></div>
<div class="line"><span class="stringliteral">cp ~/py/scripts/makeallmovie.sh .</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># open that makeallmovie.sh and set (and remove or commend-out previous such settings):</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">                     # &quot;run&quot; here is name of your &quot;model&quot; according to the bash and python scripts.</span></div>
<div class="line"><span class="stringliteral">dircollect=&quot;run&quot;     # models (here just 1) to collect latex tables over </span></div>
<div class="line"><span class="stringliteral">dirruns=&quot;run&quot;        # models (here just 1) to run over</span></div>
<div class="line"><span class="stringliteral">numkeep=2            # number of files to really use out of all of them (2 for now to iterate quickly on confusions)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># NOTE: change numkeep to very large number like 500000 to use all fieldline files.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># then edit ~/py/scripts/makemovie.sh :</span></div>
<div class="line"><span class="stringliteral">1) change for &quot;$system -eq 3&quot; part:</span></div>
<div class="line"><span class="stringliteral">numcorespernode=??   # choose ?? as number of cores on your system.  Try ??=1 at first to avoid confusion of multiple stderr and stdout output files in case something goes wrong.  Make 8 or 12 or 16 for nodes with that many cores available.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">2) change itemspergroup=$(( 20 ))  and replace 20 with 1 unless one has more than 20 files.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># Note that in general, one should setup makeallmovie.sh and makemovie.sh to have your own &quot;system&quot; sections *and* &quot;modelname&quot; sections.  That is so you can control by default which files are actually kept (default is higher half of fieldline files).</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># now get ready to run by setting arguments to pass to the script</span></div>
<div class="line"><span class="stringliteral">moviename=&quot;test1&quot;    # name of directory your analysis will be done in</span></div>
<div class="line"><span class="stringliteral">docleanexist=1       # whether to clean-out old analysis</span></div>
<div class="line"><span class="stringliteral">dolinks=1            # whether to make links to dumps as required</span></div>
<div class="line"><span class="stringliteral">dofiles=1            # whether to copy __init__.py, makemovie.sh, and other files needed</span></div>
<div class="line"><span class="stringliteral">make1d=1             # Compute 1D stuff vs. radius results</span></div>
<div class="line"><span class="stringliteral">makemerge=1          # Merge across all core&#39;</span>s 1D calculations</div>
<div class="line">makeplot=1           # Make all plots and latex output and <span class="keyword">final</span> output <span class="keywordflow">for</span> 1D calculations</div>
<div class="line">makemontage=0        # Make montage of plots (can be quite slow <span class="keywordflow">for</span> large data)</div>
<div class="line">makepowervsmplots=0  # Make <a class="code" href="../../df/d8d/koral_8mdefs_8h.html#a4846748f031c2918198ae7ed187138f5">Power</a> vs. m calculations and plots (needed <span class="keywordflow">if</span> doing fft or spec).  Only makes sense in 3D.</div>
<div class="line">makespacetimeplots=0 # space (r and theta) vs. time plots</div>
<div class="line">makefftplot=0        # FFT specific to MCAF paper (watch out <span class="keywordflow">for</span> non-constant spacing in time <span class="keywordflow">for</span> dumping or missing files)</div>
<div class="line">makespecplot=0       # Spectrogram specific to MCAF paper</div>
<div class="line">makeinitfinalplot=0  # initial and <span class="keyword">final</span> 2D plots</div>
<div class="line">makethradfinalplot=0 # theta vs. radius 2D plots</div>
<div class="line">makeframes=1         # make movie frames</div>
<div class="line">makemovie=1          # make movie (or just run ffmpeg yourself)</div>
<div class="line">makeavg=0            # compute 2D averaged time-averaged data (need to <span class="keywordflow">do</span> first before made1d stuff <span class="keywordflow">for</span> Qnlm)</div>
<div class="line">makeavgmerge=0       # merge avg</div>
<div class="line">makeavgplot=0        # make plots or tables related to averages</div>
<div class="line">collect=0            # collect results from latex info from all models</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># run it</span></div>
<div class="line"><span class="preprocessor"></span>rm -<a class="code" href="../../d9/d54/other6_8txt.html#a159e0e9e544b9a0c44070100099776de">rf</a> run/test1/ # in <span class="keywordflow">case</span> already exists</div>
<div class="line">chmod a+rx ./makeallmovie.sh</div>
<div class="line">bash ./makeallmovie.sh ${moviename} $docleanexist $dolinks $dofiles $make1d $makemerge $makeplot $makemontage $makepowervsmplots $makespacetimeplots $makefftplot $makespecplot $makeinitfinalplot $makethradfinalplot $makeframes $makemovie $makeavg $makeavgmerge $makeavgplot $collect</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># One can do each stage separately to see what&#39;s going on.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># e.g., to clean-up the directory, setup links, and copy files, do just:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># rm -rf run/test1/ ; bash ./makeallmovie.sh ${moviename} $docleanexist $dolinks 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># MOST generally, one has to run the avg stuff first so it&#39;s available for all calculations, by doing 2 runs</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># This is because the proper Fourier transforms need the time-averaged value subtracted off.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># Do:</span></div>
<div class="line"><span class="preprocessor"></span>rm -<a class="code" href="../../d9/d54/other6_8txt.html#a159e0e9e544b9a0c44070100099776de">rf</a> run/test1/</div>
<div class="line">chmod a+rx ./makeallmovie.sh</div>
<div class="line">bash ./makeallmovie.sh ${moviename} 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0</div>
<div class="line">bash ./makeallmovie.sh ${moviename} 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1 0</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># NOTE: I avoided doing makeavgplot until the second time, since only the merged avg2d.npy file is required.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># NOTE: One can of course skip certain things that are not needed, but some items require others (e.g. make1d must come before makemerge that must come before makeplot).  Indeed, makemontage through makethradfinalplot all require one to do &quot;makeplot&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># E.g., if one already has the 1d and avg files done, one can fixup your plots and redo the plotting stuff like:</span></div>
<div class="line"><span class="preprocessor"></span>bash ./makeallmovie.sh ${moviename} 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 0 0 1 0</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Many things are computed and outputted. E.g.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># FROM make1d/makemerge/makeplot:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 1) python.plot.full.out : All things from &quot;1D&quot; calculations</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 2) fitplot* : Some fitting plots</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 3) aphi.png : vector potential averaged over dumps</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 4) datavs??.txt : Many computations that can be read into SM using existing SM scripts I used to make MCAF paper plots.  Those SM scripts are in &quot;~/sm/thickdisk.m&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># FROM makepowervsmplots:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 1) power*.png power*.txt rbar*.txt # again, see SM scripts in thickdisk.m for looking at this data.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># FROM makefftplot:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 1) fft1.pdf fft1.png data*fft*.txt</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># FROM makeframes:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 1) lrho*.png</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># FROM makemovie:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 1) *.avi *.mov</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># FROM makeavgplot:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># 1) fig2.png aphizoom_avg.png aphizoom_avgfield.png aphialllog_avgfield_avg.png fig4_0.png fig4_1.png dataavgvs*.txt dataavg*.txt python.plot.avg.full.out</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># NOTE: Most of the plots won&#39;t work for 2D harm data.  Indeed, some plots may hang (e.g. makethradfinalplot making of velocity mkstreamplot1).</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># Sometimes if you kill a job, you&#39;ll have stray python processes still going.  Assuming it&#39;s all you are doing with python as a user, you should do: killall -s 9 python  to get rid of them.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">## To get movie files to always be created even if you have numkeep less than number of files in makeallmovie.sh (so it skips some files), you should run:</span></div>
<div class="line"><span class="preprocessor"></span><a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> ${moviename} # or whatever to <span class="keyword">get</span> to directory, like <a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> run/test1/$moviename</div>
<div class="line">~/py/scripts/makelinkimages.sh</div>
<div class="line"><span class="preprocessor"># this will produce links so ffmpeg or avconv or other programs can see a sequential list of files that they need to act upon.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">### NOTE: At this point, one is &quot;done&quot; with python scripts called from bash scripts to make automatted stuff.  Remaining &quot;steps&quot; are alternative ways to run python or issues related to super computers.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># NOTE: If you want to run with more cores on a multi-core node, you can change numcorespernode=1 to (e.g.) numcorespernode=8 in ~/py/scripts/makemovie.sh .  Then for the make1d/makemerge qty2.npy generation phase and the makemovie phase, it will run 8X faster.  The makeplot phase where various plots are created won&#39;t take any longer or shorter with more fieldline files or more cores -- the &quot;plotting&quot; stage only takes longer if the simulation is higher resolution.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># If you want to do that, then you should probably kill the previously running python in case it&#39;s still going.  Do &quot;killall -s 9 python&quot; to kill all your python calls.  Then you can try with more cores.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># You can check &quot;top&quot; to see if it&#39;s running python.  Or look at the latest *err* or *.out files in the movie directory to see what&#39;s going on.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">8) One can run the makemovie script directly once one has already at</div>
<div class="line">least run makeallmovie with the first 1 1 1 options so that the</div>
<div class="line">test1-like directory, files, etc. are all there.  As in those scripts,</div>
<div class="line">here<span class="stringliteral">&#39;s the full raw full command assuming one set these parameters on</span></div>
<div class="line"><span class="stringliteral">the command line with typical choices for a few parameters</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">cd run/ #i.e. actually be in that run&#39;</span>s directory</div>
<div class="line">#</div>
<div class="line">thedir=`pwd`</div>
<div class="line">system=3</div>
<div class="line">parallel=0</div>
<div class="line">make1d=1</div>
<div class="line">makemerge=1</div>
<div class="line">makeplot=1</div>
<div class="line">makemontage=0</div>
<div class="line">makepowervsmplots=1</div>
<div class="line">makespacetimeplots=1</div>
<div class="line">makefftplot=1</div>
<div class="line">makespecplot=1</div>
<div class="line">makeinitfinalplot=1</div>
<div class="line">makethradfinalplot=0</div>
<div class="line">makeframes=1</div>
<div class="line">makemovie=1</div>
<div class="line">makeavg=1</div>
<div class="line">makeavgmerge=1</div>
<div class="line">makeavgplot=1</div>
<div class="line">cmdraw=<span class="stringliteral">&quot;sh makemovielocal.sh ${thedir} $make1d $makemerge $makeplot $makemontage $makepowervsmplots $makespacetimeplots $makefftplot $makespecplot $makeinitfinalplot $makethradfinalplot $makeframes $makemovie $makeavg $makeavgmerge $makeavgplot ${system} ${parallel}&quot;</span></div>
<div class="line"></div>
<div class="line"># If one is not running on a batch system or in parallel, just run it</div>
<div class="line"># as that command:</div>
<div class="line"></div>
<div class="line">$cmdraw</div>
<div class="line"></div>
<div class="line"># Otherwise, it<span class="stringliteral">&#39;s best to do (to avoid output to screen and avoiding</span></div>
<div class="line"><span class="stringliteral"># the job to die if one gets logged out):</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">rm -rf makemovielocal_${thedir}.stderr.out</span></div>
<div class="line"><span class="stringliteral">rm -rf makemovielocal_${thedir}.out</span></div>
<div class="line"><span class="stringliteral">rm -rf makemovielocal_${thedir}.full.out</span></div>
<div class="line"><span class="stringliteral">echo &quot;((nohup $cmdraw 2&gt;&amp;1 1&gt;&amp;3 | tee makemovielocal_${thedir}.stderr.out) 3&gt;&amp;1 1&gt;&amp;2 | tee makemovielocal_${thedir}.out) &gt; makemovielocal_${thedir}.full.out 2&gt;&amp;1&quot; &gt; batch_makemovielocal_${thedir}.sh</span></div>
<div class="line"><span class="stringliteral">chmod a+x ./batch_makemovielocal_${thedir}.sh</span></div>
<div class="line"><span class="stringliteral">nohup ./batch_makemovielocal_${thedir}.sh &amp;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">8b) Additional notes on running on Kraken:</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">Can use parallel=2 for optimal speed.  This uses code makemoviec instead of the bash script makemovie.sh.  One still uses the same makeallmovie.sh script/calls, but some edits may be required:</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">a) makeallmovie.sh : Change dircollect and dirruns to &quot;rad1&quot; or the name of your run/runs.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">b) makeallmovie.sh : Change numkeep to number of files want to keep, e.g., 2200</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">c) makeallmovie.sh : Ensure in system=5 kraken section have set parallel=2 .</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">d) makeallmovie.sh : Change default &quot;factor&quot; and keepfilesstart and keepfilesend if desired.  Or add entry for your model name (&quot;$thedir&quot; section in this bash script).</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">e) Ensure makemoviec can compile when doing makeallmovie.sh:</span></div>
<div class="line"><span class="stringliteral">i) cd ~/py/scripts</span></div>
<div class="line"><span class="stringliteral">ii) set #define USEPYTHON (0) in jon_makemovie_programstartc.c</span></div>
<div class="line"><span class="stringliteral">iii) make</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">f) Edit ~/py/scripts/makemovie.sh for kraken section to be how long run should be, how many cores, etc.  Can add &quot;$modelname&quot; entry for jobsuffix, needed if have multiple jobs</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">g) default is currently set to have numtasks equal to total number of field line files, so total number of cores requested is equal to total number of field line files, so fastest possible run.  However, can set numtasks directly as number of mpi processes to run, numcorespernode directly as needed for memory issues (i.e. ensure total memory on node is sufficient for whatever number of cores you run on), and the rest should be handled by the makemovie.sh script as far as setting up the chunk list passed onto the makemoviec program.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">h) </span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">i) At least edit default for kraken sections.  Set timetot, numcorespernode (which will be total cores), memtot (estimating how much memory per core needed as well as overhead), then in kraken&#39;</span>s parllel 2 section, only have to <span class="keyword">set</span> plot part.</div>
<div class="line"></div>
<div class="line">j) Edit ~/py/mread/__init__.py :</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>) Set USENAUTILUS 0</div>
<div class="line">ii) Set use2dglobal=False near end of file in <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function that primarily calls init(), diag(), and step_ch_full() in loop.">main</a>()</div>
<div class="line">ii) Probably need OLDQTYMEMMEM=0 in same location in <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function that primarily calls init(), diag(), and step_ch_full() in loop.">main</a>()</div>
<div class="line">iii) anywhere modelname exists, check if need to add new entry for your model.</div>
<div class="line"></div>
<div class="line">k) Now can run makeallmovie as above.</div>
<div class="line"></div>
<div class="line">l) I noticed Kraken used to have latex and gs installed, but now doesn&#39;<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>.  Only Nautilus has it, and Nautilus can&#39;<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a> be used anymore.  One has to, as a <a class="code" href="../../d9/d54/other6_8txt.html#ad3c086d13a326385668d92acdb4625a6">user</a>, install latex.  <a class="code" href="../../d8/d60/init_8c.html#a07484107e6d9fdf38b53edf631d6511d">E</a>.g. from http:<span class="comment">//www.tug.org/texlive/quickinstall.html .  Use wget to get the tarball for unix, follow instructions about untaring (i.e. tar xvzf ...), and run the install program in the directory created by the tarball (./install-tl).  One just changes the installation directory to be /lustre/scratch/$USER/... instead of /usr/local/...  and change installation paths to be ~/bin ~/share/man ~/share/lib . Like:</span></div>
<div class="line"></div>
<div class="line">wget http:<span class="comment">//mirror.ctan.org/systems/texlive/tlnet/install-tl-unx.tar.gz</span></div>
<div class="line">tar xvzf install-tl-unx.tar.gz</div>
<div class="line"><a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> </div>
<div class="line">./install-tl</div>
<div class="line"><span class="preprocessor"># choose paths as user paths as mentioned above.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># *must* choose /lustre/scratch/$USER/... type path, so can access on compute nodes that have no access to $HOME</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># wait 1.5-2 hours to complete download/install process.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">m) I also noticed gs is not available.  Get it from http:<span class="comment">//www.ghostscript.com/download/gsdnld.html and follow installation instructions at (e.g.) http://ghostscript.com/doc/7.07/Install.htm , like:</span></div>
<div class="line"></div>
<div class="line">#http:<span class="comment">//www.ghostscript.com/download/gsdnld.html</span></div>
<div class="line">wget http:<span class="comment">//downloads.ghostscript.com/public/binaries/ghostscript-9.10-linux-x86_64.tgz</span></div>
<div class="line">tar xvzf ghostscript-9.10-linux-x86_64.tgz</div>
<div class="line"><a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> ghostscript-9.10-linux-x86_64/</div>
<div class="line"># run it and/or link it to your home directory</div>
<div class="line"></div>
<div class="line">#or <span class="keywordflow">for</span> a general system:</div>
<div class="line">wget http:<span class="comment">//downloads.ghostscript.com/public/ghostscript-9.10.tar.gz</span></div>
<div class="line">tar xvzf ghostscript-9.10.tar.gz</div>
<div class="line"><a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> ghostscript-9.10/</div>
<div class="line">./configure --prefix=$HOME/</div>
<div class="line">make</div>
<div class="line">make install</div>
<div class="line"></div>
<div class="line"># <span class="keywordflow">for</span> gs, copy binary to /lustre/scratch/$USER/... type path, so can access on compute nodes that have no access to $HOME .</div>
<div class="line"></div>
<div class="line">Ensure environmentfiles/kraken/setuppython27 has PATH and PYTHONPATH with the path where the binary <span class="keywordflow">for</span> <span class="stringliteral">&quot;latex&quot;</span> and <span class="stringliteral">&quot;gs&quot;</span> are located.</div>
<div class="line"></div>
<div class="line">Good idea to tgz-ball the latex and gs stuff and copied to ranch so not purged.</div>
<div class="line"></div>
<div class="line">9) Going even simpler (but with less obvious ways to <span class="keyword">get</span> something to output)</div>
<div class="line">one can use python or ipython directly.</div>
<div class="line"></div>
<div class="line">cd run/</div>
<div class="line">ipython ~/py/mread/__init__.py</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># This does nothing except run through the script from top to bottom as well as run main()</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># No command line parameters were given, so &quot;runtype&quot; was not set as viewed by the script,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># so main() catches no conditionals and the script exits.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># To get a behavior like the makemovie.sh script, one manually runs python and the script</span></div>
<div class="line"><span class="preprocessor"></span>with arguments just like done by makemovie.sh (NOT RECOMMENDED -- just use makeallmovie.sh):</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> run/</div>
<div class="line">ipython</div>
<div class="line"><a class="code" href="../../d8/d5b/defs_8general_8h.html#a265d006939e69cb72ab90c31c245e543">runtype</a>=3 # see <a class="code" href="../../d8/df4/global_8funcdeclare_8h.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function that primarily calls init(), diag(), and step_ch_full() in loop.">main</a>() or makemovie.sh for runtype and what it means and what other parameters need to be passed.</div>
<div class="line">run ~/py/mread/__init__.py $runtype $modelname $makepowervsmplots $makespacetimeplots $makefftplot $makespecplot $makeinitfinalplot $makethradfinalplot</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># To use the script in an interactive mode, instead run it without</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># arguments.  One manually sets those functions run globally during</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># the script processing.  This includes the functions</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># &quot;runglobalsetup()&quot; and &quot;main()&quot;.  But, the python script relies upon</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># command line arguments explicitly, so this is used to do</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># stuff *NOT* done by makeallmovie.sh or makemovie.sh, like</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># calling the script&#39;s more internal functions that don&#39;t use argv.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># E.g.:</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> run/</div>
<div class="line">ipython</div>
<div class="line">run ~/py/mread/__init__.py</div>
<div class="line"><span class="preprocessor"># now run a tutorial:</span></div>
<div class="line"><span class="preprocessor"></span>tutorial1()</div>
<div class="line"><span class="preprocessor"># see how lrho is plotted.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># See also the short tutorial at the end of main() as runtype==8.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># NOTE: One can&#39;t run certain functions on the command line because</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># variables lose scope immediately, even if chosen to be global in the</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># function itself.  So best to create a script file separately</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># (i.e. not inside the base __init__.py) that can contain the same</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># type of lines as tutorial1() and &quot;run&quot; your script file and then</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># call your function.  So the command sequence would look like:</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><a class="code" href="../../d9/d54/other6_8txt.html#abea40877aa2ce569e5f9e3a264872b54">cd</a> run/</div>
<div class="line">ipython</div>
<div class="line">run ~/py/mread/__init__.py</div>
<div class="line">run ~/py/myscript.py</div>
<div class="line">mytut1()</div>
<div class="line"></div>
<div class="line">10) To modify the python script:</div>
<div class="line"></div>
<div class="line">There are three modes you can operate in.</div>
<div class="line"></div>
<div class="line">Mode 1) insert code during run of normal scripts</div>
<div class="line"></div>
<div class="line">Mode 2) command-line use of ipython</div>
<div class="line"></div>
<div class="line">Mode 3) New <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>-r integrated diagnostic</div>
<div class="line"></div>
<div class="line">The advantage of #1 is you can eventually compute lots of things and</div>
<div class="line">output whatever you want.  The advantage of #2 is you can more easily</div>
<div class="line">play around and you don<span class="stringliteral">&#39;t have to have all the other script things</span></div>
<div class="line"><span class="stringliteral">going on.  I recommend Mode 2 for now until you know exactly what you</span></div>
<div class="line"><span class="stringliteral">are doing and what kind of diagnostic you want.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">Mode 3 is an advanced version of Mode 1 when you know exactly what you want to have as a diagnostic.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">===</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">For Mode 1: The best place to insert such calculations is in function</span></div>
<div class="line"><span class="stringliteral">getqtyvstime() near the top (it&#39;</span>s a <span class="keywordtype">long</span> <span class="keyword">function</span>) and just after:</div>
<div class="line"></div>
<div class="line">======</div>
<div class="line">ts[qindex]=<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a></div>
<div class="line">        #################################</div>
<div class="line">        #</div>
<div class="line">        # Begin quantities</div>
<div class="line">        #</div>
<div class="line">        ##################################</div>
<div class="line">        #</div>
<div class="line"></div>
<div class="line">#&lt;INSERT FUNCTION CALL HERE&gt;</div>
<div class="line">#e.g.</div>
<div class="line">sgralla1()</div>
<div class="line"></div>
<div class="line">======</div>
<div class="line">Then you create a <span class="keyword">function</span> (say at bottom of the __init__.py file) that has:</div>
<div class="line"></div>
<div class="line">def sgralla1():</div>
<div class="line"><span class="preprocessor">    #1) verify that B_z=const asymptotically (my definition of Wald problem)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #2) compute the energy and angular momentum flux</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #3) understand where the current sheet forms and what supports it numerically</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #4) compute B_phi/E_r asymptotically, which I believe will be 1</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #5) fit for psi where E_r = partial_r psi</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">======</div>
<div class="line">e.g.</div>
<div class="line">            sigmaks=r**2+(a*np.cos(h))**2</div>
<div class="line">            deltaks=r**2-2*r+a**2</div>
<div class="line">            Aks=(r**2+a**2)**2-a**2*deltaks*(np.sin(h))**2</div>
<div class="line">            #</div>
<div class="line">            gvks00=-(1.0-2.0*r/sigmaks)</div>
<div class="line">            gvks11=(1.0+2.0*r/sigmaks)</div>
<div class="line">            gvks22=sigmaks</div>
<div class="line">            gvks33=(np.sin(h))**2*(sigmaks + a**2*(1.0 + 2.0*r/sigmaks)*(np.sin(h))**2)</div>
<div class="line">            <span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span>            myuu0=uu[0]*<a class="code" href="../../dc/dd2/newcodediff_8txt.html#a9a663b46497bd8f1608c548396d23320">dxdxp</a>[0,0]</div>
<div class="line">            myuu1=(uu[1]*dxdxp[1,1] + uu[2]*dxdxp[1,2])*np.sqrt(gvks11)/myuu0</div>
<div class="line">            myuu2=(uu[1]*dxdxp[2,1] + uu[2]*dxdxp[2,2])*np.sqrt(gvks22)/myuu0</div>
<div class="line">            myuu3=(uu[3]*dxdxp[3,3])*np.sqrt(gvks33)/myuu0</div>
<div class="line">            myuurot=np.sqrt(myuu2**2+myuu3**2)</div>
<div class="line">            myB1=(B[1]*dxdxp[1,1] + B[2]*dxdxp[1,2])*np.sqrt(gvks11)</div>
<div class="line">            myB2=(B[1]*dxdxp[2,1] + B[2]*dxdxp[2,2])*np.sqrt(gvks22)</div>
<div class="line">            myB3=(B[3]*dxdxp[3,3])*np.sqrt(gvks33)</div>
<div class="line">            mybu1=(bu[1]*dxdxp[1,1] + bu[2]*dxdxp[1,2])*np.sqrt(gvks11)</div>
<div class="line">            mybu2=(bu[1]*dxdxp[2,1] + bu[2]*dxdxp[2,2])*np.sqrt(gvks22)</div>
<div class="line">            mybu3=(bu[3]*dxdxp[3,3])*np.sqrt(gvks33)</div>
<div class="line"><span class="preprocessor">            #</span></div>
<div class="line"><span class="preprocessor"></span>            sgrallaB1=myB1[:,ny/2,0]</div>
<div class="line">            print(<span class="stringliteral">&quot;sgrallaB1&quot;</span>);</div>
<div class="line">            print(sgrallaB1);</div>
<div class="line"><span class="preprocessor">            #</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">======</div>
<div class="line"></div>
<div class="line">For Mode2:</div>
<div class="line"></div>
<div class="line">Just look at some functions like harmradplot?() at the bottom of the</div>
<div class="line">script, like harmradplot1().  You can also look at the tutorial?() and</div>
<div class="line">tutorial1alt() calls.</div>
<div class="line"></div>
<div class="line">Create your own function sg1() that looks similar and sits within the</div>
<div class="line">same file at the bottom.  Then follow the template and compute</div>
<div class="line">whatever you want, and you can plot something or save a figure or</div>
<div class="line">anything like that.  To run on command line, you do:</div>
<div class="line"></div>
<div class="line">ipython</div>
<div class="line">run ~/py/mread/__init__.py</div>
<div class="line">sg1()</div>
<div class="line"></div>
<div class="line">To change something in Mode2, you can stay in ipython.  Just edit the</div>
<div class="line">script and your function in a different terminal, then rerun by doing:</div>
<div class="line"></div>
<div class="line">run ~/py/mread/__init__.py</div>
<div class="line">sg1()</div>
<div class="line"></div>
<div class="line">The &quot;run&quot; line just loads the script again.</div>
<div class="line"></div>
<div class="line">========</div>
<div class="line"></div>
<div class="line">For Mode3:</div>
<div class="line"></div>
<div class="line">Follow Mode1, but hijack existing quantities stored in hoverr[qindex]</div>
<div class="line">or other &lt;quantity&gt;[qindex] that you think you don&#39;<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a> need.</div>
<div class="line"></div>
<div class="line">========</div>
<div class="line"></div>
<div class="line">For Mode 4:</div>
<div class="line"></div>
<div class="line">To add a new <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>-r integrated quantity, do:</div>
<div class="line"></div>
<div class="line">1) add entry to getqtymem() like the below, at the end of the function before the &quot;return(<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>) call.</div>
<div class="line"></div>
<div class="line">    global     newvar</div>
<div class="line">    newvar=qtymem[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];i+=1</div>
<div class="line"></div>
<div class="line">2) Inside getqtyvstime(), add your calculation before the &quot;if dobob==1:&quot; line with lots of qtymem&#39;s inside the conditional.</div>
<div class="line"></div>
<div class="line">3) add 1 to the getnonbobnqty() setting of &quot;value&quot; before &quot;return(value)&quot;</div>
<div class="line"></div>
<div class="line">To add a new time-averaged quantity, do:</div>
<div class="line"></div>
<div class="line">1) add item to assignavg2dvars() after the last avgmem assignment and put like (for scalar)</div>
<div class="line"></div>
<div class="line">avg_newvar=avgmem[i,:,:,None];i+=1 <span class="preprocessor"># i=1</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">(<span class="keywordflow">for</span> tensor):</div>
<div class="line"></div>
<div class="line">n=16</div>
<div class="line">avg_newtensor=avgmem[i:i+n,:,:,None].reshape((4,4,nx,ny,1));i+=n</div>
<div class="line"></div>
<div class="line">2) add avg_newvar or avg_newtensor to global declaration at top of assignavg2dvars()</div>
<div class="line"></div>
<div class="line">3) add avg_newvar or avg_newtensor to global declaration at top of get2davgone()</div>
<div class="line"></div>
<div class="line">4) In get2davgone() <span class="keyword">function</span> inside loop after last avg_&lt;var&gt; += assignment, <span class="keywordflow">do</span> like (scalar) before the &quot;itert=itert+1&quot;</div>
<div class="line"></div>
<div class="line">        n=1</div>
<div class="line">        newvar = newvarface()</div>
<div class="line">        avg_newvar += ((_dx3*newvar.sum(-1))**2)[:,:,None]*localdt[itert]</div>
<div class="line"></div>
<div class="line">5) add 1 to the getnqtyavg() value before the &quot;return(value)&quot;</div>
<div class="line"></div>
<div class="line">11) Some notes about functions in tutorial?() or harmradplot?() functions:</div>
<div class="line"></div>
<div class="line">functions (see script for arguments to each function):</div>
<div class="line">rfd(): loads field line file</div>
<div class="line">grid3d(): loads grid positions, metric, connection coefficients, etc.</div>
<div class="line">getrhouclean(): Get clean (floor removed) versions of densities in case wanted.</div>
<div class="line">cvel(): compute some velocity-field related things</div>
<div class="line">Tcalcud(): Compute various stress-energy tensor terms/components/etc.</div>
<div class="line">faraday(): compute fdd and fuu, the F^{\mu\nu} and F_{\mu\nu} faradays as well as omegaf<span class="stringliteral">&#39;s, like the generalized omegaf1b that works for any poloidal field orientation.</span></div>
<div class="line"><span class="stringliteral">fieldcalc(): computes A_\phi</span></div>
<div class="line"><span class="stringliteral">iofreq(): get i for a given radius along the equator</span></div>
<div class="line"><span class="stringliteral">iofrpole(): get i for a given radius along the polar axis</span></div>
<div class="line"><span class="stringliteral">jofh(): get j for a given h = \theta</span></div>
<div class="line"><span class="stringliteral">kofph(): get k for a given ph = \phi</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">common things loaded/computed by rfd() or grid3d():</span></div>
<div class="line"><span class="stringliteral">r: radius</span></div>
<div class="line"><span class="stringliteral">h: \theta</span></div>
<div class="line"><span class="stringliteral">ph: \phi</span></div>
<div class="line"><span class="stringliteral">rho: rest-mass density</span></div>
<div class="line"><span class="stringliteral">ug: internal energy density</span></div>
<div class="line"><span class="stringliteral">uu[0-4]: fluid frame: u^\mu</span></div>
<div class="line"><span class="stringliteral">ud[0-4]: fluid frame: u_\mu</span></div>
<div class="line"><span class="stringliteral">B[1-3]: *F^{it}</span></div>
<div class="line"><span class="stringliteral">bu[0-4]: comoving field: b^\mu</span></div>
<div class="line"><span class="stringliteral">bd[0-4]: comoving field: b_\mu</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">t: time</span></div>
<div class="line"><span class="stringliteral">nx,ny,nz: number of cells in the radius,\theta,\phi directions</span></div>
<div class="line"><span class="stringliteral">a: spin</span></div>
<div class="line"><span class="stringliteral">rhor: horizon radius</span></div>
<div class="line"><span class="stringliteral">Rin: Inner grid radius</span></div>
<div class="line"><span class="stringliteral">Rout: Outer grid radius</span></div>
<div class="line"><span class="stringliteral">THETAROT: BH tilt</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">ti,tj,tk: index position of grid cell in radius,\theta,\phi directions</span></div>
<div class="line"><span class="stringliteral">x1,x2,x3: internal cell positions</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">========</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">Remember python is space-based (instead of curly bracket based like</span></div>
<div class="line"><span class="stringliteral">C), and code that matches in indention is at same level/scope.</span></div>
</div><!-- fragment --> 
<p>Definition in file <a class="el" href="../../d1/ddd/general__plotting__guide_8txt_source.html">general_plotting_guide.txt</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:36 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
