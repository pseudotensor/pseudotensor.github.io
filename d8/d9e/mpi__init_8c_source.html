<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>HARM: mpi_init.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HARM
   </div>
   <div id="projectbrief">harm and utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mpi_init.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d8/d9e/mpi__init_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;decs.h&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keywordtype">int</span> init_MPI_general(<span class="keywordtype">int</span> *argc, <span class="keywordtype">char</span> **argv[])</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;{</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">int</span> ierr;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">int</span> provided,required=MPI_THREAD_MULTIPLE;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="comment">// lonestar4 locked-up here for some reason.   Had to set USEOPENMP-&gt;0 in makehead.inc.  Ranger was fine with openmp, but wasn&#39;t using openmp with lonestar3 with production runs, so unsure what situation is.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  ierr=MPI_Init_thread(argc, argv,required,&amp;provided);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  stderrfprintf(<span class="stringliteral">&quot;Using MPI_Init_thread with required=%d and provided=%d\n&quot;</span>,required,provided);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor"></span>  stderrfprintf( <span class="stringliteral">&quot;Begin: MPI_Init\n&quot;</span>); fflush(stderr);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  ierr=MPI_Init(argc, argv);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  stderrfprintf( <span class="stringliteral">&quot;End: MPI_Init\n&quot;</span>); fflush(stderr);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span>(ierr!=0){</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;MPI Error during MPI_Init\n&quot;</span>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    exit(1);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  MPI_Comm_size(MPI_COMM_WORLD, &amp;<a class="code" href="../../dd/d46/mpidefs_8h.html#a1c9efb2d71bf0c79908cb56124f3e412">truenumprocs</a>); <span class="comment">// WORLD total number of processors</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  MPI_Comm_rank(MPI_COMM_WORLD, &amp;myid_world); <span class="comment">// WORLD proc id</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  MPI_Get_processor_name(processor_name, &amp;<a class="code" href="../../dd/d46/mpidefs_8h.html#a6905a8884f65ce427031a3dfbfd409e4">procnamelen</a>); <span class="comment">// to ensure really on certain nodes</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  stderrfprintf( <span class="stringliteral">&quot;WORLD proc: %d of %d on %s\n&quot;</span>, myid_world,<a class="code" href="../../dd/d46/mpidefs_8h.html#a1c9efb2d71bf0c79908cb56124f3e412">truenumprocs</a>,processor_name);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  stderrfprintf( <span class="stringliteral">&quot;end: init_MPI\n&quot;</span>);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  fflush(stderr);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../dd/d46/mpidefs_8h.html#a1c9efb2d71bf0c79908cb56124f3e412">truenumprocs</a>=1;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  myid=0;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  myid_world=0;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">// allocate things that are truenumprocs in size</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  MPIid=(<span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*<a class="code" href="../../dd/d46/mpidefs_8h.html#a1c9efb2d71bf0c79908cb56124f3e412">truenumprocs</a>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span>(MPIid==NULL){</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;Problem allocating memory for MPIid with truenumprocs=%d\n&quot;</span>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a1c9efb2d71bf0c79908cb56124f3e412">truenumprocs</a>); fflush(stderr);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    myexit(679438212);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#ad4a94f4b96d7569f1f33bdfbd29077de">   74</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/d9e/mpi__init_8c.html#ad4a94f4b96d7569f1f33bdfbd29077de" title="general initialization for OpenMP Nothing required before user arguments read-in setting number of th...">init_OPENMP_general</a>(FILE *out)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;{</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// nothing to do for OpenMP so far</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a4b0a616c11950c040cbe768834c674f6">   87</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/d9e/mpi__init_8c.html#a4b0a616c11950c040cbe768834c674f6" title="general initialization for OpenMP Nothing required before user arguments read-in setting number of th...">init_OPENMP_sets_fromargs</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor"></span>  <span class="comment">// Set number of threads either from initialization somehow or from user arguments that set numopenmpthreads variable</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>!=<a class="code" href="../../dd/d46/mpidefs_8h.html#af305d5203d4e80d6e1c7542125aa2506">numopenmpthreadsorig</a>) omp_set_num_threads(<a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="keywordtype">void</span> init_MPI_setupfilesandgrid(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;{</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">int</span> size;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// choose to combine files or not</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(USEMPI){</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a4242e6dd75844f241d042e8f43c404e8">mpicombine</a> = 1;    <span class="comment">// choice</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">//mpicombine=0;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// </span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a4242e6dd75844f241d042e8f43c404e8">mpicombine</a>){</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a125da10d4f20cf53facb2a408fdc3f52">USEROMIO</a>==0){</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment">// choice</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#aeea3c92b1852b95e378a0256e0d7d9d6">sortedoutput</a>==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ac0732fd72573f5fa69a9ef066ef63f65">SORTED</a>) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a242111ff46bde86789e819eccbb97e69">mpicombinetype</a>=MPICOMBINEMINMEM;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#aeea3c92b1852b95e378a0256e0d7d9d6">sortedoutput</a>==<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a96d713e213dcfe22f6f8c69c46a4495e">UNSORTED</a>) <a class="code" href="../../d8/d5b/defs_8general_8h.html#a242111ff46bde86789e819eccbb97e69">mpicombinetype</a>=MPICOMBINESIMPLE; <span class="comment">//forced to happen since no unsorted method for the advanced combine technique</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">//mpicombinetype=MPICOMBINESIMPLE; // forced for testing</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordflow">else</span> <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0abd0cbd4574982f7d9345d09119d7cd">truempicombinetype</a>=<a class="code" href="../../d8/d5b/defs_8general_8h.html#a242111ff46bde86789e819eccbb97e69">mpicombinetype</a>=MPICOMBINEROMIO;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// no choice</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a4242e6dd75844f241d042e8f43c404e8">mpicombine</a> = 0;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// Setup files and grid information</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// always done</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// after below can use dualfprintf, and trifprintf, etc.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="../../d8/d9e/mpi__init_8c.html#a172cf9f659c913421ba44c47305f032e">init_genfiles</a>(0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// after below, can access intra-CPU MPI related setup (all but boundary (i.e. inter-CPU MPI related) stuff)</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  init_placeongrid_gridlocation();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">// Some MPI type size checks</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor"></span>  </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(CTYPE)==<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)){</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    MPI_Type_size(MPI_LONG_LONG_INT,&amp;size);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span>(size!=8){</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;size of the long long int in MPI=%d, should be 8\n&quot;</span>,size);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      myexit(1000);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">if</span>((<span class="keyword">sizeof</span>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#acb9fa7b753f0c2d1d029ddd86ad04331" title="fundamental to set real type&#39;s for variables define your user type here (normal non-sensitive or perf...">REALTYPE</a>)==<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">double</span>))||(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/df4/global_8realdef_8h.html#a1df4ff7337c70fd414bdb050e2344649" title="(non-perf critical or sensitive data types)">SENSITIVE</a>)==<span class="keyword">sizeof</span>(<span class="keywordtype">long</span> <span class="keywordtype">double</span>))){</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    MPI_Type_size(MPI_LONG_DOUBLE,&amp;size);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span>(size!=16){</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;size of the long double in MPI=%d, should be 16\n&quot;</span>,size);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      myexit(1000);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  trifprintf(<span class="stringliteral">&quot;done with init_MPI_setupfilesandgrid()\n&quot;</span>);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keywordtype">void</span> myargs(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;{</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordtype">int</span> argi,numargs,numextraargs;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// default:</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a> = 1;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a> = 1;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a> = 1;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="comment">// default unless user adds below</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  numextraargs=2;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a00bdeb72a08e745eb0a5482af9e8cb74">RESTARTMODE</a>=0;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a8b72d2f050a5b88382fed7121a35207f">WHICHFILE</a>=0;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">if</span>(USEMPI &amp;&amp; <a class="code" href="../../d3/d67/global_8general_8h.html#a126b8328170a52811a990e5dd302f783">USEOPENMP</a>){</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    numargs=1+3+1;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span>(! (argc==numargs || argc==numargs+numextraargs) ){</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : Incorrect command line: argc: %d needed at least=%d, please specify:\n&quot;</span>,myid,argc,numargs);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : mpirun &lt;mpirunoptions&gt; &lt;progname&gt; numopenmpithreads ncpux1 ncpux2 ncpux3\n&quot;</span>,myid);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : OR\n&quot;</span>,myid);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : mpirun &lt;mpirunoptions&gt; &lt;progname&gt; numopenmpithreads ncpux1 ncpux2 ncpux3 RESTARTMODE WHICHFILE\n&quot;</span>,myid);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      exit(1);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    argi=1;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(USEMPI){</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    numargs=1+3;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span>(! (argc==numargs || argc==numargs+numextraargs) ){</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : Incorrect command line: argc: %d needed at least=%d, please specify:\n&quot;</span>,myid,argc,numargs);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : mpirun &lt;mpirunoptions&gt; &lt;progname&gt; ncpux1 ncpux2 ncpux3\n&quot;</span>,myid);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : OR\n&quot;</span>,myid);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : mpirun &lt;mpirunoptions&gt; &lt;progname&gt; ncpux1 ncpux2 ncpux3 RESTARTMODE WHICHFILE\n&quot;</span>,myid);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      exit(1);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    argi=1;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d3/d67/global_8general_8h.html#a126b8328170a52811a990e5dd302f783">USEOPENMP</a>){</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    numargs=1+1;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span>(! (argc==numargs || argc==numargs+numextraargs) ){</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : Incorrect command line: argc: %d needed at least=%d, please specify:\n&quot;</span>,myid,argc,numargs);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : mpirun &lt;mpirunoptions&gt; &lt;progname&gt; numopenmpthreads\n&quot;</span>,myid);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : OR\n&quot;</span>,myid);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;proc: %04d : mpirun &lt;mpirunoptions&gt; &lt;progname&gt; numopenmpthreads RESTARTMODE WHICHFILE\n&quot;</span>,myid);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      exit(1);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    argi=1;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    numargs=1;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span>(! (argc==numargs || argc==numargs+numextraargs) ){</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;&lt;progname&gt;\n&quot;</span>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;OR\n&quot;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        stderrfprintf(<span class="stringliteral">&quot;&lt;progname&gt; RESTARTMODE WHICHFILE\n&quot;</span>);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      exit(1);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }<span class="comment">// end if single CPU mode</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// get user-defined restart options</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span>(argc==numargs+numextraargs){</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a00bdeb72a08e745eb0a5482af9e8cb74">RESTARTMODE</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="../../d8/d5b/defs_8general_8h.html#a8b72d2f050a5b88382fed7121a35207f">WHICHFILE</a>=atoi(argv[argi++]);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// no failure variables inputted at run-time, since have to recompile anyways for failure tracking</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// General checks (that work if MPI or OpenMP not used)</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>&gt;1 &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>==1){</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;Cannot have ncpux1=%d&gt;N1=%d\n&quot;</span>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    exit(1);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>&gt;1 &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>==1){</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;Cannot have ncpux2=%d&gt;N2=%d\n&quot;</span>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    exit(1);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>&gt;1 &amp;&amp; <a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>==1){</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;Cannot have ncpux3=%d&gt;N3=%d\n&quot;</span>,<a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>,<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    exit(1);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>&gt;<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*<a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>) stderrfprintf(<span class="stringliteral">&quot;OpenMP threads (%d) larger than total number of points (%d), so parallelization will be poor\n&quot;</span>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>*<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>*N3);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// get total number of processors</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span>  <a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a> = <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>*<a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// test</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span>(sizeproclist_grmhd!=<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>){</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;Got (sizeproclist_grmhd=%d) != (numprocs=ncpux1*ncpux2*ncpux3=%d). ncpux1=%d ncpux2=%d ncpux3=%d.  Did you run without mpirun?\n&quot;</span>,sizeproclist_grmhd,<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>,ncpux3);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    exit(1);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  myfprintf(stderr,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="stringliteral">&quot;numprocs=%d ncpux1=%d ncpux2=%d ncpux3=%d numopenmpthreads=%d :: percpusize: N1=%d N2=%d N3=%d\n&quot;</span>,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>, <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>, <a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>, ncpux3, <a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>, <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>, <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>,N3);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno"><a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a172cf9f659c913421ba44c47305f032e">  334</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/d9e/mpi__init_8c.html#a172cf9f659c913421ba44c47305f032e">init_genfiles</a>(<span class="keywordtype">int</span> gopp)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;{</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordtype">char</span> temps[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0947c0a3d28c188caa4497cce08539c9" title="maximum char size of filenames or directories or commands">MAXFILENAME</a>];</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordtype">char</span> extension[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0947c0a3d28c188caa4497cce08539c9" title="maximum char size of filenames or directories or commands">MAXFILENAME</a>];</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordtype">char</span> binarytype[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0947c0a3d28c188caa4497cce08539c9" title="maximum char size of filenames or directories or commands">MAXFILENAME</a>];</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d8/d9e/mpi__init_8c.html#a0dfd77e29b6564252a5b13e511c1d68e">set_binarytype</a>(<span class="keywordtype">char</span> *binarytype);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  stderrfprintf( <span class="stringliteral">&quot;begin: init_genfiles ... &quot;</span>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  fflush(stderr);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (gopp == 1) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    strcpy(extension, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a45b4a1e8312cc6a5081a70f99a2edeac">PPEXT</a>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gopp == 0) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    strcpy(extension, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7e5f4b6a01c8bfc80f4b47342b4e4b5c">OUTEXT</a>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// always have fail and general log open</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>&lt;=2 &amp;&amp; myid==0 || <a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>&lt;=1){</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    sprintf(temps, <span class="stringliteral">&quot;%s0_fail%s%s&quot;</span>, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>, extension, myidtxt);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a> = fopen(temps, <span class="stringliteral">&quot;at&quot;</span>)) == NULL) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;fail: Cannot open: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      exit(1);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;opened: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>&lt;=2 &amp;&amp; myid==0 || <a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>&lt;=1){</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    sprintf(temps, <span class="stringliteral">&quot;%s0_log%s%s&quot;</span>, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>, extension, myidtxt);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a> = fopen(temps, <span class="stringliteral">&quot;at&quot;</span>)) == NULL) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;log: Cannot open: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      exit(1);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;opened: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    fprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>, <span class="stringliteral">&quot;fail_file: %d log_file: %d\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            (<span class="keywordtype">int</span>)<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    fflush(log_file);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>&lt;=2 &amp;&amp; myid==0 || <a class="code" href="../../da/d3e/definit_8h.html#a6fc838c14c5e9fc17d6d8bb3d868ec2f">PRODUCTION</a>&lt;=1){</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    sprintf(temps, <span class="stringliteral">&quot;%s0_logdt%s%s&quot;</span>, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>, extension, myidtxt);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5b/defs_8general_8h.html#aedac07aaaa80e2d5e281d5ba89bab5c4">logdt_file</a> = fopen(temps, <span class="stringliteral">&quot;at&quot;</span>)) == NULL) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;logdt: Cannot open: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      exit(1);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;opened: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    fflush(<a class="code" href="../../d8/d5b/defs_8general_8h.html#aedac07aaaa80e2d5e281d5ba89bab5c4">logdt_file</a>);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (myid == 0) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="../../d8/d9e/mpi__init_8c.html#a0dfd77e29b6564252a5b13e511c1d68e">set_binarytype</a>(binarytype);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    sprintf(temps, <span class="stringliteral">&quot;%s0_logfull%s%s&quot;</span>, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>, binarytype, extension);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa5d0f5183b267927d3eb00692224be5b">logfull_file</a> = fopen(temps, <span class="stringliteral">&quot;at&quot;</span>)) == NULL) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;logfull: Cannot open: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      exit(1);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;opened: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    fprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa5d0f5183b267927d3eb00692224be5b">logfull_file</a>, <span class="stringliteral">&quot;logfull_file: %d \n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa5d0f5183b267927d3eb00692224be5b">logfull_file</a>);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    fflush(logfull_file);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    sprintf(temps, <span class="stringliteral">&quot;%s0_logdtfull%s%s&quot;</span>, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>, binarytype, extension);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5b/defs_8general_8h.html#af8c64feddf49f46e69f9b77c090eae90">logdtfull_file</a> = fopen(temps, <span class="stringliteral">&quot;at&quot;</span>)) == NULL) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;logdtfull: Cannot open: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      exit(1);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;opened: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    fprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#af8c64feddf49f46e69f9b77c090eae90">logdtfull_file</a>, <span class="stringliteral">&quot;logdtfull_file: %d \n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="../../d8/d5b/defs_8general_8h.html#af8c64feddf49f46e69f9b77c090eae90">logdtfull_file</a>);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    fflush(logdtfull_file);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    sprintf(temps, <span class="stringliteral">&quot;%s0_logstep%s%s&quot;</span>, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>, binarytype, extension);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5b/defs_8general_8h.html#a61ff33df8fb8854da16b01782b8830ef">logstep_file</a> = fopen(temps, <span class="stringliteral">&quot;at&quot;</span>)) == NULL) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;logstep: Cannot open: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      exit(1);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;opened: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    sprintf(temps, <span class="stringliteral">&quot;%s0_logperf%s%s&quot;</span>, <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17897dbbc6ff46c90212d087f60f38c4" title="#define DATADIR &quot;./&quot;">DATADIR</a>, binarytype, extension);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae8dd4882429a050b93075e9ef68eabdf">logperf_file</a> = fopen(temps, <span class="stringliteral">&quot;at&quot;</span>)) == NULL) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;logperf: Cannot open: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      exit(1);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;opened: %s\n&quot;</span>, temps);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// ok now</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  trifprintf(<span class="stringliteral">&quot;end: init_genfiles\n&quot;</span>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno"><a class="code" href="../../d8/d9e/mpi__init_8c.html#a0dfd77e29b6564252a5b13e511c1d68e">  438</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/d9e/mpi__init_8c.html#a0dfd77e29b6564252a5b13e511c1d68e">set_binarytype</a>(<span class="keywordtype">char</span> *binarytype)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;{</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d0/dcc/global_8grmhd_8h.html#a57062121f1caef3c893a8f28eb924b39">DOINGGRMHDTYPECODE</a>){</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    sprintf(binarytype,<span class="stringliteral">&quot;.grmhd&quot;</span>);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d0/dcc/global_8grmhd_8h.html#a58def338ff955d374c70ace44bbe0d7a">DOINGGRRAYTYPECODE</a>){</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    sprintf(binarytype,<span class="stringliteral">&quot;.grray&quot;</span>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d0/dcc/global_8grmhd_8h.html#aec54efcba0b46100befb15a1c2c048a9">DOINGLIAISONTYPECODE</a>){</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    sprintf(binarytype,<span class="stringliteral">&quot;.liaison&quot;</span>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordtype">void</span> set_primgridpos(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;{</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">int</span> dir,pl,pliter;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// all centered</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af276566d52b9239d67b094c949e15889" title="loop over directions">DIRLOOP</a>(dir) <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2eddd9ab5ac3f8f5a8a8b62288b76f89">BOUNDPRIMTYPE</a>][dir][pl]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a2d92d15a373d4e19c816cf1e631d4a">BOUNDPRIMSIMPLETYPE</a>][dir][pl]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// pstag (centered except along dir)</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af276566d52b9239d67b094c949e15889" title="loop over directions">DIRLOOP</a>(dir) <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl){</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;       ((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>) &amp;&amp; pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;       ||((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>) &amp;&amp; pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;       ||((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>) &amp;&amp; pl==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;       ){</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a27c72ab7c1aed0da90fe96a0c6c3ac36">BOUNDPSTAGTYPE</a>][dir][pl]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae8250514c2a764de11180b30e6ee2a67">BOUNDPSTAGSIMPLETYPE</a>][dir][pl]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a27c72ab7c1aed0da90fe96a0c6c3ac36">BOUNDPSTAGTYPE</a>][dir][pl]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae8250514c2a764de11180b30e6ee2a67">BOUNDPSTAGSIMPLETYPE</a>][dir][pl]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">// all staggered (since F1 along dir=1, etc.)</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af276566d52b9239d67b094c949e15889" title="loop over directions">DIRLOOP</a>(dir) <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a435fa02094f996d08cfc56b1290c1de2">BOUNDFLUXTYPE</a>][dir][pl]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e0d0172132d3c2316bbacd5a577b1c0">BOUNDFLUXSIMPLETYPE</a>][dir][pl]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// vpot (centered except along perp to dir for A_i)</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af276566d52b9239d67b094c949e15889" title="loop over directions">DIRLOOP</a>(dir) <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(pl){</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;       ((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>) &amp;&amp; pl==1)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;       ||((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>) &amp;&amp; pl==2)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;       ||((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a> || dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>) &amp;&amp; pl==3)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;       ){</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2a10dbc87550637eb2582e022436108d">BOUNDVPOTTYPE</a>][dir][pl]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5e5da02b8601cef68e1ed99bf49a52b4">BOUNDVPOTSIMPLETYPE</a>][dir][pl]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2a10dbc87550637eb2582e022436108d">BOUNDVPOTTYPE</a>][dir][pl]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5e5da02b8601cef68e1ed99bf49a52b4">BOUNDVPOTSIMPLETYPE</a>][dir][pl]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">// all centered</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#af276566d52b9239d67b094c949e15889" title="loop over directions">DIRLOOP</a>(dir) <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../dd/d46/mpidefs_8h.html#a2efa20f4b2cd01bd974bcf4ecd6dd20e">primgridpos</a>[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2df7b4dfa08af2809ff7293c3f6645bd">BOUNDINTTYPE</a>][dir][pl]=CENTGRID;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;}</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordtype">void</span> init_placeongrid_gridlocation(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;{</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="comment">// 3&#39;s were COMPDIM, but below code is fixed to require all 3 now</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, m, l;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordtype">int</span> N[3 + 1];</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  trifprintf(<span class="stringliteral">&quot;begin: init_placeongrid_gridlocation ... &quot;</span>);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="comment">// Set CPU and grid size information</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"></span>  N[1] = <a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  N[2] = <a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  N[3] = <a class="code" href="../../da/d3e/definit_8h.html#ad66109fbdc4d3adc9c3d6ff917038aef">N3</a>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a25cd7915937cbf7e22a43eeb0b1f57b8">numbercpu</a>[1] = <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a25cd7915937cbf7e22a43eeb0b1f57b8">numbercpu</a>[2] = <a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <a class="code" href="../../d8/d5b/defs_8general_8h.html#a25cd7915937cbf7e22a43eeb0b1f57b8">numbercpu</a>[3] = <a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]=myid%<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]=(int)((myid%(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>))/<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]=(int)(myid/(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*ncpux2));</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">for</span> (m = 1; m &lt;= <a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>; m++) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[m] = <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[m] * N[m];</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#ac8b652271c49f5695b50d1345f350176">endpos</a>[m] = (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[m] + 1) * N[m] - 1;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// add up sizes for total size of grid</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[m] = 0;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a56ae6ba5398c7fcfdb35e2ea9e95cf7f">itotalsize</a>[m] = 0;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d8/d5b/defs_8general_8h.html#a25cd7915937cbf7e22a43eeb0b1f57b8">numbercpu</a>[m]; i++) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[m] += N[m];</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a56ae6ba5398c7fcfdb35e2ea9e95cf7f">itotalsize</a>[m] += N[m];</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordflow">for</span>(m=1;m&lt;=<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>;m++){</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="../../dd/d46/mpidefs_8h.html#a32538d9467c2d5bdd53a1e971bfe5082">mycpupos0</a>[m]=(<span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>))==NULL){</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate mycpupos0[%d]\n&quot;</span>,m);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      myexit(2845725);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[m]=(<span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>))==NULL){</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate startpos0[%d]\n&quot;</span>,m);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      myexit(2845726);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[m]=(<span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*numprocs))==NULL){</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;can&#39;t allocate endpos0[%d]\n&quot;</span>,m);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      myexit(2845727);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">// for cpu=0 as master to rest, needs this info</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a32538d9467c2d5bdd53a1e971bfe5082">mycpupos0</a>[1][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=i%<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a32538d9467c2d5bdd53a1e971bfe5082">mycpupos0</a>[2][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=(int)((i%(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*ncpux2))/<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <a class="code" href="../../dd/d46/mpidefs_8h.html#a32538d9467c2d5bdd53a1e971bfe5082">mycpupos0</a>[3][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>]=(int)(i/(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>*ncpux2));</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">for</span> (m = 1; m &lt;= <a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>; m++) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a5983fafcb153424b47926602970cfa99">startpos0</a>[m][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = <a class="code" href="../../dd/d46/mpidefs_8h.html#a32538d9467c2d5bdd53a1e971bfe5082">mycpupos0</a>[m][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] * N[m];</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a8c0077c95224da7db94081c9c96ae2bc">endpos0</a>[m][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] = (<a class="code" href="../../dd/d46/mpidefs_8h.html#a32538d9467c2d5bdd53a1e971bfe5082">mycpupos0</a>[m][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>] + 1) * N[m] - 1;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#ad8a743b126a76557d3fb5ed854da05a6">realtotalzones</a> = <a class="code" href="../../dd/d46/mpidefs_8h.html#a38e1083345af2cf99e31d941f18b56ad">totalzones</a> = <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[1] * <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[2] * <a class="code" href="../../dd/d46/mpidefs_8h.html#ab3efab8b1f2dffc5907e0b0a5aa3988f">totalsize</a>[3];</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#a8f9765a5f8db517e07e42f6811b24744">realtotalcompzones</a>=<a class="code" href="../../dd/d46/mpidefs_8h.html#ad8a743b126a76557d3fb5ed854da05a6">realtotalzones</a>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <a class="code" href="../../dd/d46/mpidefs_8h.html#a0c443ce04d8ec736fe0a47b7cfc87664">itotalzones</a> = <a class="code" href="../../dd/d46/mpidefs_8h.html#a56ae6ba5398c7fcfdb35e2ea9e95cf7f">itotalsize</a>[1] * <a class="code" href="../../dd/d46/mpidefs_8h.html#a56ae6ba5398c7fcfdb35e2ea9e95cf7f">itotalsize</a>[2] * <a class="code" href="../../dd/d46/mpidefs_8h.html#a56ae6ba5398c7fcfdb35e2ea9e95cf7f">itotalsize</a>[3];</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="comment">// output those things that were defined</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor"></span>  logfprintf(<span class="stringliteral">&quot;myid=%d node_name=%s procnamelen=%d\n&quot;</span>,myid,processor_name,<a class="code" href="../../dd/d46/mpidefs_8h.html#a6905a8884f65ce427031a3dfbfd409e4">procnamelen</a>);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor"></span>  trifprintf(<span class="stringliteral">&quot;\nnumprocs(MPI)=%d ncpux1=%d ncpux2=%d ncpux3=%d numopenmpthreads=%d\n&quot;</span>,numprocs,<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>,ncpux2,ncpux3,<a class="code" href="../../dd/d46/mpidefs_8h.html#a96e8ac8e9ae4bd597638862a4f451129">numopenmpthreads</a>);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  trifprintf(<span class="stringliteral">&quot;\n Per MPI Task: N1=%d N2=%d N3=%d\n&quot;</span>,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>,N3);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  logfprintf(<span class="stringliteral">&quot;per: %d %d %d\n&quot;</span>, <a class="code" href="../../dd/d46/mpidefs_8h.html#ab6ed54cec8c2547f4280b86f34426cb5" title="for only grmhd code">periodicx1</a>, <a class="code" href="../../dd/d46/mpidefs_8h.html#a504b3e0d6a16870176bb4555e95642c7">periodicx2</a>, <a class="code" href="../../dd/d46/mpidefs_8h.html#a5e966c43d71ea8ef3cd3fb6e5e4c00d8">periodicx3</a>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">for</span> (m = 1; m &lt;= <a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>; m++) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    logfprintf(<span class="stringliteral">&quot;mycpupos[%d]: %d\n&quot;</span>, m, <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[m]);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    logfprintf( <span class="stringliteral">&quot;startpos[%d]: %d\n&quot;</span>, m, <a class="code" href="../../dd/d46/mpidefs_8h.html#a23649bd7d99c7d81c59db19199e2f11d">startpos</a>[m]);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    logfprintf( <span class="stringliteral">&quot;endpos[%d]: %d\n&quot;</span>, m, <a class="code" href="../../dd/d46/mpidefs_8h.html#ac8b652271c49f5695b50d1345f350176">endpos</a>[m]);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    logfprintf( <span class="stringliteral">&quot;totalsize[%d]: %lld\n&quot;</span>, m, totalsize[m]);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  trifprintf(<span class="stringliteral">&quot;totalzones: %d\n&quot;</span>, <a class="code" href="../../dd/d46/mpidefs_8h.html#a38e1083345af2cf99e31d941f18b56ad">totalzones</a>);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  trifprintf(<span class="stringliteral">&quot;end: init_placeongrid_gridlocation\n&quot;</span>);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;}</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordtype">void</span> init_placeongrid_griddecomposition(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;{</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// 3&#39;s were COMPDIM, but below code is fixed to require all 3 now</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordtype">int</span> stage,stagei,stagef;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, m, l;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordtype">int</span> dir, bti;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordtype">int</span> opp[3*2];</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordtype">int</span> pl,pliter;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordtype">int</span> numbnd[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>],surfa[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>];</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keywordtype">int</span> numnpr;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keywordtype">int</span> gridpos;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  trifprintf(<span class="stringliteral">&quot;begin: init_placeongrid_griddecomposition ... &quot;</span>);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="comment">// standard interior MPI data transfer setup</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++) <span class="keywordflow">for</span>(dir=0;dir&lt;<a class="code" href="../../da/d3e/definit_8h.html#a1b2ef8afddd2c5d91ab65015bbd7b80b" title="NUMBER OF DIMENSIONS FOR COMPUTATION Can choose 3 and still do 1D optimized problems Choosing 2 or ev...">COMPDIM</a>*2;dir++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa996fbb1590e5c250638c3c789757f57">DIRGENNUMVARS</a>;j++){</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=0;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++) <span class="keywordflow">for</span>(dir=0;dir&lt;COMPDIM*2;dir++) <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++) <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#af1e2b8572316b15210c3e543dc0d5eba">DIRLOOPNUMVARS</a>;j++){</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=0;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">// see where this cpu needs to send/recv</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="comment">// set variable grid positions as CENT or STAG</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"></span>  set_primgridpos();</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">// set whether doing particular boundary transfer</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++) { <span class="comment">// same for any bounding type</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>&gt;1){</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="comment">// figure out left/right send/recv</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1] &gt; 0) {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 1;  <span class="comment">// do -x1 dir</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1] &lt; <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a> - 1) {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 1;  <span class="comment">// do +x1 dir</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="comment">// only do periodic mpi if </span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ab6ed54cec8c2547f4280b86f34426cb5" title="for only grmhd code">periodicx1</a>&amp;&amp;(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>&gt;1)){</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]==0) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]==<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>-1) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    }</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="comment">// then no assume boundaries to copy (i.e. can&#39;t have CPU with dimension of length 1 and stack them up -- inefficient anyways)</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 0;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 0;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="comment">// figure out up/down send/recv</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>&gt;1){</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2] &gt; 0) {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 1;  <span class="comment">// -x2 dir</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2] &lt; ncpux2 - 1) {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 1;  <span class="comment">// towards and from +x2 dir</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="comment">// can&#39;t have both periodicx2 and SPC periodicx3      </span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a504b3e0d6a16870176bb4555e95642c7">periodicx2</a>&amp;&amp;(ncpux2&gt;1)){</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==0) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==ncpux2-1) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a67cb78168551d0bd18591a73d82dccf1" title="ENO DEBUG GLOBAL VARS.">special3dspc</a>&amp;&amp;(ncpux3&gt;1)){</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="comment">// non-reflecting, transmissive boundary conditions</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==0) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==ncpux2-1) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="comment">// then no assume boundaries to copy (i.e. can&#39;t have CPU with dimension of length 1 and stack them up -- inefficient anyways)</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 0;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 0;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">// figure out out/in send/recv</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">if</span>(N3&gt;1){</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3] &gt; 0) {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 1;  <span class="comment">// -x3 dir</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3] &lt; ncpux3 - 1) {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 1;  <span class="comment">// towards and from +x3 dir</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a5e966c43d71ea8ef3cd3fb6e5e4c00d8">periodicx3</a>&amp;&amp;(ncpux3&gt;1)){</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]==0) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]==ncpux3-1) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]=1;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      }</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="comment">// then no assume boundaries to copy (i.e. can&#39;t have CPU with dimension of length 1 and stack them up -- inefficient anyways)</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 0;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>] = 0;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="comment">// define which direction the other guy communicates.  Just a simple way to store this obvious fact</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment"></span>  opp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  opp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  opp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  opp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  opp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  opp[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="comment">// set which CPUs communicate to eachother </span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="comment">// same for any method (bti)</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="comment">// In setting up communication, assumes the fastest index is x1 then x2 then x3 as slowest index</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++){</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">for</span>(dir=0;dir&lt;COMPDIM*2;dir++){</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="comment">// sets opposite direction</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a4be8962283e8eec5600f20a58ff091d5">DIROPP</a>]=opp[dir];</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="comment">// matching CPU to transfer to/from</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="comment">// x1</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>)){</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>&gt;1 &amp;&amp;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;           (</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            ((<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]&gt;0)&amp;&amp;(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>-1)) <span class="comment">// interior CPUs</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            || (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>) <span class="comment">// inner-CPUs pointing up</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            || (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]==<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>) <span class="comment">// outer-CPUs pointing down</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            )</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;           ){</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid+1;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid-1;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ab6ed54cec8c2547f4280b86f34426cb5" title="for only grmhd code">periodicx1</a> &amp;&amp; <a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>&gt;1){ <span class="comment">// here X1DN/X1UP are implicitly associated with 0/ncpux1-1</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid+(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>-1);  <span class="comment">// for X1DN</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1]==<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid-(<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>-1); <span class="comment">// for X1UP</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="comment">// x2</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>)){</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">if</span>(ncpux2&gt;1 &amp;&amp;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;           (</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]&gt;0 &amp;&amp; <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]&lt;ncpux2-1) <span class="comment">// interior CPU</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            || (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>) <span class="comment">// exterior CPU connected to interior</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            || (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==ncpux2-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>) <span class="comment">// exterior CPU connected to interior</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            )</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;           ){</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid+<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid-<a class="code" href="../../dd/d46/mpidefs_8h.html#a849af7562e98534cd4ea5764f5187bbd">ncpux1</a>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a504b3e0d6a16870176bb4555e95642c7">periodicx2</a> &amp;&amp; ncpux2&gt;1){</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid+(ncpux2-1)*ncpux1;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==ncpux2-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid-(ncpux2-1)*ncpux1;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a67cb78168551d0bd18591a73d82dccf1" title="ENO DEBUG GLOBAL VARS.">special3dspc</a>&amp;&amp;(ncpux3&gt;1)){</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          <span class="keywordflow">if</span>(ncpux3%2){</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="comment">// must have ncpux3 as even</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;ncpux3=%d must be even for polar transmissive BCs\n&quot;</span>,ncpux3);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            myexit(33676958);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          <span class="comment">// see placeongrid.nb</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;          <span class="comment">// spherical polar wrapping</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          <span class="keywordtype">int</span> othercpupos1 = <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[1];</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;          <span class="keywordtype">int</span> othercpupos2 = <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2];</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;          <span class="keywordtype">int</span> othercpupos3 = (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3] + (int)ncpux3/2)%<a class="code" href="../../dd/d46/mpidefs_8h.html#abde3246ae6acb0425ffe363997b5f835">ncpux3</a>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;          <span class="keywordtype">int</span> othermyid = othercpupos1 + othercpupos2*ncpux1 + othercpupos3*ncpux1*<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>){</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>] = othermyid;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a4be8962283e8eec5600f20a58ff091d5">DIROPP</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>; <span class="comment">// X2DN communicates with X2DN on other CPU</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;          }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==ncpux2-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>){</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>] = othermyid;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a4be8962283e8eec5600f20a58ff091d5">DIROPP</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>; <span class="comment">// X2UP communicates with X2UP on other CPU</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="comment">// x3</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>)){</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">if</span>(ncpux3&gt;1 &amp;&amp;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;           (</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            ((<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]&gt;0)&amp;&amp;(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]&lt;ncpux3-1))</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            || (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            || (<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]==ncpux3-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            )</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;           ){</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid+ncpux1*<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid-ncpux1*<a class="code" href="../../dd/d46/mpidefs_8h.html#a2b69fb4a20e91ae01ef8452216afb784">ncpux2</a>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a5e966c43d71ea8ef3cd3fb6e5e4c00d8">periodicx3</a> &amp;&amp; ncpux3&gt;1){</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid+(ncpux3-1)*ncpux1*ncpux2;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]==ncpux3-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>]=myid-(ncpux3-1)*ncpux1*ncpux2;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="comment">// MPI tags that label transfer, must be unique while doing multiple transfers</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="comment">// Send and Receive tags must match expected communications (Note that first level choice of CPU transfers is choosing which CPUs, but this tag identifies which transfer among all transfers as relevant between those CPUs)</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="comment">// Normally all communications are X1DN (cpu#1) -&gt; X1UP (cpu#2), and likewise.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="comment">// For SPC polar transfer, we have instead X1DN (cpu#1) -&gt; X1DN (cpu#2).  This is accounted for by overriding default DIROPP</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="comment">// send tag (set send tag as base tag identified by current CPU id (myid) and direction pointing out of grid (dir)</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ac43be2a3fc475396fbe1b837de7ec92e">DIRTAGS</a>]= myid     * COMPDIM * 2 + dir;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="comment">// receive tag (must match how send tag set so that receive using send tag according to other CPU)</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ac47a203f5002d630fc0e833514f0aa23">DIRTAGR</a>]= <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2b0707df1844884199fa6e722747007c">DIROTHER</a>] * COMPDIM * 2 + <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a4be8962283e8eec5600f20a58ff091d5">DIROPP</a>];</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="comment">// tags are defined by sender&#39;s ID and direction sent</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="comment">// tag=(myid*COMPDIM*2)+{0,1,2,3,4,5}</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="comment">// 0=right, 1=up,2=left,3=down,4=out,5=in</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="comment">// works/v bc[1=output/2=input][0,1,2,3,4,5]</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="comment">// so sends are like: (sendtoid,myid*COMPDIM*2+?) and recv&#39;s are</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="comment">// like: (fromid,otherid*COMPDIM*2+*) where ? and * are</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      <span class="comment">// opposites(i.e. 0 and 2, 1 and 3, 4 and 5 or non-opposites if doing polar transmissive BCs)</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    }<span class="comment">// end over dir</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  }<span class="comment">// end over bti</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// set transfer sizes</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++){</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="comment">// get number of boundary cells and number of quantities to bound</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment"></span>    set_numbnd(bti, numbnd, &amp;numnpr);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="comment">// loop over directions</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">for</span>(dir=0;dir&lt;COMPDIM*2;dir++){</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <span class="comment">// enter below if doing that particular direction for this CPU</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment"></span>      <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8e7eda9232fcf176561dd68d99529bce">DIRIF</a>]){</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="comment">// set number of variable types to transfer</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment"></span>        <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2eddd9ab5ac3f8f5a8a8b62288b76f89">BOUNDPRIMTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a2d92d15a373d4e19c816cf1e631d4a">BOUNDPRIMSIMPLETYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a27c72ab7c1aed0da90fe96a0c6c3ac36">BOUNDPSTAGTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae8250514c2a764de11180b30e6ee2a67">BOUNDPSTAGSIMPLETYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2df7b4dfa08af2809ff7293c3f6645bd">BOUNDINTTYPE</a> ){</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e7ef897cdcfb9fc01403b9797cc58c3">DIRNUMPR</a>]=NPRBOUND; <span class="comment">// not used if SPLITNPR==1 or doing general range for quantities // not used for BOUNDINTTYPE</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a435fa02094f996d08cfc56b1290c1de2">BOUNDFLUXTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e0d0172132d3c2316bbacd5a577b1c0">BOUNDFLUXSIMPLETYPE</a>){</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e7ef897cdcfb9fc01403b9797cc58c3">DIRNUMPR</a>]=NFLUXBOUND;<span class="comment">// not used if SPLITNPR==1 or doing general range for quantities</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2a10dbc87550637eb2582e022436108d">BOUNDVPOTTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5e5da02b8601cef68e1ed99bf49a52b4">BOUNDVPOTSIMPLETYPE</a>){</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e7ef897cdcfb9fc01403b9797cc58c3">DIRNUMPR</a>]=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2b1fd2d28c6a7d4a3f7027cc1b6466f3">NDIM</a>;<span class="comment">// used</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such bti=%d setup in set number of variable types in mpi_init.c\n&quot;</span>,bti);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          myexit(246346769);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="comment">// set transfer size</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <span class="comment">// surface area must be consistent with loops</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        surfa[1]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>+numbnd[2]*2)*(N3+numbnd[3]*2)*<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a51b48b29d7903bb94a3d7879c3ff8eb9">N1NOT1</a>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        surfa[2]=(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>+numbnd[1]*2)*(N3+numbnd[3]*2)*<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a9d8b7e3d088c68f51e7b29b95326a4ac">N2NOT1</a>;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        surfa[3]=(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>+numbnd[1]*2)*(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>+numbnd[2]*2)*<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#aabbd6bada71f73d78d57d14e9adc0c29">N3NOT1</a>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;           bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2eddd9ab5ac3f8f5a8a8b62288b76f89">BOUNDPRIMTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a2d92d15a373d4e19c816cf1e631d4a">BOUNDPRIMSIMPLETYPE</a></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;           || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a27c72ab7c1aed0da90fe96a0c6c3ac36">BOUNDPSTAGTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae8250514c2a764de11180b30e6ee2a67">BOUNDPSTAGSIMPLETYPE</a></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;           || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2df7b4dfa08af2809ff7293c3f6645bd">BOUNDINTTYPE</a></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;           || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a435fa02094f996d08cfc56b1290c1de2">BOUNDFLUXTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e0d0172132d3c2316bbacd5a577b1c0">BOUNDFLUXSIMPLETYPE</a></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;           || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2a10dbc87550637eb2582e022436108d">BOUNDVPOTTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5e5da02b8601cef68e1ed99bf49a52b4">BOUNDVPOTSIMPLETYPE</a></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;           ){</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;          <span class="comment">// sets size of transfer for primitive</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>)) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a91da5a062a07db57c05ae1df064071eb">DIRSIZE</a>]=numbnd[1]*surfa[1]*numnpr;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>)) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a91da5a062a07db57c05ae1df064071eb">DIRSIZE</a>]=numbnd[2]*surfa[2]*numnpr;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>)) <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a91da5a062a07db57c05ae1df064071eb">DIRSIZE</a>]=numbnd[3]*surfa[3]*numnpr;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="comment">// GODMARK: Why was I doing the below?</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="comment">//      else if(</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="comment">//       ){</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="comment">// // sets size of transfer for fluxes</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment">// // (different for &quot;left&quot; and &quot;right&quot;) for flux-types</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="comment">// if(dir==X1UP) dirgenset[bti][dir][DIRSIZE]=numbnd[1]*surfa[1]*numnpr;</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="comment">// else if(dir==X1DN) dirgenset[bti][dir][DIRSIZE]=(numbnd[1]-1)*surfa[1]*numnpr;</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="comment">// else if(dir==X2UP) dirgenset[bti][dir][DIRSIZE]=numbnd[2]*surfa[2]*numnpr;</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="comment">// else if(dir==X2DN) dirgenset[bti][dir][DIRSIZE]=(numbnd[2]-1)*surfa[2]*numnpr;</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="comment">// else if(dir==X3UP) dirgenset[bti][dir][DIRSIZE]=numbnd[3]*surfa[3]*numnpr;</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="comment">// else if(dir==X3DN) dirgenset[bti][dir][DIRSIZE]=(numbnd[3]-1)*surfa[3]*numnpr;</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="comment">//      }</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;          dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such bti=%d setup in set transfer size in mpi_init.c\n&quot;</span>,bti);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;          myexit(246346770);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      }<span class="comment">// end if DIRIF</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }<span class="comment">// over dir&#39;s</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  }<span class="comment">// end over bti</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="comment">// Below code implements the following mappings:</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="comment">// CENT = centered quantities in the direction of information copying</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="comment">// STAG = staggered on faces (pstag for B^{dir} or fluxes F1 for dir=1, etc.) in direction of information copying</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="comment">// For internal CPU boundary (any i=0..NBND)</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// CENT: 0+i -&gt; N+i  and   N-1-i -&gt; -1-i</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="comment">// STAG: 0+i -&gt; N+i  and   N-1-i -&gt; -1-i (assumes i=N set by first operation)</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="comment">// For periodic BCs  (any i=0..NBND)</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="comment">// Note that same as interior CPU copy</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">// CENT: 0+i -&gt; N+i  and   N-1-i -&gt; -1-i (so lower CPU controls i=0 boundary)</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="comment">// STAG: 0+i -&gt; N+i  and   N-1-i -&gt; -1-i (with i=N set by first operation)</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="comment">// At pole in 3D (for j=0..NBND)</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="comment">// Note copying is in opposite j directions</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="comment">// CENT: 0+j -&gt; -1-j  and   N-1-j -&gt; N+j</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="comment">// STAG: 0+j -&gt; -0-j  and   N-0-j -&gt; N+j</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="comment">// dirloopset[bti] sets limits on all inclusive for loops used in boundmpi.c</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="comment">// In reduced dimensions (i.e. N=1), below reduces to 0 positions,</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="comment">// but above DIRIF&#39;s control whether that direction is bounded or</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="comment">// not and should take care not MPI bounding the reduced dimensions.</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// for reduced dimensions, normal boundary zones are handled by LOOPS defined in global.h</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="comment">// first set BOUNDPRIMTYPE : CENT or FACE1,2,3 quantities that need full bounding</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// BOUNDPRIMSIMPLETYPE as well</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// then set BOUNDINTTYPE : CENT or FACE1,2,3 quantities that need full bounding</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="comment">// set BOUNDFLUXTYPE : FACE(1/2/3) quantities -- used to only bound along flux direction (all that&#39;s needed for ENO to de-average flux using finite difference method)</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">// set BOUNDVPOTTYPE : perp to dir is staggered except A_0</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">// and BOUNDFLUXSIMPLETYPE too</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++){</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2eddd9ab5ac3f8f5a8a8b62288b76f89">BOUNDPRIMTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a2d92d15a373d4e19c816cf1e631d4a">BOUNDPRIMSIMPLETYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a27c72ab7c1aed0da90fe96a0c6c3ac36">BOUNDPSTAGTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae8250514c2a764de11180b30e6ee2a67">BOUNDPSTAGSIMPLETYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2df7b4dfa08af2809ff7293c3f6645bd">BOUNDINTTYPE</a>){</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="comment">// then can stay</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a435fa02094f996d08cfc56b1290c1de2">BOUNDFLUXTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e0d0172132d3c2316bbacd5a577b1c0">BOUNDFLUXSIMPLETYPE</a>){</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">// then can stay</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2a10dbc87550637eb2582e022436108d">BOUNDVPOTTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5e5da02b8601cef68e1ed99bf49a52b4">BOUNDVPOTSIMPLETYPE</a>){</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="comment">// then can stay</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    }</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,<span class="stringliteral">&quot;No such bti=%d defined for dirloopset[]\n&quot;</span>,bti);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      myexit(3468346);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="comment">// get number of boundary cells and number of quantities to bound for this bti</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"></span>    set_numbnd(bti, numbnd, &amp;numnpr);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="comment">// loop over directions</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">for</span>(dir=0;dir&lt;COMPDIM*2;dir++){</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="comment">// enter below if doing that particular direction for this CPU</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment"></span>      <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][dir][DIRIF]){</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="comment">// default factor by which to multiply data</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="comment">// allows simple transformations on MPI copies</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl){</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;          <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][pl]  =1.0;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][pl]=1.0;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;          }</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="comment">// NOTEMARK: Must ensure that # of elements copied is same for PACK and UNPACK (generally numbnd[] BCs in all cases for a given direction along that direction)</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="comment">// PACKING quantities (inclusive range for loops)</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment"></span>        <span class="comment">// zones to copy from (packing -- where to copy FROM)</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>){ <span class="comment">// right</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17a46db197047615bc639131f1d1b484">DIRPSTART1</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1)-(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae6a2e192b4af988fe5bf2b5e09e755bb">DIRPSTOP1</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8de5da20f568d03637a8b617c8decaef">DIRPDIR1</a>]=+1;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17a46db197047615bc639131f1d1b484">DIRPSTART1</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1)-(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae6a2e192b4af988fe5bf2b5e09e755bb">DIRPSTOP1</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8de5da20f568d03637a8b617c8decaef">DIRPDIR1</a>]=+1;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        }</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>){ <span class="comment">// left</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17a46db197047615bc639131f1d1b484">DIRPSTART1</a>]=+0;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae6a2e192b4af988fe5bf2b5e09e755bb">DIRPSTOP1</a>] =+0+(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8de5da20f568d03637a8b617c8decaef">DIRPDIR1</a>]=+1;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17a46db197047615bc639131f1d1b484">DIRPSTART1</a>]=+0;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae6a2e192b4af988fe5bf2b5e09e755bb">DIRPSTOP1</a>] =+0+(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8de5da20f568d03637a8b617c8decaef">DIRPDIR1</a>]=+1;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        }</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){ <span class="comment">// stag and cent same for off-dir directions.  Both are equivalent to CENTGRID</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;          <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>)){</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=0   -numbnd[2];</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+numbnd[2];</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a11570140131dadff8d989cf93608b01e">DIRPSTART3</a>]=0   -numbnd[3];</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa1336aac11cf481be83c8e593fbb7013">DIRPSTOP3</a>] =N3-1+numbnd[3];</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a52eb4a9cbb30fe048a4c5c716d1449f6">DIRPDIR3</a>]=+1;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;          }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="comment">// below also correct for &quot;if(periodicx3&amp;&amp;(ncpux3&gt;1)&amp;&amp;ISSPCMCOORDNATIVE(MCOORD))&quot;</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="comment">// for ISSPC, assumes &quot;j=0&quot; at \theta=0 and &quot;j=N2&quot; at \theta=\pi is copied to other CPUs.</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="comment">// mycpupos[3]&lt;ncpux3/2 CPUs dominate others for polar value of B2, but all consistent in the end!</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="comment">// That should only affect things to machine accuracy since both poles should evolve polar B2 the same.</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="comment">// Note that this special polar copy is unlike was setup, where copied j=0 and j=N2-1 effectively.</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a67cb78168551d0bd18591a73d82dccf1" title="ENO DEBUG GLOBAL VARS.">special3dspc</a>&amp;&amp;(ncpux3&gt;1)&amp;&amp;(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a> || <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==ncpux2-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>) ){</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>){ <span class="comment">// up</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1); <span class="comment">// inverted order</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1)-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>); <span class="comment">//N2-numbnd[2];</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=-1;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            <span class="comment">// mycpupos[3]&lt;ncpux3/2 packs j=N2</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]&lt;ncpux3/2) <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);  <span class="comment">// inverted order // diff compared to non-pole // includes j=N2 right at pole</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="keywordflow">else</span>  <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>)-(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);  <span class="comment">// inverted order // do not pack j=N2 right at pole since will come from matching CPU</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>)-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>); <span class="comment">//N2-numbnd[2];</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=-1;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;            <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;              <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2eddd9ab5ac3f8f5a8a8b62288b76f89">BOUNDPRIMTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a2d92d15a373d4e19c816cf1e631d4a">BOUNDPRIMSIMPLETYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a27c72ab7c1aed0da90fe96a0c6c3ac36">BOUNDPSTAGTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae8250514c2a764de11180b30e6ee2a67">BOUNDPSTAGSIMPLETYPE</a> ){</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                <span class="comment">// at both poles we flip signature of B2 and U2 only</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                <span class="comment">// Here we flip upon packing</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][URAD1]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aacb3eec923047fe7ddf3eda070c600d9">U1</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a811c5fb3555ee81a88dda0fe251a587c" title="used to set sign of U1,B1 across axis">SIGNFLIPU1</a>;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a7b2ff3db09aee589c7ce089458fddeb8">SIGNFLIPB1</a>;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][URAD2]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae907e773ef038f3fc0c2ad5de0cb0f07">U2</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a96b6eb74093f6ef4ae6f50432aa700b4" title="used to set sign of U2,B2 across axis">SIGNFLIPU2</a>;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a96d80311dd16d962e7808e13e1dc9a3e">SIGNFLIPB2</a>;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                <span class="comment">// NOTEMARK: if only interpolate U3 and B3 across pole and not \detg U3 and \detg B3 (with FLIPGDETAXIS==1), then have to flip sign across pole to avoid jump in U3 and B3 at pole.  Then, U3 and B3 will be an extremum and reduce to lower order but not have a dissipation term in the EMF-type flux calculation.</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][URAD3]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8de9104f1fffa59f057b214d74c5cfea">U3</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a65864be6c00f670f41f3798dc4012bc3" title="used to set sign of U3,B3 across axis">SIGNFLIPU3</a>;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ade3016236a1e0ab8d7c30d320474d8e6">SIGNFLIPB3</a>;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;              }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a435fa02094f996d08cfc56b1290c1de2">BOUNDFLUXTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e0d0172132d3c2316bbacd5a577b1c0">BOUNDFLUXSIMPLETYPE</a>){</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                <span class="comment">// process sign while packing</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][pl]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#aaf5ecf596c4e9e516e9fb66d8f4337eb" title="used by mpi_init.c for some bound types to set sign of copy for polar BCs">SIGNFLIPGDET</a>; <span class="comment">// (e.g. gdet T^2_1. Assuming primitives are correct on active domain, then T^2_1 would be opposite signs for continuous flow through pole, but gdet has kink, so product has no kink)</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][URAD2]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae907e773ef038f3fc0c2ad5de0cb0f07">U2</a>]=-SIGNFLIPGDET; <span class="comment">// \detg T^2_2</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>]=-SIGNFLIPGDET; <span class="comment">// Note that F^2_{B2) = 0, so doesn&#39;t matter, but maintain consistency</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][URAD3]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8de9104f1fffa59f057b214d74c5cfea">U3</a>]=-SIGNFLIPGDET; <span class="comment">// \detg T^2_3 is like \detg T^2_2 as far as sign if don&#39;t interpolate \detg U3 and \detg B3 across pole.</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>]=-SIGNFLIPGDET; <span class="comment">// F^2_{B3) like T^2_3 like T^2_2</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                <span class="comment">// No need to handle T^2_3 </span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;              }</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;              else if(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2a10dbc87550637eb2582e022436108d">BOUNDVPOTTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5e5da02b8601cef68e1ed99bf49a52b4">BOUNDVPOTSIMPLETYPE</a>){</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                <span class="comment">// flip while packing</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(pl) <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][pl]=-SIGNFLIPGDET; <span class="comment">// A_1 A_3 : These point in 1 and 3 directions like scalars, but gdet-compressed at pole with kink, so need to unkink</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a085f543ccded0731c1191e9c76a27311">PACK</a>][2]=SIGNFLIPGDET; <span class="comment">// A_2 (points into axis but with gdet, so as if gdet*B2)</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;              }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            }<span class="comment">// end over gridpos</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;          }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;          else if(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>){ <span class="comment">// down</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=0;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =0+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            <span class="comment">// mycpupos[3]&lt;ncpux3/2 packs j=0</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]&lt;ncpux3/2) <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=0; <span class="comment">// includes j=0 right at pole</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="keywordflow">else</span> <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>; <span class="comment">// doesn&#39;t includes j=0 right at pole</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =0+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;          }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        }</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;          <span class="comment">// Old treatment of pole</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>){ <span class="comment">// up</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1)-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>); <span class="comment">//N2-numbnd[2];</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1)-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>); <span class="comment">//N2-numbnd[2];</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1);</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;          }</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>){ <span class="comment">// down</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=0;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =0+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=0;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>] =0+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;          }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){ <span class="comment">// stag and cent same for off-dir directions.  Both are equivalent to CENTGRID</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;          <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>)){</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17a46db197047615bc639131f1d1b484">DIRPSTART1</a>]=-numbnd[1];</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae6a2e192b4af988fe5bf2b5e09e755bb">DIRPSTOP1</a>]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+numbnd[1];</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8de5da20f568d03637a8b617c8decaef">DIRPDIR1</a>]=+1;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a11570140131dadff8d989cf93608b01e">DIRPSTART3</a>]=-numbnd[3];</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa1336aac11cf481be83c8e593fbb7013">DIRPSTOP3</a>]=N3-1+numbnd[3];</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a52eb4a9cbb30fe048a4c5c716d1449f6">DIRPDIR3</a>]=+1;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>){ <span class="comment">// up</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a11570140131dadff8d989cf93608b01e">DIRPSTART3</a>]=(N3-1)-(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>); <span class="comment">//N3-numbnd[3];</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa1336aac11cf481be83c8e593fbb7013">DIRPSTOP3</a>] =(N3-1);</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a52eb4a9cbb30fe048a4c5c716d1449f6">DIRPDIR3</a>]=+1;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a11570140131dadff8d989cf93608b01e">DIRPSTART3</a>]=(N3-1)-(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>); <span class="comment">//N3-numbnd[3];</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa1336aac11cf481be83c8e593fbb7013">DIRPSTOP3</a>] =(N3-1);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a52eb4a9cbb30fe048a4c5c716d1449f6">DIRPDIR3</a>]=+1;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>){ <span class="comment">// down</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a11570140131dadff8d989cf93608b01e">DIRPSTART3</a>]=+0;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa1336aac11cf481be83c8e593fbb7013">DIRPSTOP3</a>] =+0+(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a52eb4a9cbb30fe048a4c5c716d1449f6">DIRPDIR3</a>]=+1;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a11570140131dadff8d989cf93608b01e">DIRPSTART3</a>]=+0;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa1336aac11cf481be83c8e593fbb7013">DIRPSTOP3</a>] =+0+(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a52eb4a9cbb30fe048a4c5c716d1449f6">DIRPDIR3</a>]=+1;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        }</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){ <span class="comment">// stag and cent same for off-dir directions.  Both are equivalent to CENTGRID</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>)){</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a17a46db197047615bc639131f1d1b484">DIRPSTART1</a>]=-numbnd[1];</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae6a2e192b4af988fe5bf2b5e09e755bb">DIRPSTOP1</a>]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+numbnd[1];</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8de5da20f568d03637a8b617c8decaef">DIRPDIR1</a>]=+1;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acb5a3dca947f77d4e00ec4b7ef9fa5fb">DIRPSTART2</a>]=-numbnd[2];</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a53673ba89dc74e3f19e4f2c82cd5c0ce">DIRPSTOP2</a>]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+numbnd[2];</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7113efefb37bb6b37cfe43943444b35d">DIRPDIR2</a>]=+1;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          }</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        }</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        <span class="comment">// UNPACKING quantities</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment"></span>        <span class="comment">// zones to copy into (unpacking -- where to copy INTO)</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="comment">// x1</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>){ <span class="comment">// right</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7b2e56dd79b9315c344d7ec2b085a9c4">DIRUSTART1</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aac58cf26d60eb8bc9de6fdb35b97f03f">DIRUSTOP1</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>)+(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8a2f557dd99a019d77217d151fb5dc78">DIRUDIR1</a>]=+1;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7b2e56dd79b9315c344d7ec2b085a9c4">DIRUSTART1</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aac58cf26d60eb8bc9de6fdb35b97f03f">DIRUSTOP1</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>)+(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8a2f557dd99a019d77217d151fb5dc78">DIRUDIR1</a>]=+1;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        }</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>){ <span class="comment">// left</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7b2e56dd79b9315c344d7ec2b085a9c4">DIRUSTART1</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>-(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;          <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aac58cf26d60eb8bc9de6fdb35b97f03f">DIRUSTOP1</a>] =-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8a2f557dd99a019d77217d151fb5dc78">DIRUDIR1</a>]=+1;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7b2e56dd79b9315c344d7ec2b085a9c4">DIRUSTART1</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>-(numbnd[1]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aac58cf26d60eb8bc9de6fdb35b97f03f">DIRUSTOP1</a>] =-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a2fb146af349ab49ff48fa36b12b9e4fe" title="x1">SHIFT1</a>;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8a2f557dd99a019d77217d151fb5dc78">DIRUDIR1</a>]=+1;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){ <span class="comment">// stag and cent same for off-dir directions.  Both are equivalent to CENTGRID</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;          <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6a3603145c91f722d74610fbd6e4f696" title="----------—&gt; r | 3 | 1-0 | 2 v theta and likewise for 4,5 (4=out,5=in) directions:">X1UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aab7332b2c03d905515d5350d4fd0850f">X1DN</a>)){</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=-numbnd[2];</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+numbnd[2];</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2ac2545bb0b6e7f8838d60cb4b3a18a7">DIRUSTART3</a>]=-numbnd[3];</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a74945a1c94ca68a012956782a809c26f">DIRUSTOP3</a>]=N3-1+numbnd[3];</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e826aaf8a1c786fde826cdb7480e8e1">DIRUDIR3</a>]=+1;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;          }</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="comment">// normal bc has 0,1,2 -&gt; N,N+1,N+2 for both pcent and pstag</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="comment">// for &quot;if(periodicx3&amp;&amp;(ncpux3&gt;1)&amp;&amp;ISSPCMCOORDNATIVE(MCOORD))&quot; below gives: 0,1,2 -&gt; 0,-1,-2 for pstag and 0,1,2 -&gt; -1,-2,-3 for pcent</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <span class="comment">// When inverting v^\theta -&gt; -v^\theta, this effectively inverts order in x2 direction too</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="comment">// x2</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d8/d5b/defs_8general_8h.html#a67cb78168551d0bd18591a73d82dccf1" title="ENO DEBUG GLOBAL VARS.">special3dspc</a>&amp;&amp;(ncpux3&gt;1)&amp;&amp;(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==0 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a> || <a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[2]==ncpux2-1 &amp;&amp; dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>)){</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>){ <span class="comment">// up</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>)+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="comment">// mycpupos[3]&lt;ncpux3/2 packs j=N2,0, so mycpupos[3]&gt;=ncpux3/2 unpacks j=N2,0</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]&lt;ncpux3/2) <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>)+(<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            <span class="keywordflow">else</span> <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>); <span class="comment">// includes from j=N2</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>)+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;          }</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>){ <span class="comment">// down</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>; <span class="comment">// inverted order compared to packing</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            <a class="code" href="../../dd/d46/mpidefs_8h.html#a47f4bdd507d7db220631e3914647bc8a">dirloopset</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=-1;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            <span class="comment">// mycpupos[3]&lt;ncpux3/2 packs j=N2,0, so mycpupos[3]&gt;=ncpux3/2 unpacks j=N2,0</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../dd/d46/mpidefs_8h.html#ac3a964fb7b8404428db52c2588d52381">mycpupos</a>[3]&lt;ncpux3/2) dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>; <span class="comment">// inverted order compared to packing</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            <span class="keywordflow">else</span> dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=-0; <span class="comment">// diff due to pole copy // inverted order compared to packing</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =-0-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=-1;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;              <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2eddd9ab5ac3f8f5a8a8b62288b76f89">BOUNDPRIMTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a5a2d92d15a373d4e19c816cf1e631d4a">BOUNDPRIMSIMPLETYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a27c72ab7c1aed0da90fe96a0c6c3ac36">BOUNDPSTAGTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae8250514c2a764de11180b30e6ee2a67">BOUNDPSTAGSIMPLETYPE</a> ){</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                <span class="comment">// at both poles we flip signature of B2 and U2 only</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                <span class="comment">// Here we flip upon unpacking</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][URAD1]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aacb3eec923047fe7ddf3eda070c600d9">U1</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a811c5fb3555ee81a88dda0fe251a587c" title="used to set sign of U1,B1 across axis">SIGNFLIPU1</a>;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a7b2ff3db09aee589c7ce089458fddeb8">SIGNFLIPB1</a>;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][URAD2]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae907e773ef038f3fc0c2ad5de0cb0f07">U2</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a96b6eb74093f6ef4ae6f50432aa700b4" title="used to set sign of U2,B2 across axis">SIGNFLIPU2</a>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a96d80311dd16d962e7808e13e1dc9a3e">SIGNFLIPB2</a>;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                <span class="comment">// again assumes U3 and B3 interpolated across pole and not \detg U3 and \detg B3</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][URAD3]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8de9104f1fffa59f057b214d74c5cfea">U3</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a65864be6c00f670f41f3798dc4012bc3" title="used to set sign of U3,B3 across axis">SIGNFLIPU3</a>;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>]=<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ade3016236a1e0ab8d7c30d320474d8e6">SIGNFLIPB3</a>;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;              }</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a435fa02094f996d08cfc56b1290c1de2">BOUNDFLUXTYPE</a> || bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a9e0d0172132d3c2316bbacd5a577b1c0">BOUNDFLUXSIMPLETYPE</a>){</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                <span class="comment">// Here we flip upon unpacking</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#ad5ba6b43c072aca55951657f023cbfc3" title="always goes over all conserved">PALLLOOP</a>(pl) <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][pl]=SIGNFLIPGDET; <span class="comment">// gdet T^2_1, so like gdet*B2, and kink avoided if don&#39;t flip sign since B2 standard in active domains with sign change itself in active domains.</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                <span class="comment">// override for symmetric quantities</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][URAD2]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae907e773ef038f3fc0c2ad5de0cb0f07">U2</a>]=-SIGNFLIPGDET; <span class="comment">// \detg T^2_2 , avoid kink must flip sign</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a6945d50f798e1fde624d70c74457090e">B2</a>]=-SIGNFLIPGDET; <span class="comment">// Note that F^2_{B2) = 0, so doesn&#39;t matter, but maintain consistency</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][URAD3]=<a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a8de9104f1fffa59f057b214d74c5cfea">U3</a>]=-SIGNFLIPGDET; <span class="comment">// \detg T^2_3 like \detg T^2_3 if U3&amp;B3 (not \detg U3&amp;B3) interpolated</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ae6ac0edb1e2c9c7672ab9488d8b65be9">B3</a>]=-SIGNFLIPGDET; <span class="comment">// F^2_{B3) like T^2_3 like T^2_2</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;              }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;              else if(bti==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2a10dbc87550637eb2582e022436108d">BOUNDVPOTTYPE</a> || bti==BOUNDVPOTSIMPLETYPE){</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                <span class="comment">// Here we flip upon unpacking</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                <a class="code" href="../../d5/dd8/global_8loops_8perpoint_8h.html#a5f53c1711297fb7345342298fa31396f" title="loop over all Dimensions; first rank loop">DLOOPA</a>(pl) <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][pl]=-SIGNFLIPGDET; <span class="comment">// A_0 A_1 A_3 like scalars, but compressed by gdet.  So flip sign so no kink</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                <a class="code" href="../../dd/d46/mpidefs_8h.html#a96d714740992410424764d66c2d6f09e">primfactor</a>[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#acc6379beb7a0c6a86e2fecbc32c0762b">UNPACK</a>][2]=SIGNFLIPGDET; <span class="comment">// A_2 like gdet B2.  A_2 will have opposite sign across pole in active domains, but gdet + in both, so avoid flipping so that A_2 has no kink at pole.</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;              }</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            }<span class="comment">// end over gridpos</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;          }<span class="comment">// end dir==X2DN</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        }</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        else{</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;          <span class="comment">// Old treatment of pole</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>){ <span class="comment">// up</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>)+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =(<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>)+(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          }</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>){ <span class="comment">// down</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;            gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>-(numbnd[2]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>] =-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#a4601f340e88302d63182d0844c4e3c09" title="x2">SHIFT2</a>;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;          }</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        }</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){ <span class="comment">// stag and cent same for off-dir directions.  Both are equivalent to CENTGRID</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;          <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aa9363649053ac2e906715b3259a14954">X2UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#aae79dca9f851fb40349156f6bca1f8ca">X2DN</a>)){</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7b2e56dd79b9315c344d7ec2b085a9c4">DIRUSTART1</a>]=-numbnd[1];</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aac58cf26d60eb8bc9de6fdb35b97f03f">DIRUSTOP1</a>]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+numbnd[1];</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8a2f557dd99a019d77217d151fb5dc78">DIRUDIR1</a>]=+1;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2ac2545bb0b6e7f8838d60cb4b3a18a7">DIRUSTART3</a>]=-numbnd[3];</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a74945a1c94ca68a012956782a809c26f">DIRUSTOP3</a>]=N3-1+numbnd[3];</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e826aaf8a1c786fde826cdb7480e8e1">DIRUDIR3</a>]=+1;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;          }</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="comment">// x3</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>){ <span class="comment">// up</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2ac2545bb0b6e7f8838d60cb4b3a18a7">DIRUSTART3</a>]=(N3-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a74945a1c94ca68a012956782a809c26f">DIRUSTOP3</a>] =(N3-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>)+(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e826aaf8a1c786fde826cdb7480e8e1">DIRUDIR3</a>]=+1;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2ac2545bb0b6e7f8838d60cb4b3a18a7">DIRUSTART3</a>]=(N3-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a74945a1c94ca68a012956782a809c26f">DIRUSTOP3</a>] =(N3-1+<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>)+(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e826aaf8a1c786fde826cdb7480e8e1">DIRUDIR3</a>]=+1;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        }</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>){ <span class="comment">// down</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a99316f8224999045d33afd6742fff7c8">CENTGRID</a>;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2ac2545bb0b6e7f8838d60cb4b3a18a7">DIRUSTART3</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>-(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a74945a1c94ca68a012956782a809c26f">DIRUSTOP3</a>] =-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e826aaf8a1c786fde826cdb7480e8e1">DIRUDIR3</a>]=+1;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          gridpos=<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a15c33e5e560000ba4194e1878518f951">STAGGRID</a>;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2ac2545bb0b6e7f8838d60cb4b3a18a7">DIRUSTART3</a>]=-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>-(numbnd[3]-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>);</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a74945a1c94ca68a012956782a809c26f">DIRUSTOP3</a>] =-<a class="code" href="../../d1/de6/global_8depmnemonics_8h.html#ac3ff9bd198294b5b3a9c6a22b9cf456a" title="x3">SHIFT3</a>;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;          dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2e826aaf8a1c786fde826cdb7480e8e1">DIRUDIR3</a>]=+1;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        }</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++){ <span class="comment">// stag and cent same for off-dir directions.  Both are equivalent to CENTGRID</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;          <span class="keywordflow">if</span>((dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a55fd86081e74615c36554fed69074cd2">X3UP</a>)||(dir==<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#ada1c40d716a8e3567377cd77831aca10">X3DN</a>)){</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a7b2e56dd79b9315c344d7ec2b085a9c4">DIRUSTART1</a>]=-numbnd[1];</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aac58cf26d60eb8bc9de6fdb35b97f03f">DIRUSTOP1</a>]=<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1+numbnd[1];</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a8a2f557dd99a019d77217d151fb5dc78">DIRUDIR1</a>]=+1;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a2975a8686ef9d53d83d94894f5e66213">DIRUSTART2</a>]=-numbnd[2];</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ae028c116aa878c947de81062c3a8dc67">DIRUSTOP2</a>]=<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1+numbnd[2];</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            dirloopset[bti][dir][gridpos][<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a292bcf24170a8e99269cd8f0bbc15f9b">DIRUDIR2</a>]=+1;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;          }</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        }</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      }<span class="comment">// end if DIRIF</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }<span class="comment">// end DIRLOOP</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  }<span class="comment">// end bti loop</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="comment">// output those things that were defined</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++) {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">for</span> (m = 0; m &lt; COMPDIM*2; m++) {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <span class="keywordflow">for</span>(l = 0 ; l &lt; <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#aa996fbb1590e5c250638c3c789757f57">DIRGENNUMVARS</a> ; l++) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        logfprintf( <span class="stringliteral">&quot;dirgenset[%d][%d][%d]: %d\n&quot;</span>, bti, m, l, <a class="code" href="../../dd/d46/mpidefs_8h.html#a00970536660170f4b06989d265609715">dirgenset</a>[bti][m][l]);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      }</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="keywordflow">for</span>(bti=0;bti&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a23e23fc90f0eb8de16617de14da961d6" title="PURE mnemonics.">NUMBOUNDTYPES</a>;bti++) {</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">for</span> (m = 0; m &lt; COMPDIM*2; m++) {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="keywordflow">for</span>(gridpos=0;gridpos&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a411079df412c66084000a7f761d55646" title="used for primgridpos[]">NUMPRIMGRIDPOS</a>;gridpos++) {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <span class="keywordflow">for</span>(l = 0 ; l &lt; <a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#af1e2b8572316b15210c3e543dc0d5eba">DIRLOOPNUMVARS</a> ; l++) {</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;          logfprintf( <span class="stringliteral">&quot;dirloopset[%d][%d][%d][%d]: %d\n&quot;</span>, bti, m, gridpos, l, dirloopset[bti][m][gridpos][l]);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        }</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      }</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="comment">// Setup supermpi method (not working right now)</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="preprocessor">#if(SIMULBCCALC!=-1)</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="preprocessor"></span>  <span class="comment">// this is definitely not setup for 3D, and never fully worked...still interesting idea.</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a03f1dae933f1317ed8f046b200e4963e">SIMULBCCALC</a>==2){</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a03f1dae933f1317ed8f046b200e4963e">SIMULBCCALC</a>&lt;=0){ stagei=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>; stagef=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#affb13608b845e81f4595b80927fbedbd" title="for various uses (dumping and special boundary/comp interchange routine">STAGEM1</a>; }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a03f1dae933f1317ed8f046b200e4963e">SIMULBCCALC</a>==1) { stagei=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a55cd17c293a7db0ea2fce2d2be563ad8">STAGE0</a>; stagef=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a5b294b2a38519989044561129393a5c3">STAGE2</a>;}</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a03f1dae933f1317ed8f046b200e4963e">SIMULBCCALC</a>==2) { stagei=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#a55cd17c293a7db0ea2fce2d2be563ad8">STAGE0</a>; stagef=<a class="code" href="../../d5/d14/mympi_8global_8nondepmnemonics_8h.html#ac9e39afa6c08127945b21e93f02a63b0">STAGE5</a>;}</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a03f1dae933f1317ed8f046b200e4963e">SIMULBCCALC</a>&gt;=1){</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="keywordflow">for</span>(stage=stagei;stage&lt;=stagef;stage++){</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        STAGECONDITION(0,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1,0,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        logfprintf(<span class="stringliteral">&quot;CZLOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        STAGECONDITION(0,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,-1,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        logfprintf(<span class="stringliteral">&quot;F1LOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        STAGECONDITION(-1,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,0,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        logfprintf(<span class="stringliteral">&quot;F2LOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        STAGECONDITION(0,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,0,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        logfprintf(<span class="stringliteral">&quot;EMFLOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        STAGECONDITION(0,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,0,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>-1,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        logfprintf(<span class="stringliteral">&quot;F1CTLOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        STAGECONDITION(0,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>-1,0,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        logfprintf(<span class="stringliteral">&quot;F2CTLOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        STAGECONDITION(-1,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>,-1,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        logfprintf(<span class="stringliteral">&quot;DQLOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        STAGECONDITION(-2,<a class="code" href="../../da/d3e/definit_8h.html#abd7b39be02bc15d79b73e5cf2b531299" title="#define CORNGDETVERSION 0">N1</a>+1,-2,<a class="code" href="../../da/d3e/definit_8h.html#acd864640121c7df2c19f61f7baa507e4">N2</a>+1,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        logfprintf(<span class="stringliteral">&quot;PREDQLOOP: stage=%d : %d %d %d %d\n&quot;</span>,stage,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ac769548371cfdcb104296aa22811333a" title="int istart, istop, jstart, jstop;">isc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ace42474a807dfc57e99bb79d528b78c0">iec</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa90f6e52a17de1562dcdd726eb291b38">jsc</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a3aac8dc1cb572f01f8f7f5a0de35b76a">jec</a>);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        logfprintf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      }</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    }</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  trifprintf(<span class="stringliteral">&quot;end: init_placeongrid_griddecomposition\n&quot;</span>);</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;}</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="keywordtype">int</span> myexit(<span class="keywordtype">int</span> call_code)</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;{</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>, l;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="keywordtype">int</span> cleanfinish,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a449c39f209cd4f28191bd456f83650e8">dofaildump</a>;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  FILE *faildump;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keywordtype">char</span> mysys[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a3dfbb821cbe7cea4740130fcbbc4a7ab" title="for longer file names">MAXFILENAMELONG</a>];</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="keywordtype">char</span> binarytype[<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a0947c0a3d28c188caa4497cce08539c9" title="maximum char size of filenames or directories or commands">MAXFILENAME</a>];</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d8/d9e/mpi__init_8c.html#a0dfd77e29b6564252a5b13e511c1d68e">set_binarytype</a>(<span class="keywordtype">char</span> *binarytype);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordtype">int</span> inparallel,tid;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  trifprintf(<span class="stringliteral">&quot;proc: %s : Exiting cc: %d nstep: %ld\n&quot;</span>, myidtxt, call_code, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="preprocessor">#if(USEOPENMP)</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span>(omp_in_parallel()){</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    inparallel=1;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    tid=omp_get_thread_num();</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  }</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    tid=0;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    inparallel=0;    </div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  }</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="preprocessor"></span>  tid=0;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  inparallel=0;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordflow">if</span>(tid==0){ <span class="comment">// only 1 thread does below</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="preprocessor">#if(MAILWHENDONE &amp;&amp; !MPIAVOIDFORK)</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(myid==0){</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <a class="code" href="../../d8/d9e/mpi__init_8c.html#a0dfd77e29b6564252a5b13e511c1d68e">set_binarytype</a>(binarytype);</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      sprintf(mysys,<span class="stringliteral">&quot;echo \&quot;%s : done with `pwd`, inparallel=%d\&quot; &gt; done%s.txt&quot;</span>,<a class="code" href="../../da/d3e/definit_8h.html#ab9868b901025a353b28bc3146c5a72b7">EMAILMESSAGE</a>,inparallel,binarytype);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      system(mysys);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d3e/definit_8h.html#a722e9926f0ced1f5ae6bf7e236e1e3a9">MAILFROMREMOTE</a>){</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        sprintf(mysys,<span class="stringliteral">&quot;scp done.txt %s ; ssh %s \&quot;mail %s &lt; done%s.txt\&quot;&quot;</span>,<a class="code" href="../../da/d3e/definit_8h.html#a4cad2d274ecc5941c1e5fef4c64c1477">REMOTEHOST</a>,<a class="code" href="../../da/d3e/definit_8h.html#a4cad2d274ecc5941c1e5fef4c64c1477">REMOTEHOST</a>,<a class="code" href="../../da/d3e/definit_8h.html#a44c751eff66e073283994c1d296b34d4">EMAILADDRESS</a>,binarytype);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        system(mysys);</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      }</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        sprintf(mysys,<span class="stringliteral">&quot;mail %s &lt; done%s.txt&quot;</span>,<a class="code" href="../../da/d3e/definit_8h.html#a44c751eff66e073283994c1d296b34d4">EMAILADDRESS</a>,binarytype);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        system(mysys);</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    }</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    dofaildump=0;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">if</span> (call_code &gt; 0) {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      stderrfprintf(</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                    <span class="stringliteral">&quot;proc: %s : Failure.  Please check failure file: cc: %d\n&quot;</span>,</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                    myidtxt, call_code);</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <span class="keywordflow">if</span>(call_code&lt;<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a2fbdc58f192261834f16a38fdaadca70">ERRORCODEBELOWCLEANFINISH</a>) cleanfinish = 1;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <span class="keywordflow">else</span> cleanfinish=0; <span class="comment">// assume this means dump procedure failed, so don&#39;t get into infinite failure loop</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="comment">// should never have non-clean finish, but sometimes do have them in code, but not marked right now</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">if</span>(cleanfinish) dofaildump=1;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      <span class="keywordflow">if</span>(!cleanfinish){</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="preprocessor"></span>        <span class="comment">// must abort since no clear to communicate to other cpus now</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        MPI_Abort(MPI_COMM_GRMHD, 1);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    }</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      dofaildump=0;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      cleanfinish=1;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    }</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keywordflow">if</span> (dofaildump) {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;proc: %s : dumping failure dump with callcode=2\n&quot;</span>,</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                     myidtxt);</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="comment">// assume want previous timestep data, not bad just-computed</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="comment">// data\n&quot;);</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <span class="comment">// now diag should not fail if last timestep was non-fail type</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5b/defs_8general_8h.html#aac5486df6a846aa6cb47c73202ac0485">DODIAGS</a>) <a class="code" href="../../d3/da1/diag_8c.html#a33d4865bef4d1e548c3d10b3839adf67" title="main diag() call for diagnostics OPENMPNOTE: Assume diag() not called by multiple threads...">diag</a>(<a class="code" href="../../de/d10/global_8nondepmnemonics_8h.html#a08fc657d6f1d0641abaaea4efd2e3759">FINAL_OUT</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>,<a class="code" href="../../d8/d5b/defs_8general_8h.html#a0b92e4d6197989f0f9b0609c8615a46f">realnstep</a>);</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="comment">// first cleanup any prior MPI non-blocking calls by making fake write call</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment"></span><span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(cleanfinish &amp;&amp; <a class="code" href="../../dc/dd8/mympi_8definit_8h.html#a125da10d4f20cf53facb2a408fdc3f52">USEROMIO</a>==1 &amp;&amp; MPIVERSION==2 ){</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      fakedump(0);</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    }</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="comment">// must close AFTER diag()</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment"></span>    <span class="keywordflow">if</span> (call_code &gt;= 0) {</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>) fclose(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>);</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>) fclose(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ab936051f5aaca44c6c3c41dee0d19c36">log_file</a>);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      myfclose(&amp;<a class="code" href="../../d8/d5b/defs_8general_8h.html#aa5d0f5183b267927d3eb00692224be5b">logfull_file</a>,<span class="stringliteral">&quot;Can&#39;t close logfull_file\n&quot;</span>);</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    }</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordflow">if</span>(cleanfinish){</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      stderrfprintf( <span class="stringliteral">&quot;Ending Computation on proc: %s, holding for other cpus\n&quot;</span>, myidtxt);</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    }</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    myfprintf(stderr, <span class="stringliteral">&quot;Ended Computation on all processors\n&quot;</span>);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="comment">//final_myexit(); // Don&#39;t want to Abort if don&#39;t have to</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    stderrfprintf( <span class="stringliteral">&quot;END\n&quot;</span>);</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    fflush(stderr);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    exit(0);</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  }<span class="comment">// end if master thread</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;}</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="preprocessor">#if(PRODUCTION&lt;=1)</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="keywordtype">int</span> error_check(<span class="keywordtype">int</span> wherefrom)</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;{</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>, <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>, <a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  <span class="keywordtype">int</span> errorsend = 0;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="comment">// check if error exists and exit if so</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad4ec5aab9b62fbbe9b8fc2d8ac0a5989">failed</a> &gt; 0) {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                <span class="stringliteral">&quot;Detected failure on proc: %d failed: %d nstep: %ld realnstep: %ld steppart=%d :: t: %21.15g wherefrom = %d\n&quot;</span>,</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                myid, <a class="code" href="../../d8/d5b/defs_8general_8h.html#ad4ec5aab9b62fbbe9b8fc2d8ac0a5989">failed</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0b92e4d6197989f0f9b0609c8615a46f">realnstep</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>,wherefrom);</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  }</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="keywordflow">if</span> (numprocs &gt; 1) {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    errorsend = <a class="code" href="../../d8/d5b/defs_8general_8h.html#ad4ec5aab9b62fbbe9b8fc2d8ac0a5989">failed</a>;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="preprocessor">#if(USEMPI)</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="preprocessor"></span>    <span class="comment">// dualfprintf(fail_file,&quot;wtf: %d %d\n&quot;,errorsend,failed);</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="comment">// fflush(fail_file);</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    MPI_Allreduce(&amp;errorsend, &amp;<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad4ec5aab9b62fbbe9b8fc2d8ac0a5989">failed</a>, 1, MPI_INT, MPI_MAX,</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                  MPI_COMM_GRMHD);</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="comment">// dualfprintf(fail_file,&quot;wtf: %d %d\n&quot;,errorsend,failed);</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="comment">// fflush(fail_file);</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad4ec5aab9b62fbbe9b8fc2d8ac0a5989">failed</a> &gt; 0) {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    dualfprintf(<a class="code" href="../../d8/d5b/defs_8general_8h.html#ad3709a52076ae713f92f3c3fe3ec9255">fail_file</a>,</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                <span class="stringliteral">&quot;Result: Detected failure on proc: %d failed: %d nstep: %ld realnstep: %ld steppart=%d :: t: %21.15g\n&quot;</span>,</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                myid, <a class="code" href="../../d8/d5b/defs_8general_8h.html#ad4ec5aab9b62fbbe9b8fc2d8ac0a5989">failed</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a1a1088d87617078680f1fd0f0d707384">nstep</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a0b92e4d6197989f0f9b0609c8615a46f">realnstep</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#a70170b90229f9fc05eebf8508a685c70">steppart</a>, <a class="code" href="../../d8/d5b/defs_8general_8h.html#ae1ee1e1c83c3f70e2e1afed4f4f5b41e">t</a>);</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="comment">// control behavior of failure here (i.e. could return(1) and</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <span class="comment">// continue or something)</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <span class="comment">// if(failed==1) myexit(1);</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="comment">// if(failed==2) myexit(1);</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="comment">// if(failed==3) myexit(1);</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    myexit(wherefrom);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;}</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="preprocessor">#if(0)</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="preprocessor"></span><span class="keywordtype">void</span> init_MPIgroup(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;{</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="keywordtype">int</span> *ranks;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>,<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>,<a class="code" href="../../d8/da7/structblink.html#a0e05b22a5cb3451447ca2fa5147b009b">k</a>,numranks;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="comment">// allocate things that are truenumprocs in size</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  ranks=(<span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*<a class="code" href="../../dd/d46/mpidefs_8h.html#a1c9efb2d71bf0c79908cb56124f3e412">truenumprocs</a>);</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <span class="keywordflow">if</span>(ranks==NULL){</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;Problem allocating memory for ranks with truenumprocs=%d\n&quot;</span>,<a class="code" href="../../dd/d46/mpidefs_8h.html#a1c9efb2d71bf0c79908cb56124f3e412">truenumprocs</a>); fflush(stderr);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    myexit(915213756);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  }</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  MPI_Comm_group(MPI_COMM_WORLD, &amp;MPI_GROUP_WORLD);</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  stderrfprintf(<span class="stringliteral">&quot;begin: proc: %s init_MPIgroup\n&quot;</span>,myidtxt); fflush(stderr);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="comment">// x1-inner</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  j=0;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="keywordflow">if</span>(i%ncpux1==0){</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      ranks[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=MPIid[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      j++;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    }</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  }</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  numranks=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="keywordflow">if</span>(numranks!=ncpux2*ncpux3){</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;problem with inner x1-group: numranks: %d ncpux2: %d ncpux3: %d ncpux2*ncpux3: %d\n&quot;</span>,numranks,ncpux2,ncpux3,ncpux2*ncpux3);</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    myexit(97834683);</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="comment">// now ranks holds inner x1 boundary of cpus, and numranks holds number of such ranks</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="comment">// now create group and communicator</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  MPI_Group_incl(MPI_GROUP_WORLD, numranks, ranks, &amp;grprem[2]);</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  MPI_Comm_create(MPI_COMM_WORLD, grprem[2], &amp;combound[2]); </div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="comment">// x1 - outer</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  j=0;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordflow">if</span>(i%ncpux1==ncpux1-1){</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      ranks[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=MPIid[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      j++;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    }</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  }</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  numranks=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">if</span>(numranks!=ncpux2*ncpux3){</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;problem with outer x1-group: numranks: %d ncpux2*ncpux3: %d\n&quot;</span>,numranks,ncpux2*ncpux3);</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    myexit(92787621);</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  }</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="comment">// now create group and communicator</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  MPI_Group_incl(MPI_GROUP_WORLD, numranks, ranks, &amp;grprem[0]);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  MPI_Comm_create(MPI_COMM_WORLD, grprem[0], &amp;combound[0]); </div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="comment">// x2 - inner</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  j=0;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">if</span>((i%(ncpux1*ncpux2))/ncpux1==0){</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      ranks[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=MPIid[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      j++;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    }</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  numranks=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  <span class="keywordflow">if</span>(numranks!=ncpux1*ncpux3){</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;problem with inner x2-group: numranks: %d ncpux1*ncpux3: %d\n&quot;</span>,numranks,ncpux1*ncpux3);</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    myexit(83649545);</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  }</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="comment">// now create group and communicator</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  MPI_Group_incl(MPI_GROUP_WORLD, numranks, ranks, &amp;grprem[1]);</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  MPI_Comm_create(MPI_COMM_WORLD, grprem[1], &amp;combound[1]); </div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="comment">// x2 - outer</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  j=0;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">if</span>((i%(ncpux1*ncpux2))/ncpux1==ncpux2-1){</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      ranks[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=MPIid[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      j++;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    }</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  }</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  numranks=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="keywordflow">if</span>(numranks!=ncpux1*ncpux3){</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;problem with outer x2-group: numranks: %d ncpux1*ncpux3: %d\n&quot;</span>,numranks,ncpux1*ncpux3);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    myexit(28364888);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  }</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  <span class="comment">// now create group and communicator</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  MPI_Group_incl(MPI_GROUP_WORLD, numranks, ranks, &amp;grprem[3]);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  MPI_Comm_create(MPI_COMM_WORLD, grprem[3], &amp;combound[3]); </div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="comment">// x3 - inner</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  j=0;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordflow">if</span>(i/(ncpux1*ncpux2)==0){</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      ranks[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=MPIid[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      j++;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  }</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  numranks=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  <span class="keywordflow">if</span>(numranks!=ncpux1*ncpux2){</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;problem with inner x3-group: numranks: %d ncpux1*ncpux2: %d\n&quot;</span>,numranks,ncpux1*ncpux2);</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    myexit(18758365);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  }</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="comment">// now create group and communicator</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  MPI_Group_incl(MPI_GROUP_WORLD, numranks, ranks, &amp;grprem[5]);</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  MPI_Comm_create(MPI_COMM_WORLD, grprem[5], &amp;combound[5]); </div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="comment">// x3 - outer</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  j=0;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../dd/d46/mpidefs_8h.html#a31bfe068640b411bea3df0d69177ded5">numprocs</a>;i++){</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <span class="keywordflow">if</span>(i/(ncpux1*ncpux2)==ncpux3-1){</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;      ranks[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>]=MPIid[<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#ad21ff679aac3fe28202c6d592eafd3e6">i</a>];</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;      j++;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    }</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  }</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  numranks=<a class="code" href="../../d0/ddc/datadesc__mb09_8txt.html#a89e3d6451dccc75ffa4e5f4e6e774b69">j</a>;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="keywordflow">if</span>(numranks!=ncpux1*ncpux2){</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    stderrfprintf(<span class="stringliteral">&quot;problem with outer x3-group: numranks: %d ncpux1*ncpux2: %d\n&quot;</span>,numranks,ncpux1*ncpux2);</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    myexit(29776546);</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  }</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="comment">// now create group and communicator</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  MPI_Group_incl(MPI_GROUP_WORLD, numranks, ranks, &amp;grprem[4]);</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  MPI_Comm_create(MPI_COMM_WORLD, grprem[4], &amp;combound[4]); </div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  free(ranks);</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <span class="comment">// 0: right 1: up 2: left 3: down 4: out 5: in(as in bound.c)</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="comment">// when using these communicators, must make sure the call to a communication using it isn&#39;t done by a non-member cpu!</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="comment">// (above: stupid, I know, should just skip if non-member cpu tries a function)</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  stderrfprintf(<span class="stringliteral">&quot;end: proc: %s init_MPIgroup\n&quot;</span>,myidtxt); fflush(stderr);</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;}</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment">// Environment variables (in bash, set like: export &lt;variable&gt;=&lt;value&gt; )</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">// OMP_SCHEDULE : Which schedule method is set (e.g. export OMP_SCHEDULE=&quot;guided, 4&quot;)</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">// OMP_NUM_THREADS : Sets the maximum number of threads to use during execution (e.g. export OMP_NUM_THREADS=8)</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment">// OMP_DYNAMIC :  Enables or disables dynamic adjustment of the number of threads available for execution of parallel regions. Valid values are TRUE or FALSE. (e.g. export OMP_DYNAMIC=TRUE )</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">// OMP_NESTED : Enables or disables nested parallelism. Valid values are TRUE or FALSE. (e.g. export OMP_NESTED=TRUE )</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">//   Implementation notes:        * Your implementation may or may not support nested parallelism and/or dynamic threads. If nested parallelism is supported, it is often only nominal, in that a nested parallel region may only have one thread.  * Consult your implementation&#39;s documentation for details - or experiment and find out for yourself if you can&#39;t find it in the documentation. </span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">// OMP_STACKSIZE    New with OpenMP 3.0. Controls the size of the stack for created (non-Master) threads. Examples:</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">//    setenv OMP_STACKSIZE 2000500B</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">//    setenv OMP_STACKSIZE &quot;3000 k &quot;</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">//    setenv OMP_STACKSIZE 10M</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">//    setenv OMP_STACKSIZE &quot; 10 M &quot;</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment">//    setenv OMP_STACKSIZE &quot;20 m &quot;</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">//    setenv OMP_STACKSIZE &quot; 1G&quot;</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">//    setenv OMP_STACKSIZE 20000</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">// Default is about 4-8MB on modern systems.</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">// OMP_WAIT_POLICY     New with OpenMP 3.0. Provides a hint to an OpenMP implementation about the desired behavior of waiting threads. A compliant OpenMP implementation may or may not abide by the setting of the environment variable. Valid values are ACTIVE and PASSIVE. ACTIVE specifies that waiting threads should mostly be active, i.e., consume processor cycles, while waiting. PASSIVE specifies that waiting threads should mostly be passive, i.e., not consume processor cycles, while waiting. The details of the ACTIVE and PASSIVE behaviors are implementation defined. Examples:</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">//    setenv OMP_WAIT_POLICY ACTIVE</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">//    setenv OMP_WAIT_POLICY active</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment">//    setenv OMP_WAIT_POLICY PASSIVE</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">//    setenv OMP_WAIT_POLICY passive</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">//OMP_MAX_ACTIVE_LEVELS    New with OpenMP 3.0. Controls the maximum number of nested active parallel regions. The value of this environment variable must be a non-negative integer. The behavior of the program is implementation defined if the requested value of OMP_MAX_ACTIVE_LEVELS is greater than the maximum number of nested active parallel levels an implementation can support, or if the value is not a non-negative integer. Example:</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">//   setenv OMP_MAX_ACTIVE_LEVELS 2</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">// OMP_THREAD_LIMIT   New with OpenMP 3.0. Sets the number of OpenMP threads to use for the whole OpenMP program. The value of this environment variable must be a positive integer. The behavior of the program is implementation defined if the requested value of OMP_THREAD_LIMIT is greater than the number of threads an implementation can support, or if the value is not a positive integer. Example:</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">//   setenv OMP_THREAD_LIMIT 8 </span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">// To enable OpenMP:</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">// Compiler  Flag</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment"></span><span class="comment">// IBM          -qsmp=omp</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">// Intel  -openmp</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">// PathScale  -mp</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">// PGI          -mp</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">// GNU          -fopenmp</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div>
<div class="line"><a name="l01901"></a><span class="lineno"><a class="code" href="../../d5/dda/mympi_8global_8funcdeclare_8h.html#a3ac6ee7dba854e52e67e97b11645f705"> 1901</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/d9e/mpi__init_8c.html#a3ac6ee7dba854e52e67e97b11645f705" title="just copied from pnmhd code">get_report_openmp_thread_info</a>(FILE * out)</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;{</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="keywordtype">int</span> tid;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="preprocessor">#if(USEOPENMP) // need inside cpp conditional since using OpenMP functions, not just directives.</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="preprocessor">#pragma omp parallel private(tid)</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="comment">// Obtain and print thread id</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    fprintf(out,<span class="stringliteral">&quot;proc: %d : Thread = %d activated\n&quot;</span>, myid,omp_get_thread_num());</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    tid = omp_get_thread_num();</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="keywordflow">if</span> (tid == 0){</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;      <span class="comment">// Only master thread does this</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      <a class="code" href="../../dd/d46/mpidefs_8h.html#af305d5203d4e80d6e1c7542125aa2506">numopenmpthreadsorig</a> = omp_get_num_threads();</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="preprocessor">#if(OPENMPVERSION==3)</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="preprocessor"></span>      fprintf(out,<span class="stringliteral">&quot;OpenMP 3.0 activated: Maximum number of threads available=%d\n&quot;</span>,omp_get_thread_limit());</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      fprintf(out,<span class="stringliteral">&quot;Master MPI proc=%d reports: Number of threads originaly=%d out of maximum=%d out of procs=%d\n&quot;</span>, myid, <a class="code" href="../../dd/d46/mpidefs_8h.html#af305d5203d4e80d6e1c7542125aa2506">numopenmpthreadsorig</a>,omp_get_max_threads(),omp_get_num_procs());</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">if</span>(omp_get_dynamic()){</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        fprintf(out,<span class="stringliteral">&quot;Dynamic thread adjustment is enabled\n&quot;</span>);</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        fprintf(out,<span class="stringliteral">&quot;Dynamic thread adjustment is disabled\n&quot;</span>);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="comment">// Use omp_set_nested() to enable if desired</span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      <span class="keywordflow">if</span>(omp_get_nested()){</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        fprintf(out,<span class="stringliteral">&quot;Nested parallelism is enabled, so allowed\n&quot;</span>);</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      }</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        fprintf(out,<span class="stringliteral">&quot;Nested parallelism is disabled, so is NOT allowed\n&quot;</span>);</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      }</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      <span class="comment">// Note that when numopenmpthreads is requested in the next parallel region, all threads will have the value since the numopenmpthreads value is shared.</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    }</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  }<span class="comment">// end parallel region</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;}</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 20 2016 15:52:34 for HARM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
